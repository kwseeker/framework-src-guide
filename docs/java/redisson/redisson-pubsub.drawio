<mxfile host="Electron" modified="2024-05-05T15:55:54.885Z" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/21.6.5 Chrome/114.0.5735.243 Electron/25.3.1 Safari/537.36" etag="fsQn1Mfpu1U9j1Nxkn3z" version="21.6.5" type="device">
  <diagram id="C5RBs43oDa-KdzZeNtuy" name="Redisson订阅发布">
    <mxGraphModel dx="4297" dy="606" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-1" parent="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="kTrK8HJ409_ic4VhHYPP-47" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-46" target="kD-OWUimEQ-q8hTlTrfe-0" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3980" y="4140" />
              <mxPoint x="3980" y="4050" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="WIyWlLk6GJQsqaUBKTNV-3" target="I3S7IV9glcu-AFgagqgy-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-14" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="WIyWlLk6GJQsqaUBKTNV-3" target="I3S7IV9glcu-AFgagqgy-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-3" value="Config配置对象初始化" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="40" y="2160" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-0" value="&lt;h1&gt;Redisson 订阅/发布原理（3.29.0）&lt;/h1&gt;&lt;div&gt;Redisson 订阅/发布封装原理实现其实很简单，下面逻辑看上去复杂，其实大部分篇幅是在讲Redisson客户端连接管理逻辑&lt;/div&gt;&lt;p&gt;前置知识：&lt;br&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Redisson Future 模式，&lt;font color=&quot;#007fff&quot;&gt;RFuture、RPromise， 依赖 Netty Promise、JDK CompletableFuture&lt;/font&gt;&lt;/li&gt;&lt;li&gt;Redis RESP 协议，&lt;font color=&quot;#007fff&quot;&gt;Redisson采用Netty连接Redis，并不意味着Redis-Server也必须要用Netty实现服务端，客户端和服务端是分离的，各使用独立的事件回环和处理组件（即client、server可能都是Netty, 也可能只有一端是Netty，只需要做好编解码器能够正确解析双方的通信协议即可）&lt;/font&gt;&amp;nbsp;&lt;/li&gt;&lt;li&gt;Netty 工作流程&lt;br&gt;&lt;br&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="40" y="19" width="920" height="161" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-3" value="end" style="ellipse;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="80" y="3660" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-7" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-4" target="I3S7IV9glcu-AFgagqgy-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-19" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-4" target="I3S7IV9glcu-AFgagqgy-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-4" value="创建连接会话 RedissonClient" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="40" y="2280" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-9" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-6" target="I3S7IV9glcu-AFgagqgy-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-21" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-6" target="I3S7IV9glcu-AFgagqgy-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-6" value="创建消息主题" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="40" y="2860" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-11" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-8" target="I3S7IV9glcu-AFgagqgy-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-23" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-8" target="I3S7IV9glcu-AFgagqgy-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-8" value="往消息主题注册订阅者" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#fff2cc;strokeColor=#d6b656;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="40" y="2980" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-12" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-10" target="I3S7IV9glcu-AFgagqgy-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-25" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-10" target="I3S7IV9glcu-AFgagqgy-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-10" value="发布者往主题发布消息" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#f8cecc;strokeColor=#b85450;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="40" y="3540" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-13" value="new Config" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="240" y="2160" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-29" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-18" target="I3S7IV9glcu-AFgagqgy-28" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-18" value="redisson = Redisson.create(config)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="240" y="2280" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;curved=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-20" target="XNX2Z0ZqCE7KDeMgFk9w-0" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-20" value="topic = redisson.getTopic(...)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="240" y="2860" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-7" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-22" target="XNX2Z0ZqCE7KDeMgFk9w-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-22" value="topic.addListener(&lt;br&gt;Message.class, ...)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="240" y="2980" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-24" target="kTrK8HJ409_ic4VhHYPP-0" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-24" value="topic.publish(&lt;br&gt;new Message())" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="240" y="3540" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-31" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-28" target="I3S7IV9glcu-AFgagqgy-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zKmpKwrjd1G7m23i1Yf6-15" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-28" target="zKmpKwrjd1G7m23i1Yf6-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-28" value="new Redisson(config)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="490" y="2280" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="zKmpKwrjd1G7m23i1Yf6-11" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-30" target="zKmpKwrjd1G7m23i1Yf6-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-30" value="&amp;nbsp;redisson.enableRedissonReferenceSupport()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;看样子是是否支持Redisson分布式对象&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="440" y="2700" width="260" height="40" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-36" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-33" target="I3S7IV9glcu-AFgagqgy-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-33" value="queueTransferService = new &lt;b&gt;QueueTransferService&lt;/b&gt;()&lt;br&gt;liveObjectClassCache = new ConcurrentHashMap&amp;lt;&amp;gt;()&lt;br&gt;responses = new ConcurrentHashMap&amp;lt;&amp;gt;()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;static类初始化，QueueTransferService维护了多组QueueTransferTask，这个任务用于监听消息以及发布消息&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="740" y="2260" width="320" height="80" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-44" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#330000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-35" target="I3S7IV9glcu-AFgagqgy-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-48" value="单机模式" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-35" target="I3S7IV9glcu-AFgagqgy-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-35" value="connectionManager = ConfigSupport.&lt;b&gt;createConnectionManager&lt;/b&gt;(configCopy);&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;根据配置选择的工作模式，创建连接管理器ConnectionManager&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="740" y="2360" width="320" height="50" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-46" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#330000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-43" target="I3S7IV9glcu-AFgagqgy-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-43" value="evictionScheduler = new &lt;b&gt;EvictionScheduler&lt;/b&gt;(&lt;br&gt;connectionManager.getCommandExecutor())&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;包含CommandSyncService引用以及多组EvictionTask&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="740" y="2530" width="320" height="50" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-45" value="writeBehindService = new &lt;b&gt;WriteBehindService&lt;/b&gt;(&lt;br&gt;connectionManager.getCommandExecutor())&lt;br&gt;&lt;font style=&quot;font-size: 11px&quot; color=&quot;#007fff&quot;&gt;包含CommandSyncService引用以及多组MapWriteBehindTask&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="740" y="2610" width="320" height="50" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-50" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-47" target="I3S7IV9glcu-AFgagqgy-49" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-47" value="validate(configCopy.getSingleServerConfig())&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;校验配置的连接池size（默认64）是否大于最小空闲连接数（默认24），否则抛参数异常&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1180" y="2360" width="320" height="50" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-52" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-49" target="I3S7IV9glcu-AFgagqgy-51" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-49" value="new SingleConnectionManager(...)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1180" y="2440" width="320" height="50" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-63" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-51" target="I3S7IV9glcu-AFgagqgy-62" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-51" value="super(create(cfg), config, id)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;调用MasterSlaveConnectionManager &amp;lt;init&amp;gt;&lt;br&gt;除了ClusterConnectionManager，其他都是这个类的子类&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1600" y="2440" width="320" height="50" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-65" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-62" target="I3S7IV9glcu-AFgagqgy-66" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2360" y="2465" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-136" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-62" target="I3S7IV9glcu-AFgagqgy-90" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2150" y="2780" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-62" value="MasterSlaveConnectionManager(Config cfg, UUID id)&amp;nbsp;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;核心是个Netty 客户端&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2000" y="2440" width="300" height="50" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-72" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-66" target="I3S7IV9glcu-AFgagqgy-71" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-73" value="&lt;font style=&quot;font-size: 8px&quot;&gt;TransportMode.KQUEUE&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#007FFF;" parent="I3S7IV9glcu-AFgagqgy-72" vertex="1" connectable="0">
          <mxGeometry x="0.2571" y="-1" relative="1" as="geometry">
            <mxPoint x="-18" y="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-75" value="&lt;font style=&quot;font-size: 8px&quot;&gt;TransportMode.NIO&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-66" target="I3S7IV9glcu-AFgagqgy-74" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-132" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-66" target="I3S7IV9glcu-AFgagqgy-84" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2400" y="2580" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-66" value="cfg&lt;br&gt;.getTransportMode()" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;fontColor=#330000;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2340" y="2425" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-69" value="..." style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2580" y="2380" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-71" value="..." style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2580" y="2445" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-77" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-74" target="I3S7IV9glcu-AFgagqgy-76" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2790" y="2530" />
              <mxPoint x="2790" y="2390" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-74" value="创建Netty NIO 客户端&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;用的Netty 4.1.58&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2580" y="2510" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-70" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;TransportMode.EPOLL&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#330000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-66" target="I3S7IV9glcu-AFgagqgy-69" edge="1">
          <mxGeometry x="0.1795" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2530" y="2465" />
              <mxPoint x="2530" y="2390" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-79" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-76" target="I3S7IV9glcu-AFgagqgy-78" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-76" value="&lt;font style=&quot;font-size: 10px&quot;&gt;this.&lt;b&gt;group&lt;/b&gt; = new &lt;b&gt;NioEventLoopGroup&lt;/b&gt;(&lt;br&gt;cfg.getNettyThreads(), new DefaultThreadFactory(&quot;redisson-netty&quot;))&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2840" y="2360" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-81" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-78" target="I3S7IV9glcu-AFgagqgy-80" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-78" value="&lt;span style=&quot;font-size: 10px&quot;&gt;this.&lt;b&gt;socketChannelClass&lt;/b&gt; = NioSocketChannel.class&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2840" y="2440" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-80" value="&lt;span style=&quot;font-size: 10px&quot;&gt;this.&lt;b&gt;resolverGroup&lt;/b&gt; = cfg.getAddressResolverGroupFactory()&lt;br&gt;.create(NioDatagramChannel.class, DnsServerAddressStreamProviders.platformDefault())&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2820" y="2500" width="260" height="60" as="geometry" />
        </mxCell>
        <mxCell id="zKmpKwrjd1G7m23i1Yf6-0" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-84" target="I3S7IV9glcu-AFgagqgy-86" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-84" value="&lt;span style=&quot;font-size: 10px&quot;&gt;executor = Executors.newFixedThreadPool(threads, new DefaultThreadFactory(&quot;redisson&quot;))&lt;br&gt;&lt;font color=&quot;#cc0066&quot;&gt;这个线程池什么时候用的？&lt;/font&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2270" y="2580" width="260" height="40" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-89" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-86" target="I3S7IV9glcu-AFgagqgy-88" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-86" value="&lt;span style=&quot;font-size: 10px&quot;&gt;this.codec = cfg.getCodec()&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2320" y="2660" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-88" value="&lt;span style=&quot;font-size: 10px&quot;&gt;this.commandExecutor = new CommandSyncService(this)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;从接口方法看是异步传输命令到redis服务端并异步获取执行结果的&lt;/font&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2300" y="2730" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-93" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-90" target="I3S7IV9glcu-AFgagqgy-92" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-95" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-90" target="I3S7IV9glcu-AFgagqgy-94" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-90" value="&lt;span style=&quot;font-size: 10px&quot;&gt;initTimer(cfg)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2070" y="2830" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-110" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-92" target="I3S7IV9glcu-AFgagqgy-109" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-92" value="&lt;span style=&quot;font-size: 10px&quot;&gt;initSingleEntry()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;初始化Redis客户端连接（Netty）&lt;/font&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2070" y="3050" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-97" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-94" target="I3S7IV9glcu-AFgagqgy-96" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-101" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-94" target="I3S7IV9glcu-AFgagqgy-100" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-94" value="&lt;span style=&quot;font-size: 10px&quot;&gt;timer = new HashedWheelTimer(new DefaultThreadFactory(&quot;redisson-timer&quot;), minTimeout, TimeUnit.MILLISECONDS, 1024, false)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2280" y="2820" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-99" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-96" target="I3S7IV9glcu-AFgagqgy-98" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-103" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-96" target="I3S7IV9glcu-AFgagqgy-102" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-96" value="&lt;span style=&quot;font-size: 10px&quot;&gt;connectionWatcher = new IdleConnectionWatcher(this, config)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2280" y="2900" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-105" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-98" target="I3S7IV9glcu-AFgagqgy-104" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-98" value="&lt;span style=&quot;font-size: 10px&quot;&gt;subscribeService = new PublishSubscribeService(this, config)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;创建发布订阅服务&lt;/font&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2280" y="2979" width="240" height="51" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-100" value="&lt;span style=&quot;font-size: 10px&quot;&gt;...&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2560" y="2820" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-102" value="&lt;span style=&quot;font-size: 10px&quot;&gt;...&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2560" y="2900" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-104" value="&lt;span style=&quot;font-size: 10px&quot;&gt;subscribeService = new PublishSubscribeService(this, config)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2560" y="2979" width="240" height="51" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-112" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-109" target="I3S7IV9glcu-AFgagqgy-111" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-124" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-109" target="I3S7IV9glcu-AFgagqgy-123" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-109" value="&lt;span style=&quot;font-size: 10px&quot;&gt;masterSlaveEntry = &lt;b&gt;new SingleEntry&lt;/b&gt;(this, config, null);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;测试中用的单机模式，所以这里初始化的是SingleEntry, 是MasterSlaveEntry的子类&lt;/font&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2280" y="3040" width="201" height="60" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-114" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-111" target="I3S7IV9glcu-AFgagqgy-113" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-118" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-111" target="I3S7IV9glcu-AFgagqgy-117" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-111" value="&lt;span style=&quot;font-size: 10px&quot;&gt;slaveBalancer = new LoadBalancerManager(config, connectionManager, this)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;从节点负载均衡&lt;/font&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2520" y="3040" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-116" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-113" target="I3S7IV9glcu-AFgagqgy-115" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-113" value="&lt;span style=&quot;font-size: 10px&quot;&gt;&amp;nbsp;writeConnectionPool = new MasterConnectionPool(config, connectionManager, this);&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2520" y="3140" width="180" height="50" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-115" value="&lt;span style=&quot;font-size: 10px&quot;&gt;pubSubConnectionPool = new MasterPubSubConnectionPool(config, connectionManager, this)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2520" y="3220" width="180" height="50" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-120" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-117" target="I3S7IV9glcu-AFgagqgy-119" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-122" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-117" target="I3S7IV9glcu-AFgagqgy-121" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-117" value="&lt;span style=&quot;font-size: 10px&quot;&gt;slaveConnectionPool = new SlaveConnectionPool(config, connectionManager, entry)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2740" y="3050" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-119" value="&lt;span style=&quot;font-size: 10px&quot;&gt;pubSubConnectionPool = new PubSubConnectionPool(config, connectionManager, entry)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2740" y="3110" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-121" value="&lt;span style=&quot;font-size: 10px&quot;&gt;ConnectionPool#&amp;lt;init&amp;gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2960" y="3050" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-126" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-123" target="I3S7IV9glcu-AFgagqgy-125" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;curved=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-123" target="Uo9Mz0LOmQ8xmQJM_pjb-0" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-123" value="&lt;span style=&quot;font-size: 10px&quot;&gt;RFuture&amp;lt;RedisClient&amp;gt; masterFuture = masterSlaveEntry.&lt;b&gt;setupMasterEntry&lt;/b&gt;(new RedisURI(config.getMasterAddress()))&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2280" y="3310" width="199.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-128" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-125" target="I3S7IV9glcu-AFgagqgy-127" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-125" value="&lt;span style=&quot;font-size: 10px&quot;&gt;masterFuture.syncUninterruptibly()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;同步阻塞等待上一步setup完成，异常结束就关闭客户端，正常结束就什么都不做&lt;/font&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2280.5" y="3610" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-57" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;strokeColor=#330000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="I3S7IV9glcu-AFgagqgy-127" target="Uo9Mz0LOmQ8xmQJM_pjb-56" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I3S7IV9glcu-AFgagqgy-127" value="&lt;font style=&quot;font-size: 10px&quot;&gt;masterSlaveEntry.initSlaveBalancer(...)&lt;br&gt;future.syncUninterruptibly()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;大概是同步阻塞等待所有从节点连接建立完成，&lt;br&gt;测试中是单节点不会走这步，先略&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2261" y="3740" width="239.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="zKmpKwrjd1G7m23i1Yf6-2" value="命令执行器" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2220" y="2750" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="zKmpKwrjd1G7m23i1Yf6-13" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="zKmpKwrjd1G7m23i1Yf6-10" target="zKmpKwrjd1G7m23i1Yf6-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zKmpKwrjd1G7m23i1Yf6-10" value="&lt;font style=&quot;font-size: 11px&quot;&gt;new &lt;b&gt;RedissonObjectBuilder&lt;/b&gt;(config, redisson, redissonReactive, redissonRx)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="770" y="2700" width="260" height="40" as="geometry" />
        </mxCell>
        <mxCell id="zKmpKwrjd1G7m23i1Yf6-12" value="&lt;font style=&quot;font-size: 10px&quot;&gt;codecProvider = objectBuilder.getReferenceCodecProvider()&lt;br&gt;codecProvider.registerCodec((Class&amp;lt;Codec&amp;gt;) codec.getClass(), codec)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;注册编解码器&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="755" y="2770" width="290" height="60" as="geometry" />
        </mxCell>
        <mxCell id="zKmpKwrjd1G7m23i1Yf6-16" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="zKmpKwrjd1G7m23i1Yf6-14" target="I3S7IV9glcu-AFgagqgy-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zKmpKwrjd1G7m23i1Yf6-14" value="new Config(config)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;额外补充了个默认属性：编解码器 new MarshallingCodec()&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="770" y="2180" width="260" height="50" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-0" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;new RedissonTopic(codec, this.connectionManager.getCommandExecutor(), name)&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;commandExecutor、subscribeService都是从connectionManager取的，codec是新建的&lt;/font&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;SerializationCodec&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="440" y="2850" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-9" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-6" target="XNX2Z0ZqCE7KDeMgFk9w-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-13" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-6" target="XNX2Z0ZqCE7KDeMgFk9w-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-6" value="&lt;font style=&quot;font-size: 10px&quot;&gt;RFuture&amp;lt;Integer&amp;gt; future = addListenerAsync(type, (MessageListener&amp;lt;M&amp;gt;) listener)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#fff2cc;strokeColor=#d6b656;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="480" y="2980" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-11" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-8" target="XNX2Z0ZqCE7KDeMgFk9w-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-8" value="&lt;font style=&quot;font-size: 10px&quot;&gt;commandExecutor.syncSubscription(future)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;同步等待成功注册监听器&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="470" y="3100" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-10" value="&lt;font style=&quot;font-size: 10px&quot;&gt;future.getNow()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;返回PubSubConnectionEntry&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="480" y="3180" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-15" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-12" target="XNX2Z0ZqCE7KDeMgFk9w-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-12" value="&lt;font style=&quot;font-size: 10px&quot;&gt;pubSubListener = new PubSubMessageListener&amp;lt;&amp;gt;(type, listener, name)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;将MessageListener重新封装成PubSubMessageListener&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="720" y="2970" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-17" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-14" target="XNX2Z0ZqCE7KDeMgFk9w-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-14" value="&lt;font style=&quot;font-size: 10px&quot;&gt;addListenerAsync(pubSubListener)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="740" y="3050" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-19" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-16" target="XNX2Z0ZqCE7KDeMgFk9w-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-16" value="&lt;font style=&quot;font-size: 10px&quot;&gt;future = &lt;b&gt;subscribeService&lt;/b&gt;.subscribe(codec, channelName, pubSubListener)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#fff2cc;strokeColor=#d6b656;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="980" y="3050" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-21" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-18" target="XNX2Z0ZqCE7KDeMgFk9w-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-18" value="&lt;span style=&quot;font-size: 10px&quot;&gt;promise = new RedissonPromise&amp;lt;&amp;gt;()&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1220" y="3050" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-23" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-20" target="XNX2Z0ZqCE7KDeMgFk9w-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-20" value="&lt;span style=&quot;font-size: 10px&quot;&gt;lock = getSemaphore(channelName)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1220" y="3110" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-25" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-22" target="XNX2Z0ZqCE7KDeMgFk9w-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-22" value="&lt;span style=&quot;font-size: 10px&quot;&gt;lock.acquire() start&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1220" y="3170" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-27" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-24" target="XNX2Z0ZqCE7KDeMgFk9w-26" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-31" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-24" target="XNX2Z0ZqCE7KDeMgFk9w-30" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1440" y="3240" />
              <mxPoint x="1440" y="3070" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-24" value="&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;subscribe&lt;/b&gt;(codec, channelName, promise, type, lock, listeners)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#fff2cc;strokeColor=#d6b656;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1220" y="3210" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-29" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-26" target="XNX2Z0ZqCE7KDeMgFk9w-28" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-26" value="&lt;span style=&quot;font-size: 10px&quot;&gt;lock.acquire() end&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1220" y="3270" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-28" value="&lt;span style=&quot;font-size: 10px&quot;&gt;return promise&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1220" y="3310" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-43" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-30" target="XNX2Z0ZqCE7KDeMgFk9w-42" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-30" value="&lt;span style=&quot;font-size: 10px&quot;&gt;connEntry = &lt;b&gt;name2PubSubConnection&lt;/b&gt;.get(channelName)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1460" y="3050" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-32" value="&lt;span style=&quot;font-size: 10px&quot;&gt;addListeners(channelName, promise, type, lock, connEntry, listeners)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1720" y="3120" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-37" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-34" target="XNX2Z0ZqCE7KDeMgFk9w-36" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-34" value="&lt;span style=&quot;font-size: 10px&quot;&gt;freePubSubLock.acquire() 加锁同步执行&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;将RedisPubSubListener重新封装成&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;注册任务加入freePubSubLock&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;任务队列&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1460" y="3200" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-39" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-36" target="XNX2Z0ZqCE7KDeMgFk9w-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-41" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-36" target="XNX2Z0ZqCE7KDeMgFk9w-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-36" value="run()&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;执行封装后的注册任务&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1460" y="3280" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-38" value="&lt;span style=&quot;font-size: 10px&quot;&gt;freePubSubLock 解锁&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1460" y="3340" width="220" height="20" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-47" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-40" target="XNX2Z0ZqCE7KDeMgFk9w-46" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1820" y="3410" />
              <mxPoint x="1080" y="3410" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-49" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-40" target="XNX2Z0ZqCE7KDeMgFk9w-48" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2060" y="3300" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-40" value="Queue&amp;lt;PubSubConnectionEntry&amp;gt; freePubSubConnections = &lt;b&gt;getConnectionsQueue&lt;/b&gt;(channelName)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;二重检查：重新获取此信道的连接队列&lt;br&gt;刚开始为空，下面会创建新的发布订阅连接&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;glass=0;strokeWidth=1;shadow=0;fillColor=#fff2cc;strokeColor=#d6b656;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1720" y="3270" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-44" value="Y" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-42" target="XNX2Z0ZqCE7KDeMgFk9w-32" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-45" value="N" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-42" target="XNX2Z0ZqCE7KDeMgFk9w-34" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-42" value="connEntry != null&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;刚开始是null&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;rounded=1;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1510" y="3120" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-24" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-46" target="kD-OWUimEQ-q8hTlTrfe-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-46" value="&lt;b&gt;connect&lt;/b&gt;(codec, channelName, promise, type, lock, listeners)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;创建新的发布订阅连接&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="980" y="3460" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-51" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="XNX2Z0ZqCE7KDeMgFk9w-48" target="XNX2Z0ZqCE7KDeMgFk9w-50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-48" value="slot = connectionManager&lt;br&gt;.calcSlot(channelName.getName())" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1960" y="3280" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="XNX2Z0ZqCE7KDeMgFk9w-50" value="MasterSlaveEntry entry = connectionManager.getEntry(slot)&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;获取slot对应Redis服务节点的连接信息，除了集群模式，slot并没有意义，其他模式都是返回一个固定的MasterSlaveEntry&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1940" y="3360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-0" target="Uo9Mz0LOmQ8xmQJM_pjb-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-0" target="Uo9Mz0LOmQ8xmQJM_pjb-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-0" value="&lt;span style=&quot;font-size: 10px&quot;&gt;connectionManager.createClient(&lt;br&gt;NodeType.MASTER, address, sslHostname)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2520" y="3320" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;curved=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-2" target="Uo9Mz0LOmQ8xmQJM_pjb-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-2" value="&lt;span style=&quot;font-size: 10px&quot;&gt;setupMasterEntry(client)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2520" y="3540" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-4" target="Uo9Mz0LOmQ8xmQJM_pjb-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-4" value="&lt;span style=&quot;font-size: 10px&quot;&gt;createRedisConfig(type, address, timeout, commandTimeout, sslHostname)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;创建RedisClientConfig, 里面最重要的就是Netty连接配置&lt;/font&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2740" y="3310" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-6" value="&lt;span style=&quot;font-size: 10px&quot;&gt;RedisClient.create(redisConfig)&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;主要工作就是&lt;b&gt;启动Netty客户端&lt;/b&gt;，启动了两个：一个&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;Type.PLAIN， 一个Type.PUBSUB&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2735" y="3390" width="210" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-29" value="异常结束" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-10" target="Uo9Mz0LOmQ8xmQJM_pjb-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-32" value="正常结束" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-10" target="Uo9Mz0LOmQ8xmQJM_pjb-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-44" style="edgeStyle=entityRelationEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;shape=link;elbow=vertical;strokeColor=#97D077;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-10" target="Uo9Mz0LOmQ8xmQJM_pjb-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-10" value="&lt;b style=&quot;font-size: 10px&quot;&gt;RFuture&amp;lt;InetSocketAddress&amp;gt; &lt;/b&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;addrFuture = client.&lt;/span&gt;&lt;b style=&quot;font-size: 10px&quot;&gt;resolveAddr&lt;/b&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;()&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;addrFuture.onComplete(...)&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;resolvedAddr创建完成即刻触发&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2840" y="3530" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-17" value="触发" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontColor=#007FFF;curved=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-14" target="Uo9Mz0LOmQ8xmQJM_pjb-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-14" value="&lt;span style=&quot;font-size: 10px&quot;&gt;result.tryFailure(e)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3090" y="3450" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-19" value="异常" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-16" target="Uo9Mz0LOmQ8xmQJM_pjb-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-16" value="&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;RPromise&amp;lt;RedisClient&amp;gt;&lt;/b&gt; result = new RedissonPromise&amp;lt;RedisClient&amp;gt;();&lt;br&gt;result.onComplete(...)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3190" y="3530" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-18" value="&lt;span style=&quot;font-size: 10px&quot;&gt;client.shutdownAsync()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;关闭客户端连接&lt;/font&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3510" y="3540" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-24" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-21" target="Uo9Mz0LOmQ8xmQJM_pjb-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-21" value="&lt;span style=&quot;font-size: 10px&quot;&gt;masterEntry = new ClientConnectionsEntry()&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3090" y="3630" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-28" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-23" target="Uo9Mz0LOmQ8xmQJM_pjb-27" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-31" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-23" target="Uo9Mz0LOmQ8xmQJM_pjb-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-61" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#97D077;curved=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-23" target="Uo9Mz0LOmQ8xmQJM_pjb-58" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3300" y="3770" />
              <mxPoint x="3300" y="3960" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-23" value="&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;RFuture&amp;lt;Void&amp;gt; &lt;/b&gt;writeFuture = writeConnectionPool.&lt;b&gt;add&lt;/b&gt;(masterEntry);&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;writeFuture.onComplete(listener)&lt;br&gt;&lt;font color=&quot;#cc0066&quot;&gt;哪里触发？&lt;/font&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3080" y="3710" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-33" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-27" target="Uo9Mz0LOmQ8xmQJM_pjb-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-62" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#97D077;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-27" target="Uo9Mz0LOmQ8xmQJM_pjb-58" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-27" value="&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;RFuture&amp;lt;Void&amp;gt;&lt;/b&gt; pubSubFuture = pubSubConnectionPool.&lt;b&gt;add&lt;/b&gt;(masterEntry);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;pubSubFuture.onComplete(listener)&lt;br&gt;&lt;font color=&quot;#cc0066&quot;&gt;哪里触发？&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3080" y="3810" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-34" value="异常结束" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-30" target="Uo9Mz0LOmQ8xmQJM_pjb-39" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3530" y="3790" />
              <mxPoint x="3530" y="3740" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-36" value="正常结束" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-30" target="Uo9Mz0LOmQ8xmQJM_pjb-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-30" value="CountableListener#accept()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3320" y="3770" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-38" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-35" target="Uo9Mz0LOmQ8xmQJM_pjb-37" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-35" value="&amp;nbsp;decCounter()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3570" y="3820" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-41" value="&lt;font color=&quot;#007fff&quot;&gt;触发&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;fontSize=9;fontColor=#CC0066;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-37" target="Uo9Mz0LOmQ8xmQJM_pjb-16" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="3310" y="3590" as="targetPoint" />
            <Array as="points">
              <mxPoint x="3800" y="3650" />
              <mxPoint x="3310" y="3650" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-37" value="result.trySuccess(value)&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;value 是RedisClient对象&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3730" y="3820" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-40" value="&lt;font color=&quot;#007fff&quot;&gt;触发&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=9;fontColor=#CC0066;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-39" target="Uo9Mz0LOmQ8xmQJM_pjb-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-39" value="result.tryFailure(u)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3570" y="3720" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-42" value="&lt;font color=&quot;#007fff&quot;&gt;正常的话结果被直接忽略了&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#CC0066;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3425" y="3590" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-46" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#330000;elbow=vertical;curved=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-43" target="Uo9Mz0LOmQ8xmQJM_pjb-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-43" value="&lt;span style=&quot;font-size: 10px&quot;&gt;RedisClient#&lt;b&gt;resolveAddr&lt;/b&gt;()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;创建Socket地址实例（包含hostname、ipAddr、port）&lt;/font&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2560" y="3660" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-49" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;strokeColor=#330000;elbow=vertical;curved=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-45" target="Uo9Mz0LOmQ8xmQJM_pjb-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-45" value="&lt;span style=&quot;font-size: 10px&quot;&gt;RPromise&amp;lt;InetSocketAddress&amp;gt; promise = new RedissonPromise&amp;lt;InetSocketAddress&amp;gt;()&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2760" y="3660" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-51" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#330000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-47" target="Uo9Mz0LOmQ8xmQJM_pjb-50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-47" value="&lt;span style=&quot;font-size: 10px&quot;&gt;byte[] addr = NetUtil.createByteArrayFromIpAddressString(uri.getHost())&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;resolvedAddr&lt;/b&gt; = new InetSocketAddress(InetAddress.getByAddress(addr), uri.getPort())&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2720" y="3740" width="320" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-53" value="触发" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;strokeColor=#330000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-50" target="Uo9Mz0LOmQ8xmQJM_pjb-10" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3050" y="3860" />
              <mxPoint x="3050" y="3640" />
              <mxPoint x="2930" y="3640" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-50" value="&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;promise.trySuccess(resolvedAddr)&lt;/b&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return promise;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2780" y="3840" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-54" value="MasterSlaveEntry.java" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2550" y="3300" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-55" value="RedisClient.java" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2600" y="3640" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-21" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-56" target="kD-OWUimEQ-q8hTlTrfe-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-56" value="&lt;span style=&quot;font-size: 10px&quot;&gt;startDNSMonitoring(masterFuture.getNow())&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2261" y="3900" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-64" value="正常结束" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-58" target="Uo9Mz0LOmQ8xmQJM_pjb-63" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-66" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-58" target="Uo9Mz0LOmQ8xmQJM_pjb-65" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-38" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=1;entryY=0.25;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#00CC66;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-58" target="kTrK8HJ409_ic4VhHYPP-35" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1800" y="3970" />
              <mxPoint x="1800" y="3970" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-58" value="ConnectionPool# add(ClientConnectionsEntry entry)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3320" y="3940" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-63" value="entries.add(entry)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3600" y="3940" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-68" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-65" target="Uo9Mz0LOmQ8xmQJM_pjb-67" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-65" value="initConnections(entry, promise, true)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;Master写连接池默认创建10个连接&lt;br&gt;发布定于连接池默认创建1个连接&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3380" y="4015" width="220" height="50" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-1" value="&lt;font color=&quot;#007fff&quot;&gt;省略很多层Future&lt;br&gt;直接看创建连接的逻辑&lt;br&gt;&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Uo9Mz0LOmQ8xmQJM_pjb-67" target="kD-OWUimEQ-q8hTlTrfe-0" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uo9Mz0LOmQ8xmQJM_pjb-67" value="createConnection(checkFreezed, requests, entry, initPromise, minimumIdleSize, initializedConnections)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;里面还是建了个RPromise，监听进一步创建连接操作的结果&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3640" y="4005" width="240" height="70" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-0" target="kD-OWUimEQ-q8hTlTrfe-7" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="4260" y="4040" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-15" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;curved=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-0" target="kD-OWUimEQ-q8hTlTrfe-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-0" value="ClientConnectionEntry#connect()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="4020" y="4020" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-7" target="kD-OWUimEQ-q8hTlTrfe-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-7" target="kD-OWUimEQ-q8hTlTrfe-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-7" value="client.connectAsync()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="4260" y="4020" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-9" target="kD-OWUimEQ-q8hTlTrfe-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-9" value="ChannelFuture channelFuture = bootstrap.connect(res)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="4460" y="4020" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-10" value="channelFuture.addListener(new ChannelFutureListener() {...});" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="4460" y="4080" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-17" value="ConnectedListener" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;curved=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-12" target="kD-OWUimEQ-q8hTlTrfe-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-18" value="DisconnectedListener" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontColor=#007FFF;entryX=0;entryY=0.5;entryDx=0;entryDy=0;curved=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-12" target="kD-OWUimEQ-q8hTlTrfe-19" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="4500" y="4230" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-12" value="onConnect(conn)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="4260" y="4180" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-14" value="connectedSuccessful(entry, promise, conn)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="4020" y="4260" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-16" value="connectionManager.getConnectionEventsHub()&lt;br&gt;.fireConnect(conn.getRedisClient().getAddr())" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="4560" y="4140" width="280" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-19" value="connectionManager.getConnectionEventsHub()&lt;br&gt;.fireDisconnect(conn.getRedisClient().getAddr())" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="4560" y="4220" width="280" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-20" value="&lt;span style=&quot;font-size: 10px&quot;&gt;dnsMonitor.start()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;DNS变化监控&lt;/font&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2540" y="3900" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-22" value="PublishSubscribeService.java" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1230" y="3030" width="180" height="20" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-26" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-23" target="kD-OWUimEQ-q8hTlTrfe-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-30" value="Future成功" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-23" target="kD-OWUimEQ-q8hTlTrfe-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-23" value="RFuture&amp;lt;RedisPubSubConnection&amp;gt; connFuture = nextPubSubConnection(slot)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1220" y="3460" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-28" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-25" target="kD-OWUimEQ-q8hTlTrfe-27" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-25" value="pubSubConnectionPool.get()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1480" y="3460" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-27" value="ConnectionPool#acquireConnection(...)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;和前面的ConnectionPool# add(ClientConnectionsEntry entry)差不多也是创建连接&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1740" y="3450" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-32" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-29" target="kD-OWUimEQ-q8hTlTrfe-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-29" value="&amp;nbsp;entry = new PubSubConnectionEntry(conn, config.getSubscriptionsPerConnection())&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;发布订阅连接、监听器的混合体，其实就是处理器&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1480" y="3540" width="220" height="50" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-34" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-31" target="kD-OWUimEQ-q8hTlTrfe-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-31" value="name2PubSubConnection.putIfAbsent(&lt;br&gt;channelName, entry)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;注册信道和处理器(Map), 每个连接最多只支持5个信道&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1480" y="3620" width="220" height="50" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-36" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-33" target="kD-OWUimEQ-q8hTlTrfe-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-38" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-33" target="kD-OWUimEQ-q8hTlTrfe-37" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-33" value="addFreeConnectionEntry(channelName, entry)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1480" y="3700" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-35" value="freePubSubMap.computeIfAbsent(...)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;freePubSubMap ???&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1740" y="3700" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-40" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-37" target="kD-OWUimEQ-q8hTlTrfe-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-37" value="&lt;span style=&quot;font-size: 10px&quot;&gt;freePubSubLock 解锁&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1480" y="3760" width="220" height="20" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-42" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-39" target="kD-OWUimEQ-q8hTlTrfe-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-39" value="&lt;span style=&quot;font-size: 10px&quot;&gt;addListeners(channelName, promise, type, lock, entry, listeners)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;注册订阅监听器&lt;/font&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1480" y="3800" width="220" height="50" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-44" value="PSUBSCRIBE &lt;br&gt;Pattern模式&lt;br&gt;正则匹配信道名" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-41" target="kD-OWUimEQ-q8hTlTrfe-43" edge="1">
          <mxGeometry x="0.2727" relative="1" as="geometry">
            <mxPoint x="1510" y="3900" as="sourcePoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-46" value="SUBSCRIBE&lt;br&gt;信道模式&lt;br&gt;精确匹配信道名" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-41" target="kD-OWUimEQ-q8hTlTrfe-45" edge="1">
          <mxGeometry x="0.2727" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-41" value="type？&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;订阅类型&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;rounded=1;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1520" y="3880" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-58" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-43" target="kD-OWUimEQ-q8hTlTrfe-56" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-43" value="future = entry.psubscribe(codec, channelName)" style="whiteSpace=wrap;html=1;rounded=1;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1420" y="3980" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-48" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-45" target="kD-OWUimEQ-q8hTlTrfe-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-57" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-45" target="kD-OWUimEQ-q8hTlTrfe-56" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-45" value="future = entry.subscribe(codec, channelName)" style="whiteSpace=wrap;html=1;rounded=1;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1620" y="3980" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-50" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-47" target="kD-OWUimEQ-q8hTlTrfe-49" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-47" value="conn.subscribe(codec, channelName)" style="whiteSpace=wrap;html=1;rounded=1;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1800" y="3980" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-52" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-49" target="kD-OWUimEQ-q8hTlTrfe-51" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-49" value="channels.put(ch, codec)" style="whiteSpace=wrap;html=1;rounded=1;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2060" y="3980" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-54" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kD-OWUimEQ-q8hTlTrfe-51" target="kD-OWUimEQ-q8hTlTrfe-53" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-51" value="async(new PubSubMessageDecoder(codec.getValueDecoder()), RedisCommands.SUBSCRIBE, channels)&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;通过刚才创建的发布订阅连接异步发送Redis 订阅命令&lt;br&gt;这里将所有channels都传过去了，应该是因为每个连接注册订阅后就阻塞了，无法一个个地注册&lt;br&gt;&lt;/font&gt;" style="whiteSpace=wrap;html=1;rounded=1;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1980" y="4060" width="320" height="80" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-53" value="&lt;font&gt;channel.writeAndFlush(...)&lt;br&gt;&lt;/font&gt;" style="whiteSpace=wrap;html=1;rounded=1;glass=0;strokeWidth=1;shadow=0;fillColor=#fff2cc;strokeColor=#d6b656;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2341" y="4080" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-55" value="ChannelOutboundInvoker.java" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2341" y="4060" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="kD-OWUimEQ-q8hTlTrfe-56" value="future.addListener(new &lt;b&gt;ChannelFutureListener&lt;/b&gt;() {...}&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;订阅失败或超时的后置处理&lt;/font&gt;" style="whiteSpace=wrap;html=1;rounded=1;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1490" y="4140" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;curved=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-0" target="kTrK8HJ409_ic4VhHYPP-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-0" target="kTrK8HJ409_ic4VhHYPP-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-0" value="publishAsync(message)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="440" y="3540" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-2" value="commandExecutor.get(...)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;获取上一步异步结果&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="440" y="3620" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;curved=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-4" target="kTrK8HJ409_ic4VhHYPP-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-4" value="name = getName(message)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;获取主题名称，即信道名称&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="700" y="3540" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;curved=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-6" target="kTrK8HJ409_ic4VhHYPP-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-6" value="&lt;font style=&quot;font-size: 10px&quot;&gt;commandExecutor.writeAsync(name, &lt;b&gt;StringCodec.INSTANCE&lt;/b&gt;, RedisCommands.PUBLISH, name, commandExecutor.encode(codec, message))&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;先是将消息进行编码，然后异步通过连接发给服务端执行，&lt;br&gt;编码过程如果传输的对象是&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#f8cecc;strokeColor=#b85450;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="640" y="3620" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-11" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-8" target="kTrK8HJ409_ic4VhHYPP-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-8" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;NodeSource source = &lt;b&gt;getNodeSource&lt;/b&gt;(key)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="960" y="3640" width="199" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-19" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-10" target="kTrK8HJ409_ic4VhHYPP-18" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1060" y="3790" />
              <mxPoint x="320" y="3790" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-10" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;executor = new &lt;b&gt;RedisExecutor&lt;/b&gt;&amp;lt;&amp;gt;(readOnlyMode, source, codec, command, params, mainPromise, ignoreRedirect, connectionManager, objectBuilder);&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="939.5" y="3720" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-21" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-18" target="kTrK8HJ409_ic4VhHYPP-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-18" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;RedisExecutor#execute()&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#f8cecc;strokeColor=#b85450;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="240" y="3820" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-23" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-20" target="kTrK8HJ409_ic4VhHYPP-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-20" value="&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;codec = getCodec(codec)&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;其实是暂存编解码器的操作（暂存到当前线程类加载器对应的LRUCacheMap）&lt;/font&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;，先略&lt;/font&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="440" y="3820" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-25" value="正常结束" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-22" target="kTrK8HJ409_ic4VhHYPP-24" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="400" y="3920" />
              <mxPoint x="400" y="4200" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-29" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-22" target="kTrK8HJ409_ic4VhHYPP-28" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-30" value="异常结束" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-22" target="kTrK8HJ409_ic4VhHYPP-26" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="360" y="3920" />
              <mxPoint x="360" y="4280" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-22" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;RFuture&amp;lt;RedisConnection&amp;gt; connectionFuture = getConnection()&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#f8cecc;strokeColor=#b85450;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="440" y="3900" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-49" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-24" target="kTrK8HJ409_ic4VhHYPP-48" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-24" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;sendCommand(attemptPromise, connection)&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;成功获取连接后发送命令&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#f8cecc;strokeColor=#b85450;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="440" y="4180" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-26" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;主要是释放资源，优雅退出&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;和一些钩子函数的作用相同&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="440" y="4260" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-32" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-28" target="kTrK8HJ409_ic4VhHYPP-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-28" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;connectionManager.connectionWriteOp(&lt;br&gt;source, command)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="680" y="3900" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-34" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-31" target="kTrK8HJ409_ic4VhHYPP-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-31" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;MasterSlaveEntry entry = getEntry(source)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="920" y="3900" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-36" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-33" target="kTrK8HJ409_ic4VhHYPP-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-33" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;entry.connectionWriteOp(command)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="920" y="3960" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-40" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-35" target="kTrK8HJ409_ic4VhHYPP-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-35" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;writeConnectionPool.get(command)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1120" y="3960" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-42" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-39" target="kTrK8HJ409_ic4VhHYPP-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-39" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;connectTo(entry, result)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="680" y="4040" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-44" value="conn!=null" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-41" target="kTrK8HJ409_ic4VhHYPP-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-45" value="conn==null" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-41" target="kTrK8HJ409_ic4VhHYPP-46" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1120" y="4140" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-41" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;T conn = &lt;b&gt;poll&lt;/b&gt;(entry)&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;之前创建了24个连接，返回一个空闲的连接，如果没有空闲连接就新建连接，连接池和线程池原理差不多，这里最多可创建64个连接&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#f8cecc;strokeColor=#b85450;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="900" y="4065" width="200" height="65" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-43" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;connectedSuccessful(entry, promise, conn)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1159" y="4040" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-46" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;createConnection(entry, promise)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1159" y="4120" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-51" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="kTrK8HJ409_ic4VhHYPP-48" target="kTrK8HJ409_ic4VhHYPP-50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-48" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;writeFuture = connection.send(new CommandData&amp;lt;V, R&amp;gt;(attemptPromise, codec, command, params));&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;命令的传输是用的StringCodec编解码器&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="640" y="4170" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="kTrK8HJ409_ic4VhHYPP-50" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;channel.writeAndFlush(data)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;Netty API&lt;/font&gt;&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="900" y="4180" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-4" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;fontSize=11;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="1BqWvLZb_9bfCdM7f6yn-6" target="1BqWvLZb_9bfCdM7f6yn-9">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-5" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;fontSize=11;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="1BqWvLZb_9bfCdM7f6yn-6" target="1BqWvLZb_9bfCdM7f6yn-17">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-340" y="1500" />
              <mxPoint x="-620" y="1500" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-6" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 11px;&quot;&gt;&lt;b style=&quot;font-size: 11px;&quot;&gt;RedissonExpirable (A)&lt;/b&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;span style=&quot;color: rgb(0, 127, 255); background-color: initial;&quot;&gt;拓展超时方法实现，由于Redisson大部分对象都需要支持超时方法，&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;span style=&quot;color: rgb(0, 127, 255); background-color: initial;&quot;&gt;Redisson大部分对象类都继承此类&lt;/span&gt;&lt;/p&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=11;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-440" y="1520" width="400" height="120" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-7" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;fontSize=11;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="1BqWvLZb_9bfCdM7f6yn-9" target="1BqWvLZb_9bfCdM7f6yn-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-8" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.25;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;endArrow=open;endFill=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="1BqWvLZb_9bfCdM7f6yn-9" target="1BqWvLZb_9bfCdM7f6yn-18">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-460" y="1360" />
              <mxPoint x="-460" y="1000" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-9" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 11px;&quot;&gt;&lt;b style=&quot;font-size: 11px;&quot;&gt;RedissonObject (A)&lt;/b&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//命令异步执行器，其实封装了&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;protected final &lt;b&gt;CommandAsyncExecutor&lt;/b&gt; &lt;b&gt;commandExecutor&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//对象名字&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;protected String &lt;b&gt;name&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//对象使用的编解码器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;protected final Codec &lt;b&gt;codec&lt;/b&gt;;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=11;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-440" y="1320" width="400" height="160" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-10" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;fontSize=11;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="1BqWvLZb_9bfCdM7f6yn-11" target="1BqWvLZb_9bfCdM7f6yn-12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-11" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 11px;&quot;&gt;&lt;b style=&quot;font-size: 11px;&quot;&gt;RObject (I)&lt;/b&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;定义Redisson对象的基本方法（这里定义同步方法），Redisson对象的核心接口，Redisson所有对象都实现此接口&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//获取对象空闲时间（s），即从上次读写到现在的秒数&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;Long getIdleTime();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//更新对象最后访问时间&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;boolean touch();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//对象在Redis中占用内存大小（按bytes计算）&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;long sizeInMemory();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//Redisson对象的一些序列化和反序列化方法&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;void restore(byte[] state);&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;...&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;byte[] dump();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//对象迁移、复制&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;void migrate(String host, int port, int database, long timeout);&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;void copy(String host, int port, int database, long timeout);&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;boolean move(int database);&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//对象基本操作方法&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;String getName();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;boolean delete();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;boolean unlink();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;void rename(String newName);&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;boolean renamenx(String newName);&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;boolean isExists();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;Codec getCodec();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//对象监听器相关，具体参考各种监听器实现类&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;int addListener(ObjectListener listener);&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;void removeListener(int listenerId);&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=11;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-440" y="880" width="400" height="400" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-12" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 11px;&quot;&gt;&lt;b style=&quot;font-size: 11px;&quot;&gt;RObjectAsync (I)&lt;/b&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 11px;&quot;&gt;拓展 RObject&amp;nbsp;&lt;b&gt;异步&lt;/b&gt;接口方法，返回 RFuture&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=11;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-440" y="760" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-13" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;fontSize=11;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="1BqWvLZb_9bfCdM7f6yn-14" target="1BqWvLZb_9bfCdM7f6yn-12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-14" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 11px;&quot;&gt;&lt;b style=&quot;font-size: 11px;&quot;&gt;RExpirableAsync (I)&lt;/b&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;拓展 RExpirable 异步接口方法，返回 RFuture&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=11;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-760" y="880" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-15" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;fontSize=11;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="1BqWvLZb_9bfCdM7f6yn-17" target="1BqWvLZb_9bfCdM7f6yn-14">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-16" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.25;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="1BqWvLZb_9bfCdM7f6yn-17" target="1BqWvLZb_9bfCdM7f6yn-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-17" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 11px;&quot;&gt;&lt;b style=&quot;font-size: 11px;&quot;&gt;RExpirable (I)&lt;/b&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;为对象定义超时方法（TTL）&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;boolean expire(Instant time);&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;boolean expireIfSet(Instant time);&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;...&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;boolean expire(Duration duration);&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;...&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;boolean clearExpire();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;long remainTimeToLive();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;long getExpireTime();&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=11;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-760" y="1320" width="280" height="160" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-18" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;CommandAsyncExecutor&lt;/b&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;(I)&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;Redis命令异步执行器，Redisson提供了异步、批量异步、响应式（基于Reactor、RxJava）多种实现&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=11;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-1120" y="960" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-19" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="1BqWvLZb_9bfCdM7f6yn-23" target="1BqWvLZb_9bfCdM7f6yn-18">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-1000" y="1080" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-20" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;ConnectionManager&lt;/b&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;(I)&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;连接管理器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//部分关键接口方法&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//其实是启动Netty客户端&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;void &lt;b&gt;connect&lt;/b&gt;();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;void shutdown();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//获取发布订阅服务&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;PublishSubscribeService getSubscribeService();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//集群模式计算槽位&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;int calcSlot(String key);&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;...&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//主从服务节点Entry集合&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;Collection&amp;lt;MasterSlaveEntry&amp;gt; getEntrySet();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;...&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//创建Redis连接（RedisClient）&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;RedisClient &lt;b&gt;createClient&lt;/b&gt;(NodeType type, InetSocketAddress address, RedisURI uri, String sslHostname);&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;RedisClient &lt;b&gt;createClient&lt;/b&gt;(NodeType type, RedisURI address, String sslHostname);&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//&lt;b&gt;ServiceManager&lt;/b&gt;(Netty客户端 + ExecutorService + Redis Server 配置)&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;b&gt;ServiceManager&lt;/b&gt; getServiceManager();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//创建命令执行器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;CommandAsyncExecutor &lt;b&gt;createCommandExecutor&lt;/b&gt;(RedissonObjectBuilder objectBuilder,&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;RedissonObjectBuilder.ReferenceType referenceType);&lt;/span&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=11;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-1640" y="160" width="400" height="360" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-21" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;ServiceManager&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;与Redis Server 通信的核心类&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//连接事件中心，可以在这里面注册连接事件监听器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConnectionEventsHub &lt;b&gt;connectionEventsHub&lt;/b&gt; = new &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;ConnectionEventsHub();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final String &lt;b&gt;id&lt;/b&gt; = UUID.randomUUID().toString();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//Netty客户端事件循环线程池&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final EventLoopGroup &lt;b&gt;group&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Class&amp;lt;? extends SocketChannel&amp;gt; &lt;b&gt;socketChannelClass&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final AddressResolverGroup&amp;lt;InetSocketAddress&amp;gt; &lt;b&gt;resolverGroup&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//Netty客户端工作者线程池&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ExecutorService &lt;b&gt;executor&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Config &lt;b&gt;cfg&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private MasterSlaveServersConfig &lt;b&gt;config&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//用于重试的定时器，本质还是线程+队列&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private &lt;b&gt;HashedWheelTimer&lt;/b&gt; &lt;b&gt;timer&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//向EventLoopGroup中注册监视空闲连接的定时任务，用于自动释放超时的空闲连接&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private IdleConnectionWatcher &lt;b&gt;connectionWatcher&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final AtomicBoolean shutdownLatch = new AtomicBoolean();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ElementsSubscribeService &lt;b&gt;elementsSubscribeService&lt;/b&gt; = new &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;ElementsSubscribeService(this);&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private NatMapper &lt;b&gt;natMapper&lt;/b&gt; = NatMapper.direct();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private static final Map&amp;lt;InetSocketAddress, Set&amp;lt;String&amp;gt;&amp;gt; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;b&gt;SCRIPT_SHA_CACHE&lt;/b&gt; = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private static final Map&amp;lt;String, String&amp;gt; &lt;b&gt;SHA_CACHE&lt;/b&gt; =&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;new LRUCacheMap&amp;lt;&amp;gt;(500, 0, 0);&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Map&amp;lt;String, ResponseEntry&amp;gt; &lt;b&gt;responses&lt;/b&gt; = new &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final QueueTransferService &lt;b&gt;queueTransferService&lt;/b&gt; = new &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;QueueTransferService();&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=11;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-2080" y="480" width="400" height="470" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-22" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;endArrow=open;endFill=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="1BqWvLZb_9bfCdM7f6yn-23" target="1BqWvLZb_9bfCdM7f6yn-20">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-23" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;CommandAsyncService&lt;/b&gt;&lt;br&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;异步执行器实现，其他几种执行器全都继承这个类，说明所有执行器都是异步的&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;final Codec codec;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot; color=&quot;#007fff&quot;&gt;//连接管理器，就是保存连接的容器类对象&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;final&amp;nbsp;&lt;b style=&quot;border-color: var(--border-color);&quot;&gt;ConnectionManager&lt;/b&gt;&amp;nbsp;&lt;b style=&quot;border-color: var(--border-color);&quot;&gt;connectionManager&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;final RedissonObjectBuilder objectBuilder;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;final RedissonObjectBuilder.ReferenceType referenceType;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final int retryAttempts;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final int retryInterval;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final int responseTimeout;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final boolean trackChanges;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=11;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-1200" y="1080" width="400" height="200" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-24" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="1BqWvLZb_9bfCdM7f6yn-25" target="1BqWvLZb_9bfCdM7f6yn-23">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-25" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;CommandBatchService&lt;/b&gt;&lt;br&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot; color=&quot;#007fff&quot;&gt;批量执行器实现（也是异步的）&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;br style=&quot;border-color: var(--border-color);&quot;&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final AtomicInteger index = new AtomicInteger();&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final ConcurrentMap&amp;lt;NodeSource, Entry&amp;gt;&amp;nbsp;&lt;b style=&quot;border-color: var(--border-color);&quot;&gt;commands&lt;/b&gt;&amp;nbsp;= new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private Map&amp;lt;MasterSlaveEntry, Entry&amp;gt;&amp;nbsp;&lt;b style=&quot;border-color: var(--border-color);&quot;&gt;aggregatedCommands&lt;/b&gt;&amp;nbsp;= Collections.emptyMap();&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final ConcurrentMap&amp;lt;MasterSlaveEntry, ConnectionEntry&amp;gt;&amp;nbsp;&lt;b style=&quot;border-color: var(--border-color);&quot;&gt;connections&lt;/b&gt;&amp;nbsp;= new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final BatchOptions options;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final Map&amp;lt;CompletableFuture&amp;lt;?&amp;gt;, List&amp;lt;CommandBatchService&amp;gt;&amp;gt; nestedServices = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final AtomicBoolean executed = new AtomicBoolean();&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final long retryInterval;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final int retryAttempts;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=11;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-1200" y="1320" width="400" height="280" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-26" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="1BqWvLZb_9bfCdM7f6yn-27" target="1BqWvLZb_9bfCdM7f6yn-20">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-57" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=-0.003;exitY=0.604;exitDx=0;exitDy=0;endArrow=open;endFill=0;exitPerimeter=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="1BqWvLZb_9bfCdM7f6yn-27" target="1BqWvLZb_9bfCdM7f6yn-21">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-79" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=-0.003;exitY=0.412;exitDx=0;exitDy=0;endArrow=open;endFill=0;exitPerimeter=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="1BqWvLZb_9bfCdM7f6yn-27" target="wK_E6LMROi6GtL9PwVPp-65">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-1660" y="675" />
              <mxPoint x="-1660" y="380" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-27" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;MasterSlaveConnectionManager&lt;/b&gt;&lt;br&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;连接管理器基本实现，其他实现类都继承此实现，包括单机、主从复制&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;、哨兵、集群4种实现&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;protected DNSMonitor dnsMonitor;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;protected MasterSlaveServersConfig &lt;b&gt;config&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//Redis服务节点对象，里面主要是&lt;b&gt;连接池&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private MasterSlaveEntry &lt;b&gt;masterSlaveEntry&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//做什么用？&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;protected final PublishSubscribeService &lt;b&gt;subscribeService&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//与Redis Server通信的核心实现&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;protected final ServiceManager &lt;b&gt;serviceManager&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final Map&amp;lt;RedisURI, RedisConnection&amp;gt; &lt;b&gt;nodeConnections&lt;/b&gt; = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;protected final AtomicReference&amp;lt;CompletableFuture&amp;lt;Void&amp;gt;&amp;gt; lazyConnectLatch = new AtomicReference&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private boolean lastAttempt;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=11;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-1640" y="560" width="400" height="280" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-28" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="1BqWvLZb_9bfCdM7f6yn-29" target="1BqWvLZb_9bfCdM7f6yn-27">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-29" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;SingleConnectionManager&lt;/b&gt;&lt;br&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;Redis单机模式连接管理器&lt;/font&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=11;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-1640" y="1000" width="400" height="80" as="geometry" />
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-30" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="1BqWvLZb_9bfCdM7f6yn-31" target="1BqWvLZb_9bfCdM7f6yn-27">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-1880" y="980" />
              <mxPoint x="-1440" y="980" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="1BqWvLZb_9bfCdM7f6yn-31" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;ClusterConnectionManager&lt;/b&gt;&lt;br&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;Redis集群模式连接管理器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final Map&amp;lt;Integer, ClusterPartition&amp;gt; lastPartitions = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final Map&amp;lt;RedisURI, ClusterPartition&amp;gt; lastUri2Partition = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private volatile Timeout monitorFuture;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private volatile RedisURI lastClusterNode;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private RedisStrictCommand&amp;lt;List&amp;lt;ClusterNodeInfo&amp;gt;&amp;gt; clusterNodesCommand;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private String configEndpointHostName;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final AtomicReferenceArray&amp;lt;MasterSlaveEntry&amp;gt; slot2entry = new AtomicReferenceArray&amp;lt;&amp;gt;(MAX_SLOT);&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final Map&amp;lt;RedisClient, MasterSlaveEntry&amp;gt; client2entry = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private ClusterServersConfig cfg;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final long seed = ThreadLocalRandom.current().nextLong();&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=11;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-2080" y="1000" width="400" height="280" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-0" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 11px;&quot;&gt;&lt;b&gt;Config&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//几种服务器模式配置&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//哨兵模式&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private &lt;b&gt;SentinelServersConfig&lt;/b&gt; sentinelServersConfig;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//主从&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private MasterSlaveServersConfig masterSlaveServersConfig;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//单机模式&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private &lt;b&gt;SingleServerConfig&lt;/b&gt; &lt;b&gt;singleServerConfig&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//集群模式&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private &lt;b&gt;ClusterServersConfig&lt;/b&gt; &lt;b&gt;clusterServersConfig&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//主从复制&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ReplicatedServersConfig replicatedServersConfig;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//连接管理器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private &lt;b&gt;ConnectionManager&lt;/b&gt; &lt;b&gt;connectionManager&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private int threads = 16;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//Netty事件循环线程数量&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private int nettyThreads = 32;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//Netty工作者线程池，不指定的话默认使用&amp;nbsp;&lt;/font&gt;&lt;/p&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;Executors.newFixedThreadPool 创建（2*CPU核心数个线程）&lt;/font&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Executor &lt;b&gt;nettyExecutor&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Codec &lt;b&gt;codec&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ExecutorService &lt;b&gt;executor&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private boolean referenceEnabled = true;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//通信模式，NIO（默认）、EPOLL、KQUEUE、IO_URING&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;，Linux系统下设置NIO、EPOLL本质相同&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private TransportMode &lt;b&gt;transportMode&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//Redisson客户端（本质是Netty客户端）的事件循环线程池&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private EventLoopGroup &lt;b&gt;eventLoopGroup&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//锁看门狗的超时时间ms&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private long &lt;b&gt;lockWatchdogTimeout&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private boolean &lt;b&gt;checkLockSyncedSlaves&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private long &lt;b&gt;slavesSyncTimeout&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;//&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private long &lt;b&gt;reliableTopicWatchdogTimeout&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private boolean &lt;b&gt;keepPubSubOrder&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private boolean &lt;b&gt;useScriptCache&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private int &lt;b&gt;minCleanUpDelay&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private int &lt;b&gt;maxCleanUpDelay&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private int &lt;b&gt;cleanUpKeysAmount&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private NettyHook &lt;b&gt;nettyHook&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ConnectionListener &lt;b&gt;connectionListener&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private boolean useThreadClassLoader;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private AddressResolverGroupFactory addressResolverGroupFactory;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private boolean lazyInitialization;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//使用的数据序列化协议（不是网络通信协议），RESP2(默认)、RESP3&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Protocol &lt;b&gt;protocol&lt;/b&gt;;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=11;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-440" y="40" width="400" height="680" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-1" target="wK_E6LMROi6GtL9PwVPp-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-1" target="wK_E6LMROi6GtL9PwVPp-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-1" value="Config配置对象初始化" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="40" y="240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-2" value="new Config()&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 11px;&quot;&gt;包括服务器、连接的很多配置&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="280" y="240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-4" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-830" y="210" width="20" height="30" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-5" target="wK_E6LMROi6GtL9PwVPp-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-5" value="创建客户端连接" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="40" y="320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-7" target="wK_E6LMROi6GtL9PwVPp-9">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-7" value="RedissonClient redisson&amp;nbsp; = Redisson.create(config);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="280" y="320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-9" target="wK_E6LMROi6GtL9PwVPp-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-9" value="return new Redisson(config);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="520" y="320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-19" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-11" target="wK_E6LMROi6GtL9PwVPp-18">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-20" value="1" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="wK_E6LMROi6GtL9PwVPp-19">
          <mxGeometry x="0.7871" y="-2" relative="1" as="geometry">
            <mxPoint x="-10" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-11" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;Redisson(Config config) {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; this.config = config;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; Config configCopy = new Config(config);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#007fff&quot;&gt;//1 创建连接管理器，每种服务器模式都有对应的连接管理器实现&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; this.&lt;b&gt;connectionManager&lt;/b&gt; = ConfigSupport&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;.&lt;b&gt;createConnectionManager&lt;/b&gt;(configCopy);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; RedissonObjectBuilder objectBuilder = null;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; if (config.isReferenceEnabled()) {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;//2&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;objectBuilder&lt;/b&gt; = new &lt;b&gt;RedissonObjectBuilder&lt;/b&gt;(this);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#007fff&quot;&gt;//3&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; this.&lt;b&gt;commandExecutor&lt;/b&gt; = this.connectionManager&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;.&lt;b&gt;createCommandExecutor&lt;/b&gt;(&lt;span style=&quot;background-color: initial;&quot;&gt;objectBuilder, ReferenceType.DEFAULT);&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; this.&lt;b&gt;evictionScheduler&lt;/b&gt; = new EvictionScheduler(this.commandExecutor);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; this.&lt;b&gt;writeBehindService&lt;/b&gt; = new WriteBehindService(this.commandExecutor);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;}&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;glass=0;strokeWidth=1;shadow=0;align=left;arcSize=3;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="760" y="230" width="360" height="240" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-13" target="wK_E6LMROi6GtL9PwVPp-15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-17" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;endArrow=open;endFill=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-13" target="wK_E6LMROi6GtL9PwVPp-0">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-35" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.25;entryDx=0;entryDy=0;endArrow=open;endFill=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-13" target="1BqWvLZb_9bfCdM7f6yn-20">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-13" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 11px;&quot;&gt;&lt;b&gt;Redisson&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;Redisson客户端实现类&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;private final EvictionScheduler &lt;b&gt;evictionScheduler&lt;/b&gt;;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final WriteBehindService &lt;b&gt;writeBehindService&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//连接管理器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConnectionManager &lt;b&gt;connectionManager&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final CommandAsyncExecutor &lt;b&gt;commandExecutor&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConcurrentMap&amp;lt;Class&amp;lt;?&amp;gt;, Class&amp;lt;?&amp;gt;&amp;gt; &lt;b&gt;liveObjectClassCache&lt;/b&gt; = new ConcurrentHashMap();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Config &lt;b&gt;config&lt;/b&gt;;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=11;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-1120" y="160" width="400" height="200" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-14" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;Config默认值：&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;sentinelServersConfig = null&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;masterSlaveServersConfig = null&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;singleServerConfig = null&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;clusterServersConfig = null&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;replicatedServersConfig = null&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;connectionManager = null&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;threads = 16&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;nettyThreads = 32&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;nettyExecutor = null&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;codec = null&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;executor = null&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;referenceEnabled = true&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;transportMode = {TransportMode@3456} &quot;NIO&quot;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;eventLoopGroup = null&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;lockWatchdogTimeout = 30000&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;checkLockSyncedSlaves = true&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;slavesSyncTimeout = 1000&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;reliableTopicWatchdogTimeout = 600000&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;keepPubSubOrder = true&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;useScriptCache = false&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;minCleanUpDelay = 5&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;maxCleanUpDelay = 1800&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;cleanUpKeysAmount = 100&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;nettyHook = {DefaultNettyHook@3457}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;connectionListener = null&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;useThreadClassLoader = true&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;addressResolverGroupFactory = {SequentialDnsAddressResolverFactory@3458}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;lazyInitialization = false&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;protocol = {Protocol@3452} &quot;RESP2&quot;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-680" y="40" width="240" height="400" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-15" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;RedissonClient&lt;/b&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;(I)&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;包括创建连接、关闭连接、获取服务节点信息，以及获取各种&lt;b&gt;Redisson对象&lt;/b&gt;的方法。&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=11;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-1040" y="40" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-22" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-18" target="wK_E6LMROi6GtL9PwVPp-21">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-23" value="单机" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="wK_E6LMROi6GtL9PwVPp-22">
          <mxGeometry x="-0.5494" y="-3" relative="1" as="geometry">
            <mxPoint x="3" y="-23" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-25" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-18" target="wK_E6LMROi6GtL9PwVPp-24">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-26" value="集群" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="wK_E6LMROi6GtL9PwVPp-25">
          <mxGeometry x="0.1035" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-31" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-18" target="wK_E6LMROi6GtL9PwVPp-30">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-18" value="创建连接管理器&lt;br&gt;共有5种" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1159" y="280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-21" target="wK_E6LMROi6GtL9PwVPp-27">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-21" value="cm = new &lt;b&gt;SingleConnectionManager&lt;/b&gt;(&lt;br&gt;configCopy.getSingleServerConfig(), configCopy);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1400" y="240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-24" value="cm = new &lt;b&gt;ClusterConnectionManager&lt;/b&gt;(&lt;br&gt;configCopy.getClusterServersConfig(), configCopy);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1400" y="320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-34" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-27" target="wK_E6LMROi6GtL9PwVPp-33">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-41" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-27" target="wK_E6LMROi6GtL9PwVPp-38">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-42" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-27" target="wK_E6LMROi6GtL9PwVPp-40">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-27" value="实例化过程中初始化的一些重要组件" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1640" y="240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-59" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-30" target="wK_E6LMROi6GtL9PwVPp-58">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-30" value="&lt;div&gt;if (!configCopy.isLazyInitialization()) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ((ConnectionManager)cm).&lt;b&gt;connect&lt;/b&gt;();&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;return (ConnectionManager)cm;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;非懒初始化，就立即执行连接，最多重试3次&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;align=left;arcSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1159" y="680" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-33" value="private LoadBalancer loadBalancer = new RoundRobinLoadBalancer();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;Redisson#config 中的loadBalancer&lt;/font&gt;&amp;nbsp;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1880" y="240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-37" value="Redisson" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="905" y="200" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-44" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-38" target="wK_E6LMROi6GtL9PwVPp-43">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-38" value="this.&lt;b&gt;serviceManager&lt;/b&gt; = new &lt;b&gt;ServiceManager&lt;/b&gt;(this.config, configCopy);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1880" y="320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-40" value="&lt;b&gt;subscribeService&lt;/b&gt; = new &lt;b&gt;PublishSubscribeService&lt;/b&gt;(this);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1880" y="400" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-46" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-43" target="wK_E6LMROi6GtL9PwVPp-45">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-48" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-43" target="wK_E6LMROi6GtL9PwVPp-47">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-43" value="&lt;b&gt;Netty客户端初始化&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="2120" y="320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-45" value="this.&lt;b&gt;group&lt;/b&gt; = new NioEventLoopGroup(cfg.getNettyThreads(), new DefaultThreadFactory(&quot;redisson-netty&quot;));&lt;br&gt;...&lt;br&gt;this.&lt;b&gt;socketChannelClass&lt;/b&gt; = NioSocketChannel.class;&lt;br&gt;this.&lt;b&gt;resolverGroup&lt;/b&gt; = cfg.getAddressResolverGroupFactory()&lt;br&gt;.create(NioDatagramChannel.class, socketChannelClass, DnsServerAddressStreamProviders.platformDefault());" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="2360" y="300" width="360" height="100" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-51" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-47" target="wK_E6LMROi6GtL9PwVPp-50">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-47" value="&lt;b&gt;initTimer&lt;/b&gt;();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;创建用于执行重试任务的定时器&lt;/b&gt;，&lt;br&gt;”线程+事件轮队列“实现&lt;br&gt;以及&lt;b&gt;提交空闲超时连接监视任务&lt;/b&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="2120" y="440" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-49" value="ServiceManager" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="2160" y="290" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-53" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-50" target="wK_E6LMROi6GtL9PwVPp-52">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-50" value="timer timer = new &lt;b&gt;HashedWheelTimer&lt;/b&gt;(new DefaultThreadFactory(&quot;redisson-timer&quot;), minTimeout, TimeUnit.MILLISECONDS, 1024, false);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="2360" y="440" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-52" value="connectionWatcher = new &lt;b&gt;IdleConnectionWatcher&lt;/b&gt;(group, config);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;往Netty事件循环线程池中注册了一个定时任务，默认每隔10s检查一下空闲超时的连接并执行关闭&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="2360" y="520" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-56" value="&lt;font color=&quot;#007fff&quot;&gt;连接并不是空闲超时后就直接关闭，而是有一个规则&lt;br&gt;不细说了&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="2570" y="530" width="300" height="40" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-61" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-58" target="wK_E6LMROi6GtL9PwVPp-60">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-58" value="doConnect(new HashSet&amp;lt;&amp;gt;(), u -&amp;gt; null);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1400" y="690" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-67" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-60" target="wK_E6LMROi6GtL9PwVPp-66">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-68" value="1" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="wK_E6LMROi6GtL9PwVPp-67">
          <mxGeometry x="0.8608" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-60" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;try {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; if (config.isSlaveNotUsed()) {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; masterSlaveEntry = new &lt;b&gt;SingleEntry&lt;/b&gt;(this, config); &lt;font color=&quot;#007fff&quot;&gt;//单机模式，里面主要是一组连接池&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; masterSlaveEntry = new &lt;b&gt;MasterSlaveEntry&lt;/b&gt;(this, config); &lt;font color=&quot;#007fff&quot;&gt;//其他模式&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#007fff&quot;&gt;//从配置中解析连接uri&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; RedisURI uri = new RedisURI(config.getMasterAddress());&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; String hostname = hostnameMapper.apply(uri);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;//1 创建到Redis Master节点的连接&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; CompletableFuture&amp;lt;&lt;b&gt;RedisClient&lt;/b&gt;&amp;gt; &lt;b&gt;masterFuture&lt;/b&gt; = masterSlaveEntry.&lt;b&gt;setupMasterEntry&lt;/b&gt;(uri, hostname);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; try {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;//阻塞等待连接建立&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (config.getMasterConnectionMinimumIdleSize() == 0) {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; masterFuture.join();&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp;masterFuture.get(config.getConnectTimeout()*config.getMasterConnectionMinimumIdleSize(), TimeUnit.MILLISECONDS);&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; } catch (InterruptedException e) {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Thread.currentThread().interrupt();&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; } catch (ExecutionException | TimeoutException e) {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; throw new RedisConnectionException(e);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; if (!config.isSlaveNotUsed()) {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;//创建到Redis Slave节点的连接&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; CompletableFuture&amp;lt;Void&amp;gt; &lt;b&gt;fs&lt;/b&gt; = masterSlaveEntry.&lt;b&gt;initSlaveBalancer&lt;/b&gt;(disconnectedSlaves, hostnameMapper);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ... &lt;font color=&quot;#007fff&quot;&gt;// 和Master节点处理相同&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; //&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; startDNSMonitoring(masterFuture.getNow(null));&lt;/div&gt;&lt;div style=&quot;&quot;&gt;} catch (Exception e) {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; internalShutdown();&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; ...&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; throw e;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;}&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;glass=0;strokeWidth=1;shadow=0;align=left;arcSize=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1640" y="600" width="440" height="480" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-62" value="MasterSlaveConnectionManager" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1400" y="660" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-65" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;MasterSlaveEntry&lt;/b&gt;&lt;br&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot; color=&quot;#007fff&quot;&gt;&lt;b style=&quot;border-color: var(--border-color);&quot;&gt;Redis服务节点对象，主要是RedisClient连接池&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;br style=&quot;border-color: var(--border-color);&quot;&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;volatile ClientConnectionsEntry&amp;nbsp;&lt;b style=&quot;border-color: var(--border-color);&quot;&gt;masterEntry&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;int references;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;final MasterSlaveServersConfig&amp;nbsp;&lt;b style=&quot;border-color: var(--border-color);&quot;&gt;config&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;final ConnectionManager&amp;nbsp;&lt;b style=&quot;border-color: var(--border-color);&quot;&gt;connectionManager&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;final MasterConnectionPool&amp;nbsp;&lt;b style=&quot;border-color: var(--border-color);&quot;&gt;masterConnectionPool&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;final MasterPubSubConnectionPool&amp;nbsp;&lt;b style=&quot;border-color: var(--border-color);&quot;&gt;masterPubSubConnectionPool&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;final PubSubConnectionPool&amp;nbsp;&lt;b style=&quot;border-color: var(--border-color);&quot;&gt;slavePubSubConnectionPool&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;final SlaveConnectionPool&amp;nbsp;&lt;b style=&quot;border-color: var(--border-color);&quot;&gt;slaveConnectionPool&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;final Map&amp;lt;RedisClient, &lt;b&gt;ClientConnectionsEntry&lt;/b&gt;&amp;gt;&amp;nbsp;&lt;b style=&quot;border-color: var(--border-color);&quot;&gt;client2Entry&lt;/b&gt;&amp;nbsp;= new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;final AtomicBoolean active = new AtomicBoolean(true);&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;final AtomicBoolean noPubSubSlaves = new AtomicBoolean();&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;volatile int availableSlaves = -1;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=11;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-2080" y="160" width="400" height="280" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-70" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-66" target="wK_E6LMROi6GtL9PwVPp-69">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-66" value="CompletableFuture&amp;lt;RedisClient&amp;gt; masterFuture = masterSlaveEntry.&lt;b&gt;setupMasterEntry&lt;/b&gt;(&lt;br&gt;uri, hostname);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="2120" y="640" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-72" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-69" target="wK_E6LMROi6GtL9PwVPp-71">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-74" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-69" target="wK_E6LMROi6GtL9PwVPp-73">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-69" value="RedisClient client = connectionManager.&lt;b&gt;createClient&lt;/b&gt;(&lt;br&gt;NodeType.MASTER, address, sslHostname);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;创建Netty客户端(bootstrap channels 等)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="2360" y="630" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-91" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-71" target="wK_E6LMROi6GtL9PwVPp-90">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-71" value="return setupMasterEntry(client);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;真正的建立连接（Chanel），并缓存连接到连接池中&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="2360" y="1130" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-76" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-73" target="wK_E6LMROi6GtL9PwVPp-75">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-73" value="RedisClient client = createClient(type, address, config.getConnectTimeout(), config.getTimeout(), sslHostname);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="2600" y="640" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-78" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-75" target="wK_E6LMROi6GtL9PwVPp-77">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-75" value="RedisClientConfig &lt;b&gt;redisConfig&lt;/b&gt; = createRedisConfig(type, address, timeout, commandTimeout, sslHostname);&lt;br&gt;return &lt;b&gt;RedisClient&lt;/b&gt;.&lt;b&gt;create&lt;/b&gt;(redisConfig);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="2840" y="630" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-82" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-77" target="wK_E6LMROi6GtL9PwVPp-81">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-77" value="return new RedisClient(config);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="3080" y="640" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-80" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;RedisClient&lt;/b&gt;&lt;br&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final AtomicReference&amp;lt;CompletableFuture&amp;lt;InetSocketAddress&amp;gt;&amp;gt; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;b&gt;resolvedAddrFuture&lt;/b&gt; = new AtomicReference&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;//除pubsub外其他命令使用&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final Bootstrap &lt;b&gt;bootstrap&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final Bootstrap &lt;b&gt;pubSubBootstrap&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final RedisURI &lt;b&gt;uri&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//解析后的连接地址&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private InetSocketAddress &lt;b&gt;resolvedAddr&lt;/b&gt;;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//连接的通道&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final ChannelGroup &lt;b&gt;channels&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private ExecutorService &lt;b&gt;executor&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final long &lt;b&gt;commandTimeout&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private Timer &lt;b&gt;timer&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private RedisClientConfig &lt;b&gt;config&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private boolean &lt;b&gt;hasOwnTimer&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private boolean &lt;b&gt;hasOwnExecutor&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private boolean &lt;b&gt;hasOwnGroup&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private boolean &lt;b&gt;hasOwnResolver&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private volatile boolean &lt;b&gt;shutdown&lt;/b&gt;;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=11;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-2520" y="160" width="400" height="360" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-84" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-81" target="wK_E6LMROi6GtL9PwVPp-83">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-81" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;RedisClientConfig &lt;b&gt;copy&lt;/b&gt; = new &lt;b&gt;RedisClientConfig&lt;/b&gt;(config);&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//如果 timer group executor resolverGroup 为空则创建默认的&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;...&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;this.config = copy;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;this.executor = copy.&lt;b&gt;getExecutor&lt;/b&gt;();&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;this.timer = copy.&lt;b&gt;getTimer&lt;/b&gt;();&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;uri = copy.&lt;b&gt;getAddress&lt;/b&gt;();&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;resolvedAddr = copy.&lt;b&gt;getAddr&lt;/b&gt;();&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;if (resolvedAddr != null) {&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; resolvedAddrFuture.set(CompletableFuture.completedFuture(resolvedAddr));&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;//调用Netty接口创建客户端连接&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;channels = new &lt;b&gt;DefaultChannelGroup&lt;/b&gt;(copy.getGroup().next());&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;//向每个Redis节点创建了两个Bootstrap,&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;bootstrap = &lt;b&gt;createBootstrap&lt;/b&gt;(copy, Type.PLAIN); &lt;font color=&quot;#007fff&quot;&gt;//对应RedisConnectionHandler&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;pubSubBootstrap = &lt;b&gt;createBootstrap&lt;/b&gt;(copy, Type.PUBSUB); &lt;font color=&quot;#007fff&quot;&gt;//对应RedisPubSubConnectionHandler&amp;nbsp;&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;this.commandTimeout = copy.getCommandTimeout();&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;glass=0;strokeWidth=1;shadow=0;align=left;arcSize=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="3320" y="540" width="440" height="260" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-92" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;dashed=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-83" target="wK_E6LMROi6GtL9PwVPp-85">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-83" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;Bootstrap bootstrap = new &lt;b&gt;Bootstrap&lt;/b&gt;()&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .resolver(config.&lt;b&gt;getResolverGroup&lt;/b&gt;()) &lt;font color=&quot;#007fff&quot;&gt;//命名地址解析&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .channel(config.&lt;b&gt;getSocketChannelClass&lt;/b&gt;())&lt;font color=&quot;#007fff&quot;&gt; //Channel类型&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .group(config.getGroup()); &lt;font color=&quot;#007fff&quot;&gt;//事件循环线程池&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;bootstrap.&lt;b&gt;handler&lt;/b&gt;(new &lt;b&gt;RedisChannelInitializer&lt;/b&gt;(bootstrap, config, this, channels, type));&lt;/div&gt;&lt;div style=&quot;&quot;&gt;bootstrap.option(ChannelOption.CONNECT_TIMEOUT_MILLIS, config.getConnectTimeout());&lt;/div&gt;&lt;div style=&quot;&quot;&gt;bootstrap.option(ChannelOption.SO_KEEPALIVE, config.isKeepAlive());&lt;/div&gt;&lt;div style=&quot;&quot;&gt;bootstrap.option(ChannelOption.TCP_NODELAY, config.isTcpNoDelay());&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//应用通过&amp;nbsp;ExtendedSocketOptions 设置的选项&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;applyChannelOptions(config, bootstrap);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;config.getNettyHook().afterBoostrapInitialization(bootstrap);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;return &lt;b&gt;bootstrap&lt;/b&gt;;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;glass=0;strokeWidth=1;shadow=0;align=left;arcSize=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="3800" y="575" width="440" height="190" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-88" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-85" target="wK_E6LMROi6GtL9PwVPp-87">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-85" value="RedisChannelInitializer#initChannel()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="4280" y="640" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-87" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;initSsl(config, ch);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;if (type == Type.PLAIN) {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; ch.pipeline().addLast(new &lt;b style=&quot;font-size: 10px;&quot;&gt;RedisConnectionHandler&lt;/b&gt;(redisClient));&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;} else {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; ch.pipeline().addLast(new &lt;b style=&quot;font-size: 10px;&quot;&gt;RedisPubSubConnectionHandler&lt;/b&gt;(redisClient));&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;}&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;ch.pipeline().addLast(&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b style=&quot;font-size: 10px;&quot;&gt;connectionWatchdog&lt;/b&gt;,&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; new &lt;b style=&quot;font-size: 10px;&quot;&gt;CommandEncoder&lt;/b&gt;(config.getCommandMapper()),&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b style=&quot;font-size: 10px;&quot;&gt;CommandBatchEncoder&lt;/b&gt;.INSTANCE);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;if (type == Type.PLAIN) {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; ch.pipeline().addLast(new &lt;b style=&quot;font-size: 10px;&quot;&gt;CommandsQueue&lt;/b&gt;());&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;} else {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; ch.pipeline().addLast(new &lt;b style=&quot;font-size: 10px;&quot;&gt;CommandsQueuePubSub&lt;/b&gt;());&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;}&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;if (pingConnectionHandler != null) {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; ch.pipeline().addLast(&lt;b style=&quot;font-size: 10px;&quot;&gt;pingConnectionHandler&lt;/b&gt;);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;}&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;if (type == Type.PLAIN) {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; ch.pipeline().addLast(new&lt;b style=&quot;font-size: 10px;&quot;&gt;CommandDecoder&lt;/b&gt;(config.getAddress().getScheme()));&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;} else {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; ch.pipeline().addLast(new &lt;b style=&quot;font-size: 10px;&quot;&gt;CommandPubSubDecoder&lt;/b&gt;(config));&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;}&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;ch.pipeline().addLast(new &lt;b style=&quot;font-size: 10px;&quot;&gt;ErrorsLoggingHandler&lt;/b&gt;());&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;config.getNettyHook().afterChannelInitialization(ch);&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;glass=0;strokeWidth=1;shadow=0;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;arcSize=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="4520" y="470" width="400" height="400" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-89" value="&lt;font color=&quot;#cc0000&quot; style=&quot;font-size: 11px;&quot;&gt;普通命令和pubsub命令有什么不同？&lt;br style=&quot;font-size: 11px;&quot;&gt;为何要分成两个 Bootstrap&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=11;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="4282" y="700" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-96" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-90" target="wK_E6LMROi6GtL9PwVPp-95">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-90" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//异步解析Redis Server 地址&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;CompletableFuture&amp;lt;InetSocketAddress&amp;gt; addrFuture = client.&lt;b&gt;resolveAddr&lt;/b&gt;();&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;return addrFuture.thenCompose(res -&amp;gt; {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;masterEntry&lt;/b&gt; = new &lt;/span&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;ClientConnectionsEntry&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;(&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; client,&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; config.getMasterConnectionMinimumIdleSize(),&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; config.getMasterConnectionPoolSize(),&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; connectionManager,&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; NodeType.MASTER,&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; config);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; if (!config.isSlaveNotUsed()) {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; addSlaveEntry(masterEntry);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; if (masterEntry.isFreezed()) {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return CompletableFuture.completedFuture(null);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#007fff&quot;&gt;//创建连接&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; List&amp;lt;CompletableFuture&amp;lt;Void&amp;gt;&amp;gt; futures = new ArrayList&amp;lt;&amp;gt;();&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#007fff&quot;&gt;//初始会创建最小空闲数量的连接，默认24&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; CompletableFuture&amp;lt;Void&amp;gt; writeFuture = masterEntry.&lt;b&gt;initConnections&lt;/b&gt;(config.getMasterConnectionMinimumIdleSize());&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; futures.add(writeFuture);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; if (config.getSubscriptionMode() == SubscriptionMode.MASTER) {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; CompletableFuture&amp;lt;Void&amp;gt; pubSubFuture = masterEntry.&lt;b&gt;initPubSubConnections&lt;/b&gt;(config.getSubscriptionConnectionMinimumIdleSize());&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; futures.add(pubSubFuture);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; return CompletableFuture.allOf(futures.toArray(new CompletableFuture[0]));&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;}).whenComplete((r, e) -&amp;gt; {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; if (e != null) {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; client.shutdownAsync();&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;}).thenApply(r -&amp;gt; {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#007fff&quot;&gt;//注册到连接池&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; masterConnectionPool.addEntry(masterEntry);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; masterPubSubConnectionPool.addEntry(masterEntry);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; return client;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;});&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;glass=0;strokeWidth=1;shadow=0;align=left;arcSize=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="2600" y="910" width="440" height="500" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-93" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;ClientConnectionsEntry&lt;/b&gt;&lt;br&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;b&gt;&lt;font color=&quot;#007fff&quot;&gt;连接的封装对象&lt;/font&gt;&lt;/b&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final ConnectionsHolder&amp;lt;&lt;b&gt;RedisConnection&lt;/b&gt;&amp;gt; &lt;b&gt;connectionsHolder&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final ConnectionsHolder&amp;lt;&lt;b&gt;RedisPubSubConnection&lt;/b&gt;&amp;gt; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;b&gt;pubSubConnectionsHolder&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final TrackedConnectionsHolder trackedConnectionsHolder;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;public enum FreezeReason {MANAGER, RECONNECT, SYSTEM}&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private volatile FreezeReason freezeReason;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;final RedisClient client;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final NodeType nodeType;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final IdleConnectionWatcher idleConnectionWatcher;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final ConnectionManager connectionManager;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private volatile boolean initialized = false;&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final WrappedLock lock = new WrappedLock();&lt;/p&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;private final Map&amp;lt;RedisConnection, ConnectionsHolder&amp;lt;?&amp;gt;&amp;gt; connection2holder &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;= new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;hr style=&quot;font-size: 11px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=11;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-2520" y="560" width="400" height="280" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-94" value="发送Redis命令" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="40" y="500" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-98" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-95" target="wK_E6LMROi6GtL9PwVPp-97">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-95" value="return connectionsHolder.initConnections(&lt;br&gt;minimumIdleSize);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="3080" y="1130" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-100" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-97" target="wK_E6LMROi6GtL9PwVPp-99">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-97" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//这里可以看到是通过 thenCompse()&amp;nbsp;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;顺序创建&amp;nbsp;minimumIdleSize 个连接&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;CompletableFuture&amp;lt;Void&amp;gt; f =&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;b&gt;createConnection&lt;/b&gt;(minimumIdleSize, 1);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;for (int i = 2; i &amp;lt;= minimumIdleSize; i++) {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; int k = i;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; f = f.&lt;b&gt;thenCompose&lt;/b&gt;(r -&amp;gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;b&gt;createConnection&lt;/b&gt;(minimumIdleSize, k));&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;}&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;return f.thenAccept(r -&amp;gt; {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; log.info(&quot;{} connections initialized for {}&quot;, minimumIdleSize, client.getAddr());&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;});&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;glass=0;strokeWidth=1;shadow=0;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;arcSize=4;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="3320" y="1100" width="440" height="120" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-105" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-99" target="wK_E6LMROi6GtL9PwVPp-106">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="4280" y="1160" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-99" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;CompletableFuture&amp;lt;Void&amp;gt; f = acquireConnection();&lt;/div&gt;&lt;div style=&quot;&quot;&gt;return f.thenCompose(r -&amp;gt; {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; CompletableFuture&amp;lt;T&amp;gt; promise = new CompletableFuture&amp;lt;&amp;gt;();&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#007fff&quot;&gt;//1&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;createConnection&lt;/b&gt;(promise);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; return promise.handle((conn, e) -&amp;gt; {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (e == null) {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (changeUsage) {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; conn.decUsage();&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;addConnection&lt;/b&gt;(conn);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; releaseConnection();&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (e != null) {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; for (RedisConnection connection : getAllConnections()) {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (!connection.isClosed()) {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; connection.closeAsync();&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; getAllConnections().clear();&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; int totalInitializedConnections = index - 1;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; String errorMsg;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (totalInitializedConnections == 0) {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; errorMsg = &quot;Unable to connect to Redis server: &quot; + client.getAddr();&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; errorMsg = &quot;Unable to init enough connections amount! Only &quot; +&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;totalInitializedConnections&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;+ &quot; of &quot; + minimumIdleSize +&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&quot; were initialized. Redis server: &quot; + client.getAddr();&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Exception cause = new RedisConnectionException(errorMsg, e);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; throw new CompletionException(cause);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return null;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; });&lt;/div&gt;&lt;div style=&quot;&quot;&gt;});&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;glass=0;strokeWidth=1;shadow=0;align=left;arcSize=2;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="3800" y="920" width="440" height="480" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-101" value="MasterSlaveEntry" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="2770" y="880" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-102" value="ClientConnectionsEntry" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="3110" y="1100" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-103" value="ConnectionsHolder" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="3475" y="1070" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-108" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-106" target="wK_E6LMROi6GtL9PwVPp-109">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="4670" y="1160" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-106" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;CompletionStage&amp;lt;T&amp;gt; connFuture = &lt;b&gt;connectionCallback&lt;/b&gt;.&lt;b&gt;apply&lt;/b&gt;(client);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;connFuture.whenComplete((conn, e) -&amp;gt; {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; if (e != null) {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; releaseConnection();&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; promise.completeExceptionally(e);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; log.debug(&quot;new connection created: {}&quot;, conn);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; allConnections.add(conn);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; if (changeUsage) {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; promise.thenApply(c -&amp;gt; c.incUsage());&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; connectedSuccessful(promise, conn);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;});&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;glass=0;strokeWidth=1;shadow=0;align=left;arcSize=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="4280" y="1050" width="320" height="220" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-111" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="wK_E6LMROi6GtL9PwVPp-109" target="wK_E6LMROi6GtL9PwVPp-110">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-109" value="RedisClient#connectAsync()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;glass=0;strokeWidth=1;shadow=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="4640" y="1130" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="wK_E6LMROi6GtL9PwVPp-110" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;CompletableFuture&amp;lt;InetSocketAddress&amp;gt; addrFuture = resolveAddr();&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;CompletableFuture&amp;lt;RedisConnection&amp;gt; f = addrFuture.thenCompose(&lt;b&gt;res&lt;/b&gt; -&amp;gt; {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; CompletableFuture&amp;lt;RedisConnection&amp;gt; r = new CompletableFuture&amp;lt;&amp;gt;();&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; //调用Netty接口建立连接&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; ChannelFuture channelFuture = bootstrap.connect(res);&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; channelFuture.&lt;b&gt;addListener&lt;/b&gt;(new ChannelFutureListener() {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; @Override&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; public void operationComplete(final &lt;b&gt;ChannelFuture future&lt;/b&gt;) throws Exception {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/font&gt;if (isShutdown()) { &lt;font color=&quot;#007fff&quot;&gt;//判断RedisClient shutdown 以及 bootstrap.config().group() 状态&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; RedisConnectionException cause = new RedisConnectionException(&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&quot;RedisClient is shutdown&quot;);&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; r.completeExceptionally(cause);&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (future.isSuccess()) {&amp;nbsp; &lt;font color=&quot;#007fff&quot;&gt;//即 connect() 成功&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//连接成功后获取连接通道Channel&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;RedisConnection&lt;/b&gt; c = RedisConnection.getFrom(future.&lt;b&gt;channel&lt;/b&gt;());&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//connect() 成功后需要注册回调：当连接被complete后回调，用于关闭连接&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; c.getConnectionPromise().whenComplete((res, e) -&amp;gt; {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; bootstrap.config().group().execute(new Runnable() {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; @Override&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; public void run() {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (e == null) {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (!r.complete(c)) {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; c.closeAsync();&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; executor.execute(() -&amp;gt; {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (config.getConnectedListener() != null) {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; config.getConnectedListener().accept(getAddr());&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; });&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; r.completeExceptionally(e);&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; c.closeAsync();&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; });&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; });&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else { &lt;font color=&quot;#007fff&quot;&gt;//即 connect() 失败&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; bootstrap.config().group().execute(new Runnable() {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; public void run() {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; r.completeExceptionally(future.cause());&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; });&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; });&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; return r;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;});&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;return new CompletableFutureWrapper&amp;lt;&amp;gt;(f);&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;glass=0;strokeWidth=1;shadow=0;fillColor=#d5e8d4;strokeColor=#82b366;align=left;arcSize=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="4880" y="880" width="400" height="560" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
