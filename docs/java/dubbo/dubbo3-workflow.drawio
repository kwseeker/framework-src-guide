<mxfile host="Electron" modified="2024-01-23T07:55:49.175Z" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/21.6.5 Chrome/114.0.5735.243 Electron/25.3.1 Safari/537.36" etag="Z10WPSz8iTf5O8sq6ACX" version="21.6.5" type="device">
  <diagram name="Dubbo主流程" id="0Qyq6zLl2fmwNNAztLvH">
    <mxGraphModel dx="3694" dy="733" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-61" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;fillColor=#d5e8d4;strokeColor=#82b366;entryX=1;entryY=0.25;entryDx=0;entryDy=0;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-53" target="-OMnOMYa6ulq2eywQm4B-4" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2500" y="6905" />
              <mxPoint x="2500" y="6930" />
              <mxPoint x="1300" y="6930" />
              <mxPoint x="1300" y="6955" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-83" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;dashed=1;endArrow=block;endFill=0;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-82" target="Uk-qqwOQmqZAEX01Hiqb-38" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-1400" y="3752.5" />
              <mxPoint x="-1520" y="3752.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-84" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;dashed=1;endArrow=block;endFill=0;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-82" target="Uk-qqwOQmqZAEX01Hiqb-33" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-1400" y="3752.5" />
              <mxPoint x="-1240" y="3752.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-91" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;dashed=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-90" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-720" y="3722.5" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-640" y="3742.5" />
              <mxPoint x="-720" y="3742.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-109" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;endArrow=diamondThin;endFill=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-96" target="LEzOs3IW3RDwebMgTtXX-26" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-1" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-86" target="VcwutDj3bW0QsIIaURAk-49" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1029.9999999999995" y="830.1764705882354" as="targetPoint" />
            <Array as="points">
              <mxPoint x="820" y="830" />
              <mxPoint x="820" y="505" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-49" value="1" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="LEzOs3IW3RDwebMgTtXX-1" vertex="1" connectable="0">
          <mxGeometry x="-0.9223" y="2" relative="1" as="geometry">
            <mxPoint y="-7" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="30zH5Bm8l3Furl-t-DYP-1" value="&lt;h1 style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;Dubbo工作原理 &lt;/font&gt;&lt;font style=&quot;font-size: 16px; font-weight: normal;&quot;&gt;（3.2.9）&lt;/font&gt;&lt;/h1&gt;&lt;p style=&quot;font-size: 10px;&quot;&gt;Dubbo3 是在云原生背景下诞生的，使用 Dubbo 构建的微服务遵循云原生思想，能更好的复用底层云原生基础设施、贴合云原生微服务架构。Dubbo或许能基于云原生迸发第二春；&lt;br&gt;Spring初始化相关代码流程做了简化，详细参考 spring-context.drawio。&lt;br&gt;官方源码解析：&lt;span style=&quot;background-color: initial;&quot;&gt;https://cn.dubbo.apache.org/zh-cn/blog/java/codeanalysis/3.0.8/ (个人感觉官方源码解析写的东西还是碎片化的，没多大帮助)&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;关于Dubbo SPI 原理参考 dubbo-spi.drawio&lt;/font&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="40" y="10" width="840" height="100" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-8" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-1" target="VcwutDj3bW0QsIIaURAk-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-9" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-1" target="VcwutDj3bW0QsIIaURAk-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-1" value="服务提供者和消费者&lt;br&gt;启动流程" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="40" y="220" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-11" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-2" target="VcwutDj3bW0QsIIaURAk-10" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="340" y="250" />
              <mxPoint x="340" y="730" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-26" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-2" target="VcwutDj3bW0QsIIaURAk-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-27" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-2" target="VcwutDj3bW0QsIIaURAk-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-2" value="自动配置&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;一些自动配置类&lt;br&gt;先看个大概，后面用到再逆向看&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="200" y="220" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-3" value="接口层" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="40" y="120" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-29" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-4" target="VcwutDj3bW0QsIIaURAk-28" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-105" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="VcwutDj3bW0QsIIaURAk-4" target="H5okSNMw3-DTD0Bd1JaA-104" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="200" y="7450" as="targetPoint" />
            <Array as="points">
              <mxPoint x="180" y="6970" />
              <mxPoint x="180" y="7450" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-4" value="服务消费者调用" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="40" y="6940" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-6" value="&lt;font color=&quot;#007fff&quot;&gt;提供接口定义，用于服务提供者和消费者生成远程调用的服务端和客户端Stub&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="170" y="120" width="230" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-13" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-7" target="VcwutDj3bW0QsIIaURAk-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-7" value="系统初始化&lt;br&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;&lt;b&gt;自动配置&lt;/b&gt;属于系统初始化，只不过总是先看自动配置的代码用于提供读源码的切入点&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="200" y="800" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-74" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-10" target="VcwutDj3bW0QsIIaURAk-73" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-10" value="@EnableDubbo" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="360" y="700" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-87" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-12" target="VcwutDj3bW0QsIIaURAk-86" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-88" value="..." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="VcwutDj3bW0QsIIaURAk-87" vertex="1" connectable="0">
          <mxGeometry x="-0.263" y="-2" relative="1" as="geometry">
            <mxPoint x="5" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-65" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-12" target="LEzOs3IW3RDwebMgTtXX-59" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="570" y="830" />
              <mxPoint x="570" y="990" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-66" value="..." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="LEzOs3IW3RDwebMgTtXX-65" vertex="1" connectable="0">
          <mxGeometry x="0.7415" relative="1" as="geometry">
            <mxPoint x="6" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-98" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-12" target="LEzOs3IW3RDwebMgTtXX-97" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-101" value="..." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="LEzOs3IW3RDwebMgTtXX-98" vertex="1" connectable="0">
          <mxGeometry x="-0.571" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-106" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-12" target="LEzOs3IW3RDwebMgTtXX-105" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="570" y="830" />
              <mxPoint x="570" y="1770" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-94" value="..." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="LEzOs3IW3RDwebMgTtXX-106" vertex="1" connectable="0">
          <mxGeometry x="0.9637" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-115" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-12" target="LEzOs3IW3RDwebMgTtXX-114" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="570" y="830" />
              <mxPoint x="570" y="1070" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-92" value="..." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="LEzOs3IW3RDwebMgTtXX-115" vertex="1" connectable="0">
          <mxGeometry x="0.8841" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-118" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-12" target="LEzOs3IW3RDwebMgTtXX-116" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="570" y="830" />
              <mxPoint x="570" y="1930" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-95" value="..." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="LEzOs3IW3RDwebMgTtXX-118" vertex="1" connectable="0">
          <mxGeometry x="0.9594" y="3" relative="1" as="geometry">
            <mxPoint x="3" y="3" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-122" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-12" target="LEzOs3IW3RDwebMgTtXX-121" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="570" y="830" />
              <mxPoint x="570" y="1150" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-93" value="..." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="LEzOs3IW3RDwebMgTtXX-122" vertex="1" connectable="0">
          <mxGeometry x="0.8799" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-12" value="&lt;b&gt;invokeBeanFactoryPostProcessors&lt;/b&gt;(&lt;br&gt;beanFactory);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;执行BeanFactory后置处理&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;主要是针对 BeanDefinition&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="360" y="800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-31" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-22" target="VcwutDj3bW0QsIIaURAk-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-22" value="dubbo-spring-boot-starter&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;核心功能配置&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="360" y="220" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-72" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-24" target="VcwutDj3bW0QsIIaURAk-71" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-24" value="dubbo-nacos-spring-boot-starter&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;服务发现功能配置，支持Nacos、ZK、Consul、ETCD, 这里以Nacos为例&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="360" y="460" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-102" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-1" target="H5okSNMw3-DTD0Bd1JaA-101" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-28" value="本地调用" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="200" y="6940" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-33" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-30" target="VcwutDj3bW0QsIIaURAk-32" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-38" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-30" target="VcwutDj3bW0QsIIaURAk-34" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-39" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-30" target="VcwutDj3bW0QsIIaURAk-36" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-30" value="dubbo-spring-boot-autoconfigure&lt;br&gt;内部依赖&amp;nbsp;&lt;br&gt;dubbo-spring-boot-autoconfigure-compatible" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="600" y="220" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-41" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-32" target="VcwutDj3bW0QsIIaURAk-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-44" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-32" target="VcwutDj3bW0QsIIaURAk-42" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1060" y="250" />
              <mxPoint x="1060" y="330" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-32" value="DubboRelaxedBinding2AutoConfiguration&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;@ConditionalOnProperty 属性条件：dubbo.enabled = true, 默认就是true&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="840" y="220" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-46" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-34" target="VcwutDj3bW0QsIIaURAk-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-48" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-34" target="VcwutDj3bW0QsIIaURAk-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-53" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-34" target="VcwutDj3bW0QsIIaURAk-51" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-34" value="DubboAutoConfiguration" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="840" y="380" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-36" value="DubboRelaxedBindingAutoConfiguration&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;DubboRelaxedBinding2AutoConfiguration&lt;br&gt;存在的话此配置类不会起作用&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="840" y="300" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-59" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.25;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-40" target="VcwutDj3bW0QsIIaURAk-51" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1290" y="250" />
              <mxPoint x="1290" y="560" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-40" value="@Bean(name = BASE_PACKAGES_BEAN_NAME)&lt;br style=&quot;font-size: 10px;&quot;&gt;Set&amp;lt;String&amp;gt; dubboBasePackages(...)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;内部通过PropertyResolver读取base-packages&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1080" y="220" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-42" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;@Bean(RELAXED_DUBBO_CONFIG&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;_BINDER_BEAN_NAME)&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; @Scope(scopeName = &lt;/span&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;SCOPE_PROTOTYPE&lt;/font&gt;)&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;b style=&quot;font-size: 9px;&quot;&gt;ConfigurationBeanBinder&lt;/b&gt; relaxedDubboConfigBinder()&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1080" y="300" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-45" value="@EnableConfigurationProperties({&lt;br&gt;&lt;b&gt;DubboConfigurationProperties&lt;/b&gt;.class})&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;Dubbo配置属性类&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1080" y="380" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-50" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-47" target="VcwutDj3bW0QsIIaURAk-49" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-3" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-47" target="LEzOs3IW3RDwebMgTtXX-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-47" value="@EnableDubboConfig" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1080" y="460" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-5" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-49" target="LEzOs3IW3RDwebMgTtXX-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-49" value="@Import({&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;b style=&quot;font-size: 9px;&quot;&gt;DubboConfigConfigurationRegistrar&lt;/b&gt;.class})" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1320" y="460" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-51" value="创建 &lt;b&gt;ServiceAnnotationPostProcessor&lt;/b&gt;&amp;nbsp;类型Bean通过&amp;nbsp;@Qualifier(BASE_PACKAGES_BEAN_NAME) 注入依赖&amp;nbsp;dubboBasePackages&lt;br&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;如果没有设置 dubbo.scan.base-packages 属性不会创建，测试DEMO没有配置此属性&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1080" y="540" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-58" value="&lt;font color=&quot;#007fff&quot; style=&quot;&quot;&gt;创建了一个Bean dubboBasePackages&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;内容是Dubbo base-packages 列表&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1300" y="230" width="190" height="40" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-60" value="&lt;font color=&quot;#007fff&quot; style=&quot;&quot;&gt;创建了一个Bean relaxedDubboConfigBinder&lt;br style=&quot;font-size: 10px;&quot;&gt;TODO 用途&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1300" y="310" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-63" value="后面忽略一些ApplicationListener &lt;br style=&quot;font-size: 10px;&quot;&gt;和 应用上下文初始化器" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#007FFF;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="615" y="280" width="170" height="40" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-68" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1770" y="475" width="20" height="30" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-71" value="依赖 nacos-client" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="600" y="460" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-77" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-73" target="VcwutDj3bW0QsIIaURAk-76" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-73" value="&lt;div&gt;@EnableDubboConfig&lt;/div&gt;&lt;div&gt;&lt;b&gt;@DubboComponentScan&lt;/b&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="600" y="700" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-79" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-76" target="VcwutDj3bW0QsIIaURAk-78" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-76" value="@Import(&lt;br&gt;&lt;b&gt;DubboComponentScanRegistrar&lt;/b&gt;.class)&lt;br&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;主要是扫描 @DubboComponentScan basePakcages、basePackageClasses，&lt;/font&gt;&lt;span style=&quot;color: rgb(0, 127, 255); background-color: initial;&quot;&gt;@EnableDubbo scanBasePackages、scanBasePackageClasses 注册Bean定义&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="840" y="690" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-52" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-78" target="LEzOs3IW3RDwebMgTtXX-22" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1780" y="730" />
              <mxPoint x="1780" y="505" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-54" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-78" target="LEzOs3IW3RDwebMgTtXX-53" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-63" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;dashed=1;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-78" target="LEzOs3IW3RDwebMgTtXX-4" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1540" y="715" />
              <mxPoint x="1540" y="505" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-78" value="&lt;div&gt;DubboSpringInitializer.initialize(registry);&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;前面已经执行过一次了，这次就不会再初始化了&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1080" y="700" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-84" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;如果想研究Dubbo服务一步步怎么启动的可以参考&lt;br&gt;日志输出，给对应的类加断点一步步调试，也可以顺着自动配置类一步步深入&lt;br&gt;&lt;br&gt;如果只想看关键点实现原理，可以通过注解类、NacosClient&amp;nbsp;&lt;br&gt;接口等找到相应代码加端点调试&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="200" y="290" width="280" height="90" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-85" value="&lt;b&gt;Spring refresh()&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="405" y="770" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-50" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;rounded=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-86" target="VcwutDj3bW0QsIIaURAk-76" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="830" y="830" />
              <mxPoint x="830" y="750" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-51" value="2" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="LEzOs3IW3RDwebMgTtXX-50" vertex="1" connectable="0">
          <mxGeometry x="-0.346" y="1" relative="1" as="geometry">
            <mxPoint y="-9" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-86" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;b&gt;registrars&lt;/b&gt;.forEach((registrar, metadata) -&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;registrar.registerBeanDefinitions(metadata, this.registry,this.importBeanNameGenerator));&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;遍历所有ImportBeanDefinitionRegistrar实例注册BeanDefinition，这里只关注Dubbo的&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="600" y="800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VcwutDj3bW0QsIIaURAk-89" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;ConfigurationClassBeanDefinitionReader&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="595" y="770" width="210" height="30" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-2" value="boolean &lt;b&gt;multiple&lt;/b&gt;() default true;&lt;br&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;用于选择Bean实现 DubboConfigConfiguration.&lt;b&gt;Single&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;或 DubboConfigConfiguration.&lt;b&gt;Multiple&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;" parent="1" vertex="1">
          <mxGeometry x="1320" y="380" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-7" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-22" target="LEzOs3IW3RDwebMgTtXX-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-4" value="&lt;b&gt;DubboSpringInitializer&lt;/b&gt;.initialize(registry);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;registry是Bean工厂&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1560" y="460" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-15" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-6" target="LEzOs3IW3RDwebMgTtXX-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-17" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-6" target="LEzOs3IW3RDwebMgTtXX-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-6" value="customize(context);&lt;br style=&quot;font-size: 10px;&quot;&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2040" y="460" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-21" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;endArrow=diamondThin;endFill=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-12" target="LEzOs3IW3RDwebMgTtXX-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-450" y="730" />
              <mxPoint x="-450" y="760" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-12" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;DubboSpringInitializer &lt;/b&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;Dubbo初始化上下文的容器&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//Dubbo初始化上下文Map&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;private static final Map&amp;lt;BeanDefinitionRegistry, DubboSpringInitContext&amp;gt; &lt;b&gt;contextMap&lt;/b&gt; =&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&amp;nbsp; new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;public static void initialize(BeanDefinitionRegistry registry)&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="-440" y="680" width="400" height="100" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-27" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=diamondThin;endFill=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-13" target="LEzOs3IW3RDwebMgTtXX-26" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-13" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;DubboSpringInitContext&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;private BeanDefinitionRegistry registry;&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ConfigurableListableBeanFactory beanFactory; &lt;font color=&quot;#007fff&quot;&gt;//Spring Bean容器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ApplicationContext applicationContext;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;//Spring应用上下文&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//DubboSpringInitializer初始化时创建了ApplicationModel对象，再借助此对象创建ModuleModel对象&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private &lt;b&gt;ModuleModel&lt;/b&gt; moduleModel;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;private final Map&amp;lt;String, Object&amp;gt; &lt;b&gt;moduleAttributes&lt;/b&gt; = new HashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;//这里绑定的意思是DubboSpringInitContext、ApplicationModel、ModuleModel是否已经注册到Spring Bean容器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile boolean &lt;b&gt;bound&lt;/b&gt;;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#ffcd28;strokeColor=#d79b00;gradientColor=#ffa500;" parent="1" vertex="1">
          <mxGeometry x="-920" y="680" width="440" height="160" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-43" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-14" target="LEzOs3IW3RDwebMgTtXX-42" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-14" value="applicationModel = ApplicationModel.&lt;b&gt;defaultModel&lt;/b&gt;();&lt;br style=&quot;font-size: 10px;&quot;&gt;moduleModel = applicationModel.&lt;b&gt;getDefaultModule&lt;/b&gt;();&lt;br style=&quot;font-size: 10px;&quot;&gt;context.&lt;b&gt;setModuleModel&lt;/b&gt;(moduleModel);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="2040" y="620" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-19" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-16" target="LEzOs3IW3RDwebMgTtXX-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-41" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-16" target="LEzOs3IW3RDwebMgTtXX-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-16" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;Set&amp;lt;DubboSpringInitCustomizer&amp;gt; customizers = FrameworkModel.&lt;b&gt;defaultModel&lt;/b&gt;()&lt;/div&gt;&lt;div style=&quot;&quot;&gt;.getExtensionLoader(&lt;font style=&quot;font-size: 8px;&quot;&gt;&lt;b&gt;DubboSpringInitCustomizer&lt;/b&gt;&lt;/font&gt;.class)&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;.getSupportedExtensionInstances();&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;SPI 加载&amp;nbsp;&lt;b&gt;DubboSpringInitCustomizer&lt;/b&gt; 并遍历执行&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;" parent="1" vertex="1">
          <mxGeometry x="2270" y="460" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-30" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-18" target="LEzOs3IW3RDwebMgTtXX-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-18" value="defaultInstance = new &lt;b&gt;FrameworkModel&lt;/b&gt;();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;初始化了很多内部的组件，TODO 后面用到再回来看，需要结合业务理解&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2520" y="460" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-25" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-20" target="LEzOs3IW3RDwebMgTtXX-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-20" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;FrameworkModel &lt;/b&gt;框架模型, 单例模式&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;public static final String NAME = &quot;FrameworkModel&quot;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private static final AtomicLong index = new AtomicLong(1);&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private static final Object globalLock = new Object();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private &lt;b&gt;static&lt;/b&gt; volatile FrameworkModel &lt;b&gt;defaultInstance&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private &lt;b&gt;static&lt;/b&gt; final List&amp;lt;FrameworkModel&amp;gt; &lt;b&gt;allInstances&lt;/b&gt; = new CopyOnWriteArrayList&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final AtomicLong appIndex = new AtomicLong(0);&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile ApplicationModel &lt;b&gt;defaultAppModel&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//内部包含的 ApplicationModel&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final List&amp;lt;ApplicationModel&amp;gt; &lt;b&gt;applicationModels&lt;/b&gt; = new CopyOnWriteArrayList&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final List&amp;lt;ApplicationModel&amp;gt; &lt;b&gt;pubApplicationModels&lt;/b&gt; = new CopyOnWriteArrayList&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//ProviderModel的容器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final FrameworkServiceRepository &lt;b&gt;serviceRepository&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//创建FrameworkModel时会默认创建一个ApplicationModel实例&lt;/font&gt;&lt;/p&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;Dubbo Application[1.0](unknown)&lt;/font&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ApplicationModel &lt;b&gt;internalApplicationModel&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ReentrantLock destroyLock = new ReentrantLock();&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;public ApplicationModel getApplicationModel()&amp;nbsp;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-1400" y="400" width="440" height="270" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-23" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-4" target="LEzOs3IW3RDwebMgTtXX-22" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1760" y="490" as="sourcePoint" />
            <mxPoint x="2040" y="490" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-22" value="创建初始化上下文 &lt;b&gt;DubboSpringInitContext&lt;/b&gt; 实例，然后执行初始化" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;" parent="1" vertex="1">
          <mxGeometry x="1800" y="460" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-24" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;ScopeModel &lt;/b&gt;(A)&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String internalId; &lt;font color=&quot;#007fff&quot;&gt;//模型的层次结构&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String modelName; &lt;font color=&quot;#007fff&quot;&gt;//公共模型名称&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String desc;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Set&amp;lt;ClassLoader&amp;gt; classLoaders = new ConcurrentHashSet&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ScopeModel parent;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//当前模型的所属域ExtensionScope有:FRAMEWORK(框架)，APPLICATION(应用)，MODULE(模块)，SELF(自给自足，为每个作用域创建一个实例，用于特殊的SPI扩展，如ExtensionInjector)&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ExtensionScope &lt;b&gt;scope&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;//Dubbo SPI ExtensionLoader 的管理器，即拓展类加载器的管理器，保存各种类型拓展类的类加载器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile ExtensionDirector &lt;b&gt;extensionDirector&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//用于Dubbo内部共享对象的存储&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile ScopeBeanFactory &lt;b&gt;beanFactory&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final List&amp;lt;ScopeModelDestroyListener&amp;gt; destroyListeners = new CopyOnWriteArrayList&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final List&amp;lt;ScopeClassLoaderListener&amp;gt; classLoaderListeners = new CopyOnWriteArrayList&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Map&amp;lt;String, Object&amp;gt; attributes = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final AtomicBoolean destroyed = new AtomicBoolean(false);&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final boolean internalScope;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected final Object instLock = new Object();&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-920" y="40" width="440" height="280" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-28" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-26" target="LEzOs3IW3RDwebMgTtXX-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-26" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;ModuleModel&amp;nbsp;&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;应用的服务模块，不是对应某个具体的组件，也可能是一组组件的集合&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;public static final String NAME = &quot;ModuleModel&quot;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//所属的ApplicationModel&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ApplicationModel &lt;b&gt;applicationModel&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//services consumers providers 的容器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile ModuleServiceRepository &lt;b&gt;serviceRepository&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;//&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile ModuleEnvironment moduleEnvironment;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// 一组组件配置的容器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile &lt;b&gt;ModuleConfigManager&lt;/b&gt; &lt;b&gt;moduleConfigManager&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// 服务模块的起动器，在 ConfigScopeModelInitializer 中创建并赋值&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile &lt;b&gt;ModuleDeployer&lt;/b&gt; &lt;b&gt;deployer&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private boolean lifeCycleManagedExternally = false;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-920" y="400" width="440" height="220" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-32" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-29" target="LEzOs3IW3RDwebMgTtXX-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-29" value="initialize();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;" parent="1" vertex="1">
          <mxGeometry x="2760" y="460" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-34" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-31" target="LEzOs3IW3RDwebMgTtXX-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-31" value="TypeDefinitionBuilder.initBuilders(this);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;" parent="1" vertex="1">
          <mxGeometry x="2760" y="540" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-36" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-33" target="LEzOs3IW3RDwebMgTtXX-35" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2860" y="690" />
              <mxPoint x="2900" y="690" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-33" value="serviceRepository = new FrameworkServiceRepository(this);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;" parent="1" vertex="1">
          <mxGeometry x="2760" y="620" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-38" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-35" target="LEzOs3IW3RDwebMgTtXX-37" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2900" y="790" />
              <mxPoint x="2960" y="790" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-99" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="LEzOs3IW3RDwebMgTtXX-35" target="H5okSNMw3-DTD0Bd1JaA-98" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-100" value="比如" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" parent="H5okSNMw3-DTD0Bd1JaA-99" vertex="1" connectable="0">
          <mxGeometry x="-0.05" y="-3" relative="1" as="geometry">
            <mxPoint y="-3" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-35" value="&lt;div&gt;ExtensionLoader&amp;lt;ScopeModelInitializer&amp;gt; initializerExtensionLoader =&lt;/div&gt;&lt;div&gt;this.getExtensionLoader(&lt;b&gt;ScopeModelInitializer&lt;/b&gt;.class);&lt;/div&gt;&lt;div&gt;Set&amp;lt;ScopeModelInitializer&amp;gt; &lt;b&gt;initializers&lt;/b&gt; = initializerExtensionLoader.getSupportedExtensionInstances();&lt;/div&gt;&lt;div&gt;for (ScopeModelInitializer initializer : &lt;b&gt;initializers&lt;/b&gt;) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; initializer.&lt;b&gt;initializeFrameworkModel&lt;/b&gt;(this);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;arcSize=7;" parent="1" vertex="1">
          <mxGeometry x="2760" y="700" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-37" value="&lt;div&gt;internalApplicationModel = new &lt;b&gt;ApplicationModel&lt;/b&gt;(this, true);&lt;/div&gt;&lt;div&gt;internalApplicationModel&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .getApplicationConfigManager()&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .setApplication(new &lt;b&gt;ApplicationConfig&lt;/b&gt;(&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; internalApplicationModel, CommonConstants.DUBBO_INTERNAL_APPLICATION));&lt;/div&gt;&lt;div&gt;internalApplicationModel.setModelName(CommonConstants.DUBBO_INTERNAL_APPLICATION);&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;arcSize=7;" parent="1" vertex="1">
          <mxGeometry x="2760" y="800" width="400" height="80" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-39" value="initializers = {LinkedHashSet@5781}  size = 14&#xa; 0 = {CertScopeModelInitializer@5784} &#xa; 1 = {ClusterScopeModelInitializer@5788} &#xa; 2 = {CommonScopeModelInitializer@5789} &#xa; 3 = {ConfigScopeModelInitializer@5790} &#xa; 4 = {SpringScopeModelInitializer@5791} &#xa; 5 = {MetadataScopeModelInitializer@5792} &#xa; 6 = {MetricsScopeModelInitializer@5793} &#xa; 7 = {RegistryScopeModelInitializer@5794} &#xa; 8 = {RemotingScopeModelInitializer@5795} &#xa; 9 = {Fastjson2ScopeModelInitializer@5796} &#xa; 10 = {Hessian2ScopeModelInitializer@5797} &#xa; 11 = {QosScopeModelInitializer@5798} &#xa; 12 = {RpcScopeModelInitializer@5799} &#xa; 13 = {XdsScopeModelInitializer@5800}" style="text;whiteSpace=wrap;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="3060" y="510" width="280" height="190" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-40" value="&lt;div&gt;DubboSpringInitCustomizerHolder customizerHolder = DubboSpringInitCustomizerHolder.get();&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;customizers = customizerHolder.getCustomizers();&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;&lt;font color=&quot;#007fff&quot;&gt;从 DubboSpringInitCustomizerHolder 读取&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;b&gt;DubboSpringInitCustomizer&lt;/b&gt; 并遍历执行&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;" parent="1" vertex="1">
          <mxGeometry x="2270" y="540" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-45" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-42" target="LEzOs3IW3RDwebMgTtXX-44" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-48" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-42" target="LEzOs3IW3RDwebMgTtXX-104" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2280" y="840" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2260" y="730" />
              <mxPoint x="2260" y="840" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-42" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;b style=&quot;font-size: 9px;&quot;&gt;registerContextBeans&lt;/b&gt;(beanFactory, context);&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;context.markAsBound();&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;moduleModel.setLifeCycleManagedExternally(true);&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;DubboBeanUtils.&lt;b style=&quot;font-size: 9px;&quot;&gt;registerCommonBeans&lt;/b&gt;(registry);&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2030" y="700" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-44" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;div&gt;registerSingleton(beanFactory, &lt;b&gt;context&lt;/b&gt;);&lt;/div&gt;&lt;div&gt;registerSingleton(beanFactory, &lt;br&gt;&amp;nbsp; context.&lt;b&gt;getApplicationModel&lt;/b&gt;());&lt;/div&gt;&lt;div&gt;registerSingleton(beanFactory, &lt;br&gt;&amp;nbsp; context.&lt;b&gt;getModuleModel&lt;/b&gt;());&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="2280" y="700" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-46" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;将DubboSpringInitContext、ApplicationModel、&lt;br&gt;ModuleModel 实例注册到Spring容器&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2481" y="710" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-56" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-53" target="LEzOs3IW3RDwebMgTtXX-55" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-53" value="Set&amp;lt;String&amp;gt; packagesToScan = getPackagesToScan(&lt;br&gt;importingClassMetadata);&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;从注解中提取需要扫描的包路径，测试DEMO中就是“org.apache.dubbo.springboot.demo.provider”&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1080" y="780" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-58" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-55" target="LEzOs3IW3RDwebMgTtXX-57" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-55" value="registerServiceAnnotationPostProcessor(&lt;br&gt;packagesToScan, registry);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1080" y="860" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-60" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-57" target="LEzOs3IW3RDwebMgTtXX-59" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1420" y="950" />
              <mxPoint x="705" y="950" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-57" value="BeanDefinitionBuilder builder = rootBeanDefinition(&lt;br&gt;&lt;b&gt;&amp;nbsp; ServiceAnnotationPostProcessor&lt;/b&gt;.class);&lt;br&gt;AbstractBeanDefinition beanDefinition = &lt;br&gt;&amp;nbsp; builder.getBeanDefinition();&lt;br style=&quot;font-size: 9px;&quot;&gt;BeanDefinitionReaderUtils.registerWithGeneratedName(&lt;br&gt;&amp;nbsp; beanDefinition, registry);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;注册了ServiceAnnotationPostProcessor 这个后置处理器BeanDefinition&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1300" y="840" width="240" height="100" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-68" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-59" target="LEzOs3IW3RDwebMgTtXX-67" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-72" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-59" target="LEzOs3IW3RDwebMgTtXX-71" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-96" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-59" target="LEzOs3IW3RDwebMgTtXX-95" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-59" value="&lt;b style=&quot;font-size: 10px;&quot;&gt;ServiceAnnotationPostProcessor&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;实现 BeanDefinitionRegistryPostProcessor 接口，用于扫描Dubbo服务的BeanDefinition&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="600" y="960" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-70" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-67" target="LEzOs3IW3RDwebMgTtXX-69" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-67" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;ServiceAnnotationPostProcessor#&lt;br&gt;&lt;b&gt;afterPropertiesSet&lt;/b&gt;()&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;前面定义了此后置处理器的Bean定义，此后置处理器也需要先创建自身的Bean，然后为其他Bean执行后置处理，自身的Bean初始化后执行此方法&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="840" y="960" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-69" value="this.&lt;b style=&quot;font-size: 10px;&quot;&gt;resolvedPackagesToScan&lt;/b&gt; = resolvePackagesToScan(packagesToScan);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1080" y="960" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-74" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-71" target="LEzOs3IW3RDwebMgTtXX-73" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-71" value="ServiceAnnotationPostProcessor#&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;postProcessBeanDefinitionRegistry&lt;/b&gt;(&lt;br style=&quot;font-size: 10px;&quot;&gt;BeanDefinitionRegistry registry)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="840" y="1200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-79" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-73" target="LEzOs3IW3RDwebMgTtXX-78" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1340" y="1230" />
              <mxPoint x="1340" y="990" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-73" value="this.registry = registry;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;scanServiceBeans&lt;/b&gt;(&lt;br style=&quot;font-size: 10px;&quot;&gt;resolvedPackagesToScan, registry);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1080" y="1200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-5" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;dashed=1;endArrow=block;endFill=0;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-75" target="omU1pgqW6LJjpDUwzffS-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-75" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;ServiceAnnotationPostProcessor&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;此后置处理器用于扫描Dubbo服务（@DubboService @Service）并注册BeanDefinition&lt;br&gt;&lt;br&gt;&lt;/font&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;public static final String BEAN_NAME = &quot;dubboServiceAnnotationPostProcessor&quot;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// 扫描的注解类型，Dubbo服务定义注解是 @DubboService @Service (不是Spring的 @Service)&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private static final List&amp;lt;Class&amp;lt;? extends Annotation&amp;gt;&amp;gt; &lt;b&gt;serviceAnnotationTypes&lt;/b&gt; = &lt;br&gt;&amp;nbsp; loadServiceAnnotationTypes();&lt;/p&gt;&amp;nbsp; &lt;font color=&quot;#007fff&quot;&gt;//原始需要扫描的包路径，可以通过配置文件、注解修改&lt;/font&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected final Set&amp;lt;String&amp;gt; &lt;b&gt;packagesToScan&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//经过处理后最终需要扫描的包路径（比如原始包路径可能有多个使用分隔符连接）&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Set&amp;lt;String&amp;gt; &lt;b&gt;resolvedPackagesToScan&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Environment environment;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ResourceLoader resourceLoader;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ClassLoader classLoader;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private BeanDefinitionRegistry &lt;b&gt;registry&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//已经扫描过的包和类的记录器，用于ExcludeFilter防止重复扫描&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ServicePackagesHolder &lt;b&gt;servicePackagesHolder&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//是否已经开始扫描BeanDefinition&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile boolean &lt;b&gt;scanned&lt;/b&gt; = false;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-480" y="1120" width="440" height="280" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-81" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-78" target="LEzOs3IW3RDwebMgTtXX-80" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-78" value="&lt;div&gt;DubboClassPathBeanDefinitionScanner scanner =&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;new&amp;nbsp;&lt;b&gt;DubboClassPathBeanDefinitionScanner&lt;/b&gt;(&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;registry, environment, resourceLoader);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;Dubbo 重写了BeanDefinition扫描器用于扫描Dubbo服务&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;" parent="1" vertex="1">
          <mxGeometry x="1361" y="960" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-83" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-80" target="LEzOs3IW3RDwebMgTtXX-82" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-80" value="&lt;div&gt;for (Class&amp;lt;? extends Annotation&amp;gt; annotationType &lt;br&gt;&amp;nbsp; &amp;nbsp; : &lt;b&gt;serviceAnnotationTypes&lt;/b&gt;) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; scanner.&lt;b&gt;addIncludeFilter&lt;/b&gt;(new &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;AnnotationTypeFilter(annotationType));&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;给每个注解类型注册了一个过滤器&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;即用于过滤 &lt;b&gt;@DubboService&lt;/b&gt; &lt;b&gt;@Service&lt;/b&gt;注解的类&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;arcSize=9;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1361" y="1040" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-85" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-82" target="LEzOs3IW3RDwebMgTtXX-84" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-82" value="&lt;div&gt;&lt;div&gt;ScanExcludeFilter scanExcludeFilter = new ScanExcludeFilter();&lt;/div&gt;&lt;div&gt;scanner.addExcludeFilter(scanExcludeFilter);&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;还注册了一个排除过滤器，看实现是防止重复扫描的&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;arcSize=9;" parent="1" vertex="1">
          <mxGeometry x="1361" y="1140" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-87" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-84" target="LEzOs3IW3RDwebMgTtXX-86" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-84" value="&lt;div&gt;for (String packageToScan : packagesToScan)：&lt;br&gt;&lt;/div&gt;&lt;div&gt;scanner.&lt;b&gt;scan&lt;/b&gt;(packageToScan);&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;遍历所有包路径执行扫描，扫描到的类的BeanDefinition 注册到Spring Bean容器，在 &lt;b&gt;beanDefinitionMap&lt;/b&gt; 中可以查到&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;arcSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="1361" y="1240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-89" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-86" target="LEzOs3IW3RDwebMgTtXX-88" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-86" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;Set&amp;lt;BeanDefinitionHolder&amp;gt; beanDefinitionHolders =&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;findServiceBeanDefinitionHolders(scanner, packageToScan, registry, beanNameGenerator);&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;又扫描了一次，这次将BeanDefinition和BeanName封装成了BeanDefinitionHolder&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;arcSize=9;" parent="1" vertex="1">
          <mxGeometry x="1356" y="1320" width="210" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-91" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-88" target="LEzOs3IW3RDwebMgTtXX-90" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-88" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;for &lt;b&gt;beanDefinitionHolders&lt;/b&gt;:&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;b&gt;processScannedBeanDefinition&lt;/b&gt;(&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; beanDefinitionHolder);&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;遍历第二次扫描获取的BeanDefinitionHolder，依次&lt;b&gt;创建&lt;/b&gt;并注册RootBeanDefinition实例到Spring容器&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;arcSize=9;" parent="1" vertex="1">
          <mxGeometry x="1356" y="1400" width="210" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-90" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;registry.&lt;b&gt;registerBeanDefinition&lt;/b&gt;(&lt;/div&gt;&lt;div style=&quot;&quot;&gt;serviceBeanName, serviceBeanDefinition);&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;如果已经注册且是同一BeanDefinition就直接返回，不是同一个就抛异常，没有注册就重新注册&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;arcSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="1601" y="1400" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-51" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-95" target="omU1pgqW6LJjpDUwzffS-50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-95" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;ServiceAnnotationPostProcessor#&lt;br style=&quot;&quot;&gt;&lt;/font&gt;&lt;b style=&quot;font-size: 9px;&quot;&gt;postProcessBeanFactory&lt;/b&gt;(&lt;br style=&quot;font-size: 9px;&quot;&gt;ConfigurableListableBeanFactory beanFactory)&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-weight: bold; font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;处理配置类中 @Bean方法的 Dubbo Service注解&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="840" y="1640" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-100" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-97" target="LEzOs3IW3RDwebMgTtXX-99" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-109" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-97" target="LEzOs3IW3RDwebMgTtXX-107" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="580" y="2230" />
              <mxPoint x="580" y="2410" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-123" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-97" target="LEzOs3IW3RDwebMgTtXX-120" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-97" value="&lt;div&gt;&lt;b&gt;finishBeanFactoryInitialization&lt;/b&gt;(&lt;/div&gt;&lt;div&gt;beanFactory)&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;Bean实例化与初始化&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="360" y="2200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-111" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-99" target="LEzOs3IW3RDwebMgTtXX-110" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="560" y="2790" />
              <mxPoint x="560" y="2790" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-99" value="&lt;div&gt;&lt;b&gt;finishRefresh()&lt;/b&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="360" y="2760" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-104" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;又往Spring容器注册了几个&lt;b&gt;BeanDefinition&lt;/b&gt;:&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;ServicePackagesHolder&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;b&gt;ReferenceBeanManager&lt;/b&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;ReferenceAnnotationBeanPostProcessor&lt;br style=&quot;font-size: 9px;&quot;&gt;DubboConfigAliasPostProcessor&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;b&gt;DubboDeployApplicationListener&lt;/b&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;DubboConfigApplicationListener&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;DubboConfigDefaultPropertyValueBeanPostProcessor&lt;/font&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;DubboConfigBeanInitializer&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;DubboInfraBeanRegisterPostProcessor&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#ffe6cc;strokeColor=#d79b00;arcSize=4;" parent="1" vertex="1">
          <mxGeometry x="2280" y="780" width="201" height="120" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-20" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-105" target="omU1pgqW6LJjpDUwzffS-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-105" value="&lt;b style=&quot;font-size: 10px;&quot;&gt;ReferenceAnnotationBeanPostProcessor&lt;/b&gt;&lt;font color=&quot;#007fff&quot;&gt;实现了BeanDefinitionRegistryPostProcessor接口，用于扫描Dubbo消费者&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="600" y="1740" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-34" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-107" target="omU1pgqW6LJjpDUwzffS-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-107" value="&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;DubboConfigBeanInitializer&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;&quot; color=&quot;#007fff&quot;&gt;这是一个普通Bean&lt;/font&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="600" y="2380" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-189" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-110" target="omU1pgqW6LJjpDUwzffS-188" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-110" value="&lt;span style=&quot;font-size: 10px;&quot;&gt;DubboDeployApplicationListener#&lt;/span&gt;&lt;br&gt;onApplicationEvent(ApplicationContextEvent event)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;实现了Spring ApplicationListener，主要关注Spring ContextRefreshedEvent 事件的处理&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="600" y="2760" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-38" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-114" target="omU1pgqW6LJjpDUwzffS-37" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="780" y="1070" />
              <mxPoint x="780" y="1070" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-114" value="&lt;b style=&quot;font-size: 10px;&quot;&gt;DubboConfigAliasPostProcessor&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;别名处理，就是在Bean初始化后往&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;BeanDefinitionRegistry中给Bean注册一下别名&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="600" y="1040" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-116" value="&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;DubboConfigDefaultPropertyValue&lt;/b&gt;&lt;br&gt;&lt;b&gt;BeanPostProcessor&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;&quot; color=&quot;#007fff&quot;&gt;在Bean初始化之前给Bean设置属性，TODO&lt;/font&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="600" y="1900" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-36" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-120" target="omU1pgqW6LJjpDUwzffS-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-89" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-120" target="omU1pgqW6LJjpDUwzffS-88" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-120" value="&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;ReferenceAnnotationBeanPostProcessor&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;&quot; color=&quot;#007fff&quot;&gt;同时实现了 BeanPostProcessor及其子接口&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;分析消费者时再细看&lt;/font&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="600" y="2200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-42" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-121" target="omU1pgqW6LJjpDUwzffS-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-47" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;rounded=1;" parent="1" source="LEzOs3IW3RDwebMgTtXX-121" target="omU1pgqW6LJjpDUwzffS-45" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="810" y="1150" />
              <mxPoint x="810" y="1430" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEzOs3IW3RDwebMgTtXX-121" value="&lt;b&gt;DubboInfraBeanRegisterPostProcessor&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="600" y="1120" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-1" value="Dubbo注册了很多各种类型后置处理器，&lt;br&gt;最好先梳理下各类型后置处理器及方法的执行时机" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="200" y="880" width="240" height="90" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-4" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-2" target="omU1pgqW6LJjpDUwzffS-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-2" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;BeanDefinitionRegistryPostProcessor (I)&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;void &lt;/span&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;postProcessBeanDefinitionRegistry&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;(BeanDefinitionRegistry var1) throws BeansException;&lt;/span&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-480" y="980" width="440" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-3" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;BeanFactoryPostProcessor （I）&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;void &lt;/span&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;postProcessBeanFactory&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;(ConfigurableListableBeanFactory beanFactory) throws BeansException;&lt;/span&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-480" y="880" width="440" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-8" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0.25;entryY=1;entryDx=0;entryDy=0;dashed=1;endArrow=block;endFill=0;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-6" target="omU1pgqW6LJjpDUwzffS-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-630" y="1360" />
              <mxPoint x="-500" y="1360" />
              <mxPoint x="-500" y="970" />
              <mxPoint x="-370" y="970" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-15" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-6" target="omU1pgqW6LJjpDUwzffS-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-6" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;ReferenceAnnotationBeanPostProcessor&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;此后置处理器可扫描Dubbo消费者（@DubboReference&amp;nbsp;@Reference）并注册BeanDefinition&lt;br&gt;&lt;br&gt;&lt;/font&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;public static final String BEAN_NAME = &quot;referenceAnnotationBeanPostProcessor&quot;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private static final int CACHE_SIZE = Integer.getInteger(BEAN_NAME + &quot;.cache.size&quot;, 32);&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//已经解析的注释（创建BeanDefinition并注册到Spring容器和referenceBeanManager&lt;/font&gt;&lt;span style=&quot;color: rgb(0, 127, 255); background-color: initial;&quot;&gt;）有@DubboReference @Reference的&lt;b&gt;字段&lt;/b&gt;的名称&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConcurrentMap&amp;lt;InjectionMetadata.InjectedElement, String&amp;gt; &lt;b&gt;injectedFieldReferenceBeanCache&lt;/b&gt; =&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; new ConcurrentHashMap&amp;lt;&amp;gt;(CACHE_SIZE);&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//已经解析的注释（创建BeanDefinition并注册到Spring容器和referenceBeanManager）有@DubboReference @Reference的&lt;b&gt;@Bean方法&lt;/b&gt;的名称&lt;/font&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConcurrentMap&amp;lt;InjectionMetadata.InjectedElement, String&amp;gt; &lt;b&gt;injectedMethodReferenceBeanCache&lt;/b&gt; =&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; new ConcurrentHashMap&amp;lt;&amp;gt;(CACHE_SIZE);&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ApplicationContext applicationContext;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ReferenceBeanManager &lt;b&gt;referenceBeanManager&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private BeanDefinitionRegistry &lt;b&gt;beanDefinitionRegistry&lt;/b&gt;;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-960" y="1400" width="440" height="260" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-17" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-9" target="omU1pgqW6LJjpDUwzffS-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-9" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;MergedBeanDefinitionPostProcessor&lt;/b&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;(I)&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;void postProcessMergedBeanDefinition(RootBeanDefinition beanDefinition, Class&amp;lt;?&amp;gt; beanType, String beanName);&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;void resetBeanDefinition(String beanName)&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-960" y="980" width="440" height="70" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-13" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;dashed=1;endArrow=block;endFill=0;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-11" target="omU1pgqW6LJjpDUwzffS-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-14" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;dashed=1;endArrow=block;endFill=0;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-11" target="omU1pgqW6LJjpDUwzffS-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-11" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;AbstractAnnotationBeanPostProcessor&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private static final int CACHE_SIZE = Integer.getInteger(&quot;&quot;, 32);&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//@DubboReference @Reference 还有一个老版本的@Reference&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Class&amp;lt;? extends Annotation&amp;gt;[] &lt;b&gt;annotationTypes&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConcurrentMap&amp;lt;String, AbstractAnnotationBeanPostProcessor.AnnotatedInjectionMetadata&amp;gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;injectionMetadataCache&lt;/b&gt; = new ConcurrentHashMap&amp;lt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; String, AbstractAnnotationBeanPostProcessor.AnnotatedInjectionMetadata&amp;gt;(CACHE_SIZE);&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ConfigurableListableBeanFactory &lt;b&gt;beanFactory&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Environment &lt;b&gt;environment&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ClassLoader &lt;b&gt;classLoader&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private int order = Ordered.LOWEST_PRECEDENCE;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-960" y="1120" width="440" height="200" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-18" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-12" target="omU1pgqW6LJjpDUwzffS-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-12" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;InstantiationAwareBeanPostProcessor&lt;/b&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;(I)&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;Object postProcessBeforeInstantiation(Class&amp;lt;?&amp;gt; beanClass, String beanName) throws&amp;nbsp;&lt;br&gt;&amp;nbsp; BeansException;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;boolean postProcessAfterInstantiation(Object bean, String beanName) throws BeansException;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;PropertyValues postProcessProperties(PropertyValues pvs, Object bean, String beanName)&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&amp;nbsp; throws BeansException&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-1440" y="980" width="440" height="90" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-16" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;BeanFactoryPostProcessor （I）&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-960" y="880" width="440" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-22" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-65" target="omU1pgqW6LJjpDUwzffS-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-19" value="&lt;span style=&quot;font-size: 10px;&quot;&gt;ReferenceAnnotationBeanPostProcessor#&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;b&gt;postProcessBeanFactory&lt;/b&gt;(&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;ConfigurableListableBeanFactory beanFactory)&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(0, 127, 255); background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;扫描所有Bean定义&lt;/b&gt;，查看内部是否有注解&lt;br&gt;@DubboReference @Reference&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="840" y="1740" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-68" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-21" target="omU1pgqW6LJjpDUwzffS-67" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-71" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fillColor=#dae8fc;strokeColor=#000000;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-21" target="omU1pgqW6LJjpDUwzffS-70" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-21" value="AnnotatedInjectionMetadata metadata = &lt;b&gt;findInjectionMetadata&lt;/b&gt;(beanName, beanType, null);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;查找类中@DubboReference @Reference注解的字段或@Bean方法，并缓存&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1080" y="1820" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-26" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-23" target="omU1pgqW6LJjpDUwzffS-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-23" value="beanDefinitionRegistry&lt;br&gt;.removeBeanDefinition(BEAN_NAME);&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;删除后置处理器ReferenceAnnotationBeanPostProcessor，&lt;br&gt;因为到这里这个后置处理器任务就完成了&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1080" y="1980" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-114" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-25" target="omU1pgqW6LJjpDUwzffS-111" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1300" y="2090" />
              <mxPoint x="1300" y="2590" />
              <mxPoint x="590" y="2590" />
              <mxPoint x="590" y="2630" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-115" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-25" target="omU1pgqW6LJjpDUwzffS-112" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1300" y="2090" />
              <mxPoint x="1300" y="2590" />
              <mxPoint x="590" y="2590" />
              <mxPoint x="590" y="2710" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-25" value="applicationContext.publishEvent(new &lt;b&gt;DubboConfigInitEvent&lt;/b&gt;(applicationContext));" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1080" y="2060" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-31" style="orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-28" target="omU1pgqW6LJjpDUwzffS-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-28" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;这一步注册的是 ScannedGenericBeanDefinition&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;beanName是类名首字母小写，比如 demoServiceImpl&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontColor=#007FFF;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1566" y="1255" width="320" height="30" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-32" style="orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-29" target="omU1pgqW6LJjpDUwzffS-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-29" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;div&gt;这一步注册的是 RootBeanDefinition&lt;/div&gt;&lt;div&gt;beanName是 “ServiceBean:&amp;lt;接口全限定名&amp;gt;::” ,&lt;/div&gt;&lt;div&gt;比如 ServiceBean:org.apache.dubbo.springboot.demo.DemoService::&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontColor=#007FFF;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1811" y="1415" width="320" height="30" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-30" value="&lt;div style=&quot;&quot;&gt;&lt;b&gt;正好对应注册中心里面每个Dubbo服务注册的两个服务实例&lt;/b&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontColor=#007FFF;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1681" y="1330" width="320" height="30" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-64" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-33" target="omU1pgqW6LJjpDUwzffS-63" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-33" value="&lt;span style=&quot;font-size: 10px;&quot;&gt;DubboConfigBeanInitializer#&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/span&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;afterPropertiesSet()&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;Bean dubboConfigBeanInitializer 初始化阶段执行&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="840" y="2380" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-35" value="ReferenceAnnotationBeanPostProcessor#&lt;br&gt;postProcessMergedBeanDefinition(...)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="840" y="2200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-40" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-37" target="omU1pgqW6LJjpDUwzffS-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-37" value="DubboConfigAliasPostProcessor#&lt;br&gt;&lt;b&gt;postProcessBeanDefinitionRegistry&lt;/b&gt;(...)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;仅仅是在后置处理器内保存一下BeanDefinitionRegistry&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="840" y="1040" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-39" value="this.registry = registry;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1080" y="1040" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-44" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-41" target="omU1pgqW6LJjpDUwzffS-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-41" value="DubboInfraBeanRegisterPostProcessor#&lt;div&gt;&lt;b&gt;postProcessBeanDefinitionRegistry(...)&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;&quot; color=&quot;#007fff&quot;&gt;仅仅是在后置处理器内保存一下BeanDefinitionRegistry&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="840" y="1120" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-43" value="&lt;b&gt;this.registry = registry;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1080" y="1120" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-49" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-45" target="omU1pgqW6LJjpDUwzffS-48" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-45" value="DubboInfraBeanRegisterPostProcessor&lt;br&gt;#&lt;b&gt;postProcessBeanFactory()&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 8px;&quot; color=&quot;#007fff&quot;&gt;前面DubboSpringInitializer注册了ReferenceAnnotationBeanPostProcessor的&lt;b&gt;Bean定义&lt;/b&gt;，但是没有没有创建Bean，这里创建Bean并注册&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="840" y="1400" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-55" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-56" target="omU1pgqW6LJjpDUwzffS-54" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-48" value="referenceAnnotationBeanPostProcessor = beanFactory.&lt;b&gt;getBean&lt;/b&gt;(...);&lt;br&gt;beanFactory.&lt;b&gt;addBeanPostProcessor&lt;/b&gt;(&lt;br&gt;referenceAnnotationBeanPostProcessor);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1080" y="1400" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-50" value="&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;暂没用到这种方式，暂略&lt;/font&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;" parent="1" vertex="1">
          <mxGeometry x="1080" y="1640" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-53" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#ea6b66&quot;&gt;执行BeanFactory后置处理的第一步就是读取BeanFactoryPostProcessor&lt;br&gt;Bean定义并创建Bean，看ServiceAnnotationPostProcessor、&lt;br&gt;DubboInfraBeanRegisterPostProcessor等后置处理器的Bean都创建完成了&lt;br&gt;&lt;span style=&quot;&quot;&gt;为何唯独&amp;nbsp;ReferenceAnnotationBeanPostProcessor&lt;/span&gt;&lt;span style=&quot;&quot;&gt;没有创建Bean,&lt;br&gt;以至于还要通过这种方式创建Bean并注册&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;&quot;&gt;TODO&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="470" y="1380" width="350" height="100" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-54" value="beanFactory.&lt;b style=&quot;font-size: 10px;&quot;&gt;registerSingleton&lt;/b&gt;(&lt;br style=&quot;font-size: 10px;&quot;&gt;ConfigManager.BEAN_NAME, applicationModel&lt;br style=&quot;font-size: 10px;&quot;&gt;.&lt;b style=&quot;font-size: 10px;&quot;&gt;getApplicationConfigManager&lt;/b&gt;());&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;注册dubboConfigManager&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1080" y="1560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-57" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-48" target="omU1pgqW6LJjpDUwzffS-56" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1180" y="1460" as="sourcePoint" />
            <mxPoint x="1180" y="1565" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-59" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-56" target="omU1pgqW6LJjpDUwzffS-58" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-56" value="获取ApplicationModel、ModuleModel Bean实例，然后获取&lt;b&gt;ExtensionInjector&lt;/b&gt;并执行初始化，然后从Spring环境上文读取&lt;b&gt;Dubbo的配置属性，&lt;/b&gt;写入ApplicationModel" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="1080" y="1480" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-58" value="ExtensionInjector&amp;nbsp;&lt;br&gt;TODO" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1320" y="1480" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-60" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;b style=&quot;font-size: 9px;&quot;&gt;读取的属性：&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&quot;dubbo.application.name&quot; -&amp;gt; &quot;dubbo-springboot-demo-provider&quot;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&quot;dubbo.config.multiple&quot; -&amp;gt; &quot;true&quot;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&quot;dubbo.protocol.host&quot; -&amp;gt; &quot;localhost&quot;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&quot;dubbo.protocol.name&quot; -&amp;gt; &quot;tri&quot;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&quot;dubbo.protocol.port&quot; -&amp;gt; &quot;50052&quot;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&quot;dubbo.registry.address&quot; -&amp;gt; &quot;nacos://127.0.0.1:8848&quot;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1286" y="1545" width="280" height="90" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-98" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-63" target="omU1pgqW6LJjpDUwzffS-97" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-100" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-63" target="omU1pgqW6LJjpDUwzffS-99" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-63" value="prepareDubboConfigBeans();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;用于在@Reference Bean自动注入前初始化Dubbo一些配置Bean&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1080" y="2380" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-66" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-19" target="omU1pgqW6LJjpDUwzffS-65" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1040" y="1770" as="sourcePoint" />
            <mxPoint x="1180" y="1820" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-65" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;首先从BeanDefinition或BeanFactory中获取Bean类型&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1080" y="1740" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-67" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp;metadata = buildAnnotatedMetadata(clazz);&lt;span style=&quot;background-color: initial; font-size: 9px;&quot;&gt;&amp;nbsp;&lt;br style=&quot;font-size: 9px;&quot;&gt;this.injectionMetadataCache.put(cacheKey, metadata);&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;查找类中@DubboReference @Reference注解的&lt;b style=&quot;font-size: 9px;&quot;&gt;字段&lt;/b&gt;或&lt;b style=&quot;font-size: 9px;&quot;&gt;@Bean方法，&lt;/b&gt;&lt;span style=&quot;font-size: 9px;&quot;&gt;并缓存&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;" parent="1" vertex="1">
          <mxGeometry x="1320" y="1820" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-72" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-70" target="omU1pgqW6LJjpDUwzffS-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-74" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-70" target="omU1pgqW6LJjpDUwzffS-73" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-70" value="prepareInjection(metadata);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;解析上一步查找到的字段或@Bean方法，创建BeanDefinition并注册到Spring容器&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1080" y="1900" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-76" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-73" target="omU1pgqW6LJjpDUwzffS-75" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-78" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-73" target="omU1pgqW6LJjpDUwzffS-77" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-73" value="&lt;div&gt;String referenceBeanName = &lt;b&gt;registerReferenceBean&lt;/b&gt;(&lt;/div&gt;&lt;div&gt;fieldElement.getPropertyName(), injectedType, attributes, fieldElement.field);&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;比如Demo的Task&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1320" y="1900" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-75" target="-dgZXbgsa9ORmBTnPNrw-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-75" value="beanDefinitionRegistry.&lt;b&gt;registerBeanDefinition&lt;/b&gt;(&lt;br&gt;referenceBeanName, beanDefinition);&lt;br&gt;&lt;b&gt;referenceBeanManager&lt;/b&gt;&lt;br&gt;.&lt;b&gt;registerReferenceKeyAndBeanName&lt;/b&gt;(&lt;br&gt;referenceKey, referenceBeanName);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1550" y="1900" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-32" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-77" target="-dgZXbgsa9ORmBTnPNrw-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-77" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;String referenceBeanName = &lt;b style=&quot;font-size: 9px;&quot;&gt;registerReferenceBean&lt;/b&gt;(&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;methodElement.getPropertyName(), injectedType, attributes,methodElement.method);&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;比如Demo的Task中的 DemoService&lt;/font&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;" parent="1" vertex="1">
          <mxGeometry x="1320" y="1980" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-18" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" source="omU1pgqW6LJjpDUwzffS-88" target="-dgZXbgsa9ORmBTnPNrw-7" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1060" y="2310" />
              <mxPoint x="1060" y="6340" />
              <mxPoint x="580" y="6340" />
              <mxPoint x="580" y="6635" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-88" value="ReferenceAnnotationBeanPostProcessor#&lt;br&gt;&lt;b&gt;postProcessProperties&lt;/b&gt;(...)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;这里实现服务引用Bean的注入，后面详细解析&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="840" y="2280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-108" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;endArrow=diamondThin;endFill=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-96" target="omU1pgqW6LJjpDUwzffS-106" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-96" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;DubboConfigBeanInitializer&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//是否初始化Dubbo配置Bean&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final AtomicBoolean &lt;b&gt;initialized&lt;/b&gt; = new AtomicBoolean(false);&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ConfigurableListableBeanFactory &lt;b&gt;beanFactory&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//Reference Bean 容器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ReferenceBeanManager&amp;nbsp;&lt;b&gt;referenceBeanManager&lt;/b&gt;;&lt;/p&gt;&amp;nbsp; &lt;font color=&quot;#007fff&quot;&gt;//此Bean在DubboInfraBeanRegisterPostProcessor中注册&lt;/font&gt;&lt;br&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;@Autowired&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ConfigManager &lt;b&gt;configManager&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//此Bean在DubboSpringInitializer 初始化时注册&lt;/font&gt;&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;@Autowired&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;@Qualifier(&quot;org.apache.dubbo.rpc.model.ModuleModel&quot;)&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ModuleModel &lt;b&gt;moduleModel&lt;/b&gt;;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="-440" y="1700" width="400" height="220" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-97" value="referenceBeanManager&lt;br&gt;.prepareReferenceBeans();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;用于初始化所有 reference Bean, 分析消费者时再细看&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1080" y="2460" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-102" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-99" target="omU1pgqW6LJjpDUwzffS-101" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-105" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-99" target="omU1pgqW6LJjpDUwzffS-104" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-99" value="&lt;div style=&quot;font-size: 8px;&quot;&gt;loadConfigBeansOfType(&lt;b&gt;ApplicationConfig&lt;/b&gt;.class, configManager);&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;loadConfigBeansOfType(&lt;b&gt;RegistryConfig&lt;/b&gt;.class, configManager);&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;loadConfigBeansOfType(&lt;b&gt;ProtocolConfig&lt;/b&gt;.class, configManager);&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;loadConfigBeansOfType(&lt;b&gt;MonitorConfig&lt;/b&gt;.class, configManager);&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;loadConfigBeansOfType(&lt;b&gt;ConfigCenterBean&lt;/b&gt;.class, configManager);&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;loadConfigBeansOfType(&lt;b&gt;MetadataReportConfig&lt;/b&gt;.class, configManager);&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;loadConfigBeansOfType(&lt;b&gt;MetricsConfig&lt;/b&gt;.class, configManager);&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;loadConfigBeansOfType(&lt;b&gt;TracingConfig&lt;/b&gt;.class, configManager);&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;loadConfigBeansOfType(&lt;b&gt;SslConfig&lt;/b&gt;.class, configManager);&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;loadConfigBeansOfType(&lt;b&gt;ModuleConfig&lt;/b&gt;.class, moduleModel.getConfigManager());&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;loadConfigBeansOfType(&lt;b&gt;ProviderConfig&lt;/b&gt;.class, moduleModel.getConfigManager());&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;loadConfigBeansOfType(&lt;b&gt;ConsumerConfig&lt;/b&gt;.class, moduleModel.getConfigManager());&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;align=left;arcSize=5;" parent="1" vertex="1">
          <mxGeometry x="1320" y="2350" width="320" height="120" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-101" value="从 beanFactory 按类型获取所有beanName,&lt;br&gt;然后 beanFactory.getBean(beanName, configClass) 创建所有Bean，并注册到 &lt;b&gt;configManager&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1680" y="2380" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-103" value="&lt;font color=&quot;#ea6b66&quot;&gt;这一步创建Bean需要BeanDefinition,&amp;nbsp;&lt;br style=&quot;font-size: 10px;&quot;&gt;BeanDefinition 哪里注册的？TODO&lt;br&gt;测试Demo中没有加载到任何一个配置Bean&lt;br&gt;先略&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1886" y="2380" width="210" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-104" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;List&amp;lt;ConfigCenterBean&amp;gt; configCenterBeans = configManager.loadConfigsOfTypeFromProps(&lt;br&gt;ConfigCenterBean.class);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;加载配置中心配置Bean，暂略&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1380" y="2490" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-106" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;ReferenceBeanManager&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;Reference Bean实例的容器，也归Spring容器管理&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;由于BeanFactoryPostProcessor中需要，很早就创建了其Bean实例&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// reference key -&amp;gt; reference bean names&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ConcurrentMap&amp;lt;String, List&amp;lt;String&amp;gt;&amp;gt; &lt;b&gt;referenceKeyMap&lt;/b&gt; = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// reference alias -&amp;gt; reference bean name&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ConcurrentMap&amp;lt;String, String&amp;gt; &lt;b&gt;referenceAliasMap&lt;/b&gt; = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// reference bean name -&amp;gt; ReferenceBean&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ConcurrentMap&amp;lt;String, ReferenceBean&amp;gt; &lt;b&gt;referenceBeanMap&lt;/b&gt; = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// reference key -&amp;gt; ReferenceConfig instance&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ConcurrentMap&amp;lt;String, ReferenceConfig&amp;gt; &lt;b&gt;referenceConfigMap&lt;/b&gt; = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ApplicationContext &lt;b&gt;applicationContext&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile boolean &lt;b&gt;initialized&lt;/b&gt; = false;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ModuleModel &lt;b&gt;moduleModel&lt;/b&gt;;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="-960" y="1700" width="480" height="220" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-117" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-111" target="omU1pgqW6LJjpDUwzffS-116" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-111" value="DubboConfigApplicationListener#&lt;br&gt;onApplicationEvent(&lt;b&gt;DubboConfigInitEvent&lt;/b&gt; event)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="600" y="2600" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-187" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-112" target="omU1pgqW6LJjpDUwzffS-116" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-112" value="DubboBootstrapApplicationListener#&lt;br&gt;onApplicationEvent(ApplicationEvent event)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;DubboConfigInitEvent 继承&amp;nbsp;ApplicationEvent&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="600" y="2680" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-119" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-116" target="omU1pgqW6LJjpDUwzffS-118" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-116" value="initDubboConfigBeans();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;Dubbo应用及模块配置初始化&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="840" y="2600" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-121" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-118" target="omU1pgqW6LJjpDUwzffS-120" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-118" value="moduleModel.getDeployer().prepare();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;这里的moduleModel仅仅作为&lt;b&gt;委托对象&lt;/b&gt;，不对应任何实际的组件，仅&lt;br&gt;用于调用applicationDeployer初始化方法&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1080" y="2600" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-124" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-120" target="omU1pgqW6LJjpDUwzffS-123" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-128" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-120" target="omU1pgqW6LJjpDUwzffS-127" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-120" value="&lt;b&gt;applicationDeployer&lt;/b&gt;.&lt;b&gt;initialize&lt;/b&gt;();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#ffcd28;strokeColor=#d79b00;gradientColor=#ffa500;" parent="1" vertex="1">
          <mxGeometry x="1999.97" y="2599.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-122" value="&lt;b&gt;DefaultModuleDeployer&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2035.97" y="2567.5" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-176" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-123" target="omU1pgqW6LJjpDUwzffS-175" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-123" value="this.initialize();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2001" y="3497.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-126" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-125" target="LEzOs3IW3RDwebMgTtXX-24" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-700" y="340" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-171" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.25;exitDx=0;exitDy=0;entryX=1;entryY=0.25;entryDx=0;entryDy=0;endArrow=diamondThin;endFill=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-125" target="LEzOs3IW3RDwebMgTtXX-26" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-125" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;ApplicationModel&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;表示正在使用Dubbo的应用程序&lt;/font&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;public static final String NAME = &quot;ApplicationModel&quot;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// 内部包含的 ModuleModel&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final List&amp;lt;ModuleModel&amp;gt; &lt;b&gt;moduleModels&lt;/b&gt; = new CopyOnWriteArrayList&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final List&amp;lt;ModuleModel&amp;gt; &lt;b&gt;pubModuleModels&lt;/b&gt; = new CopyOnWriteArrayList&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile Environment environment;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// 一组组件配置的容器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile &lt;b&gt;ConfigManager&lt;/b&gt; &lt;b&gt;configManager&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile ServiceRepository serviceRepository;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//ApplicationModel 的起动器，内部会遍历所有Module 并执行 ModuleDeployer 起动器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile &lt;b&gt;ApplicationDeployer&lt;/b&gt; &lt;b&gt;deployer&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final &lt;b&gt;FrameworkModel&lt;/b&gt; &lt;b&gt;frameworkModel&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;//创建FrameworkModel时会默认创建一个ApplicationModel实例&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ModuleModel &lt;b&gt;internalModule&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile ModuleModel defaultModule;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;private final AtomicInteger moduleIndex = new AtomicInteger(0);&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-440" y="400" width="400" height="270" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-130" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-127" target="omU1pgqW6LJjpDUwzffS-129" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-127" value="registerShutdownHook();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2239.97" y="2599.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-132" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-136" target="omU1pgqW6LJjpDUwzffS-131" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-151" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-129" target="omU1pgqW6LJjpDUwzffS-150" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-129" value="startConfigCenter();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;解析配置中心的配置并从配置中心加载配置数据&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2239.97" y="2677.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-131" value="1 先从ConfigManager environment 读取属性 PropertiesConfiguration；&lt;span style=&quot;background-color: initial;&quot;&gt;读取以 “dubbo.applications.” 开头的属性，&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;按name分组创建ApplicationConfig并存储到 &lt;b&gt;ConfigManager configCache&lt;/b&gt;&lt;/span&gt;&lt;br&gt;2 再从ConfigManager environment 读取 globalConfigurationMaps，从中查找以 “dubbo.application” 开头的配置; 使用配置创建 ApplicationConfig 实例，存储到 &lt;b&gt;ConfigManager configCache&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=4;" parent="1" vertex="1">
          <mxGeometry x="2719.97" y="2667.5" width="319" height="80" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-135" value="&lt;div style=&quot;text-align: center; font-size: 9px;&quot;&gt;&lt;b style=&quot;font-size: 9px;&quot;&gt;AbstractConfigManager &lt;/b&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;Dubbo配置管理器&lt;/font&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 9px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;private static final Set&amp;lt;Class&amp;lt;? extends AbstractConfig&amp;gt;&amp;gt; uniqueConfigTypes = new ConcurrentHashSet&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;//用于存储各种类型的配置类，每种类型配置可能还有多组&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;//RPC服务的配置类型 key 是 service&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;//还有 provider、consumer、module&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;final Map&amp;lt;String, Map&amp;lt;String, AbstractConfig&amp;gt;&amp;gt; &lt;b style=&quot;font-size: 9px;&quot;&gt;configsCache&lt;/b&gt; = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;private final Map&amp;lt;String, AtomicInteger&amp;gt; configIdIndexes = &lt;font style=&quot;font-size: 9px;&quot;&gt;new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;protected Set&amp;lt;AbstractConfig&amp;gt; duplicatedConfigs = new ConcurrentHashSet&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;protected final ScopeModel scopeModel;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;protected final ApplicationModel applicationModel;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;private final Collection&amp;lt;Class&amp;lt;? extends AbstractConfig&amp;gt;&amp;gt; supportedConfigTypes;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;private final Environment environment;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;private ConfigValidator configValidator;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;private final AtomicBoolean initialized = new AtomicBoolean(false);&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;protected ConfigMode configMode = ConfigMode.STRICT;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;protected boolean ignoreDuplicatedInterface = false;private static final Set&amp;lt;Class&amp;lt;? extends AbstractConfig&amp;gt;&amp;gt; uniqueConfigTypes = new ConcurrentHashSet&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;final Map&amp;lt;String, Map&amp;lt;String, AbstractConfig&amp;gt;&amp;gt; configsCache = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;private final Map&amp;lt;String, AtomicInteger&amp;gt; configIdIndexes = &lt;font style=&quot;font-size: 9px;&quot;&gt;new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;protected Set&amp;lt;AbstractConfig&amp;gt; duplicatedConfigs = new ConcurrentHashSet&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;protected final ScopeModel scopeModel;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;protected final ApplicationModel applicationModel;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;private final Collection&amp;lt;Class&amp;lt;? extends AbstractConfig&amp;gt;&amp;gt; supportedConfigTypes;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;private final Environment environment;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;private ConfigValidator configValidator;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;private final AtomicBoolean initialized = new AtomicBoolean(false);&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;protected ConfigMode configMode = ConfigMode.STRICT;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;protected boolean ignoreDuplicatedInterface = false;&lt;/p&gt;&lt;hr style=&quot;font-size: 9px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=9;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-1400" y="1999.5" width="400" height="380.5" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-137" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-129" target="omU1pgqW6LJjpDUwzffS-136" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2439.97" y="2707.5" as="sourcePoint" />
            <mxPoint x="2739.97" y="2707.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-139" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-136" target="omU1pgqW6LJjpDUwzffS-138" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-136" value="configManager&lt;br&gt;.&lt;b&gt;loadConfigsOfTypeFromProps&lt;/b&gt;(&lt;br&gt;&lt;b&gt;ApplicationConfig&lt;/b&gt;.class);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;加载dubbo.appliction配置&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="2479.97" y="2677.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-141" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-138" target="omU1pgqW6LJjpDUwzffS-140" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-138" value="configManager&lt;br&gt;.loadConfigsOfTypeFromProps(&lt;br&gt;&lt;b&gt;ConfigCenterConfig&lt;/b&gt;.class);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;同理加载dubbo.config-center配置&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="2479.97" y="2757.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-143" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-140" target="omU1pgqW6LJjpDUwzffS-142" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-145" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-140" target="omU1pgqW6LJjpDUwzffS-144" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-140" value="useRegistryAsConfigCenterIfNecessary();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;如果没有设置配置中心就尝试使用注册中心&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2479.97" y="2837.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-142" value="configManager.loadConfigsOfTypeFromProps(&lt;br&gt;&lt;b&gt;RegistryConfig&lt;/b&gt;.class);&lt;br&gt;configManager.addConfigCenter(configCenter);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="2709.97" y="2837.5" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-147" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-144" target="omU1pgqW6LJjpDUwzffS-146" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-149" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-144" target="omU1pgqW6LJjpDUwzffS-148" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-144" value="compositeDynamicConfiguration&lt;br&gt;.addConfiguration(&lt;b&gt;prepareEnvironment&lt;/b&gt;(&lt;br&gt;configCenter));&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;从配置中心的“dubbo.properties”读取配置信息&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="2479.97" y="2917.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-146" value="TODO" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2719.97" y="2917.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-148" value="environment.setDynamicConfiguration(&lt;br&gt;compositeDynamicConfiguration);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2479.97" y="2997.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-153" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-150" target="omU1pgqW6LJjpDUwzffS-152" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-162" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-164" target="omU1pgqW6LJjpDUwzffS-161" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-150" value="loadApplicationConfigs();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2239.97" y="3127.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-155" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-152" target="omU1pgqW6LJjpDUwzffS-154" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-170" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-152" target="omU1pgqW6LJjpDUwzffS-169" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-152" value="&amp;nbsp;initModuleDeployers();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2239.97" y="3257.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-157" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-154" target="omU1pgqW6LJjpDUwzffS-156" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-154" value="initMetricsReporter();&lt;br&gt;initMetricsService();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2239.97" y="3337.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-156" value="startMetadataCenter();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;初始化元数据配置&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2239.97" y="3417.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-158" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;DefaultApplicationDeployer&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2264.97" y="2567.5" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-168" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=1;entryDx=0;entryDy=0;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-161" target="omU1pgqW6LJjpDUwzffS-131" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-161" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;loadConfigsOfTypeFromProps(&lt;b&gt;ApplicationConfig&lt;/b&gt;.class);&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;// 加载 dubbo.monitor.xxx&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;loadConfigsOfTypeFromProps(&lt;b&gt;MonitorConfig&lt;/b&gt;.class);&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;// 加载 dubbo.metric.xxx&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;loadConfigsOfTypeFromProps(&lt;b&gt;MetricsConfig&lt;/b&gt;.class);&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;// 加载 dubbo.tracing.xxx&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;loadConfigsOfTypeFromProps(&lt;b&gt;TracingConfig&lt;/b&gt;.class);&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;// 加载 dubbo.protocol.xxx&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;loadConfigsOfTypeFromProps(&lt;b&gt;ProtocolConfig&lt;/b&gt;.class);&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;// 加载 dubbo.registry.xxx&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;loadConfigsOfTypeFromProps(&lt;b&gt;RegistryConfig&lt;/b&gt;.class);&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;// 加载 dubbo.metadata-report.xxx&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;loadConfigsOfTypeFromProps(&lt;b&gt;MetadataReportConfig&lt;/b&gt;.class);&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;arcSize=2;verticalAlign=middle;" parent="1" vertex="1">
          <mxGeometry x="2719.97" y="3077.5" width="259" height="160" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-163" value="&lt;font color=&quot;#007fff&quot;&gt;这里注意&lt;b&gt;每种类型的配置都支持配置多组&lt;/b&gt;&lt;br&gt;比如 dubbo.applictions.xxx &lt;br&gt;也可以只配置一组如：dubbo.appliction.xxx&lt;br&gt;后面仅展示只配置一组的配置前缀&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="3039.97" y="2677.5" width="210" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-166" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-150" target="omU1pgqW6LJjpDUwzffS-164" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2439.97" y="3157.5" as="sourcePoint" />
            <mxPoint x="2719.97" y="3157.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-164" value="configManager.loadConfigs();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2479.97" y="3127.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-167" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;ApplicationConfig&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String name;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String version;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String owner;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String organization;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String architecture;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String environment;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String compiler;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private List&amp;lt;RegistryConfig&amp;gt; &lt;b&gt;registries&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String &lt;b&gt;registryIds&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private MonitorConfig &lt;b&gt;monitor&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String dumpDirectory;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Boolean dumpEnable;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Boolean qosEnable;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Boolean qosCheck;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String qosHost;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Integer qosPort;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Boolean qosAcceptForeignIp;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String qosAcceptForeignIpWhitelist;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String qosAnonymousAccessPermissionLevel;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String qosAnonymousAllowCommands;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Map&amp;lt;String, String&amp;gt; parameters;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String shutwait;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String hostname;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String metadataType;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//&amp;nbsp;用于控制是否将实例注册到注册中心。仅当实例是纯使用者时，才设置为“false”，即纯消费者不需要将消费者服务实例注册到注册中心&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Boolean &lt;b&gt;registerConsumer&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String repository;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Boolean enableFileCache;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String protocol;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String metadataServiceProtocol;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Integer metadataServicePort;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Integer mappingRetryInterval;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String livenessProbe;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String readinessProbe;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String startupProbe;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String registerMode;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Boolean enableEmptyProtection;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String serializeCheckStatus;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Boolean autoTrustSerializeClass;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Integer trustSerializeClassLevel;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Boolean checkSerializable;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String executorManagementMode;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-880" y="2677.5" width="400" height="580" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-174" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-169" target="omU1pgqW6LJjpDUwzffS-123" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2698.97" y="3287.5" />
              <mxPoint x="2698.97" y="3487.5" />
              <mxPoint x="1989.97" y="3487.5" />
              <mxPoint x="1989.97" y="3527.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-169" value="for&amp;nbsp;applicationModel.getModuleModels():&lt;br&gt;moduleModel.getDeployer().&lt;b&gt;initialize&lt;/b&gt;();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;遍历初始化各个模块，模块不直接对应组件（注册中心、配置中心这些）&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2479.97" y="3257.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-172" value="&lt;font color=&quot;#007fff&quot;&gt;FrameworkModel 可能包含多个 ApplicationModel, ApplicationModel 可能包含多个ModuleModel&lt;br&gt;FrameworkModel ApplicationModel 创建实例时都会创建一个内部模块（internalApplicationModel、internaModel, 什么用途）&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="-1170" y="360" width="680" height="40" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-178" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-175" target="omU1pgqW6LJjpDUwzffS-177" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-175" value="onInitialize();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;调用&amp;nbsp;ModuleDeployListener 回调，如果有监听器的话&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2240.97" y="3497.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-181" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-177" target="omU1pgqW6LJjpDUwzffS-180" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-177" value="&amp;nbsp;loadConfigs();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2240.97" y="3577.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-179" value="ModuleModel委托对象 -&amp;gt; Dubbo应用模型对象 -&amp;gt; Dubbo应用模块对象" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1080" y="2680" width="390" height="30" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-183" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-180" target="omU1pgqW6LJjpDUwzffS-184" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2719.97" y="3607.500000000001" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-180" value="moduleModel.getConfigManager()&lt;br&gt;.loadConfigs();&lt;br&gt;moduleModel.getConfigManager()&lt;br&gt;.refreshAll();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2480.97" y="3577.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-184" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;// 加载 dubbo.provider.xxx&lt;/font&gt;&lt;/div&gt;&lt;div&gt;loadConfigsOfTypeFromProps(&lt;b&gt;ProviderConfig&lt;/b&gt;.class);&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;// 加载 dubbo.consumer.xxx&lt;/font&gt;&lt;/div&gt;&lt;div&gt;loadConfigsOfTypeFromProps(&lt;b&gt;ConsumerConfig&lt;/b&gt;.class);&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;// 加载 dubbo.module.xxx&lt;/font&gt;&lt;/div&gt;&lt;div&gt;loadConfigsOfTypeFromProps(&lt;b&gt;ModuleConfig&lt;/b&gt;.class);&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;arcSize=2;verticalAlign=middle;" parent="1" vertex="1">
          <mxGeometry x="2719.97" y="3572.5" width="240" height="70" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-185" value="在SpringBoot 中一般都用注解&lt;br&gt;不会用在配置文件中直接定义生产者消费者" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="2959.97" y="3587.5" width="210" height="40" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-193" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-188" target="omU1pgqW6LJjpDUwzffS-192" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-188" value="ModuleDeployer deployer = moduleModel.getDeployer();&lt;br&gt;future = deployer.&lt;b&gt;start&lt;/b&gt;();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="840" y="2760" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-198" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-192" target="omU1pgqW6LJjpDUwzffS-194" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-192" value="ModuleDeployer deployer = moduleModel.getDeployer();&lt;br&gt;future = deployer.&lt;b&gt;start&lt;/b&gt;();&lt;br&gt;if (!deployer.isBackground())&lt;br&gt;future.get();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1080" y="2760" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-197" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-194" target="omU1pgqW6LJjpDUwzffS-196" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-199" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-194" target="omU1pgqW6LJjpDUwzffS-120" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1310" y="2910" />
              <mxPoint x="1310" y="2645" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-194" value="&lt;b&gt;applicationDeployer&lt;/b&gt;.&lt;b&gt;initialize&lt;/b&gt;();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;前面通过DubboConfigApplicationListener已经初始化，这里会直接返回&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="600" y="2880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-195" value="&lt;b&gt;最开始执行默认模块的 DefaultModuleDeployer&lt;/b&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="600" y="2850" width="240" height="30" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-201" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-196" target="omU1pgqW6LJjpDUwzffS-200" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-196" value="&lt;b&gt;return startSync();&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;&quot; color=&quot;#007fff&quot;&gt;Dubbo应用及模块启动&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#ffcd28;strokeColor=#d79b00;gradientColor=#ffa500;" parent="1" vertex="1">
          <mxGeometry x="600" y="2960" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-203" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-200" target="omU1pgqW6LJjpDUwzffS-202" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-208" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-200" target="omU1pgqW6LJjpDUwzffS-207" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-200" value="onModuleStarting();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="840" y="2960" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-205" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-202" target="omU1pgqW6LJjpDUwzffS-204" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-210" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-202" target="omU1pgqW6LJjpDUwzffS-209" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-202" value="for listeners:&lt;br&gt;listener.onStarting(scopeModel);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;通知DefaultModuleDeployer所有监听器&lt;br&gt;回调onStarting方法&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1080" y="2960" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-204" value="publishModuleEvent(&lt;br&gt;DeployState.&lt;b&gt;STARTING&lt;/b&gt;);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;没看到哪里有监听这个事件，暂略&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1320" y="2960" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-206" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;DubboDeployApplicationListener&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1330" y="2930" width="180" height="30" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-214" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-207" target="omU1pgqW6LJjpDUwzffS-213" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-207" value="initialize();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;前面已经初始化，直接返回&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="840" y="3040" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-212" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-209" target="omU1pgqW6LJjpDUwzffS-211" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-209" value="applicationDeployer.notifyModuleChanged(&lt;br&gt;moduleModel, DeployState.STARTING);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1080" y="3040" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-211" value="&lt;div&gt;synchronized (stateLock) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; stateLock.notifyAll();&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="1320" y="3040" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-218" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-213" target="omU1pgqW6LJjpDUwzffS-217" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-299" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-213" target="omU1pgqW6LJjpDUwzffS-298" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-213" value="&amp;nbsp;exportServices();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;暴露服务就是在本地或向注册中心&lt;br&gt;注册服务Invoker&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="840" y="3120" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-216" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-215" target="omU1pgqW6LJjpDUwzffS-135" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-215" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;ModuleConfigManager&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 9px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;public static final String NAME = &quot;moduleConfig&quot;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Map&amp;lt;String, AbstractInterfaceConfig&amp;gt; &lt;b&gt;serviceConfigCache&lt;/b&gt; = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConfigManager &lt;b&gt;applicationConfigManager&lt;/b&gt;;&lt;/p&gt;&lt;hr style=&quot;font-size: 9px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 9px;&quot;&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=9;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-1400" y="2420" width="400" height="100" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-220" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-217" target="omU1pgqW6LJjpDUwzffS-219" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-217" value="for configManager.getServices():&lt;br&gt;&lt;b&gt;exportServiceInternal&lt;/b&gt;(sc);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;查找模块配置管理器中关于“service”的配置&lt;br&gt;遍历暴露&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1080" y="3120" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-222" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-219" target="omU1pgqW6LJjpDUwzffS-221" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-219" value="&lt;div&gt;sc.&lt;b&gt;export&lt;/b&gt;(RegisterTypeEnum.&lt;/div&gt;&lt;div&gt;AUTO_REGISTER_BY_DEPLOYER);&lt;/div&gt;&lt;div&gt;&lt;b&gt;exportedServices&lt;/b&gt;.add(sc);&lt;/div&gt;&lt;font color=&quot;#007fff&quot;&gt;查找模块配置管理器中关于“service”的配置&lt;br&gt;遍历暴露&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1320" y="3120" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-225" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-221" target="omU1pgqW6LJjpDUwzffS-224" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1770" y="3150" />
              <mxPoint x="1770" y="3190" />
              <mxPoint x="1070" y="3190" />
              <mxPoint x="1070" y="3230" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-221" value="&lt;div&gt;&lt;/div&gt;&lt;b&gt;doExportUrls&lt;/b&gt;(registerType);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1561" y="3120" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-223" value="&lt;b&gt;ServiceConfig&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1610" y="3090" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-227" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-224" target="omU1pgqW6LJjpDUwzffS-226" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-224" value="&lt;div&gt;&lt;/div&gt;ModuleServiceRepository repository = getScopeModel().&lt;b&gt;getServiceRepository&lt;/b&gt;();&lt;br&gt;serviceDescriptor = repository&lt;br&gt;.&lt;b&gt;registerService&lt;/b&gt;(getInterfaceClass());" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1080" y="3200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-229" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-226" target="omU1pgqW6LJjpDUwzffS-228" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-226" value="providerModel = new &lt;b&gt;ProviderModel&lt;/b&gt;(...);&lt;br&gt;repository.&lt;b&gt;registerProvider&lt;/b&gt;(providerModel);&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1080" y="3280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-231" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-228" target="omU1pgqW6LJjpDUwzffS-230" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-233" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-228" target="omU1pgqW6LJjpDUwzffS-232" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-228" value="List&amp;lt;URL&amp;gt; registryURLs = ConfigValidationUtils.&lt;b&gt;loadRegistries&lt;/b&gt;(this, true);&lt;br&gt;repository.&lt;b&gt;registerService&lt;/b&gt;(pathKey, interfaceClass);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;根据组件配置类数据拼接完整的向注册中心注册服务的URL&lt;/font&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1080" y="3360" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-230" value="&lt;div&gt;List&amp;lt;URL&amp;gt; urls = UrlUtils.parseURLs(address, map);&lt;/div&gt;&lt;div&gt;for (URL url : urls) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; url = URLBuilder.from(url)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .addParameter(REGISTRY_KEY, url.getProtocol())&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .setProtocol(extractRegistryType(url))&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .setScopeModel(interfaceConfig.getScopeModel())&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .build();&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (provider || url.getParameter(SUBSCRIBE_KEY, true)) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; registryList.add(url);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=4;" parent="1" vertex="1">
          <mxGeometry x="1320" y="3330" width="280" height="140" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-236" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-232" target="omU1pgqW6LJjpDUwzffS-235" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-103" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-232" target="Uk-qqwOQmqZAEX01Hiqb-102" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-232" value="for &lt;b&gt;protocols&lt;/b&gt;:&lt;br&gt;doExportUrlsFor1Protocol(protocolConfig, registryURLs, registerType);&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1080" y="3500" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-234" value="&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;registry://127.0.0.1:8848/org.apache.dubbo.registry.&lt;b&gt;RegistryService&lt;/b&gt;?&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;application=dubbo-springboot-demo-provider&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;dubbo=2.0.2&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;executor-management-mode=isolation&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;file-cache=true&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;pid=145596&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;registry&lt;/b&gt;=&lt;b&gt;nacos&lt;/b&gt;&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;release=3.2.9&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;timestamp=1704715810770&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1610" y="3330" width="400" height="140" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-238" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-235" target="omU1pgqW6LJjpDUwzffS-237" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-235" value="Map&amp;lt;String, String&amp;gt; map = buildAttributes(protocolConfig);&lt;br&gt;serviceMetadata.getAttachments()&lt;br&gt;.putAll(map);&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1320" y="3500" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-241" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-237" target="omU1pgqW6LJjpDUwzffS-239" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-260" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-237" target="omU1pgqW6LJjpDUwzffS-259" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-237" value="URL url = buildUrl(protocolConfig, map);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;构建RPC服务的URL, 包括host port 解析&lt;/font&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1320" y="3580" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-246" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-239" target="omU1pgqW6LJjpDUwzffS-245" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-252" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-239" target="omU1pgqW6LJjpDUwzffS-249" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-239" value="String host = &lt;b&gt;findConfiguredHosts&lt;/b&gt;(protocolConfig, provider, params);&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1561" y="3580" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-242" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;依次从系统环境变量&lt;/b&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;TRI_DUBBO_IP_TO_BIND、DUBBO_IP_TO_BIND&lt;/b&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;取RPC host 值,&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;为空就从 ProtocolConfig 配置对象中取 host,&lt;/b&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;还是为空就从&amp;nbsp;ProviderConfig 配置对象中取 host,&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;最后还要对host进行有效性检查，null、空字符串、&lt;/b&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;localhost、0.0.0.0、127.*.*.* 都是无效的host&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;需要通过NetUtils获取本地网络接口IP&lt;br&gt;&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1560" y="3642.5" width="460" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-251" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-245" target="omU1pgqW6LJjpDUwzffS-247" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-245" value="&lt;b&gt;NetUtils#getLocalHost&lt;/b&gt;()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;Demo中配置的localhost这一无效host&lt;br&gt;需要借助NetUtils重新解析本地IP&lt;br&gt;原理参考：多网卡环境Dubbo识别本地IP错误与解决.md&lt;/font&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1801" y="3580" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-247" value="map.put(BIND_IP_KEY, hostToBind);&lt;br&gt;map.put(ANYHOST_KEY, String.valueOf(anyhost));&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1801" y="3720" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-254" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-249" target="omU1pgqW6LJjpDUwzffS-253" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-256" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-249" target="omU1pgqW6LJjpDUwzffS-255" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-249" value="&lt;div&gt;Integer port =&lt;/div&gt;&lt;div&gt;&lt;b&gt;findConfiguredPort&lt;/b&gt;(protocolConfig, provider, this.getExtensionLoader(Protocol.class), name, params);&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1561" y="3800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-253" value="&lt;div&gt;final int defaultPort = extensionLoader.getExtension(name)&lt;/div&gt;&lt;div&gt;.getDefaultPort();&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;扩展点&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="1801" y="3800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-258" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-255" target="omU1pgqW6LJjpDUwzffS-257" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-255" value="&lt;div&gt;&lt;div&gt;URL url = new &lt;b&gt;ServiceConfigURL&lt;/b&gt;(&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; name, null, null, host, port,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; getContextPath(protocolConfig)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .map(p -&amp;gt; p + &quot;/&quot; + path).orElse(path),&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; params);&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1561" y="3880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-257" value="&lt;div&gt;&lt;div&gt;&amp;nbsp;可以通过&amp;nbsp;ConfiguratorFactory 拓展其他参数&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="1561" y="3960" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-262" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-259" target="omU1pgqW6LJjpDUwzffS-261" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-264" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-259" target="omU1pgqW6LJjpDUwzffS-263" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-259" value="exportUrl(url, registryURLs, registerType);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;根据 url 中 scope 参数值选择暴露方式&lt;br&gt;none不暴露、非remote暴露到本地、非local暴露到远程，所以不存此参数会同时暴露到本地和远程&lt;/font&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1320" y="4040" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-261" value="initServiceMethodMetrics(url);&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1320" y="4440" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-266" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-263" target="omU1pgqW6LJjpDUwzffS-265" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-292" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-263" target="omU1pgqW6LJjpDUwzffS-291" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-263" value="&lt;b&gt;exportLocal&lt;/b&gt;(url);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;exportLocal() 暴露到本地&lt;br&gt;暴露到本地就是将Invoker保存到本地容器对象&lt;/font&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1560" y="4040" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-270" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-265" target="omU1pgqW6LJjpDUwzffS-269" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-265" value="&lt;b&gt;doExportUrl&lt;/b&gt;(local, false, RegisterTypeEnum.AUTO_REGISTER);&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1799.95" y="4040" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-267" value="&lt;font color=&quot;#007fff&quot;&gt;injvm://127.0.0.1/org.apache.dubbo.springboot.demo.&lt;b&gt;DemoService&lt;/b&gt;?&lt;br style=&quot;font-size: 10px;&quot;&gt;anyhost=true&amp;amp;application=dubbo-springboot-demo-provider&amp;amp;background=false&amp;amp;&lt;br style=&quot;font-size: 10px;&quot;&gt;bind.ip=172.17.0.1&amp;amp;bind.port=50052&amp;amp;deprecated=false&amp;amp;dubbo=2.0.2&amp;amp;&lt;br style=&quot;font-size: 10px;&quot;&gt;dynamic=true&amp;amp;executor-management-mode=isolation&amp;amp;exporter.listener=injvm&amp;amp;&lt;br style=&quot;font-size: 10px;&quot;&gt;file-cache=true&amp;amp;generic=false&amp;amp;&lt;b&gt;interface&lt;/b&gt;=org.apache.dubbo.springboot.demo.DemoService&amp;amp;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;methods&lt;/b&gt;=sayHello&amp;amp;pid=182904&amp;amp;prefer.serialization=fastjson2,hessian2&amp;amp;release=3.2.9&amp;amp;&lt;br style=&quot;font-size: 10px;&quot;&gt;side=provider&amp;amp;timestamp=1704788919714&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1601" y="4110" width="440" height="100" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-283" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-269" target="omU1pgqW6LJjpDUwzffS-282" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-288" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-269" target="omU1pgqW6LJjpDUwzffS-287" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-269" value="Invoker&amp;lt;?&amp;gt; invoker = &lt;b style=&quot;font-size: 10px;&quot;&gt;proxyFactory&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;.getInvoker(ref, (Class) interfaceClass, url);&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;生成调用代理&lt;br style=&quot;font-size: 10px;&quot;&gt;ref: 要暴露的服务实例&lt;br style=&quot;font-size: 10px;&quot;&gt;interfaceClass 要暴露的服务接口类&lt;/font&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2039.97" y="4040" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-278" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-271" target="omU1pgqW6LJjpDUwzffS-273" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-271" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;ServiceConfigBase&amp;lt;T&amp;gt;&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//要暴露的服务接口类型&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected Class&amp;lt;?&amp;gt; interfaceClass;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//接口实现类型&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected transient T ref;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//Service类型path&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected String path;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//Provider配置&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected ProviderConfig provider;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected String providerIds;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected volatile String generic;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-440" y="3000" width="400" height="160" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-277" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-272" target="omU1pgqW6LJjpDUwzffS-271" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-272" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;ServiceConfig&amp;lt;T&amp;gt;&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private static final Map&amp;lt;String, Integer&amp;gt; RANDOM_PORT_MAP = new HashMap&amp;lt;String, Integer&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// 通过SPI注入的自适应Protocol实现类 Protocol$Adaptive&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Protocol &lt;b&gt;protocolSPI&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// 通过SPI注入的自适应ProxyFactory实现类 ProxyFactory$Adaptive&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ProxyFactory &lt;b&gt;proxyFactory&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;//&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ProviderModel providerModel;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private transient volatile boolean exported;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private transient volatile boolean unexported;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private transient volatile AtomicBoolean initialized = new AtomicBoolean(false);&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//已经暴露的服务, 注册类型 -&amp;gt; 暴露的服务列表&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Map&amp;lt;RegisterTypeEnum, List&amp;lt;Exporter&amp;lt;?&amp;gt;&amp;gt;&amp;gt; &lt;b&gt;exporters&lt;/b&gt; = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final List&amp;lt;ServiceListener&amp;gt; serviceListeners = new ArrayList&amp;lt;&amp;gt;();&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="-440" y="3200" width="400" height="240" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-279" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-273" target="omU1pgqW6LJjpDUwzffS-274" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-273" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;AbstractServiceConfig&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-340" y="2920" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-280" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-274" target="omU1pgqW6LJjpDUwzffS-275" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-274" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;AbstractInterfaceConfig&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-340" y="2840" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-281" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-275" target="omU1pgqW6LJjpDUwzffS-276" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-275" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;AbstractMethodConfig&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-340" y="2760" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-276" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;AbstractConfig&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-340" y="2680" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-285" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-282" target="omU1pgqW6LJjpDUwzffS-284" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-290" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-282" target="omU1pgqW6LJjpDUwzffS-289" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-282" value="Exporter&amp;lt;?&amp;gt; exporter = &lt;b&gt;protocolSPI&lt;/b&gt;.export(invoker);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;这里protocolSPI是SPI加载的Protocol自适应拓展类&lt;/font&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2039.9700000000003" y="4260" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-284" value="&lt;div&gt;&lt;b&gt;exporters&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .computeIfAbsent(registerType, k -&amp;gt; new CopyOnWriteArrayList&amp;lt;&amp;gt;()).&lt;span style=&quot;background-color: initial;&quot;&gt;add(exporter);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;缓存已经暴露的服务, 这里可以看到本地暴露就是将Invoker缓存到服务本地&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=6;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2040.0000000000002" y="4360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_qlzL3zjAAnoA7vvJnCW-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-287" target="_qlzL3zjAAnoA7vvJnCW-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-287" value="优先通过url中参数proxy选择ProxyFactory实现，但是此DEMO proxy参数未设置，就使用默认的javassist， SPI文件中对应&amp;nbsp;JavassistProxyFactory，由于SPI文件还指定了StubProxyFactoryWrapper这个包装类&lt;br style=&quot;font-size: 10px;&quot;&gt;还需要将 JavasistProxyFactory再包装一下&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2279.94" y="4030" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-289" target="Uk-qqwOQmqZAEX01Hiqb-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-289" value="protocolSPI.export() 先通过invoker参数getUrl获取URL配置，再获取协议类型，通过协议类型选择最终调用的Protocol类型,&lt;br&gt;这里是InjvmProtocol，另外由于SPI中有几个&lt;b&gt;Wrapper&lt;/b&gt;类，还会包装几次，最终&lt;b&gt;获取到一个经过多层封装的InjvmProtocol实例&lt;/b&gt;，然后调用此实例的export()方法&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2279.94" y="4250" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-294" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-291" target="omU1pgqW6LJjpDUwzffS-293" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-296" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-291" target="omU1pgqW6LJjpDUwzffS-295" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-291" value="url = &lt;b&gt;exportRemote&lt;/b&gt;(url, registryURLs, registerType);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;exportRemote()暴露到远程&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#ea6b66&quot;&gt;但是没有像预想的那样调用注册中心客户端接口远程注册&lt;/font&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1560" y="4520" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-99" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-293" target="Uk-qqwOQmqZAEX01Hiqb-98" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-293" value="MetadataUtils.publishServiceDefinition(url, providerModel.getServiceModel(), getApplicationModel());&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;向配置中心发布元数据&lt;/font&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1559.5" y="4960" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-49" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="omU1pgqW6LJjpDUwzffS-295" target="Uk-qqwOQmqZAEX01Hiqb-48" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-295" value="for registryURLs:&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1801" y="4535" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-301" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-298" target="omU1pgqW6LJjpDUwzffS-300" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-306" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-298" target="omU1pgqW6LJjpDUwzffS-305" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-298" value="&lt;div&gt;if (moduleModel != moduleModel.getApplicationModel()&lt;/div&gt;&lt;div&gt;.getInternalModule()) &lt;span style=&quot;background-color: initial;&quot;&gt;&lt;b&gt;applicationDeployer&lt;/b&gt;.&lt;b&gt;prepareInternalModule&lt;/b&gt;();&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;获取ApplictionModel下内部模块启动&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="830" y="4520" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-303" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-300" target="omU1pgqW6LJjpDUwzffS-302" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-300" value="&lt;div&gt;ModuleDeployer internalModuleDeployer =&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp;applicationModel.getInternalModule()&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;.getDeployer();&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1080" y="4520" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-304" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-302" target="omU1pgqW6LJjpDUwzffS-194" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1300" y="4630" />
              <mxPoint x="1300" y="4590" />
              <mxPoint x="580" y="4590" />
              <mxPoint x="580" y="2925" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-302" value="Future future = internalModuleDeployer.&lt;b&gt;start&lt;/b&gt;();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1080" y="4600" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-308" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-1" target="omU1pgqW6LJjpDUwzffS-307" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-305" target="2B_0uOn4qaRjd3fYnrwT-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-305" value="referServices();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;服务引用处理, 服务引用是动态代理类，比如通过Netty通信的服务引用就是Netty客户端的代理&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="840" y="5060" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-310" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-307" target="omU1pgqW6LJjpDUwzffS-309" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-20" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-307" target="H5okSNMw3-DTD0Bd1JaA-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-307" value="onModuleStarted();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="840" y="5460" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-312" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-309" target="omU1pgqW6LJjpDUwzffS-311" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-69" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-309" target="H5okSNMw3-DTD0Bd1JaA-68" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-309" value="&amp;nbsp;registerServices();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;这一步才真正实现RPC服务的注册&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="840" y="6200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-314" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-311" target="omU1pgqW6LJjpDUwzffS-313" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-91" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-311" target="H5okSNMw3-DTD0Bd1JaA-90" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-311" value="checkReferences();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="840" y="6360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-313" value="completeStartFuture(true);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="840" y="6520" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-316" style="orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=0.996;entryY=0.086;entryDx=0;entryDy=0;fillColor=#dae8fc;strokeColor=#6c8ebf;entryPerimeter=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-315" target="omU1pgqW6LJjpDUwzffS-282" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-323" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-315" target="omU1pgqW6LJjpDUwzffS-319" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uXRkhWS-5dNDIYHjtDfL-1" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="omU1pgqW6LJjpDUwzffS-315" target="2B_0uOn4qaRjd3fYnrwT-23">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2500" y="3940" />
              <mxPoint x="2500" y="5060" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-315" value="&lt;b&gt;protocolSPI&lt;/b&gt; = this.getExtensionLoader(&lt;b&gt;Protocol&lt;/b&gt;.class)&lt;br&gt;.getAdaptiveExtension();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;获取Protocol自适应拓展类,&amp;nbsp; 这个类的SPI文件有多个（在引入的不同模块中）&lt;/font&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2279.94" y="3880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-318" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-317" target="omU1pgqW6LJjpDUwzffS-315" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-317" value="&lt;b&gt;ServiceConfig&lt;br&gt;#postProcessAfterScopeModelChanged()&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;前面创建“ServiceBean:&amp;lt;接口全限定名&amp;gt;::”类型Bean 调用构造方法时会调用此方法&lt;br&gt;&lt;/font&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2041.0000000000002" y="3880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-320" style="orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=0;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=1;" parent="1" source="omU1pgqW6LJjpDUwzffS-319" target="omU1pgqW6LJjpDUwzffS-269" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="omU1pgqW6LJjpDUwzffS-319" value="&lt;b&gt;proxyFactory&lt;/b&gt; = this.getExtensionLoader(&lt;br&gt;&lt;b&gt;ProxyFactory&lt;/b&gt;.class)&lt;br&gt;.getAdaptiveExtension();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;获取Protocol自适应拓展类&lt;/font&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2279.9700000000003" y="3960" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_qlzL3zjAAnoA7vvJnCW-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_qlzL3zjAAnoA7vvJnCW-2" target="_qlzL3zjAAnoA7vvJnCW-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_qlzL3zjAAnoA7vvJnCW-2" value="return &lt;b&gt;proxyFactory&lt;/b&gt;.getInvoker(proxy, type, url);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;这里的proxyFactory就是被包装的&amp;nbsp;JavassistProxyFactory，这里创建方法调用代理&lt;/font&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="2519.97" y="4040" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_qlzL3zjAAnoA7vvJnCW-4" value="StubProxyFactoryWrapper" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2540" y="4010" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_qlzL3zjAAnoA7vvJnCW-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_qlzL3zjAAnoA7vvJnCW-5" target="_qlzL3zjAAnoA7vvJnCW-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_qlzL3zjAAnoA7vvJnCW-5" value="&lt;div&gt;final Wrapper wrapper =&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;Wrapper.getWrapper(&lt;/span&gt;&lt;/div&gt;&lt;div&gt;proxy.getClass().getName().indexOf(&#39;$&#39;) &amp;lt; 0 ? proxy.getClass() : type);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2759.97" y="4040" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_qlzL3zjAAnoA7vvJnCW-7" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;return new &lt;b&gt;AbstractProxyInvoker&lt;/b&gt;&amp;lt;T&amp;gt;(proxy, type, url) {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; @Override&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; protected Object &lt;b&gt;doInvoke&lt;/b&gt;(T proxy, String methodName, Class&amp;lt;?&amp;gt;[] parameterTypes, Object[] arguments) throws Throwable {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; return wrapper.&lt;b&gt;invokeMethod&lt;/b&gt;(proxy, methodName, parameterTypes, arguments);&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;};&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;arcSize=6;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="2739.99" y="4120" width="240.03" height="100" as="geometry" />
        </mxCell>
        <mxCell id="_qlzL3zjAAnoA7vvJnCW-9" value="JavassistProxyFactory" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2790" y="4010" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-1" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;String extName = ( url.getProtocol() == null ? &quot;dubbo&quot; : url.getProtocol() );&lt;br style=&quot;font-size: 10px;&quot;&gt;关于这句怎么生成的参考自适应拓展类代码生成器AdaptiveClassCodeGenerator&lt;br style=&quot;font-size: 10px;&quot;&gt;最终它会根据URL的协议类型调用Protocol具体实现类&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2481" y="3885" width="380" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-2" target="Uk-qqwOQmqZAEX01Hiqb-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-2" value="&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="2521.0000000000005" y="4260" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-4" value="&lt;b&gt;InjvmProtocol&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2569.97" y="4330" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-5" value="InvokerCountWrapper" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2550" y="4230" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-6" target="Uk-qqwOQmqZAEX01Hiqb-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-6" value="&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="2760.0100000000007" y="4260" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-8" value="ProtocolSerializationWrapper" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2770.01" y="4230" width="180" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-9" target="Uk-qqwOQmqZAEX01Hiqb-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-9" value="&lt;font color=&quot;#007fff&quot;&gt;在Invoker外又包装了一个过滤器链，&lt;br&gt;此Demo中注册了14个&lt;/font&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="3000.0000000000005" y="4260" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-11" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;Wrapper 其实也属于拓展点，&lt;br style=&quot;font-size: 10px;&quot;&gt;定位相当于拦截器、过滤器等&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2521" y="4160" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-12" value="ProtocolFilterWrapper" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="3030" y="4230" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-13" target="Uk-qqwOQmqZAEX01Hiqb-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-13" value="&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="3240.0000000000005" y="4260" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-15" value="ProtocolSecurityWrapper" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="3260" y="4230" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-20" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-16" target="Uk-qqwOQmqZAEX01Hiqb-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-16" value="startQosServer(invoker.getUrl(), true);&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="3480.0000000000005" y="4260" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-18" value="QosProtocolWrapper" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="3510" y="4230" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-23" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-19" target="Uk-qqwOQmqZAEX01Hiqb-22" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3930" y="4290" />
              <mxPoint x="3930" y="4340" />
              <mxPoint x="2510" y="4340" />
              <mxPoint x="2510" y="4390" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-19" value="&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="3720.0000000000005" y="4260" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-21" value="ProtocolListenerWrapper" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="3740" y="4230" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-22" value="return new &lt;b&gt;InjvmExporter&lt;/b&gt;&amp;lt;T&amp;gt;(invoker, invoker.getUrl().getServiceKey(), exporterMap);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;此时invoke是经过过滤器链封装的 ProxyInvoker&lt;/font&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2520" y="4360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-24" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;Exporter&amp;lt;T&amp;gt; (I)&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;Invoker&amp;lt;T&amp;gt; getInvoker();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;void unexport();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;void register();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;void unregister();&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-840" y="3642.5" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-28" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;dashed=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-25" target="Uk-qqwOQmqZAEX01Hiqb-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-25" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;AbstractExporter&amp;lt;T&amp;gt; (A)&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;Invoker 和 Exporter 是一对一的关系&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//注册的调用器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Invoker&amp;lt;T&amp;gt; invoker;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//是否未暴露&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile boolean unexported = false;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-840" y="3762.5" width="240" height="120" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-30" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-26" target="Uk-qqwOQmqZAEX01Hiqb-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-26" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;InjvmExporter&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;b&gt;Exporter其实就是加了暴露服务名和暴露状态等信息的Invoker&lt;/b&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//暴露的服务类全限定名&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final String key;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//key -&amp;gt; Exporter, 这个Map其实是AbstractProtocol中创建的&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Map&amp;lt;String, Exporter&amp;lt;?&amp;gt;&amp;gt; &lt;b&gt;exporterMap&lt;/b&gt;;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-1060" y="3922.5" width="320" height="120" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-31" value="&lt;b&gt;下面的类位于dubbo-rpc 模块&lt;/b&gt;" style="text;html=1;align=right;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="-220" y="3572.5" width="180" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-33" value="&lt;div style=&quot;text-align: center;&quot;&gt;Protocol&lt;b&gt;&amp;nbsp;(I)&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;Invoker&amp;lt;T&amp;gt; getInvoker();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;void unexport();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;void register();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;void unregister();&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-1360" y="3642.5" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-34" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;dashed=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-35" target="Uk-qqwOQmqZAEX01Hiqb-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-39" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;dashed=1;endArrow=block;endFill=0;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-35" target="Uk-qqwOQmqZAEX01Hiqb-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-35" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;AbstractProtocol&lt;/b&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;(A)&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;Invoker 和 Exporter 是一对一的关系&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//&lt;b&gt;服务全限定名&lt;/b&gt; -&amp;gt; Exporter, 引用会传给此Protocol下所有的Exporter&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected final Map&amp;lt;String, Exporter&amp;lt;?&amp;gt;&amp;gt; &lt;b&gt;exporterMap&lt;/b&gt; = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected final Map&amp;lt;String, ProtocolServer&amp;gt; &lt;b&gt;serverMap&lt;/b&gt; = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected final Set&amp;lt;Invoker&amp;lt;?&amp;gt;&amp;gt; &lt;b&gt;invokers&lt;/b&gt; = new ConcurrentHashSet&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected FrameworkModel &lt;b&gt;frameworkModel&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Set&amp;lt;String&amp;gt; &lt;b&gt;optimizers&lt;/b&gt; = new ConcurrentHashSet&amp;lt;&amp;gt;();&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-1560" y="3762.5" width="400" height="200" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-36" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-37" target="Uk-qqwOQmqZAEX01Hiqb-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-37" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;InjvmProtocol&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;public static final String NAME = LOCAL_PROTOCOL; &lt;font color=&quot;#007fff&quot;&gt;//“injvm”&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;public static final int DEFAULT_PORT = 0;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-1520" y="4002.5" width="320" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-38" value="&lt;div style=&quot;text-align: center;&quot;&gt;ScopeModelAware&lt;b&gt;&amp;nbsp;(I)&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;Invoker&amp;lt;T&amp;gt; getInvoker();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;void unexport();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;void register();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;void unregister();&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-1640" y="3642.5" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-40" value="&lt;div style=&quot;text-align: center;&quot;&gt;Node&lt;b&gt;&amp;nbsp;(I)&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;URL getUrl();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;boolean isAvailable();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;void destroy();&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-280" y="3642.5" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-44" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-41" target="Uk-qqwOQmqZAEX01Hiqb-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-41" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;Invoker&amp;lt;T&amp;gt;&lt;/b&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;(I)&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//暴露的服务类&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;Class&amp;lt;T&amp;gt; &lt;b&gt;getInterface&lt;/b&gt;();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;Result &lt;b&gt;invoke&lt;/b&gt;(Invocation invocation) throws RpcException;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-280" y="3762.5" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-45" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;dashed=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-43" target="Uk-qqwOQmqZAEX01Hiqb-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-43" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;AbstractProxyInvoker&lt;/b&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&amp;lt;T&amp;gt;&lt;/b&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;(A)&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//暴露的服务类代理&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final T proxy;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Class&amp;lt;T&amp;gt; type;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final URL url;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-280" y="3882.5" width="240" height="120" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-46" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;Invocation&lt;/b&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;(I)&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;String getMethodName();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;String getServiceName();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;Class&amp;lt;?&amp;gt;[] getParameterTypes();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;Object[] getArguments();&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Map&amp;lt;String, String&amp;gt; getAttachments();&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Map&amp;lt;String, Object&amp;gt; getObjectAttachments();&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Invoker&amp;lt;?&amp;gt; getInvoker();&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;...&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-560" y="3642.5" width="240" height="160" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-47" value="for end&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1801" y="4770" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-51" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-48" target="Uk-qqwOQmqZAEX01Hiqb-50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-48" value="registryURL协议名为&lt;br&gt;service-discovery-registry&lt;br&gt;会往URL添加service-name-mapping=true&lt;br&gt;另外还会往registryURL添加一些其他参数、属性：dynamic、monitor、proxy、export&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1801" y="4600" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-53" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-50" target="Uk-qqwOQmqZAEX01Hiqb-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-59" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-50" target="Uk-qqwOQmqZAEX01Hiqb-55" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2020" y="4710" />
              <mxPoint x="2020" y="4510" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-50" value="&lt;b&gt;doExportUrl&lt;/b&gt;(&lt;br&gt;registryURL.putAttribute(EXPORT_KEY,url), true, registerType);&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1801" y="4680" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-54" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;rounded=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-63" target="Uk-qqwOQmqZAEX01Hiqb-57" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-55" value="Invoker&amp;lt;?&amp;gt; invoker = &lt;b style=&quot;font-size: 10px;&quot;&gt;proxyFactory&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;.getInvoker(ref, (Class) interfaceClass, url);&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;和上面一样,也是创建一个代理Invoker&lt;/font&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2039.9700000000003" y="4480" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-56" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-57" target="Uk-qqwOQmqZAEX01Hiqb-58" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-61" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-57" target="Uk-qqwOQmqZAEX01Hiqb-60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-57" value="Exporter&amp;lt;?&amp;gt; exporter = &lt;b&gt;protocolSPI&lt;/b&gt;.export(invoker);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;和本地暴露的差别在这一步&lt;/font&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2039.9700000000003" y="4640" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-58" value="&lt;div&gt;&lt;b&gt;exporters&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .computeIfAbsent(registerType, k -&amp;gt; new CopyOnWriteArrayList&amp;lt;&amp;gt;()).&lt;span style=&quot;background-color: initial;&quot;&gt;add(exporter);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;缓存已经暴露的服务到服务本地&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=6;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2039.9700000000003" y="4860" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-67" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-60" target="Uk-qqwOQmqZAEX01Hiqb-66" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-60" value="同样最终&lt;b&gt;获取到一个经过多层Wrapper封装的RegistryProtocol实例&lt;/b&gt;,&lt;br&gt;然后调用此实例的export()方法&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;同样讲过多层Wrapper这里不重复展示了&lt;/font&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2279.94" y="4640" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-64" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;rounded=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-55" target="Uk-qqwOQmqZAEX01Hiqb-63" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2140" y="4540" as="sourcePoint" />
            <mxPoint x="2140" y="4640" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-63" value="invoker = new DelegateProviderMetaDataInvoker(invoker, this);&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2039.9700000000003" y="4560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-65" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;service-discovery-registry=org.apache.dubbo.registry.integration.RegistryProtocol&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2040" y="4700" width="380" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-70" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-72" target="Uk-qqwOQmqZAEX01Hiqb-69" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-73" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-66" target="Uk-qqwOQmqZAEX01Hiqb-72" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uXRkhWS-5dNDIYHjtDfL-2" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" edge="1" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-66" target="2B_0uOn4qaRjd3fYnrwT-23">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-66" value="URL &lt;b&gt;registryUrl&lt;/b&gt; = getRegistryUrl(originInvoker);&lt;br&gt;URL &lt;b&gt;providerUrl&lt;/b&gt; = getProviderUrl(originInvoker);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;注册接口和服务调用接口，TODO后续再看&lt;/font&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2521.0000000000005" y="4640" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-68" value="&lt;b&gt;RegistryProtocol&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2561" y="4610" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-76" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-69" target="Uk-qqwOQmqZAEX01Hiqb-75" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-79" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-69" target="Uk-qqwOQmqZAEX01Hiqb-78" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-69" value="final ExporterChangeableWrapper&amp;lt;T&amp;gt; exporter = &lt;b&gt;doLocalExport&lt;/b&gt;(originInvoker, providerUrl);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;注册中心远程服务在各服务本地一般都有缓存，这个bounds或许就是&lt;/font&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2521.0000000000005" y="4800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-71" value="nacos://127.0.0.1:8848/org.apache.dubbo.registry.RegistryService?application=dubbo-springboot-demo-provider&amp;dubbo=2.0.2&amp;executor-management-mode=isolation&amp;file-cache=true&amp;pid=9621&amp;register=false&amp;release=3.2.9&amp;timestamp=1705129751201&#xa;dubbo://172.17.0.1:50052/org.apache.dubbo.springboot.demo.DemoService?anyhost=true&amp;application=dubbo-springboot-demo-provider&amp;background=false&amp;bind.ip=172.17.0.1&amp;bind.port=50052&amp;deprecated=false&amp;dubbo=2.0.2&amp;dynamic=true&amp;executor-management-mode=isolation&amp;file-cache=true&amp;generic=false&amp;interface=org.apache.dubbo.springboot.demo.DemoService&amp;methods=sayHello&amp;pid=9621&amp;prefer.serialization=fastjson2,hessian2&amp;release=3.2.9&amp;service-name-mapping=true&amp;side=provider&amp;timestamp=1705129751306" style="text;whiteSpace=wrap;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="2730" y="4620" width="1000" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-74" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-66" target="Uk-qqwOQmqZAEX01Hiqb-72" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2620" y="4700" as="sourcePoint" />
            <mxPoint x="2620" y="4860" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-72" value="&lt;b&gt;providerUrl&lt;/b&gt; = overrideUrlWithConfig(providerUrl, overrideSubscribeListener);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;TODO后续再看&lt;/font&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2521.0000000000005" y="4720" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-75" value="return new &lt;b&gt;DestroyableExporter&lt;/b&gt;&amp;lt;&amp;gt;(exporter);&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2521.0000000000005" y="4880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-77" value="&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;dubbo://172.17.0.1:50052/org.apache.dubbo.springboot.demo.DemoService?anyhost=true&amp;amp;application=dubbo-springboot-demo-provider&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;background=false&amp;amp;bind.ip=172.17.0.1&amp;amp;bind.port=50052&amp;amp;deprecated=false&amp;amp;dubbo=2.0.2&amp;amp;dynamic=true&amp;amp;executor-management-mode=isolation&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;file-cache=true&amp;amp;generic=false&amp;amp;interface=org.apache.dubbo.springboot.demo.DemoService&amp;amp;methods=sayHello&amp;amp;pid=9621&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;prefer.serialization=fastjson2,hessian2&amp;amp;release=3.2.9&amp;amp;service-name-mapping=true&amp;amp;side=provider&amp;amp;timestamp=1705129751306&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2730" y="4720" width="800" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-81" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-78" target="Uk-qqwOQmqZAEX01Hiqb-80" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-78" value="Invoker&amp;lt;?&amp;gt; invokerDelegate = new &lt;b&gt;InvokerDelegate&lt;/b&gt;&amp;lt;&amp;gt;(originInvoker, providerUrl);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;包含原始Invoker、元数据、服务调用URL&lt;/font&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2760.0100000000007" y="4800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-86" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-80" target="Uk-qqwOQmqZAEX01Hiqb-85" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-89" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-80" target="Uk-qqwOQmqZAEX01Hiqb-88" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-107" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-80" target="Uk-qqwOQmqZAEX01Hiqb-105" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-80" value="&lt;div&gt;ReferenceCountExporter&amp;lt;?&amp;gt; exporter =&lt;/div&gt;&lt;div&gt;&lt;b&gt;exporterFactory&lt;/b&gt;.createExporter(&lt;/div&gt;&lt;div&gt;providerUrlKey, () -&amp;gt; &lt;b&gt;protocol&lt;/b&gt;.&lt;b&gt;export&lt;/b&gt;(invokerDelegate));&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2760.0100000000007" y="4880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-82" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;RegistryProtocol&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Map&amp;lt;String, ServiceConfigurationListener&amp;gt; &lt;b&gt;serviceConfigurationListeners&lt;/b&gt; = new &lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// provider url &amp;lt;--&amp;gt; registry url &amp;lt;--&amp;gt; exporter&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Map&amp;lt;String, Map&amp;lt;String, ExporterChangeableWrapper&amp;lt;?&amp;gt;&amp;gt;&amp;gt; &lt;b&gt;bounds&lt;/b&gt; = new &lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//&amp;nbsp;Protocol 自适应拓展实现类&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected Protocol &lt;b&gt;protocol&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// RegistryFactory 自适应拓展实现类&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected ProxyFactory &lt;b&gt;proxyFactory&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ConcurrentMap&amp;lt;URL, ReExportTask&amp;gt; &lt;b&gt;reExportFailedTasks&lt;/b&gt; = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private HashedWheelTimer &lt;b&gt;retryTimer&lt;/b&gt; = new HashedWheelTimer(...);&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private FrameworkModel &lt;b&gt;frameworkModel&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ExporterFactory &lt;b&gt;exporterFactory&lt;/b&gt;;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-1640" y="4122.5" width="480" height="240" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-106" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-85" target="Uk-qqwOQmqZAEX01Hiqb-105" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-85" value="&lt;div&gt;return new &lt;b&gt;ReferenceCountExporter&lt;/b&gt;&amp;lt;&amp;gt;(exporterProducer.call(), key, this);&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="3000.0000000000005" y="4880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-87" value="&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#ea6b66&quot;&gt;RegistryProtol#export()&lt;br&gt;&amp;nbsp;这部分代码都是创建对象，&lt;br&gt;赋值什么的？不看后面的使用逻辑，&lt;br&gt;很难理解这些类都是做什么的，&lt;br&gt;可以先略过细节，后面用到时回来再看&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2301" y="4760" width="190" height="90" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-88" value="&lt;div&gt;&lt;div&gt;return (ExporterChangeableWrapper&amp;lt;T&amp;gt;) &lt;b&gt;bounds&lt;/b&gt;.computeIfAbsent(providerUrlKey, _k -&amp;gt; new ConcurrentHashMap&amp;lt;&amp;gt;())&lt;/div&gt;&lt;div&gt;.computeIfAbsent(registryUrlKey, s -&amp;gt; {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return new &lt;b&gt;ExporterChangeableWrapper&lt;/b&gt;&amp;lt;&amp;gt;((ReferenceCountExporter&amp;lt;T&amp;gt;) exporter, originInvoker);&lt;/div&gt;&lt;div&gt;});&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="2760.01" y="4980" width="359.99" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-90" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;RegistryProtocol$&lt;/b&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;ExporterChangeableWrapper&amp;lt;T&amp;gt;&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ScheduledExecutorService &lt;b&gt;executor&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Invoker&amp;lt;T&amp;gt; &lt;b&gt;originInvoker&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Exporter&amp;lt;T&amp;gt; &lt;b&gt;exporter&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private URL subscribeUrl;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private URL registerUrl;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private NotifyListener notifyListener;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final AtomicBoolean registered = new AtomicBoolean(false);&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-880" y="4122.5" width="320" height="160" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-93" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;dashed=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-92" target="Uk-qqwOQmqZAEX01Hiqb-24" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-360" y="3842.5" />
              <mxPoint x="-580" y="3842.5" />
              <mxPoint x="-580" y="3732.5" />
              <mxPoint x="-720" y="3732.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-92" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;ReferenceCountExporter&amp;lt;T&amp;gt;&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Exporter&amp;lt;T&amp;gt; exporter;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final String providerKey;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ExporterFactory exporterFactory;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final AtomicInteger count = new AtomicInteger(0);&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-520" y="4122.5" width="320" height="160" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-101" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-98" target="Uk-qqwOQmqZAEX01Hiqb-100" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-98" value="&lt;b&gt;reportCacheExecutor&lt;/b&gt;.execute(() -&amp;gt; storeProviderMetadataTask(&lt;br&gt;providerMetadataIdentifier, serviceDefinition));&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1799.45" y="4960" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-100" value="&lt;b&gt;NacosMetadata#&lt;br&gt;storeProviderMetadataTask(...)&lt;br&gt;&lt;/b&gt;&lt;font color=&quot;#007fff&quot;&gt;倒是先把Provider服务元数据推到了配置中心&lt;/font&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2040.4999999999998" y="4960" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-102" value="providerModel.setServiceUrls(urls);&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1080" y="3577.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-104" value="默认模块的DefaultModuleDeployer -&amp;gt; DefaultApplicationDeployer -&amp;gt; 内部模块的DefaultModuleDeployer" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="600" y="4480" width="570" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-109" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-105" target="Uk-qqwOQmqZAEX01Hiqb-108" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3460" y="4910" />
              <mxPoint x="3460" y="5100" />
              <mxPoint x="2510" y="5100" />
              <mxPoint x="2510" y="5150" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-114" value="..." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="Uk-qqwOQmqZAEX01Hiqb-109" vertex="1" connectable="0">
          <mxGeometry x="-0.25" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-112" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=1;entryDx=0;entryDy=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-105" target="Uk-qqwOQmqZAEX01Hiqb-57" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-105" value="&lt;div&gt;&lt;b&gt;protocol&lt;/b&gt;.&lt;b&gt;export&lt;/b&gt;(invokerDelegate)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;此protocol即前面的protocolSPI&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;只不过因为&lt;/font&gt;&lt;span style=&quot;color: rgb(0, 127, 255); background-color: initial;&quot;&gt;&amp;nbsp;invokerDelegate url协议改为了dubbo，这里最终调用到 DubboProtocol&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="3240.0000000000005" y="4880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-119" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-108" target="Uk-qqwOQmqZAEX01Hiqb-118" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-108" value="&lt;div&gt;DubboExporter&amp;lt;T&amp;gt; exporter = new &lt;b&gt;DubboExporter&lt;/b&gt;&amp;lt;T&amp;gt;(invoker, key, exporterMap);&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2519.9500000000003" y="5120" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-113" value="&lt;b&gt;DubboProtocol&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2566.0000000000005" y="5090" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-115" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;DubboProtocol&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;public static final String NAME = &quot;dubbo&quot;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;public static final int DEFAULT_PORT = 20880;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private static final String IS_CALLBACK_SERVICE_INVOKE = &quot;_isCallBackServiceInvoke&quot;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Map&amp;lt;String, SharedClientsProvider&amp;gt; &lt;b&gt;referenceClientMap&lt;/b&gt; = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final AtomicBoolean destroyed = new AtomicBoolean();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ExchangeHandler &lt;b&gt;requestHandler&lt;/b&gt;;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-2160" y="4122.5" width="480" height="240" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-117" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-116" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-720" y="3882.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-116" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;DubboExporter&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//暴露的服务类全限定名+端口，比如&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;org.apache.dubbo.springboot.demo.DemoService:50052&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final String key;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//key -&amp;gt; Exporter&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Map&amp;lt;String, Exporter&amp;lt;?&amp;gt;&amp;gt; exporterMap;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-700" y="3922.5" width="320" height="120" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-121" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-118" target="Uk-qqwOQmqZAEX01Hiqb-120" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-123" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-118" target="Uk-qqwOQmqZAEX01Hiqb-122" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-118" value="&lt;div&gt;openServer(url);&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2519.9500000000003" y="5200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-125" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-120" target="Uk-qqwOQmqZAEX01Hiqb-124" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2998.95" y="5229.999999999999" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-120" value="&lt;div&gt;serverMap.put(key, &lt;b&gt;createServer&lt;/b&gt;(url));&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2759.9500000000003" y="5200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-122" value="&lt;div&gt;optimizeSerialization(url);&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;初始化序列化优化器&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2519.9500000000003" y="5280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-127" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-124" target="Uk-qqwOQmqZAEX01Hiqb-126" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-131" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-124" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="3098.95" y="5260" as="sourcePoint" />
            <mxPoint x="3098.95" y="5280" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-124" value="&lt;div&gt;server = Exchangers.bind(url, requestHandler);&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;本质是创建了Netty服务端，但是这里没有启动&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="3000.0000000000005" y="5200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-129" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uk-qqwOQmqZAEX01Hiqb-126" target="Uk-qqwOQmqZAEX01Hiqb-128" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-126" value="&lt;div&gt;return getExchanger(url).bind(url, handler);&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="3240.0000000000005" y="5200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-128" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;server = new &lt;b&gt;HeaderExchangeServer&lt;/b&gt;(&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;Transporters.bind(url, new DecodeHandler(new HeaderExchangeHandler(handler))));&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;return server;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="3480.0000000000005" y="5200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-130" value="&lt;div&gt;&amp;nbsp;DubboProtocolServer protocolServer = new &lt;b&gt;DubboProtocolServer&lt;/b&gt;(server);&lt;br&gt;&lt;/div&gt;&lt;div&gt;return protocolServer;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="3000.0000000000005" y="5280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Uk-qqwOQmqZAEX01Hiqb-132" value="&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;不过内部模块很多东西都是空的，暂略&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1300" y="4610" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-2" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="omU1pgqW6LJjpDUwzffS-305" target="H5okSNMw3-DTD0Bd1JaA-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="940" y="5360" as="sourcePoint" />
            <mxPoint x="940" y="5460" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-1" value="如果 asyncExportingFutures 和&amp;nbsp;asyncReferringFutures 非空&lt;br&gt;需要等待它们完成" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="840" y="5380" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-24" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-3" target="H5okSNMw3-DTD0Bd1JaA-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-26" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-3" target="H5okSNMw3-DTD0Bd1JaA-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-3" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; setStarted();&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1319.5" y="5461" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-5" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;Deployer (I)&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;初始化、启动、关闭、状态判断、状态获取、添加删除监听器等等方法&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-700" y="1999.5" width="400" height="40" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-7" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-6" target="H5okSNMw3-DTD0Bd1JaA-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-6" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;ApplicationDeployer (I)&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-280" y="2079.5" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-9" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-8" target="H5okSNMw3-DTD0Bd1JaA-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-240.00000000000045" y="2039.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-8" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;ModuleDeployer (I)&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-960" y="2079.5" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-17" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0.725;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-10" target="H5okSNMw3-DTD0Bd1JaA-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-10" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;AbstractDeployer&lt;/b&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;(A)&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//状态：UNKNOWN、PENDING（待启动 ）、STARING、STARTED、&lt;/font&gt;&lt;/p&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;STOPPING、STOPPED、FAILED&lt;/font&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile DeployState &lt;b&gt;state&lt;/b&gt; = PENDING;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile Throwable &lt;b&gt;lastError&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected volatile boolean &lt;b&gt;initialized&lt;/b&gt; = false;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//监听Deployer生命周期事件&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected List&amp;lt;DeployListener&amp;lt;E&amp;gt;&amp;gt; &lt;b&gt;listeners&lt;/b&gt; = new CopyOnWriteArrayList&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private E &lt;b&gt;scopeModel&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-680" y="2079.5" width="360" height="120" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-16" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-12" target="H5okSNMw3-DTD0Bd1JaA-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-12" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;DefaultApplicationDeployer&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;private final ApplicationModel applicationModel;&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConfigManager &lt;b&gt;configManager&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Environment environment;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ReferenceCache referenceCache;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final FrameworkExecutorRepository frameworkExecutorRepository;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ExecutorRepository executorRepository;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final AtomicBoolean hasPreparedApplicationInstance = new AtomicBoolean(false);&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile boolean hasPreparedInternalModule = false;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ScheduledFuture&amp;lt;?&amp;gt; asyncMetadataFuture;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile CompletableFuture&amp;lt;Boolean&amp;gt; startFuture;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final DubboShutdownHook dubboShutdownHook;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private volatile MetricsServiceExporter metricsServiceExporter;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Object stateLock = new Object();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Object startLock = new Object();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Object destroyLock = new Object();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Object internalModuleLock = new Object();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-440" y="2239.5" width="400" height="360" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-14" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-13" target="H5okSNMw3-DTD0Bd1JaA-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-13" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;DefaultModuleDeployer&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final List&amp;lt;CompletableFuture&amp;lt;?&amp;gt;&amp;gt; asyncExportingFutures = new ArrayList&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final List&amp;lt;CompletableFuture&amp;lt;?&amp;gt;&amp;gt; asyncReferringFutures = new ArrayList&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final List&amp;lt;ServiceConfigBase&amp;lt;?&amp;gt;&amp;gt; exportedServices = new ArrayList&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ModuleModel moduleModel;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final FrameworkExecutorRepository frameworkExecutorRepository;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ExecutorRepository executorRepository;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ModuleConfigManager configManager;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final SimpleReferenceCache referenceCache;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ApplicationDeployer &lt;b&gt;applicationDeployer&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private CompletableFuture startFuture;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Boolean background;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Boolean exportAsync;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Boolean referAsync;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private CompletableFuture&amp;lt;?&amp;gt; exportFuture;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private CompletableFuture&amp;lt;?&amp;gt; referFuture;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-880" y="2239.5" width="400" height="360" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-21" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-19" target="H5okSNMw3-DTD0Bd1JaA-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-22" value="Y" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" parent="H5okSNMw3-DTD0Bd1JaA-21" vertex="1" connectable="0">
          <mxGeometry x="0.0778" y="3" relative="1" as="geometry">
            <mxPoint x="-2" y="3" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-19" value="isStarting()" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="1100" y="5460" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-23" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;this.state = STARTED;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;for listeners:&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;listener.onStarted(scopeModel);&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1559.5" y="5461" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-28" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-25" target="H5okSNMw3-DTD0Bd1JaA-27" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-25" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;applicationDeployer&lt;/b&gt;.notifyModuleChanged(&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;moduleModel, DeployState.STARTED);&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1320" y="5560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-30" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-27" target="H5okSNMw3-DTD0Bd1JaA-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-32" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-27" target="H5okSNMw3-DTD0Bd1JaA-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-27" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;checkState(moduleModel, state);&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;根据不同的状态，调用对应的onXxx()方法&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1560.5" y="5560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-29" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;synchronized (stateLock) {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;stateLock.notifyAll();&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;}&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="1560.5" y="5640" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-34" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-31" target="H5okSNMw3-DTD0Bd1JaA-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-36" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-31" target="H5okSNMw3-DTD0Bd1JaA-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-31" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;prepareApplicationInstance();&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1801.5" y="5560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-56" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-33" target="H5okSNMw3-DTD0Bd1JaA-55" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-33" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;onStarted();&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1801.5" y="6060" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-38" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-35" target="H5okSNMw3-DTD0Bd1JaA-37" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-35" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;exportMetricsService();&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;暴露Metrics服务,暂时没有用到，todo&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2039.97" y="5560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-41" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-37" target="H5okSNMw3-DTD0Bd1JaA-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-44" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-37" target="H5okSNMw3-DTD0Bd1JaA-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-37" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;然后判断是否是纯消费者实例，不是的话&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;exportMetadataService&lt;/b&gt;();&amp;nbsp;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2040.5" y="5640" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-39" value="&lt;b style=&quot;font-size: 10px;&quot;&gt;DefaultApplicationDeployer&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1586" y="5530" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-40" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;内部向Netty服务器注册服务，todo&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2279.94" y="5640" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-42" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;dubbo://172.17.0.1:50052/org.apache.dubbo.metadata.MetadataService?anyhost=true&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;application=dubbo-springboot-demo-provider&amp;amp;background=false&amp;amp;bind.ip=172.17.0.1&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;bind.port=50052&amp;amp;delay=0&amp;amp;deprecated=false&amp;amp;dubbo=2.0.2&amp;amp;dynamic=true&amp;amp;executor-management-mode=isolation&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;file-cache=true&amp;amp;generic=false&amp;amp;getAndListenInstanceMetadata.1.callback=true&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;getAndListenInstanceMetadata.return=true&amp;amp;getAndListenInstanceMetadata.sent=true&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;group=dubbo-springboot-demo-provider&amp;amp;interface=org.apache.dubbo.metadata.MetadataService&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;methods=exportInstanceMetadata,getAndListenInstanceMetadata,getExportedServiceURLs,getExportedURLs,&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;getInstanceMetadataChangedListenerMap,getMetadataInfo,getMetadataInfos,getMetadataURL,&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;getServiceDefinition,getSubscribedURLs,isMetadataService,serviceName,toSortedStrings,version&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;pid=10556&amp;amp;prefer.serialization=fastjson2,hessian2&amp;amp;register=false&amp;amp;release=3.2.9&amp;amp;revision=1.0.0&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;service.filter=-default&amp;amp;side=provider&amp;amp;timestamp=1705478253281&amp;amp;version=1.0.0&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2490" y="5640" width="540" height="150" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-46" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-43" target="H5okSNMw3-DTD0Bd1JaA-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-43" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;非纯消费者实例且hasPreparedApplicationInstance == false,执行&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;registerServiceInstance&lt;/b&gt;();&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2040.5" y="5800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-48" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-45" target="H5okSNMw3-DTD0Bd1JaA-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-54" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-45" target="H5okSNMw3-DTD0Bd1JaA-53" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-45" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;registered = true;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;ServiceInstanceMetadataUtils&lt;br style=&quot;font-size: 10px;&quot;&gt;.&lt;b style=&quot;font-size: 10px;&quot;&gt;registerMetadataAndInstance&lt;/b&gt;(&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;applicationModel);&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2279.5" y="5800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-50" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-47" target="H5okSNMw3-DTD0Bd1JaA-49" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-47" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;RegistryManager registryManager = applicationModel.getBeanFactory()&lt;br style=&quot;font-size: 10px;&quot;&gt;.getBean(&lt;b style=&quot;font-size: 10px;&quot;&gt;RegistryManager&lt;/b&gt;.class);&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2521" y="5800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-52" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-49" target="H5okSNMw3-DTD0Bd1JaA-51" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-49" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;List&amp;lt;ServiceDiscovery&amp;gt; serviceDiscoveries = registryManager.getServiceDiscoveries();&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;从注册中心管理器ServiceDiscoveryRegistry类型列表获取ServiceDiscovery实例&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2521" y="5880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-51" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 10px;&quot;&gt;serviceDiscoveries.forEach(&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;ServiceDiscovery::register);&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=14;" parent="1" vertex="1">
          <mxGeometry x="2521" y="5960" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-53" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;div&gt;asyncMetadataFuture = frameworkExecutorRepository&lt;/div&gt;&lt;div&gt;.getSharedScheduledExecutor()&lt;/div&gt;&lt;div&gt;.scheduleWithFixedDelay(...);&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;定时任务定期刷新服务实例&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2279.5" y="5880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-58" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-55" target="H5okSNMw3-DTD0Bd1JaA-57" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-61" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-55" target="H5okSNMw3-DTD0Bd1JaA-60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-55" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;setStarted();&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2041.5" y="6060" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-57" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;startMetricsCollector();&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2041.5" y="6140" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-63" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-60" target="H5okSNMw3-DTD0Bd1JaA-62" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-66" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-60" target="H5okSNMw3-DTD0Bd1JaA-64" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-67" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-60" target="H5okSNMw3-DTD0Bd1JaA-65" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-60" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;for&amp;nbsp;listeners:&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;listener.onStarted(scopeModel);&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2279.5" y="6060" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-62" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;ExporterDeployListener#onStarted()&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2521" y="6060" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-64" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;CertDeployListener#onStarted()&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2521" y="6140" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-65" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;DubboDeployApplicationListener#onStarted()&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2521" y="6220" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-71" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-68" target="H5okSNMw3-DTD0Bd1JaA-70" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-89" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-68" target="H5okSNMw3-DTD0Bd1JaA-72" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-68" value="for configManager.getServices()&lt;br&gt;&lt;b&gt;registerServiceInternal&lt;/b&gt;(sc);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1080" y="6200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-70" value="applicationDeployer&lt;br&gt;.refreshServiceInstance();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1080" y="6280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-77" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-72" target="H5okSNMw3-DTD0Bd1JaA-76" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-72" value="ServiceConfig&amp;lt;?&amp;gt; serviceConfig = (ServiceConfig&amp;lt;?&amp;gt;) sc;&lt;br&gt;sc.register(true);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1320" y="6200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-74" value="ServiceConfig" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1376" y="6170" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-79" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-76" target="H5okSNMw3-DTD0Bd1JaA-78" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-76" value="遍历获取exporters中所有AUTO_REGISTER&lt;br&gt;类型的 Exporter 执行&lt;br&gt;exporter.&lt;b&gt;register&lt;/b&gt;();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1561" y="6200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-81" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-78" target="H5okSNMw3-DTD0Bd1JaA-80" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-78" value="遍历获取exporters中所有AUTO_REGISTER_BY_DEPLOYER&lt;br&gt;类型的 Exporter 执行&lt;br&gt;exporter.&lt;b&gt;register&lt;/b&gt;();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1561" y="6280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-84" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-80" target="H5okSNMw3-DTD0Bd1JaA-83" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-80" value="URL registryUrl = getRegistryUrl(originInvoker);&lt;br&gt;Registry registry = getRegistry(registryUrl);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1801" y="6280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-82" value="&lt;b&gt;RegistryProtocol&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1841" y="6250" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-86" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-83" target="H5okSNMw3-DTD0Bd1JaA-85" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-88" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-83" target="H5okSNMw3-DTD0Bd1JaA-87" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-83" value="RegistryProtocol.&lt;b&gt;register&lt;/b&gt;(registry, getRegisterUrl());" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1801.5" y="6360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-85" value="RegistryProtocol.&lt;b&gt;register&lt;/b&gt;(registry, getRegisterUrl());" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2041.5" y="6360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-87" value="" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1801.5" y="6440" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-93" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-90" target="H5okSNMw3-DTD0Bd1JaA-92" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-90" value="Optional&amp;lt;ModuleConfig&amp;gt; module = configManager.getModule();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1080" y="6360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-92" value="for (ReferenceConfigBase&amp;lt;?&amp;gt; rc : configManager.getReferences()) referenceCache.check(rc, timeout);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1080" y="6440" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-94" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;DubboDeployApplicationListener&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;实现了Spring ApplicationListener 接口，监听Spring ContextRefreshedEvent、ContextClosedEvent 事件；还可以发布&amp;nbsp;DubboApplicationStateEvent、DubboModuleStateEvent 事件&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//Spring应用上下文&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ApplicationContext applicationContext;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//DubboSpringInitializer初始化时创建&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ApplicationModel applicationModel;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;DubboSpringInitializer初始化时创建&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ModuleModel moduleModel;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="-1320" y="2680" width="400" height="200" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-97" value="FrameworkModel.defaultModel().defaultApplication() 方式创建了ApplicationModel实例，&lt;br&gt;然后又通过&amp;nbsp;applicationModel.getDefaultModule() 方式创建了 ModuleModel实例&lt;br&gt;所以这里创建了 Framework -&amp;gt; Application -&amp;gt; Module 的模型" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="2239.97" y="625" width="410" height="50" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-98" value="&lt;b&gt;RegistryScopeModelInitializer&lt;/b&gt;#&lt;br&gt;initializeFrameworkModel(FrameworkModel frameworkModel)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;往ScopeBeanFactory中注册了ExporterFactory实例&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="3080" y="710" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="H5okSNMw3-DTD0Bd1JaA-101" target="-OMnOMYa6ulq2eywQm4B-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-101" value="String result = demoService.sayHello(&quot;world&quot;);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="600" y="6940" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H5okSNMw3-DTD0Bd1JaA-104" value="远程调用" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="200" y="7420" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="-OMnOMYa6ulq2eywQm4B-1" target="-OMnOMYa6ulq2eywQm4B-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-1" value="invoke(Object &lt;b style=&quot;font-size: 10px;&quot;&gt;proxy&lt;/b&gt;, Method &lt;b style=&quot;font-size: 10px;&quot;&gt;method&lt;/b&gt;, Object[] &lt;b style=&quot;font-size: 10px;&quot;&gt;args&lt;/b&gt;)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="840" y="6940" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-3" value="LazyTargetInvocationHandler" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="865" y="6760" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="-OMnOMYa6ulq2eywQm4B-4" target="-OMnOMYa6ulq2eywQm4B-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-64" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="-OMnOMYa6ulq2eywQm4B-4" target="-dgZXbgsa9ORmBTnPNrw-63" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-4" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;if (target == null) {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;target&lt;/b&gt; = lazyTargetSource.getTarget();&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;获取的target是 ReferenceConfig 中的 ref,同样是一个代理类&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1080" y="6940" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="-OMnOMYa6ulq2eywQm4B-6" target="-OMnOMYa6ulq2eywQm4B-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-6" value="return method.invoke(&lt;b&gt;target&lt;/b&gt;, args);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1080" y="7020" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-OMnOMYa6ulq2eywQm4B-8" target="-OMnOMYa6ulq2eywQm4B-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-8" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;RpcInvocation rpcInvocation = new RpcInvocation()&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1320" y="7020" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-10" value="InvokerInvocationHandler" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1349.5" y="7000" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-OMnOMYa6ulq2eywQm4B-11" target="-OMnOMYa6ulq2eywQm4B-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-11" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;return InvocationUtil.invoke(invoker, rpcInvocation);&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1320" y="7100" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-OMnOMYa6ulq2eywQm4B-13" target="-OMnOMYa6ulq2eywQm4B-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-13" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;return invoker.invoke(rpcInvocation).recreate();&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1560" y="7100" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-19" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="-OMnOMYa6ulq2eywQm4B-15" target="-OMnOMYa6ulq2eywQm4B-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-15" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;return decideInvoker()&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;.invoke(invocation);&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;serviceDiscoveryInvoker&lt;/font&gt;&lt;/b&gt;&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1800" y="7100" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-17" value="MigrationInvoker" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1849.5" y="7070" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-22" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="-OMnOMYa6ulq2eywQm4B-18" target="-OMnOMYa6ulq2eywQm4B-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-18" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;if (isInjvmExported())&lt;br style=&quot;font-size: 10px;&quot;&gt;return injvmInvoker&lt;br style=&quot;font-size: 10px;&quot;&gt;.invoke(invocation);&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2039.97" y="7100" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-20" value="ScopeClusterInvoker" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2081.5" y="7070" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-26" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-OMnOMYa6ulq2eywQm4B-21" target="-OMnOMYa6ulq2eywQm4B-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-21" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;return filterInvoker.invoke(invocation);&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2279.9700000000003" y="7100" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-23" value="ClusterFilterInvoker" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2326.5" y="7070" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-28" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-OMnOMYa6ulq2eywQm4B-24" target="-OMnOMYa6ulq2eywQm4B-27" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-24" value="&lt;font style=&quot;&quot;&gt;asyncResult = filter.invoke(nextNode, invocation);&lt;br&gt;return asyncResult;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;这里是责任链模式，这里的filter代表后面的Filter实例&lt;/font&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1320.0000000000002" y="7220" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-25" value="FilterChainBuilder#CopyOfFilterChainNode" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1316.53" y="7190" width="210" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-31" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-OMnOMYa6ulq2eywQm4B-27" target="-OMnOMYa6ulq2eywQm4B-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-27" value="&lt;font style=&quot;&quot;&gt;return invoker.invoke(invocation);&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1560.0000000000002" y="7220" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-29" value="ConsumerContextFilter" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1594.5" y="7190" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-34" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-OMnOMYa6ulq2eywQm4B-30" target="-OMnOMYa6ulq2eywQm4B-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-30" value="&lt;font style=&quot;&quot;&gt;return invoker.invoke(invocation);&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1800.0000000000002" y="7220" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-32" value="ConsumerClassLoaderFilter" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1824.5" y="7190" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uXRkhWS-5dNDIYHjtDfL-13" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="-OMnOMYa6ulq2eywQm4B-33" target="-OMnOMYa6ulq2eywQm4B-35">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-33" value="&lt;font style=&quot;&quot;&gt;...&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2041.0000000000002" y="7220" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-38" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-OMnOMYa6ulq2eywQm4B-35" target="-OMnOMYa6ulq2eywQm4B-37" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-35" value="&lt;font style=&quot;&quot;&gt;&lt;div&gt;Object value = doInvoke(&lt;/div&gt;&lt;div&gt;proxy, invocation.getMethodName(), invocation.getParameterTypes(), invocation.getArguments());&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1321.5300000000002" y="7320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-36" value="AbstractProxyInvoker" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1350" y="7290" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-40" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-OMnOMYa6ulq2eywQm4B-37" target="-OMnOMYa6ulq2eywQm4B-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-37" value="&lt;font style=&quot;&quot;&gt;wrapper.invokeMethod(proxy, methodName, parameterTypes, arguments);&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1560.0000000000002" y="7320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-39" value="&lt;font style=&quot;&quot;&gt;sayHello(String name)&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="1801.0000000000002" y="7320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-OMnOMYa6ulq2eywQm4B-41" value="DemoServiceImpl" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1840" y="7290" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="VcwutDj3bW0QsIIaURAk-28" target="-dgZXbgsa9ORmBTnPNrw-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="320" y="6970" as="sourcePoint" />
            <mxPoint x="600" y="6970" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-1" value="&lt;div&gt;@DubboReference&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; private DemoService &lt;b&gt;demoService&lt;/b&gt;;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;比如测试Demo中Task中怎么注入 DemoService，注入的是由Dubbo Proxy创建的动态代理类的实例&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="360" y="6940" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-4" value="&lt;b&gt;referenceBeanManager&lt;/b&gt; 是Spring应用上下文中名为&amp;nbsp;&lt;b&gt;dubboReferenceBeanManager&lt;/b&gt; 的Bean&lt;br&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;后面注入引用对象时（@DubboReference等）会用到&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="1800" y="1900" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-8" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-7" target="-dgZXbgsa9ORmBTnPNrw-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-9" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;看这个Bean是怎么注入的&lt;br&gt;调试Spring Bean初始化过程&lt;br&gt;&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="-dgZXbgsa9ORmBTnPNrw-8" vertex="1" connectable="0">
          <mxGeometry x="0.1684" y="-3" relative="1" as="geometry">
            <mxPoint x="3" y="139" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-13" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-7" target="-dgZXbgsa9ORmBTnPNrw-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-7" value="ReferenceAnnotationBeanPostProcessor#&lt;br&gt;&lt;b&gt;postProcessProperties&lt;/b&gt;()&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;比如Demo中Task实例通过 @DubboReference 注入DemoService实例&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="600" y="6620" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-10" value="这里主要分析Dubbo主流程，其他模块在单独的流程图分析&lt;br style=&quot;font-size: 10px;&quot;&gt;主要关注：&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;ol style=&quot;font-size: 10px;&quot;&gt;&lt;li style=&quot;font-size: 10px;&quot;&gt;服务提供者、服务消费者（如：@DubboService @DubboReference）Bean实例的创建、注册；&lt;br&gt;服务注册与发现；&lt;br style=&quot;font-size: 10px;&quot;&gt;RPC远程调用服务器配置（Netty）；&lt;br&gt;服务暴露与服务引用；&lt;br style=&quot;font-size: 10px;&quot;&gt;服务Invoker的生成与装饰器模式封装（Wrapper，通过Wrapper装饰了包括Filter在内一系列功能）&lt;/li&gt;&lt;li style=&quot;font-size: 10px;&quot;&gt;服务本地调用、远程调用流程；&lt;br&gt;&lt;/li&gt;&lt;li style=&quot;font-size: 10px;&quot;&gt;优雅停机；&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="880" y="10" width="640" height="150" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-17" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-12" target="-dgZXbgsa9ORmBTnPNrw-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-20" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-12" target="-dgZXbgsa9ORmBTnPNrw-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-12" value="AnnotatedInjectionMetadata metadata = findInjectionMetadata(beanName, bean.getClass(), pvs);&lt;br&gt;prepareInjection(metadata);&lt;br&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;扫描待注入的字段和@Bean方法的元数据信息&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="840" y="6620" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-14" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;Spring 本身不支持 @DubboReference 注解注入，&lt;br&gt;但是提供了一些后置处理器接口可以实现自己的拓展，&lt;br&gt;Dubbo 就是通过 ReferenceAnnotationBeanPostProcessor&amp;nbsp;&lt;br&gt;#postProcessProperties() 方法实现服务引用注入的&lt;br&gt;注意服务引用是用动态代理生成并经过多层封装的一个Invoker&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="140" y="6700" width="300" height="90" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-23" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-16" target="-dgZXbgsa9ORmBTnPNrw-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-16" value="metadata.&lt;b&gt;inject&lt;/b&gt;(bean, beanName, pvs);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;遍历注入前面扫描到的待注入的元数据&lt;br&gt;以&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;@DubboReference 引入 demoService为例&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="840" y="6700" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-19" value="&lt;font color=&quot;#007fff&quot;&gt;大致看了下，主要是扫描&lt;b&gt;字段&lt;/b&gt;(field) 和 &lt;b&gt;@Bean方法&lt;/b&gt;上是否有注释 &lt;b&gt;@DubboReference 等注解&lt;/b&gt;，有的话就记录一下，分别对应&amp;nbsp;AnnotatedFieldElement AnnotatedMethodElement&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1080" y="6620" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-21" value="&lt;font color=&quot;#007fff&quot;&gt;这部分细节没时间看，对梳理流程影响不大，&lt;br&gt;后面如果有需要再回头仔细看&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="600" y="6675" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-25" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-22" target="-dgZXbgsa9ORmBTnPNrw-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-26" value="..." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="-dgZXbgsa9ORmBTnPNrw-25" vertex="1" connectable="0">
          <mxGeometry x="-0.0917" y="-4" relative="1" as="geometry">
            <mxPoint x="2" y="-4" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-22" value="&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;首次会先创建Bean，创建Bean需要BeanDefinition, Bean定义来自哪里，来自 postProcessBeanFactory()，参考上面代码&lt;br&gt;会存储到 Spring容器，通过getMergedLocalBeanDefinition(beanName)获取&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1080" y="6700" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-28" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-24" target="-dgZXbgsa9ORmBTnPNrw-27" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-29" value="..." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="-dgZXbgsa9ORmBTnPNrw-28" vertex="1" connectable="0">
          <mxGeometry x="-0.1333" y="-2" relative="1" as="geometry">
            <mxPoint x="3" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-24" value="createBean(beanName, mbd, args)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;此Demo创建DemoService Bean, 由于没有构造方法、instanceSupplier、工厂方法、&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1320" y="6700" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-35" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-43" target="-dgZXbgsa9ORmBTnPNrw-34" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-27" value="&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;上面流程得知mbd中beanClass是FactoryBean类型的ReferenceBean&lt;br&gt;所以这里会先实例化工厂Bean，再用工厂Bean的工厂方法创建DemoService Bean实例&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1560" y="6700" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-33" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-31" target="omU1pgqW6LJjpDUwzffS-75" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1770" y="2010" />
              <mxPoint x="1770" y="1970" />
              <mxPoint x="1540" y="1970" />
              <mxPoint x="1540" y="1945" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-31" value="&lt;div style=&quot;&quot;&gt;beanDefinition.setBeanClassName(&lt;/div&gt;&lt;div style=&quot;&quot;&gt;ReferenceBean.class.getName());&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;注意注册引用Bean定义的时候设置的 beanClass&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;是 &lt;b&gt;ReferenceBean&lt;/b&gt; 的全限定名，ReferenceBean 是一个FactoryBean 会影响后面实例化过程&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1560" y="1980" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-40" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-34" target="-dgZXbgsa9ORmBTnPNrw-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-34" value="&lt;font size=&quot;1&quot;&gt;referenceBeanManager.addReference(this);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;创建ReferenceBean(实现FactoryBean)实例时会记录此实例到referenceBeanManager&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2040.97" y="6700" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-36" value="&lt;b&gt;ReferenceBean&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1849.9999999999998" y="6670" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-50" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-37" target="-dgZXbgsa9ORmBTnPNrw-49" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-37" value="&lt;font size=&quot;1&quot;&gt;&lt;b&gt;getObject()&lt;br&gt;&lt;/b&gt;&lt;font color=&quot;#007fff&quot;&gt;创建ReferenceBean(实现FactoryBean)实例时会记录此实例到referenceBeanManager&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1799.45" y="6860" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-42" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-39" target="-dgZXbgsa9ORmBTnPNrw-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-39" value="&lt;font size=&quot;1&quot;&gt;&lt;b&gt;referenceBeanMap&lt;/b&gt;.put(&lt;br&gt;referenceBeanName, referenceBean);&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2279.4599999999996" y="6700" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-47" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-41" target="2B_0uOn4qaRjd3fYnrwT-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-41" value="&lt;font size=&quot;1&quot;&gt;initReferenceBean(referenceBean);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;这里实现了对ReferenceBean的初始化逻辑&lt;br&gt;记录Dubbo配置类和属性中的配置&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2279.46" y="6780" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-44" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-27" target="-dgZXbgsa9ORmBTnPNrw-43" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1760" y="6730" as="sourcePoint" />
            <mxPoint x="2041" y="6730" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-45" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-43" target="-dgZXbgsa9ORmBTnPNrw-37" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-43" value="&lt;font size=&quot;1&quot;&gt;&lt;b&gt;afterPropertiesSet()&lt;br&gt;&lt;/b&gt;&lt;font color=&quot;#007fff&quot;&gt;ReferenceBean 初始化流程中的一步&lt;br&gt;严格遵循了Spring Bean初始化流程&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1799.9999999999998" y="6700" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-46" value="&lt;font style=&quot;&quot;&gt;&lt;b style=&quot;font-size: 9px;&quot;&gt;referenceConfigMap&lt;/b&gt;.put(referenceKey, referenceConfig);&lt;br style=&quot;font-size: 9px;&quot;&gt;moduleModel.getConfigManager().&lt;b style=&quot;font-size: 9px;&quot;&gt;addReference&lt;/b&gt;(referenceConfig);&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;div style=&quot;&quot;&gt;referenceBean.&lt;b&gt;setKeyAndReferenceConfig&lt;/b&gt;(referenceKey, referenceConfig);&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;" parent="1" vertex="1">
          <mxGeometry x="2519.97" y="6780" width="279" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-48" value="ReferenceBeanManager" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2314.5" y="6670" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-52" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-49" target="-dgZXbgsa9ORmBTnPNrw-51" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-59" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-49" target="-dgZXbgsa9ORmBTnPNrw-56" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-49" value="&lt;font size=&quot;1&quot;&gt;&lt;b&gt;createLazyProxy();&lt;br&gt;&lt;/b&gt;&lt;font color=&quot;#007fff&quot;&gt;比如Demo中创建的是名为DemoServiceDubboProxy0的代理对象&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2039.95" y="6860" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-54" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-51" target="-dgZXbgsa9ORmBTnPNrw-53" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-51" value="&lt;font size=&quot;1&quot;&gt;generateFromJavassistFirst(interfaces);&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2280.5" y="6860" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-53" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;this.lazyProxy = Proxy.&lt;b&gt;getProxy&lt;/b&gt;(&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;interfaces.toArray(new Class[0]))&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; .newInstance(new &lt;b&gt;LazyTargetInvocationHandler&lt;/b&gt;(&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;new DubboReferenceLazyInitTargetSource()));&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="2519.95" y="6860" width="220.04" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-55" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;这里解释了为何后面调用的时候看到注入的实例内部 handler 是&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;LazyTargetInvocationHandler类型&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;关于Dubbo 借助Javasist实现动态代理的源码分析参考 dubbo-proxy.drawio&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2519.95" y="6920" width="350" height="50" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-56" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;generateFromJdk(interfaces);&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;默认用javasist创建代理，如果javasist创建失败再尝试使用JDK接口创建代理&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;" parent="1" vertex="1">
          <mxGeometry x="2279.46" y="6940" width="200.04" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-60" value="&lt;b style=&quot;border-color: var(--border-color); font-size: 9px; text-align: left;&quot;&gt;LazyTargetInvocationHandler&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1105" y="6910" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-62" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px;&quot;&gt;&lt;b style=&quot;font-size: 8px;&quot;&gt;生成的代理对象：&lt;/b&gt;&lt;br style=&quot;font-size: 8px;&quot;&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;public class DemoServiceDubboProxy0 implements ClassGenerator.DC, DemoService, EchoService, Destroyable {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; public static Method[] methods;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; private InvocationHandler handler;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&lt;br style=&quot;font-size: 8px;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; public String &lt;b&gt;sayHello&lt;/b&gt;(String var1) {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Object[] var2 = new Object[]{var1};&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Object var3 = this.handler.invoke(this, methods[0], var2);&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return (String)var3;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&lt;br style=&quot;font-size: 8px;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; public Object $echo(Object var1) {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Object[] var2 = new Object[]{var1};&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Object var3 = this.handler.invoke(this, methods[1], var2);&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return (Object)var3;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&lt;br style=&quot;font-size: 8px;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; public void $destroy() {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Object[] var1 = new Object[0];&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; this.handler.invoke(this, methods[2], var1);&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&lt;br style=&quot;font-size: 8px;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; public DemoServiceDubboProxy0() {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&lt;br style=&quot;font-size: 8px;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; public DemoServiceDubboProxy0(InvocationHandler var1) {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; this.handler = var1;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;font-size: 8px;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=top;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;" parent="1" vertex="1">
          <mxGeometry x="360" y="7010" width="430" height="290" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-66" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-63" target="-dgZXbgsa9ORmBTnPNrw-65" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-63" value="&lt;div style=&quot;&quot;&gt;&lt;b&gt;ReferenceBean&lt;/b&gt;#&lt;b&gt;getCallProxy&lt;/b&gt;()&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1319.5" y="6940" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="-dgZXbgsa9ORmBTnPNrw-65" target="2B_0uOn4qaRjd3fYnrwT-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-65" value="&lt;div style=&quot;&quot;&gt;return &lt;b&gt;referenceConfig&lt;/b&gt;.get();&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1559.5" y="6940" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-dgZXbgsa9ORmBTnPNrw-67" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;ReferenceBean&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;用于创建服务引用代理Bean实例的FactoryBean&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private transient ApplicationContext applicationContext;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ClassLoader beanClassLoader;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;// lazy proxy of reference&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Object lazyProxy;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;// beanName&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected String id;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;// reference key&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String key;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;/**&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;* The interface class of the reference service&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;*/&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Class&amp;lt;?&amp;gt; interfaceClass;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;/*&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;* remote service interface class name&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;*/&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String interfaceName;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;// proxy style&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String proxy;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;// from annotation attributes&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Map&amp;lt;String, Object&amp;gt; referenceProps;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;// from xml bean definition&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private MutablePropertyValues propertyValues;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;// actual reference config&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ReferenceConfig &lt;b&gt;referenceConfig&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;// ReferenceBeanManager&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ReferenceBeanManager referenceBeanManager;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;// Registration sources of this reference, may be xml file or annotation location&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private List&amp;lt;Map&amp;lt;String, Object&amp;gt;&amp;gt; sources = new ArrayList&amp;lt;&amp;gt;();&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-440" y="6360" width="400" height="420" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-9" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;" parent="1" source="2B_0uOn4qaRjd3fYnrwT-1" target="2B_0uOn4qaRjd3fYnrwT-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-1" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;ReferenceConfig&amp;lt;T&amp;gt;&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;用于创建服务引用代理Bean实例的FactoryBean&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Protocol protocolSPI;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ProxyFactory proxyFactory;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ConsumerModel consumerModel;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//真正的服务引用代理对象&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private transient volatile T &lt;b&gt;ref&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//调用器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private transient volatile Invoker&amp;lt;?&amp;gt; &lt;b&gt;invoker&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private transient volatile boolean initialized;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private transient volatile boolean destroyed;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String services;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="-880" y="6520" width="400" height="260" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-3" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="2B_0uOn4qaRjd3fYnrwT-2" target="-dgZXbgsa9ORmBTnPNrw-46" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-2" value="&lt;div&gt;referenceConfig = ReferenceCreator&lt;/div&gt;&lt;div&gt;&amp;nbsp; .create(&lt;span style=&quot;background-color: initial;&quot;&gt;referenceAttributes, applicationContext)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; .defaultInterfaceClass(referenceBean.getObjectType())&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; .build();&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;内部构建流程还是有点复杂，这里只关注部分重要成员是否被初始化，如 ref&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;arcSize=13;" parent="1" vertex="1">
          <mxGeometry x="2519.95" y="6700" width="279" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-8" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;" parent="1" source="2B_0uOn4qaRjd3fYnrwT-4" target="2B_0uOn4qaRjd3fYnrwT-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-4" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;ReferenceConfigBase&amp;lt;T&amp;gt;&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private static final String ORIGIN_CONFIG = &quot;ORIGIN_CONFIG&quot;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//服务引用代理实现的服务接口类&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected Class&amp;lt;?&amp;gt; interfaceClass;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;//&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected String url;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;//&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected ConsumerConfig consumer;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;//&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;/**&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;* In the mesh mode, uninstall the directory, router and load balance related to the cluster in the currently invoked invoker.&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;* Delegate retry, load balancing, timeout and other traffic management capabilities to Sidecar.&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;*/&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected Boolean unloadClusterRelated;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-880" y="6120" width="400" height="360" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-7" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;" parent="1" source="2B_0uOn4qaRjd3fYnrwT-5" target="2B_0uOn4qaRjd3fYnrwT-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-5" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;AbstractReferenceConfig&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-880" y="6000" width="400" height="80" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-6" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;AbstractInterfaceConfig&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-780" y="5910" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-10" value="&lt;div style=&quot;&quot;&gt;return &lt;b&gt;ref&lt;/b&gt;;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;获取实际的服务应用代理对象，如果不存在会先创建&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="1799.5" y="6940" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-15" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="2B_0uOn4qaRjd3fYnrwT-12" target="2B_0uOn4qaRjd3fYnrwT-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-12" value="configManager.getReferences().forEach(rc-&amp;gt; {&lt;br style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; referenceConfig.refresh();&lt;br&gt;&amp;nbsp; referenceCache.get(rc, false);&lt;br&gt;}" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;" parent="1" vertex="1">
          <mxGeometry x="1080" y="5060" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="2B_0uOn4qaRjd3fYnrwT-14" target="2B_0uOn4qaRjd3fYnrwT-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-14" value="从 referenceCache 缓存中获取此ReferenceConfig对象的服务引用代理对象，不存在则创建，proxy = rc.get(check);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;" parent="1" vertex="1">
          <mxGeometry x="1320" y="5060" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-20" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="2B_0uOn4qaRjd3fYnrwT-16" target="2B_0uOn4qaRjd3fYnrwT-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-16" value="init(check);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;初始化当前ReferenceConfig,里面初始化了很多东西，暂时只关注 ref&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1559.5" y="5060" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-18" value="ReferenceConfig" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1606" y="5030" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-22" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="2B_0uOn4qaRjd3fYnrwT-19" target="2B_0uOn4qaRjd3fYnrwT-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-19" value="&lt;b&gt;ref&lt;/b&gt; = createProxy(referenceParameters);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="1799.5" y="5060" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-24" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="2B_0uOn4qaRjd3fYnrwT-21" target="2B_0uOn4qaRjd3fYnrwT-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uXRkhWS-5dNDIYHjtDfL-10" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="2B_0uOn4qaRjd3fYnrwT-21" target="uXRkhWS-5dNDIYHjtDfL-9">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-21" value="createInvoker();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;" parent="1" vertex="1">
          <mxGeometry x="2039.95" y="5060" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-26" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="2B_0uOn4qaRjd3fYnrwT-23" target="2B_0uOn4qaRjd3fYnrwT-25" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2490" y="5090" />
              <mxPoint x="2490" y="5220" />
              <mxPoint x="1070" y="5220" />
              <mxPoint x="1070" y="5270" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-23" value="URL curUrl = urls.get(0);&lt;br&gt;&lt;b&gt;invoker&lt;/b&gt; = &lt;b&gt;protocolSPI&lt;/b&gt;.refer(interfaceClass, curUrl);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;protocolSPI自适应类是有缓存的&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2279.46" y="5060" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uXRkhWS-5dNDIYHjtDfL-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="2B_0uOn4qaRjd3fYnrwT-25" target="uXRkhWS-5dNDIYHjtDfL-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2B_0uOn4qaRjd3fYnrwT-25" value="层层深入，经过&amp;nbsp;&lt;b&gt;InvokerCountWrapper&lt;/b&gt; 等包装类 refer() 方法，最终到达 RegistryProtocol#refer()&amp;nbsp;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="1079.75" y="5240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uXRkhWS-5dNDIYHjtDfL-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="uXRkhWS-5dNDIYHjtDfL-3" target="uXRkhWS-5dNDIYHjtDfL-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uXRkhWS-5dNDIYHjtDfL-3" value="&lt;b&gt;RegistryProtocol&lt;/b&gt;#refer(Class&amp;lt;T&amp;gt; type, URL url)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1319.75" y="5240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uXRkhWS-5dNDIYHjtDfL-5" value="ClusterInvoker&amp;lt;T&amp;gt; migrationInvoker = &lt;b&gt;getMigrationInvoker&lt;/b&gt;(this, cluster, registry, type, url, consumerUrl);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="1559.25" y="5240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uXRkhWS-5dNDIYHjtDfL-12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="uXRkhWS-5dNDIYHjtDfL-9" target="uXRkhWS-5dNDIYHjtDfL-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uXRkhWS-5dNDIYHjtDfL-9" value="return (T) proxyFactory.getProxy(&lt;b&gt;invoker&lt;/b&gt;, ProtocolUtils.isGeneric(generic));&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;默认通过JavassistProxyFactory创建代理&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;" vertex="1" parent="1">
          <mxGeometry x="2039.9499999999998" y="5140" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uXRkhWS-5dNDIYHjtDfL-11" value="return (T) &lt;b&gt;Proxy&lt;/b&gt;.&lt;b&gt;getProxy&lt;/b&gt;(interfaces).newInstance(new &lt;b&gt;InvokerInvocationHandler&lt;/b&gt;(invoker));" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;" vertex="1" parent="1">
          <mxGeometry x="2279.9399999999996" y="5140" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uXRkhWS-5dNDIYHjtDfL-14" value="其他一系列Filter" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="2091.5" y="7190" width="100" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
