<mxfile host="Electron" modified="2024-04-27T17:23:27.078Z" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/21.6.5 Chrome/114.0.5735.243 Electron/25.3.1 Safari/537.36" etag="7JEZ2VRXwNL25BH6YY-_" version="21.6.5" type="device">
  <diagram name="第 1 页" id="3n3RV5EYqTcjxA4MDu5d">
    <mxGraphModel dx="3020" dy="837" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-1" value="&lt;p style=&quot;line-height: 1&quot;&gt;&lt;/p&gt;&lt;h1 style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;从 Mono.delay() 看阻塞操作的异步非阻塞改造&lt;/font&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&amp;nbsp;&lt;/font&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;( ProjectReactor v3.5.8)&amp;nbsp;&lt;br style=&quot;&quot;&gt;&lt;/font&gt;&lt;/font&gt;&lt;/h1&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;Mono.delay() 可以看作是 Thread.sleep() 的异步非阻塞实现。&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;看怎么通过 发布者、调度器、订阅者的封装实现异步非阻塞的延迟，这里忽略了一些不重要的细节代码。&lt;/font&gt;&lt;/div&gt;&lt;p style=&quot;font-size: 10px&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="40" y="10" width="600" height="70" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-5" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-2" target="s0Pp-TZyqNJsN6R80Y19-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-9" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-2" target="s0Pp-TZyqNJsN6R80Y19-8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-2" value="Mono.delay(Duration.ofMillis(100))&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;从订阅开始100ms后发送onNext() 信号&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-7" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-4" target="s0Pp-TZyqNJsN6R80Y19-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-98" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-4" target="s0Pp-TZyqNJsN6R80Y19-97">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-4" value=".doOnSubscribe(...)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;注册订阅事件回调（钩子）&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="480" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-109" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-6" target="s0Pp-TZyqNJsN6R80Y19-108">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-6" value=".subscribe(...)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;这里是通过lambda表达式创建订阅者，然后触发订阅&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="680" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-89" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-8" target="s0Pp-TZyqNJsN6R80Y19-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-91" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-8" target="s0Pp-TZyqNJsN6R80Y19-90">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-8" value="return delay(duration, Schedulers.&lt;b&gt;parallel&lt;/b&gt;());" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-10" target="s0Pp-TZyqNJsN6R80Y19-12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-83" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-10" target="s0Pp-TZyqNJsN6R80Y19-82">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-10" value="return &lt;b&gt;onAssembly&lt;/b&gt;(new &lt;b&gt;MonoDelay&lt;/b&gt;(duration.toNanos(), TimeUnit.NANOSECONDS, timer));&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;由于没有定义钩子这里获取的就是MonoDelay对象&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="520" y="280" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-114" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-12" target="s0Pp-TZyqNJsN6R80Y19-103">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-12" value="&lt;b&gt;MonoDelay&lt;/b&gt;(long delay, TimeUnit unit, Scheduler timedScheduler)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;元素发布者&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="760" y="290" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-14" value="MonoDelay" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="820" y="260" width="80" height="30" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-16" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;i style=&quot;font-size: 10px;&quot;&gt;&amp;lt;&amp;lt;interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;Processor&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;既是订阅者有时发布者，不推荐使用&lt;/font&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-270" y="298.5" width="180" height="61.5" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-17" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;i style=&quot;font-size: 10px;&quot;&gt;&amp;lt;&amp;lt;interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;Publisher&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;发布者是任意数量序列元素的提供者&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//请求发布者开始传输流数据给某个订阅者&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 10px;&quot;&gt;+ subscribe(Subscriber&amp;lt;T&amp;gt;): void&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-280" y="80" width="240" height="100" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-18" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;i style=&quot;font-size: 10px;&quot;&gt;&amp;lt;&amp;lt;interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;Subscriber&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 10px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//调用Publisher.subscribe(Subscriber)后会被回调，负责调用&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 10px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;Subscription.request(long) 来请求发布者发送数据&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 10px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+ onSubscribe(Subscription): void&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//发布者发送数据元素的处理回调，传参带过来的就是元素，&lt;/font&gt;&lt;span style=&quot;color: rgb(0, 127, 255); background-color: initial;&quot;&gt;或者称为事件&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 10px;&quot;&gt;+ onNext(T): void&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//正常结束流元素传输，手动主动结束或者元素传输完毕&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 10px;&quot;&gt;+ onComplete(): void&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//异常结束流元素传输，比如处理过程中抛出异常需要结束流处理&lt;/font&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;+ onError(Throwable): void&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-680" y="80" width="358" height="200" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-19" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;i style=&quot;font-size: 10px;&quot;&gt;&amp;lt;&amp;lt;interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;Subscription（发布订阅模式的调度器）&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6;&quot;&gt;&lt;font style=&quot;&quot; color=&quot;#007fff&quot;&gt;这个类是调度中心，定义数据发送，回调订阅者回调方法&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//请求n个流元素&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 10px;&quot;&gt;+ request(long): void&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;//停止发送流元素，并清理资源，cancel之前已经请求的元素还是会发送&lt;/font&gt;&lt;br style=&quot;&quot;&gt;+ cancel(): void&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-680" y="298.5" width="360" height="121.5" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-20" value="" style="html=1;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=0;startArrow=none;endArrow=block;endSize=12;strokeColor=#008200;exitX=0.606;exitY=0;exitDx=0;exitDy=0;entryX=0.500;entryY=1.000;entryDx=0;entryDy=0;fontSize=10;exitPerimeter=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-16" target="s0Pp-TZyqNJsN6R80Y19-17">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-161" y="197" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-21" value="" style="html=1;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=0;startArrow=none;endArrow=block;endSize=12;strokeColor=#008200;exitX=0.500;exitY=0.001;exitDx=0;exitDy=0;entryX=1.000;entryY=0.688;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-16" target="s0Pp-TZyqNJsN6R80Y19-18">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-180" y="218" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-22" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;Publisher 与 Subscriber 可以是一对多的关系，每个 Subscriber 只能向单个Publisher订阅一次&lt;br&gt;Subscription 的定义看上去就是数据源&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-680" y="30" width="480" height="50" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-23" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;labelPosition=left;verticalLabelPosition=middle;align=right;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="-710" y="80" width="20" height="340" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-24" value="reactive-stream &lt;br&gt;API规范" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="-820" y="220" width="110" height="40" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-25" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=0.87;entryDx=0;entryDy=0;endArrow=block;endFill=1;entryPerimeter=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-26" target="s0Pp-TZyqNJsN6R80Y19-18">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-501" y="440" />
              <mxPoint x="-501" y="430" />
              <mxPoint x="-302" y="430" />
              <mxPoint x="-302" y="254" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-26" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i style=&quot;&quot;&gt;&amp;lt;&amp;lt;interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br&gt;&lt;b style=&quot;&quot;&gt;CoreSubscriber&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;+ currentContext(): Context&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//@Override, 只是为了加点文档注释&lt;br&gt;&lt;/font&gt;+ onSubscribe(Subscription): void&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=14;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-612" y="440" width="224" height="103" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-27" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;dashed=1;endArrow=block;endFill=1;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-29" target="s0Pp-TZyqNJsN6R80Y19-26">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-28" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.75;entryDx=0;entryDy=0;dashed=1;" edge="1" parent="1" target="s0Pp-TZyqNJsN6R80Y19-19">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-290" y="579" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="-290" y="579" />
              <mxPoint x="-290" y="376" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-29" value="BaseSubscriber" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-680" y="580" width="480" height="380" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-30" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;//这个往往指最终的订阅者，即自定义订阅器经过层层装饰后的订阅者&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;volatile Subscription &lt;b&gt;subscription&lt;/b&gt;;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;static AtomicReferenceFieldUpdater&amp;lt;BaseSubscriber, Subscription&amp;gt; &lt;b&gt;S&lt;/b&gt; =&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;AtomicReferenceFieldUpdater.newUpdater(BaseSubscriber.class, Subscription.class, &quot;subscription&quot;);&lt;/font&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="s0Pp-TZyqNJsN6R80Y19-29">
          <mxGeometry y="26" width="480" height="74" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-31" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="s0Pp-TZyqNJsN6R80Y19-29">
          <mxGeometry y="100" width="480" height="8" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-32" value="&lt;div&gt;# hookOnCancel(): void&lt;/div&gt;&lt;div&gt;+ onError(Throwable): void&lt;/div&gt;&lt;div&gt;+ cancel(): void&lt;/div&gt;&lt;div&gt;+ onSubscribe(Subscription): void&lt;/div&gt;&lt;div&gt;# hookOnSubscribe(Subscription): void&lt;/div&gt;&lt;div&gt;+ toString(): String&lt;/div&gt;&lt;div&gt;+ request(long): void&lt;/div&gt;&lt;div&gt;# hookFinally(SignalType): void&lt;/div&gt;&lt;div&gt;# hookOnComplete(): void&lt;/div&gt;&lt;div&gt;+ onNext(T): void&lt;/div&gt;&lt;div&gt;+ dispose(): void&lt;/div&gt;&lt;div&gt;+ onComplete(): void&lt;/div&gt;&lt;div&gt;# upstream(): Subscription&lt;/div&gt;&lt;div&gt;# hookOnNext(T): void&lt;/div&gt;&lt;div&gt;~ safeHookFinally(SignalType): void&lt;/div&gt;&lt;div&gt;# hookOnError(Throwable): void&lt;/div&gt;&lt;div&gt;+ requestUnbounded(): void&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="s0Pp-TZyqNJsN6R80Y19-29">
          <mxGeometry y="108" width="480" height="272" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-33" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;AtomicBoolean&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-197" y="1162" width="157" height="33" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-34" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;DefaultMonoSink&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;div&gt;final CoreSubscriber&amp;lt;? super T&amp;gt; &lt;b&gt;actual&lt;/b&gt;;&lt;/div&gt;&lt;div&gt;volatile Disposable disposable;&lt;/div&gt;&lt;div&gt;volatile int &lt;b&gt;state&lt;/b&gt;;&lt;/div&gt;&lt;div&gt;volatile LongConsumer &lt;b&gt;requestConsumer&lt;/b&gt;;&lt;/div&gt;&lt;div&gt;T value;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;static final AtomicReferenceFieldUpdater&amp;lt;DefaultMonoSink, Disposable&amp;gt; DISPOSABLE = ...;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;static final AtomicIntegerFieldUpdater&amp;lt;DefaultMonoSink&amp;gt; STATE = ...;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;static final AtomicReferenceFieldUpdater&amp;lt;DefaultMonoSink, LongConsumer&amp;gt; REQUEST_CONSUMER = ...;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;//继承MonoSink&lt;/font&gt;&lt;/div&gt;&lt;div&gt;+ success(): void&lt;/div&gt;&lt;div&gt;+ success(T?): void&lt;/div&gt;&lt;div&gt;+ onRequest(LongConsumer): MonoSink&amp;lt;T&amp;gt;&lt;/div&gt;&lt;div&gt;+ onCancel(Disposable): MonoSink&amp;lt;T&amp;gt;&lt;/div&gt;&lt;div&gt;+ onDispose(Disposable): MonoSink&amp;lt;T&amp;gt;&lt;/div&gt;&lt;div&gt;+ currentContext(): Context&lt;/div&gt;&lt;div&gt;+ error(Throwable): void&lt;/div&gt;&lt;div&gt;+ contextView(): ContextView&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;//继承InnerProducer&lt;/font&gt;&lt;/div&gt;&lt;div&gt;+ actual(): CoreSubscriber&amp;lt;T&amp;gt;&lt;/div&gt;&lt;div&gt;+ scanUnsafe(Attr): Object?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;//继承Subsciption&lt;/font&gt;&lt;/div&gt;&lt;div&gt;+ request(long): void&lt;/div&gt;&lt;div&gt;+ cancel(): void&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/div&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-560" y="1240" width="440" height="360" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-35" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;i style=&quot;font-size: 10px;&quot;&gt;&amp;lt;&amp;lt;annotation&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;FunctionalInterface&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-533" y="1000" width="186" height="39" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-36" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;i style=&quot;font-size: 10px;&quot;&gt;&amp;lt;&amp;lt;interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;InnerProducer&lt;o style=&quot;font-size: 10px;&quot;&gt;&lt;/o&gt;&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-455" y="1162" width="180" height="39" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-37" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;i style=&quot;font-size: 10px;&quot;&gt;&amp;lt;&amp;lt;interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;MonoSink&lt;t style=&quot;font-size: 10px;&quot;&gt;&lt;/t&gt;&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-621" y="1162" width="146" height="39" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-38" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;i style=&quot;font-size: 10px;&quot;&gt;&amp;lt;&amp;lt;interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;Scannable&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-501" y="1081" width="122" height="39" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-39" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;i style=&quot;font-size: 10px;&quot;&gt;&amp;lt;&amp;lt;interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;Serializable&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-183" y="1081" width="129" height="39" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-40" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;i style=&quot;font-size: 10px;&quot;&gt;&amp;lt;&amp;lt;interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;Subscription&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="-359" y="1081" width="139" height="39" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-41" value="" style="html=1;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=1;startArrow=none;endArrow=block;endSize=12;strokeColor=#008200;exitX=0.500;exitY=0.002;exitDx=0;exitDy=0;entryX=0.500;entryY=1.002;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-33" target="s0Pp-TZyqNJsN6R80Y19-39">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-42" value="" style="html=1;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=0;startArrow=none;endArrow=block;endSize=12;strokeColor=#000082;exitX=0.750;exitY=0.001;exitDx=0;exitDy=0;entryX=0.500;entryY=1.001;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-34" target="s0Pp-TZyqNJsN6R80Y19-33">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-230" y="1223" />
              <mxPoint x="-118" y="1223" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-43" value="" style="html=1;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=1;startArrow=none;endArrow=block;endSize=12;strokeColor=#008200;exitX=0.250;exitY=0.001;exitDx=0;exitDy=0;entryX=0.500;entryY=1.001;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-34" target="s0Pp-TZyqNJsN6R80Y19-36">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-450" y="1223" />
              <mxPoint x="-456" y="1223" />
              <mxPoint x="-456" y="1213" />
              <mxPoint x="-365" y="1213" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-44" value="" style="html=1;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=1;startArrow=none;endArrow=block;endSize=12;strokeColor=#008200;exitX=0.250;exitY=0.001;exitDx=0;exitDy=0;entryX=0.500;entryY=1.001;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-34" target="s0Pp-TZyqNJsN6R80Y19-37">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-450" y="1223" />
              <mxPoint x="-456" y="1223" />
              <mxPoint x="-456" y="1213" />
              <mxPoint x="-548" y="1213" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-45" value="" style="html=1;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=0;startArrow=none;endArrow=block;endSize=12;strokeColor=#008200;exitX=0.500;exitY=0.002;exitDx=0;exitDy=0;entryX=0.500;entryY=1.002;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-36" target="s0Pp-TZyqNJsN6R80Y19-38">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-365" y="1137" />
              <mxPoint x="-440" y="1137" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-46" value="" style="html=1;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=0;startArrow=none;endArrow=block;endSize=12;strokeColor=#008200;exitX=0.500;exitY=0.002;exitDx=0;exitDy=0;entryX=0.500;entryY=1.002;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-36" target="s0Pp-TZyqNJsN6R80Y19-40">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-365" y="1137" />
              <mxPoint x="-290" y="1137" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-47" value="" style="html=1;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=1;dashPattern=1 1;startArrow=none;endArrow=none;strokeColor=#999900;exitX=0.500;exitY=0.002;exitDx=0;exitDy=0;entryX=0.500;entryY=1.002;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-38" target="s0Pp-TZyqNJsN6R80Y19-35">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-48" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.75;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=1;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-49" target="s0Pp-TZyqNJsN6R80Y19-17">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-152" y="430" />
              <mxPoint x="-60" y="430" />
              <mxPoint x="-60" y="250" />
              <mxPoint x="-100" y="250" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-49" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i style=&quot;&quot;&gt;&amp;lt;&amp;lt;interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br&gt;&lt;b style=&quot;&quot;&gt;CorePublisher&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 10px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+ void subscribe(CoreSubscriber&amp;lt;? super T&amp;gt;&amp;nbsp;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 10px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;subscriber);&lt;/span&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=14;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="-264" y="440" width="224" height="103" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-50" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;i style=&quot;font-size: 10px;&quot;&gt;&amp;lt;&amp;lt;interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;CorePublisher&lt;t style=&quot;font-size: 10px;&quot;&gt;&lt;/t&gt;&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 10px;&quot;&gt;+ subscribe(CoreSubscriber&amp;lt;T&amp;gt;): void&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="-287" y="1787" width="247" height="73" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-51" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;i style=&quot;font-size: 10px;&quot;&gt;&amp;lt;&amp;lt;annotation&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;FunctionalInterface&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-858" y="1662" width="186" height="39" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-52" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=1;fontSize=10;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-79" target="s0Pp-TZyqNJsN6R80Y19-63">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-340" y="2040" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-54" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;i style=&quot;font-size: 10px;&quot;&gt;&amp;lt;&amp;lt;interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;Publisher&lt;t style=&quot;font-size: 10px;&quot;&gt;&lt;/t&gt;&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 10px;&quot;&gt;+ subscribe(Subscriber&amp;lt;T&amp;gt;): void&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-413" y="1640" width="220" height="73" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-55" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;i style=&quot;font-size: 10px;&quot;&gt;&amp;lt;&amp;lt;interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;Scannable&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 10px;&quot;&gt;+ tags(): Stream&amp;lt;Tuple2&amp;lt;String, String&amp;gt;&amp;gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;+ isScanAvailable(): boolean&lt;br style=&quot;font-size: 10px;&quot;&gt;+ from(Object?): Scannable&lt;br style=&quot;font-size: 10px;&quot;&gt;+ actuals(): Stream&amp;lt;Scannable&amp;gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;+ scanUnsafe(Attr): Object?&lt;br style=&quot;font-size: 10px;&quot;&gt;+ inners(): Stream&amp;lt;Scannable&amp;gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;+ stepName(): String&lt;br style=&quot;font-size: 10px;&quot;&gt;+ tagsDeduplicated(): Map&amp;lt;String, String&amp;gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;+ parents(): Stream&amp;lt;Scannable&amp;gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;+ name(): String&lt;br style=&quot;font-size: 10px;&quot;&gt;+ scan(Attr&amp;lt;T&amp;gt;): T?&lt;br style=&quot;font-size: 10px;&quot;&gt;+ scanOrDefault(Attr&amp;lt;T&amp;gt;, T): T&lt;br style=&quot;font-size: 10px;&quot;&gt;+ steps(): Stream&amp;lt;String&amp;gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-902" y="1740" width="272" height="260" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-56" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;i style=&quot;font-size: 10px;&quot;&gt;&amp;lt;&amp;lt;interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;SourceProducer&lt;o style=&quot;font-size: 10px;&quot;&gt;&lt;/o&gt;&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 10px;&quot;&gt;+ scanUnsafe(Attr): Object?&lt;br style=&quot;font-size: 10px;&quot;&gt;+ stepName(): String&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-591" y="1787" width="195" height="103" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-57" value="" style="html=1;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=0;startArrow=none;endArrow=block;endSize=12;strokeColor=#008200;exitX=0.518;exitY=0.021;exitDx=0;exitDy=0;entryX=0.359;entryY=1.000;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-50" target="s0Pp-TZyqNJsN6R80Y19-54">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-159" y="1750" />
              <mxPoint x="-334" y="1750" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-58" value="" style="html=1;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=1;startArrow=none;endArrow=block;endSize=12;strokeColor=#008200;entryX=0.500;entryY=1.001;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="1" target="s0Pp-TZyqNJsN6R80Y19-56">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-340" y="2000" />
              <mxPoint x="-493" y="2000" />
            </Array>
            <mxPoint x="-340" y="2040" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-59" value="" style="html=1;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=1;dashPattern=1 1;startArrow=none;endArrow=none;strokeColor=#999900;exitX=0.500;exitY=0.000;exitDx=0;exitDy=0;entryX=0.500;entryY=1.000;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-55" target="s0Pp-TZyqNJsN6R80Y19-51">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-60" value="" style="html=1;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=0;startArrow=none;endArrow=block;endSize=12;strokeColor=#008200;exitX=0.500;exitY=0.000;exitDx=0;exitDy=0;entryX=0.359;entryY=1.000;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-56" target="s0Pp-TZyqNJsN6R80Y19-54">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-490" y="1750" />
              <mxPoint x="-333" y="1750" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-61" value="" style="html=1;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=0;startArrow=none;endArrow=block;endSize=12;strokeColor=#008200;exitX=0.000;exitY=0.500;exitDx=0;exitDy=0;entryX=1.006;entryY=0.381;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=10;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-56" target="s0Pp-TZyqNJsN6R80Y19-55">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-62" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=1;dashed=1;fontSize=10;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-63" target="s0Pp-TZyqNJsN6R80Y19-50">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-63" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;Mono&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; line-height: 1.6; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-287" y="1910" width="247" height="50" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-64" value="BlockingMonoSubscriber" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="-1148" y="830" width="248" height="130" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-65" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;fontSize=10;" vertex="1" parent="s0Pp-TZyqNJsN6R80Y19-64">
          <mxGeometry y="26" width="248" height="8" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-66" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;可以阻塞等待获取发布者发送的流元素&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;+ onNext(T): void&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;+ onError(Throwable): void&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;+ stepName(): String&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=10;" vertex="1" parent="s0Pp-TZyqNJsN6R80Y19-64">
          <mxGeometry y="34" width="248" height="96" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-67" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-68" target="s0Pp-TZyqNJsN6R80Y19-64">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-68" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;BlockingSingleSubscriber&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;//发布者发送的流元素对象&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;T&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;b&gt;value&lt;/b&gt;;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;//过程中出现的异常&lt;/font&gt;&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;Throwable &lt;b&gt;error&lt;/b&gt;;&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;Subscription &lt;b&gt;s&lt;/b&gt;;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;final Context &lt;b&gt;context&lt;/b&gt;;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;volatile boolean &lt;b&gt;cancelled&lt;/b&gt;;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;+ isDisposed(): boolean&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;+ onSubscribe(Subscription): void&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;+ dispose(): void&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;+ onComplete(): void&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;+ currentContext(): Context&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;+ scanUnsafe(Attr): Object?&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-1148" y="588" width="248" height="210" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-69" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;i style=&quot;font-size: 10px;&quot;&gt;&amp;lt;&amp;lt;interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;CoreSubscriber&lt;t style=&quot;font-size: 10px;&quot;&gt;&lt;/t&gt;&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-1320" y="422" width="185" height="39" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-70" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;CountDownLatch&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;借助此类实现阻塞等待&lt;/font&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-892" y="505" width="172" height="45" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-71" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;i style=&quot;font-size: 10px;&quot;&gt;&amp;lt;&amp;lt;interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;Disposable&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;定义关闭和释放资源操作&lt;/font&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-965" y="422" width="125" height="58" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-72" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;i style=&quot;font-size: 10px;&quot;&gt;&amp;lt;&amp;lt;interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;InnerConsumer&lt;i style=&quot;font-size: 10px;&quot;&gt;&lt;/i&gt;&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-1231" y="505" width="180" height="39" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-73" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;i style=&quot;font-size: 10px;&quot;&gt;&amp;lt;&amp;lt;interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;Scannable&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="-1107" y="422" width="122" height="39" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-74" value="" style="html=1;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=0;startArrow=none;endArrow=block;endSize=12;strokeColor=#000082;exitX=0.750;exitY=0.001;exitDx=0;exitDy=0;entryX=0.500;entryY=1.001;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-68" target="s0Pp-TZyqNJsN6R80Y19-70">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-962" y="567" />
              <mxPoint x="-806" y="567" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-75" value="" style="html=1;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=1;startArrow=none;endArrow=block;endSize=12;strokeColor=#008200;exitX=0.250;exitY=0.001;exitDx=0;exitDy=0;entryX=0.500;entryY=1.001;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-68" target="s0Pp-TZyqNJsN6R80Y19-71">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-1084" y="557" />
              <mxPoint x="-903" y="557" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-76" value="" style="html=1;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=1;startArrow=none;endArrow=block;endSize=12;strokeColor=#008200;exitX=0.250;exitY=0.001;exitDx=0;exitDy=0;entryX=0.500;entryY=1.001;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-68" target="s0Pp-TZyqNJsN6R80Y19-72">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-1084" y="557" />
              <mxPoint x="-1141" y="557" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-77" value="" style="html=1;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=0;startArrow=none;endArrow=block;endSize=12;strokeColor=#008200;exitX=0.500;exitY=0.001;exitDx=0;exitDy=0;entryX=0.500;entryY=1.001;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-72" target="s0Pp-TZyqNJsN6R80Y19-69">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-1141" y="479" />
              <mxPoint x="-1227" y="479" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-78" value="" style="html=1;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=0;startArrow=none;endArrow=block;endSize=12;strokeColor=#008200;exitX=0.500;exitY=0.001;exitDx=0;exitDy=0;entryX=0.500;entryY=1.001;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-72" target="s0Pp-TZyqNJsN6R80Y19-73">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-1141" y="479" />
              <mxPoint x="-1046" y="479" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-79" value="&lt;p style=&quot;margin:0px;margin-top:4px;text-align:center;&quot;&gt;&lt;b&gt;MonoDelay&amp;nbsp;&lt;/b&gt;&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin:0px;margin-left:4px;&quot;&gt;final Scheduler timedScheduler;&lt;/p&gt;&lt;p style=&quot;margin:0px;margin-left:4px;&quot;&gt;final long delay;&lt;/p&gt;&lt;p style=&quot;margin:0px;margin-left:4px;&quot;&gt;final TimeUnit unit;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin:0px;margin-left:4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="-520" y="2040" width="360" height="120" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-81" value="" style="html=1;rounded=1;edgeStyle=orthogonalEdgeStyle;dashed=1;startArrow=none;endArrow=block;endSize=12;strokeColor=#008200;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=10;exitX=0.5;exitY=0;exitDx=0;exitDy=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-79" target="s0Pp-TZyqNJsN6R80Y19-55">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-340" y="2020" />
              <mxPoint x="-766" y="2020" />
            </Array>
            <mxPoint x="-631" y="2160" as="sourcePoint" />
            <mxPoint x="-774" y="2020" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-82" value="&amp;nbsp;&amp;lt;T&amp;gt; Mono&amp;lt;T&amp;gt; onAssembly(Mono&amp;lt;T&amp;gt; source)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;给MonoDelay装配一些钩子,暂时没用到先忽略&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="760" y="390" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-84" value="Mono" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="835" y="360" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-94" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-90" target="s0Pp-TZyqNJsN6R80Y19-93">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-90" value="Schedulers.&lt;b&gt;parallel&lt;/b&gt;()" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="520" y="200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-92" value="Schedulers" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="580" y="170" width="80" height="30" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-96" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-93" target="s0Pp-TZyqNJsN6R80Y19-95">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-93" value="return cache(CACHED_PARALLEL, PARALLEL, PARALLEL_SUPPLIER);" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="760" y="200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-148" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-95" target="s0Pp-TZyqNJsN6R80Y19-147">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-95" value="s = new &lt;b&gt;CachedScheduler&lt;/b&gt;(key, supplier.get());" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1000" y="200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-100" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-97" target="s0Pp-TZyqNJsN6R80Y19-99">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-97" value="return doOnSignal(this, onSubscribe, null, null,&amp;nbsp; null);" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="480" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-106" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-99" target="s0Pp-TZyqNJsN6R80Y19-103">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-107" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-99" target="s0Pp-TZyqNJsN6R80Y19-104">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-99" value="&lt;div&gt;return &lt;b&gt;onAssembly&lt;/b&gt;(new &lt;b&gt;MonoPeek&lt;/b&gt;&amp;lt;&amp;gt;(source,&lt;/div&gt;&lt;div&gt;onSubscribe, onNext, onRequest, onCancel));&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;装配了几个onXxx() 方法&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="520" y="470" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-103" value="&lt;b&gt;MonoPeek&lt;/b&gt;(...)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;装饰器模式封装&lt;br&gt;MonoDelay -&amp;gt; MonoPeek&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="760" y="480" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-104" value="&amp;nbsp;&amp;lt;T&amp;gt; Mono&amp;lt;T&amp;gt; onAssembly(Mono&amp;lt;T&amp;gt; source)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;给MonoDelay装配一些钩子,暂时没用到先忽略&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="760" y="580" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-105" value="Mono" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="835" y="550" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-111" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-108" target="s0Pp-TZyqNJsN6R80Y19-110">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-108" value="return subscribe(consumer, null, null);" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="680" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-113" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-110" target="s0Pp-TZyqNJsN6R80Y19-112">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-116" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-110" target="s0Pp-TZyqNJsN6R80Y19-115">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-110" value="&lt;div style=&quot;font-size: 11px;&quot;&gt;return &lt;b&gt;subscribeWith&lt;/b&gt;(new &lt;b&gt;LambdaMonoSubscriber&lt;/b&gt;&amp;lt;&amp;gt;(consumer, errorConsumer,&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;completeConsumer, null, initialContext));&lt;span style=&quot;font-size: 11px;&quot;&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="520" y="680" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-125" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-112" target="s0Pp-TZyqNJsN6R80Y19-123">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-112" value="&lt;div style=&quot;&quot;&gt;&lt;b&gt;LambdaMonoSubscriber&lt;/b&gt;(...)&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;订阅者，此类间接实现&amp;nbsp;&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;font color=&quot;#007fff&quot;&gt;CoreSubscriber, 而没有继承BaseSubscriber，是个纯粹的订阅者&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="760" y="680" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-122" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-115" target="s0Pp-TZyqNJsN6R80Y19-121">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-115" value="&lt;div style=&quot;&quot;&gt;&lt;b&gt;subscribe&lt;/b&gt;(subscriber);&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;return subscriber;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;触发订阅&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="760" y="760" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-124" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-121" target="s0Pp-TZyqNJsN6R80Y19-123">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-126" value="1" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="s0Pp-TZyqNJsN6R80Y19-124">
          <mxGeometry x="0.8493" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-128" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-121" target="s0Pp-TZyqNJsN6R80Y19-127">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-129" value="3" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="s0Pp-TZyqNJsN6R80Y19-128">
          <mxGeometry x="0.2543" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-121" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;//装配通过 Hooks#onLastOperator 定义的钩子，这个Demo没有定义，返回source是MonoDelay类型&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;CorePublisher publisher = Operators.onLastAssembly(this);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//内部就是强制类型转换&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;CoreSubscriber subscriber = Operators.toCoreSubscriber(actual);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;...&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;try {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; if (publisher instanceof OptimizableOperator) {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; OptimizableOperator operator = (OptimizableOperator) publisher;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; while (true) {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;font color=&quot;#007fff&quot;&gt;//1 判断订阅者是否实现了Fuseable.ConditionalSubscriber接口，对应的再使用装饰器模式&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;封装一层，实现了此接口就封装成&amp;nbsp;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;FluxPeekFuseable.PeekConditionalSubscriber， 否则封装成&amp;nbsp;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;PeekSubscriber&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;subscriber&lt;/b&gt; = operator.&lt;b&gt;subscribeOrReturn&lt;/b&gt;(subscriber);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (subscriber == null) {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // null means &quot;I will subscribe myself&quot;, returning...&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //2&amp;nbsp;这里获取操作符优化的发布器，猜测应该也是装饰器模式，额外拓展功能的，这里没用到&lt;/font&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; &amp;nbsp; //最终还是使用原始的发布器&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; OptimizableOperator newSource = operator.nextOptimizableSource();&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (newSource == null) {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;//没有就使用原始的发布器&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;publisher&lt;/b&gt; = operator.source();&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; operator = newSource;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; //3 触发订阅，并指定消费者&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;publisher&lt;/b&gt;.&lt;b&gt;subscribe&lt;/b&gt;(&lt;b&gt;subscriber&lt;/b&gt;);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;}&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;catch (Throwable e) {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; Operators.reportThrowInSubscribe(subscriber, e);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; return;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;}&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;arcSize=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1000" y="759" width="440" height="421" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-123" value="&lt;div style=&quot;&quot;&gt;return new &lt;b&gt;FluxPeek&lt;/b&gt;.&lt;b&gt;PeekSubscriber&lt;/b&gt;&amp;lt;&amp;gt;(&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;actual, this);&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;div&gt;装饰器模式封装&lt;/div&gt;&lt;div&gt;LambdaMonoSubscriber -&amp;gt; PeekSubscriber&lt;/div&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1480" y="760" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-131" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-127" target="s0Pp-TZyqNJsN6R80Y19-130">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-127" value="&lt;div style=&quot;&quot;&gt;&lt;b&gt;subscribe&lt;/b&gt;(subscriber);&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;return subscriber;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1480" y="939.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-135" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-130" target="s0Pp-TZyqNJsN6R80Y19-134">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-144" value="1" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="s0Pp-TZyqNJsN6R80Y19-135">
          <mxGeometry x="0.2639" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-143" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-130" target="s0Pp-TZyqNJsN6R80Y19-142">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2180" y="969" />
              <mxPoint x="2180" y="1359" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-145" value="2" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="s0Pp-TZyqNJsN6R80Y19-143">
          <mxGeometry x="0.912" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-155" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-130" target="s0Pp-TZyqNJsN6R80Y19-153">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-130" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 11px;&quot;&gt;//该标志决定了在下游无法接收元素时是立即终止还是缓冲元素&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;boolean failOnBackpressure = actual.currentContext()&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;.getOrDefault(CONTEXT_OPT_OUT_NOBACKPRESSURE, false) == Boolean.TRUE;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//用于在延迟时间过后发出 0 值的任务（间接实现了&lt;b&gt;Subscription&lt;/b&gt; 接口&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//说明它还是个&lt;b&gt;调度器&lt;/b&gt;，决定了元素发出的方式)&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;MonoDelayRunnable r = new MonoDelayRunnable(actual, failOnBackpressure);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;//&lt;b&gt;1&lt;/b&gt; 订阅真正的实现，先回调订阅钩子，即Demo中定义的&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;doOnSubscribe(...)&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//然后调用FluxPeek 内部订阅器 LambdaMonoSubscriber&amp;nbsp;的 onSubscribe() 方法（装饰器模式），不过这里并不会发送事件元素，因为计时器还没超时&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;actual.&lt;b&gt;onSubscribe&lt;/b&gt;(r);&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;try {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;//&lt;b&gt;2&lt;/b&gt;&amp;nbsp;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;MonoDelayRunnable cancel 类型是函数式接口类型&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&amp;nbsp; &amp;nbsp; r.&lt;b&gt;setCancel&lt;/b&gt;(timedScheduler.schedule(r, delay, unit));&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;}&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;catch (RejectedExecutionException ree) {&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&amp;nbsp; &amp;nbsp; if(!MonoDelayRunnable.wasCancelled(r.state)) {&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; actual.onError(Operators.onRejectedExecution(ree, r, null, null,&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; actual.currentContext()));&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;}&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;arcSize=3;" vertex="1" parent="1">
          <mxGeometry x="1720" y="829.5" width="440" height="280" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-132" value="MonoDelay" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="1900" y="799.5" width="80" height="30" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-141" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-134" target="s0Pp-TZyqNJsN6R80Y19-137">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-134" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 10px;&quot;&gt;if (Operators.validate(subscription, s)) {&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; this.subscription = s;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;//这个Demo中没有用到&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; if (subscriptionConsumer != null) {&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; try {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; subscriptionConsumer.accept(s);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; catch (Throwable t) {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Exceptions.throwIfFatal(t);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; s.cancel();&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; onError(t);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; else {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;//终于看到这个方法调用了不过里面只是检查下状态并不会回调订阅者，s 是&amp;nbsp;&lt;/font&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;MonoDelayRunnable&lt;/b&gt;&lt;/font&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; s.&lt;b style=&quot;font-size: 10px;&quot;&gt;request&lt;/b&gt;(Long.MAX_VALUE);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=3;" vertex="1" parent="1">
          <mxGeometry x="2200" y="860" width="280" height="220" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-136" value="LambdaMonoSubscriber" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="2265" y="830" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-180" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.468;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;entryPerimeter=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-137" target="s0Pp-TZyqNJsN6R80Y19-177">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3820" y="971" />
              <mxPoint x="3820" y="1305" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-137" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;if (Operators.validate(n)) {&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;//状态检查, 初始状态是 ob00000000&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&amp;nbsp; &amp;nbsp; int previousState = markRequested(this);&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&amp;nbsp; &amp;nbsp; if (wasCancelled(previousState) || wasRequested(previousState)) {&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return; &lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;//订阅已经取消 或者 已经请求过，直接返回&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&amp;nbsp; &amp;nbsp; if (wasDelayDone(previousState) &amp;amp;&amp;amp; !failOnBackpressure) {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;font-size: 11px;&quot;&gt;propagateDelay&lt;/span&gt;(); &lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;//计时器已经超时 &amp;amp;&amp;amp;&amp;nbsp;&lt;/font&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;failOnBackpressure == false&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;}&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;align=left;arcSize=4;" vertex="1" parent="1">
          <mxGeometry x="2520" y="901" width="360" height="139" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-139" value="MonoDelayRunnable" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="2630" y="871" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-142" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;Disposable c = this.cancel;&lt;/div&gt;&lt;div&gt;this.cancel = &lt;b&gt;cancel&lt;/b&gt;;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;//仅仅只是检查下是否被取消，取消的话设置下状态标志&lt;/font&gt;&lt;/div&gt;&lt;div&gt;int previousState = markCancelFutureSet(this);&lt;/div&gt;&lt;div&gt;if (wasCancelFutureSet(previousState)) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (c != null) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; c.dispose();&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;if (wasCancelled(previousState)) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; cancel.dispose();&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;align=left;arcSize=3;" vertex="1" parent="1">
          <mxGeometry x="2201.48" y="1279" width="280" height="160" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-146" value="MonoDelayRunnable#setCancel" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="2241.48" y="1249" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-150" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-147" target="s0Pp-TZyqNJsN6R80Y19-149">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-147" value="&lt;div&gt;Supplier&amp;lt;Scheduler&amp;gt; PARALLEL_SUPPLIER =&lt;/div&gt;&lt;div&gt;() -&amp;gt; &lt;b&gt;newParallel&lt;/b&gt;(PARALLEL, DEFAULT_POOL_SIZE, true);&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1241" y="200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-152" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-149" target="s0Pp-TZyqNJsN6R80Y19-151">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-149" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;return newParallel(parallelism,&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;new &lt;b&gt;ReactorThreadFactory&lt;/b&gt;(name, ParallelScheduler.COUNTER, daemon,&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;true, Schedulers::defaultUncaughtException));&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;线程工厂&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1480" y="190" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-157" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-151" target="s0Pp-TZyqNJsN6R80Y19-153">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2190" y="230" />
              <mxPoint x="2190" y="1135" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-151" value="&lt;div style=&quot;font-size: 11px;&quot;&gt;return new &lt;b style=&quot;font-size: 11px;&quot;&gt;ParallelScheduler&lt;/b&gt;(parallelism, threadFactory);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;创建了parallelism 个单线程的&amp;nbsp;ScheduledThreadPoolExecutor&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1720" y="200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-160" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-153" target="s0Pp-TZyqNJsN6R80Y19-159">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-153" value="&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;timedScheduler.schedule(r, delay, unit)&lt;br style=&quot;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 11px;&quot;&gt;前面可以看到&amp;nbsp;&lt;b style=&quot;font-size: 10px;&quot;&gt;MonoDelayRunnable 中包含了订阅者的对象引用，再结合上下文其他地方都没有对订阅者Lambda表达式进行回调，猜测是在这个调度器中进行的回调&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="2200" y="1120" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-156" value="&lt;font color=&quot;#007fff&quot;&gt;而且LambdaMonoSubscriber lambda表达式&lt;br&gt;回调接口方法是 &lt;b&gt;onNext&lt;/b&gt;()，可以直接在这个方法上加断点，&lt;br&gt;通过调试快速找到回调流程&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="2200.96" y="1182" width="340" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-162" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-159" target="s0Pp-TZyqNJsN6R80Y19-161">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-159" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;return Schedulers.&lt;b&gt;directSchedule&lt;/b&gt;(&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;pick(), task, null, delay, unit);&lt;br style=&quot;font-size: 11px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;pick() 通过 RoundRobin算法选择一个单线程计划任务线程池，然后通过这个线程池&lt;b&gt;异步&lt;/b&gt;处理任务&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;align=center;arcSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2520" y="1120" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-161" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//回调钩子方法，这个Demo没有用忽略&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;task = onSchedule(task);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//任务重新封装为SchedulerTask&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;SchedulerTask sr = new SchedulerTask(task, parent);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;Future&amp;lt;?&amp;gt; f;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;if (delay &amp;lt;= 0L) {&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;//不需要延迟&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; f = exec.&lt;b&gt;submit&lt;/b&gt;((Callable&amp;lt;?&amp;gt;) sr);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;}&lt;/div&gt;&lt;div style=&quot;&quot;&gt;else {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; //这个方法会将SchedulerTask再封装成&lt;b&gt;FutureTask&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; f = exec.&lt;b&gt;schedule&lt;/b&gt;((Callable&amp;lt;?&amp;gt;) sr, delay, unit);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;}&lt;/div&gt;&lt;div style=&quot;&quot;&gt;sr.&lt;b&gt;setFuture&lt;/b&gt;(f);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;return sr;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;align=left;arcSize=3;" vertex="1" parent="1">
          <mxGeometry x="2760" y="1050" width="280" height="200" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-168" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-166" target="s0Pp-TZyqNJsN6R80Y19-167">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-166" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;ScheduledThreadPoolExecutor&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;异步处理, 此线程池内部的任务按时间延迟排序加入任务队列，工作者线程从队列头部获取可执行的任务（没有任务或头部任务未到执行时间工作者线程会阻塞等待）&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;align=center;arcSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="2520" y="1281" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-173" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-167" target="s0Pp-TZyqNJsN6R80Y19-172">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-167" value="&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;FutureTask#run()&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;即到期时调用&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;align=center;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="2760" y="1281" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-171" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-169" target="s0Pp-TZyqNJsN6R80Y19-170">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-169" value="&lt;div style=&quot;font-size: 11px;&quot;&gt;ReatorThreadFactory#newThread(&lt;br&gt;Runnable runnable)&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;通过这个工厂可以创建非阻塞线程（默认，不过这个非阻塞线程只是套了个空壳）&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1480" y="340" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-170" value="&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;div&gt;String newThreadName = name + &quot;-&quot; + counterReference.incrementAndGet();&lt;/div&gt;&lt;div&gt;Thread t = rejectBlocking&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ? new &lt;b&gt;NonBlockingThread&lt;/b&gt;(runnable, newThreadName)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; : new &lt;b&gt;Thread&lt;/b&gt;(runnable, newThreadName);&lt;/div&gt;&lt;div&gt;if (daemon) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; t.setDaemon(true); &lt;font color=&quot;#007fff&quot;&gt;//守护线程&lt;/font&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;if (uncaughtExceptionHandler != null) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; t.setUncaughtExceptionHandler(this);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;return t;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;align=left;arcSize=3;" vertex="1" parent="1">
          <mxGeometry x="1720" y="280" width="240" height="180" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-175" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-172" target="s0Pp-TZyqNJsN6R80Y19-174">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-172" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;result = c.call();&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;...&lt;/div&gt;&lt;div style=&quot;&quot;&gt;set(result);&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;align=center;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="3000" y="1281" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-178" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-174" target="s0Pp-TZyqNJsN6R80Y19-177">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-174" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;task.run();&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 11px; background-color: initial;&quot;&gt;...&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;align=center;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="3240" y="1281" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-176" value="SchedulerTask" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="3290" y="1251" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-182" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="s0Pp-TZyqNJsN6R80Y19-177" target="s0Pp-TZyqNJsN6R80Y19-181">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3820" y="1311" />
              <mxPoint x="3820" y="1421" />
              <mxPoint x="2740" y="1421" />
              <mxPoint x="2740" y="1520" />
              <mxPoint x="2760" y="1520" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-177" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;//CAS自旋标记任务状态为 timer 已经超时（FLAG_DELAY_DONE）&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;//返回之前的旧值&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;int previousState = &lt;b style=&quot;font-size: 10px;&quot;&gt;markDelayDone&lt;/b&gt;(this);&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//如果之前的任务状态是已经取消 或者 已经超时，不需要处理直接返回&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;if (wasCancelled(previousState) || wasDelayDone(previousState)) {&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; return;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;}&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;if (wasRequested(previousState)) {&lt;font color=&quot;#007fff&quot;&gt;//subscription是否已经request()过&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;propagateDelay&lt;/b&gt;();&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;}&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;else if (failOnBackpressure) {&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; actual.onError(Exceptions.failWithOverflow(&quot;Could not emit value due to lack of requests&quot;));&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=5;" vertex="1" parent="1">
          <mxGeometry x="3480" y="1221" width="320" height="180" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-179" value="MonoDelayRunnable" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="3550" y="1190" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-181" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;//CAS标记任务状态为已经发送事件元素，并返回修改之前的状态&lt;/font&gt;&lt;/div&gt;&lt;div&gt;int previousState = &lt;b&gt;markPropagated&lt;/b&gt;(this);&lt;/div&gt;&lt;div&gt;if (wasCancelled(previousState)) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;try {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; //onNext 中会回调 Demo subscribe() 中的 lambda表达式，传递的事件元素是 0L，这个值没有什么意义，只是onNext() 需要一个传参&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; actual.&lt;b&gt;onNext&lt;/b&gt;(0L);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; actual.&lt;b&gt;onComplete&lt;/b&gt;();&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;catch (Throwable t){&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; actual.onError(Operators.onOperatorError(t, actual.currentContext()));&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=5;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="2760" y="1439" width="320" height="161" as="geometry" />
        </mxCell>
        <mxCell id="s0Pp-TZyqNJsN6R80Y19-184" value="&lt;div&gt;&lt;b&gt;总结&lt;/b&gt;：&lt;/div&gt;&lt;div&gt;实现还是严格遵循 ReativeStream 规范的;&amp;nbsp;&lt;/div&gt;&lt;div&gt;Mono.delay() 方法定义一个发布者，但是这个发布者在订阅时，并不会发出元素；&lt;/div&gt;&lt;div&gt;而是通过 ScheduledThreadPoolExecutor 单线程的线程池提交一个异步任务（MonoDelayRunnable），这个定时任务到期时会被执行，然后通过 onNext() 方法发出元素（0L）; 并实现回调延迟之后需要执行的业务逻辑。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;即相当于 Mono.delay() 将阻塞操作从本线程中移到了ScheduledThreadPoolExecutor的工作者线程，并复用工作者线程统一处理阻塞操作；有点像 Reactor 模式线程复用的思想；&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="640" y="10" width="800" height="150" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
