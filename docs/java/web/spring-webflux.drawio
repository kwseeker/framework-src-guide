<mxfile host="Electron" modified="2024-04-26T09:43:33.816Z" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/21.6.5 Chrome/114.0.5735.243 Electron/25.3.1 Safari/537.36" etag="lUy8VWE-L6UXMHpasgWi" version="21.6.5" type="device">
  <diagram name="第 1 页" id="0NwcDRs000kfrG-1apiR">
    <mxGraphModel dx="3847" dy="837" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-1" value="&lt;p style=&quot;line-height: 1&quot;&gt;&lt;/p&gt;&lt;h1&gt;&lt;font style=&quot;font-size: 20px&quot;&gt;Spring-WebFlux 工作原理&lt;/font&gt;&lt;font style=&quot;font-size: 16px&quot;&gt;&amp;nbsp;&lt;/font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;(v5.2.1)&amp;nbsp;&lt;br style=&quot;font-size: 10px&quot;&gt;&lt;/font&gt;&lt;/h1&gt;&lt;div style=&quot;font-size: 10px&quot;&gt;属于spring-framework的一个模块。对比Spring MVC实现原理看，两者实现还是类似的。这里基于 spring-boot-starter-webflux:2.2.1.RELEASE分析。&lt;/div&gt;&lt;p style=&quot;font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;前提：&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 10px&quot;&gt;&lt;/p&gt;&lt;ul style=&quot;font-size: 10px&quot;&gt;&lt;li style=&quot;font-size: 10px&quot;&gt;SpringBoot 初始化流程（主要是Web容器初始化原理，可以参考 spring-analysis中的流程图）&lt;/li&gt;&lt;li style=&quot;font-size: 10px&quot;&gt;Reactor3、Reator-Netty(将Netty封装成了响应式的通信框架)、Netty工作原理（参考Netty源码分析流程图）、Netty应用开发（WebFlux默认使用Netty作为Web容器）&lt;/li&gt;&lt;/ul&gt;&lt;div&gt;说明：&lt;br&gt;&lt;ul&gt;&lt;li&gt;将WebFlux使用Reactor-Netty实现HTTP响应式服务器的主流程代码抽离到了reactor-netty/webflux-skeleton模块（省略了DispatcherHandler复杂的处理），可以用来理解Reactor-Netty对Netty的封装原理以及HTTP协议处理原理&lt;/li&gt;&lt;li&gt;决定还是将Reactor-Netty逻辑画到一个新的流程图，不然这里的流程图看起来有点过于复杂了&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&lt;p style=&quot;font-size: 10px&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="10" y="10" width="810" height="180" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-41" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-36" target="QhXQWBFm0-bGqjXrz0u2-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-36" value="spring-boot-starter-webflux" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="40" y="200" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-94" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-40" target="QhXQWBFm0-bGqjXrz0u2-93" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-252" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-40" target="QhXQWBFm0-bGqjXrz0u2-42" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-40" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;自动配置&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;扫描配置类加载BeanDefinition时加载&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="240" y="200" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-99" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-42" target="QhXQWBFm0-bGqjXrz0u2-98" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-42" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;初始化流程&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;需要了解SpringBoot初始化流程&lt;br&gt;这里只关注WebFlux初始化流程&lt;br&gt;&lt;/font&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="240" y="599" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-18" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-43" target="ALvgZmMKo5qc2uUOR07o-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-43" value="请求处理与响应" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="40" y="1840" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-96" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-93" target="QhXQWBFm0-bGqjXrz0u2-95" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-240" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-93" target="QhXQWBFm0-bGqjXrz0u2-238" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-93" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;spring-boot-starter-&lt;br&gt;reactor-netty&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;核心是这个starter,不过它本身并没有自动配置类，只是引入依赖&lt;/font&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="440" y="200" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-239" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-95" target="QhXQWBFm0-bGqjXrz0u2-238" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-245" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-95" target="QhXQWBFm0-bGqjXrz0u2-242" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-95" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;spring-boot-autoconfigure&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="640" y="200" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-101" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-98" target="QhXQWBFm0-bGqjXrz0u2-100" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-98" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;SpringApplication#run(...)&lt;br&gt;&lt;/font&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="439" y="599" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-103" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-100" target="QhXQWBFm0-bGqjXrz0u2-102" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-107" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-100" target="QhXQWBFm0-bGqjXrz0u2-106" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-100" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;new SpringApplication(primarySources))&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;选择Web类型&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="639" y="599" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-102" value="this.webApplicationType = WebApplicationType&lt;br&gt;.deduceFromClasspath();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;通过尝试加载类判断Web应用类型，是REACTIVE还是SERVLET&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="839" y="599" width="201" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-110" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-106" target="QhXQWBFm0-bGqjXrz0u2-109" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-106" value="run(args)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="639" y="679" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-108" value="&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;可以加载org.springframework.web.reactive.&lt;b&gt;DispatcherHandler &lt;/b&gt;(spring-webflux中定义的类，前面引入了此依赖，一定是会加载的)&lt;br&gt;且不可以加载org.springframework.web.servlet.DispatcherServlet （spring-mvc中定义的类，没有引入此依赖，一定不可以加载此类，下同）&lt;br&gt;和&amp;nbsp;org.glassfish.jersey.servlet.ServletContainer 说明是 REACTIVE 类型&lt;br&gt;&lt;b&gt;这里的逻辑同时也说明应用要么是REACTIVE要么是SERLVET, 如果同时引入spring-webflux 和 spring-mvc 那也只是SERVLET类型。&lt;/b&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1049" y="594" width="640" height="70" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-112" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-109" target="QhXQWBFm0-bGqjXrz0u2-111" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-115" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-109" target="QhXQWBFm0-bGqjXrz0u2-114" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-109" value="context = createApplicationContext();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;实例化应用上下文&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="839" y="679" width="201" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-111" value="通过反射加载并实例化&lt;br&gt;&lt;b&gt;AnnotationConfigReactiveWebServerApplicationContext&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1080.5" y="679" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-113" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;走到这里不妨先猜下接下来要初始化的内容（根据对MVC、Netty的了解，&lt;br&gt;个人认为主要包括下面3个流程）：&lt;br&gt;1. 创建Netty服务端（采用HTTP11/HTTP2编解码器）&lt;br&gt;2. 解析@Controller注解的Bean 或 实现了RouterFunction接口的Bean,&lt;br&gt;然后添加修饰的拦截器、序列化反序列化等工具组成责任链然后注册到&lt;br&gt;DispatcherHandler Map中&lt;br&gt;3. 注册使用reator-netty封装的DispatcherHandler 为 ChannelHander，&lt;br&gt;注册到Netty服务端的pipeline中。&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="289" y="679" width="350" height="130" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-117" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-114" target="QhXQWBFm0-bGqjXrz0u2-116" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-114" value="refreshContext(context);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="839" y="779" width="201" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-120" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-116" target="QhXQWBFm0-bGqjXrz0u2-119" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-116" target="u_z_PSljN5TfgaHLhyht-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-116" value="refresh()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1081" y="779" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-118" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;AbstractApplicationContext&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1090.5" y="750" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-223" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-119" target="QhXQWBFm0-bGqjXrz0u2-121" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-256" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-119" target="QhXQWBFm0-bGqjXrz0u2-215" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1360.5" y="1001" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-119" value="onRefresh();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1280.5" y="779" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-125" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-121" target="QhXQWBFm0-bGqjXrz0u2-124" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-121" value="super.onRefresh();&lt;br&gt;this.&lt;b&gt;createWebServer&lt;/b&gt;()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1479.5" y="779" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-123" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;ReactiveWebServerApplicationContext&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1459.5" y="749" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-127" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-124" target="QhXQWBFm0-bGqjXrz0u2-126" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-124" value="ReactiveWebServerFactory webServerFactory = this.getWebServerFactory(webServerFactoryBeanName);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;加载ReactiveWebServerFactory类型工厂Bean,默认只有&lt;br&gt;&lt;b&gt;NettyReactiveWebSeverFactory&lt;/b&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1679.5" y="779" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-133" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-126" target="QhXQWBFm0-bGqjXrz0u2-132" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-126" value="this.&lt;b&gt;serverManager&lt;/b&gt; = ReactiveWebServerApplicationContext&lt;br&gt;.ServerManager.get(webServerFactory, lazyInit);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1679.5" y="859" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-128" value="&lt;div style=&quot;text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;org.springframework.boot.web.server.&lt;/font&gt;&lt;b style=&quot;color: rgb(51, 0, 0); background-color: initial;&quot;&gt;AbstractConfigurableWebServerFactory&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;private int &lt;b&gt;port&lt;/b&gt; = 8080;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;private InetAddress &lt;b&gt;address&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;private Set&amp;lt;ErrorPage&amp;gt; errorPages = new LinkedHashSet();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;private Ssl ssl;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;private SslStoreProvider sslStoreProvider;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;private Http2 &lt;b&gt;http2&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;private Compression compression;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;private String serverHeader;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-440" y="480" width="400" height="160" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-130" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=blockThin;endFill=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-129" target="QhXQWBFm0-bGqjXrz0u2-128" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-129" value="&lt;div style=&quot;text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;org.springframework.boot.web.embedded.netty.&lt;/font&gt;&lt;span style=&quot;color: rgb(51, 0, 0); background-color: initial;&quot;&gt;&lt;b&gt;NettyReactiveWebServerFactory&lt;/b&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;创建基于Netty的响应式 WebServer 工厂&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;private Set&amp;lt;NettyServerCustomizer&amp;gt; &lt;b&gt;serverCustomizers&lt;/b&gt; = new LinkedHashSet();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;private List&amp;lt;NettyRouteProvider&amp;gt; &lt;b&gt;routeProviders&lt;/b&gt; = new ArrayList();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;private Duration &lt;b&gt;lifecycleTimeout&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;private boolean useForwardHeaders;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;private ReactorResourceFactory resourceFactory;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-440" y="680" width="400" height="120" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-131" value="&lt;div style=&quot;text-align: center; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#330000&quot;&gt;org.springframework.boot.web.reactive.context.&lt;/font&gt;&lt;font style=&quot;background-color: initial; font-size: 11px;&quot; color=&quot;#330000&quot;&gt;ReactiveWebServerApplicationContext.&lt;/font&gt;&lt;b style=&quot;background-color: initial; color: rgb(51, 0, 0);&quot;&gt;ServerManager&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 11px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#330000&quot;&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;响应式WebServer实例的&lt;/font&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;缓存容器,&amp;nbsp;class ServerManager implements HttpHandler&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;是&amp;nbsp;&lt;b&gt;ReactiveWebServerApplicationContext&amp;nbsp;&lt;/b&gt;的成员变量&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//经过多层装饰后的Netty服务器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;private final &lt;b&gt;WebServer&lt;/b&gt; &lt;b&gt;server&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//是否是首次请求才初始化HttpHandler&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;private final boolean lazyInit;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//即HttpWebHandlerAdpater实例&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;private volatile HttpHandler &lt;b&gt;handler&lt;/b&gt; = this::handleUninitialized;&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-1000" y="480" width="520" height="160" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-135" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-132" target="QhXQWBFm0-bGqjXrz0u2-134" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-132" value="new ServerManager(factory, lazyInit);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1999.5" y="859" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-139" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-134" target="QhXQWBFm0-bGqjXrz0u2-138" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-134" value="this.server = factory.&lt;b&gt;getWebServer&lt;/b&gt;(this);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2199.5" y="859" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-141" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-138" target="QhXQWBFm0-bGqjXrz0u2-140" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-148" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-138" target="QhXQWBFm0-bGqjXrz0u2-147" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-138" value="&lt;div&gt;HttpServer &lt;b&gt;httpServer&lt;/b&gt; = this.&lt;b&gt;createHttpServer&lt;/b&gt;();&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;创建Netty服务端并设置默认配置&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2399.5" y="859" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-143" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-140" target="QhXQWBFm0-bGqjXrz0u2-142" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="IVSfiaFSnUMNmgRAi2Nb-5" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.407;entryDx=0;entryDy=0;entryPerimeter=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-140" target="IVSfiaFSnUMNmgRAi2Nb-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-140" value="&lt;div&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;ReactorHttpHandlerAdapter handlerAdapter = new ReactorHttpHandlerAdapter(httpHandler);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;这里只是个空壳，后面&lt;/font&gt;&lt;/div&gt;&lt;font size=&quot;1&quot; color=&quot;#007fff&quot;&gt;finishRefresh()中&lt;/font&gt;&lt;span style=&quot;font-size: 9px; color: rgb(0, 127, 255); background-color: initial;&quot;&gt;才初始化&lt;/span&gt;&lt;font size=&quot;1&quot; color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2399.5" y="979" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-213" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-142" target="QhXQWBFm0-bGqjXrz0u2-144" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-142" value="&lt;div&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;NettyWebServer webServer = this.&lt;b&gt;createNettyWebServer&lt;/b&gt;(&lt;b&gt;httpServer&lt;/b&gt;, &lt;b&gt;handlerAdapter&lt;/b&gt;, this.lifecycleTimeout, this.getShutdown());&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#e3c800;strokeColor=#B09500;fontColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="2399.5" y="1059" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="IVSfiaFSnUMNmgRAi2Nb-6" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.998;entryY=0.487;entryDx=0;entryDy=0;entryPerimeter=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-144" target="IVSfiaFSnUMNmgRAi2Nb-4" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2360" y="1020" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-144" value="&lt;div&gt;webServer.setRouteProviders(&lt;br&gt;this.routeProviders);&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;这个routeProviders是空的&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2399.5" y="1139" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-153" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-147" target="QhXQWBFm0-bGqjXrz0u2-152" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-173" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-60" target="QhXQWBFm0-bGqjXrz0u2-172" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-147" value="&lt;b&gt;HttpServer&lt;/b&gt; &lt;b&gt;server&lt;/b&gt; = HttpServer.create();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;HttpServerBind&lt;/b&gt; 单例对象，默认本质是Netty服务端&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2639.5" y="859" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-149" value="&lt;div style=&quot;text-align: center; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;reactor.netty.http.server&lt;font style=&quot;background-color: initial; font-size: 11px;&quot;&gt;.&lt;/font&gt;&lt;/font&gt;&lt;b style=&quot;color: rgb(0, 0, 0); background-color: initial;&quot;&gt;HttpServer&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 11px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;reator-netty HTTP服务器实现类&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;static final TcpServer &lt;b&gt;DEFAULT_TCP_SERVER&lt;/b&gt; = TcpServer.create();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;span style=&quot;color: rgb(0, 0, 0); background-color: initial;&quot;&gt;static final Function&amp;lt;TcpServer, TcpServer&amp;gt; &lt;/span&gt;&lt;b style=&quot;color: rgb(0, 0, 0); background-color: initial;&quot;&gt;COMPRESS_ATTR_CONFIG&lt;/b&gt;&lt;span style=&quot;color: rgb(0, 0, 0); background-color: initial;&quot;&gt; = (tcp) -&amp;gt; {&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;&amp;nbsp; &amp;nbsp; return tcp.bootstrap(HttpServerConfiguration.MAP_COMPRESS);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;};&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;static final Function&amp;lt;TcpServer, TcpServer&amp;gt; &lt;b&gt;COMPRESS_ATTR_DISABLE&lt;/b&gt; = (tcp) -&amp;gt; {&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;&amp;nbsp; &amp;nbsp; return tcp.bootstrap(HttpServerConfiguration.MAP_NO_COMPRESS);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;};&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;static final Function&amp;lt;TcpServer, TcpServer&amp;gt; &lt;b&gt;FORWARD_ATTR_CONFIG&lt;/b&gt; = (tcp) -&amp;gt; {&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;&amp;nbsp; &amp;nbsp; return tcp.bootstrap(HttpServerConfiguration.MAP_FORWARDED);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;};&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;static final Function&amp;lt;TcpServer, TcpServer&amp;gt; &lt;b&gt;FORWARD_ATTR_DISABLE&lt;/b&gt; = (tcp) -&amp;gt; {&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;&amp;nbsp; &amp;nbsp; return tcp.bootstrap(HttpServerConfiguration.MAP_NO_FORWARDED);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;};&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-960" y="840" width="480" height="260" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-151" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-150" target="QhXQWBFm0-bGqjXrz0u2-149" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-150" value="&lt;div style=&quot;text-align: center; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;reactor.netty.http.server&lt;font style=&quot;background-color: initial; font-size: 11px;&quot;&gt;.&lt;/font&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;HttpServerBind&lt;/font&gt;&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 11px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;基于 Netty 响应式 WebServer 的默认实现，本质就是 TcpServerBind.INSTANCE&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;static final HttpServerBind &lt;b&gt;INSTANCE&lt;/b&gt; = new HttpServerBind();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;static final Function&amp;lt;DisposableServer, DisposableServer&amp;gt; &lt;b&gt;CLEANUP_GLOBAL_RESOURCE&lt;/b&gt; =&amp;nbsp;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;DisposableBind::new;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;final TcpServer &lt;b&gt;tcpServer&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-960" y="1134" width="480" height="106" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-159" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-152" target="QhXQWBFm0-bGqjXrz0u2-158" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-152" value="TcpServer &lt;b&gt;DEFAULT_TCP_SERVER&lt;/b&gt; = TcpServer.create();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;TcpServerBind 单例对象&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2879.5" y="859" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-157" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endArrow=diamondThin;endFill=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-154" target="QhXQWBFm0-bGqjXrz0u2-150" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-154" value="&lt;div style=&quot;text-align: center; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;reactor.netty.tcp.&lt;/font&gt;&lt;span style=&quot;color: rgb(0, 0, 0); background-color: initial;&quot;&gt;&lt;b&gt;TcpServer&lt;/b&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 11px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;static final int &lt;b&gt;DEFAULT_PORT&lt;/b&gt; = 0;&lt;/font&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-1400" y="1020" width="400" height="80" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-155" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-156" target="QhXQWBFm0-bGqjXrz0u2-154" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-156" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;reactor.netty.tcp.&lt;b&gt;Tcp&lt;/b&gt;&lt;/font&gt;&lt;b style=&quot;font-size: 11px; color: rgb(0, 0, 0); background-color: initial;&quot;&gt;ServerBind&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 11px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;基于 Netty 响应式 WebServer 的默认实现，本质就是 TcpServerBind.INSTANCE&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;同时实现了 Function&amp;lt;ServerBootStrap, ServerBootstrap&amp;gt; 接口，用于定义初始化&lt;br&gt;方法&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;static final TcpServerBind &lt;b&gt;INSTANCE&lt;/b&gt; = new TcpServerBind();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;//Netty最基础的服务端实例&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;final &lt;b&gt;ServerBootstrap&lt;/b&gt; &lt;b&gt;serverBootstrap&lt;/b&gt; = this.createServerBootstrap();&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-1400" y="1134" width="400" height="126" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-158" value="&lt;div&gt;return (ServerBootstrap)((ServerBootstrap)(new &lt;b&gt;ServerBootstrap&lt;/b&gt;())&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .&lt;b&gt;option&lt;/b&gt;(ChannelOption.SO_REUSEADDR, true))&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .&lt;b&gt;childOption&lt;/b&gt;(ChannelOption.AUTO_READ, false)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .&lt;b&gt;childOption&lt;/b&gt;(ChannelOption.TCP_NODELAY, true)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .&lt;b&gt;localAddress&lt;/b&gt;(new InetSocketAddress(0));&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;创建Netty服务端&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="3119.5" y="844" width="320" height="90" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-56" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;dashed=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-160" target="ALvgZmMKo5qc2uUOR07o-55" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-160" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;server = server.&lt;b&gt;tcpConfiguration&lt;/b&gt;((tcpServer) -&amp;gt; {&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; return tcpServer.runOn(resources)&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;.addressSupplier(this::getListenAddress);&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;});&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="2879.5" y="979" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-76" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-162" target="ALvgZmMKo5qc2uUOR07o-75" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-162" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;b.group(selectorGroup, elg)&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;.&lt;b&gt;channel&lt;/b&gt;(resources.onServerChannel(elg));&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;设置Channel类型（即服务端连接的实现）, 默认使用native实现，还可以选择&lt;/font&gt;&lt;/div&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;NioServerSocketChannel&lt;/b&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="3120" y="1139" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-167" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-164" target="QhXQWBFm0-bGqjXrz0u2-166" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-164" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;div&gt;server = server.tcpConfiguration((tcpServer) -&amp;gt; {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return tcpServer.runOn(resources)&lt;br&gt;.addressSupplier(this::getListenAddress);&lt;/div&gt;&lt;div&gt;});&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="2879.5" y="1240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-166" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;(ServerBootstrap)b.&lt;b&gt;localAddress&lt;/b&gt;(&lt;br&gt;(SocketAddress)bindingAddressSupplier.get());&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;绑定端口地址&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="3119.5" y="1240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-171" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-168" target="QhXQWBFm0-bGqjXrz0u2-170" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-184" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-168" target="QhXQWBFm0-bGqjXrz0u2-183" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-168" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;server = server.&lt;b&gt;protocol&lt;/b&gt;(this.listProtocols())&lt;br&gt;.&lt;b&gt;forwarded&lt;/b&gt;(this.useForwardHeaders);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;设置用于选择通信协议的初始化函数，如果有启用HTTP2就使用HTTP2协议否则用HTTP11&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2640" y="1399" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-182" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-170" target="QhXQWBFm0-bGqjXrz0u2-181" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-170" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;return this.&lt;b&gt;applyCustomizers&lt;/b&gt;(server);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;默认只有一个解码器的配置&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2640" y="1559" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-174" value="Y" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-172" target="QhXQWBFm0-bGqjXrz0u2-160" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2860" y="1169" />
              <mxPoint x="2860" y="1009" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-176" value="N" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-172" target="QhXQWBFm0-bGqjXrz0u2-164" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2800" y="1170" />
              <mxPoint x="2860" y="1170" />
              <mxPoint x="2860" y="1270" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-179" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-172" target="QhXQWBFm0-bGqjXrz0u2-178" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-172" value="this.resourceFactory &lt;br&gt;!= null" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="2679.5" y="1139" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-180" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-178" target="QhXQWBFm0-bGqjXrz0u2-168" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-178" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;SSL、数据压缩等&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;默认没启用略&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2640" y="1319" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-207" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-181" target="QhXQWBFm0-bGqjXrz0u2-206" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-181" value="&lt;div style=&quot;&quot;&gt;for&amp;nbsp;this.serverCustomizers:&lt;/div&gt;&lt;div style=&quot;&quot;&gt;server = customizer.&lt;b&gt;apply&lt;/b&gt;(server);&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2880" y="1559" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-203" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-183" target="QhXQWBFm0-bGqjXrz0u2-202" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-84" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-183" target="ALvgZmMKo5qc2uUOR07o-83" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-183" value="&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;div&gt;&lt;div&gt;return this.&lt;b&gt;tcpConfiguration&lt;/b&gt;((tcpServer) -&amp;gt; {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return tcpServer.&lt;b&gt;bootstrap&lt;/b&gt;((b) -&amp;gt; {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return HttpServerConfiguration&lt;/div&gt;&lt;div&gt;.protocols(b, supportedProtocols);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; });&lt;/div&gt;&lt;div&gt;});&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="2880" y="1399" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-186" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;strokeColor=none;endArrow=block;endFill=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-185" target="QhXQWBFm0-bGqjXrz0u2-154" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-187" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-185" target="QhXQWBFm0-bGqjXrz0u2-154" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-185" value="&lt;div style=&quot;text-align: center; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;reactor.netty.tcp.&lt;/font&gt;&lt;/font&gt;&lt;span style=&quot;color: rgb(0, 0, 0); background-color: initial;&quot;&gt;&lt;b&gt;TcpServerOperator&lt;/b&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 11px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;final TcpServer source;&lt;/font&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-1780" y="1134" width="320" height="105" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-189" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-188" target="QhXQWBFm0-bGqjXrz0u2-185" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-188" value="&lt;div style=&quot;text-align: center; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;reactor.netty.tcp.&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;b style=&quot;color: rgb(0, 0, 0);&quot;&gt;TcpServerBootstrap &lt;/b&gt;（这里其实是&lt;b&gt;装饰器模式&lt;/b&gt;）&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 11px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;//用于更新服务器配置的函数式方法，每装饰一层注册一个方法&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;final Function&amp;lt;? super ServerBootstrap, ? extends ServerBootstrap&amp;gt; bootstrapMapper;&lt;/font&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-1840" y="1281" width="440" height="79" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-191" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;后面的逻辑是使用&lt;b&gt;装饰器模式&lt;/b&gt;，&lt;br&gt;为HttpServer附加一些初始化方法，&lt;br&gt;在服务器启动时调用实现Netty服务器初始化&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2639.5" y="919" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-195" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-192" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-720.0000000000005" y="1100" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-192" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;reactor.netty.http.server.&lt;/font&gt;&lt;span style=&quot;color: rgb(0, 0, 0); background-color: initial;&quot;&gt;&lt;b&gt;HttpServerOperator&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 11px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;final HttpServer&amp;nbsp;source;&lt;/font&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-420" y="1134" width="320" height="105" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-193" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-194" target="QhXQWBFm0-bGqjXrz0u2-192" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-194" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;reactor.netty.http.server&lt;/font&gt;&lt;font style=&quot;background-color: initial; font-size: 11px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;/font&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;&lt;b&gt;HttpServerTcpConfig&lt;/b&gt;&lt;/font&gt;&lt;b style=&quot;color: rgb(0, 0, 0); font-size: 11px;&quot;&gt;&amp;nbsp;&lt;/b&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;（这里其实是&lt;/span&gt;&lt;b style=&quot;font-size: 11px;&quot;&gt;装饰器模式&lt;/b&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;）&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 11px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;final Function&amp;lt;? super ServerBootstrap, ? extends ServerBootstrap&amp;gt; bootstrapMapper;&lt;/font&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-480" y="1281" width="440" height="79" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-205" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-202" target="QhXQWBFm0-bGqjXrz0u2-204" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-202" value="&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;return forwardedEnabled ? this.tcpConfiguration(FORWARD_ATTR_CONFIG) : this.&lt;b&gt;tcpConfiguration&lt;/b&gt;(FORWARD_ATTR_DISABLE);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="2880" y="1479" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-204" value="&lt;div style=&quot;&quot;&gt;hcc.&lt;b&gt;forwarded&lt;/b&gt; = false;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;同上&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="3120" y="1479" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-210" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-206" target="QhXQWBFm0-bGqjXrz0u2-209" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-206" value="&lt;div style=&quot;&quot;&gt;NettyWebServerFactoryCustomizer#&lt;br&gt;apply()&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="3120" y="1559" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-87" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-209" target="ALvgZmMKo5qc2uUOR07o-86" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-209" value="&lt;div style=&quot;&quot;&gt;tcp -&amp;gt; tcp.&lt;b&gt;bootstrap&lt;/b&gt;(b -&amp;gt; HttpServerConfiguration.decoder(b, decoder))&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="3360" y="1559" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-211" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;HttpRequestDecoderSpec&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="3390" y="1529" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-212" value="&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&lt;b&gt;httpServer&lt;/b&gt; = {HttpServerTcpConfig@5566}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;&lt;b&gt;tcpServerMapper&lt;/b&gt; = {HttpRequestDecoderSpec$lambda@5567}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; arg$1 = {HttpRequestDecoderSpec@5568}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;maxInitialLineLength = 4096&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;maxHeaderSize = 8192&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;maxChunkSize = 8192&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;validateHeaders = true&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;initialBufferSize = 128&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;&lt;b&gt;source&lt;/b&gt; = {HttpServerTcpConfig@5545}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &lt;b&gt;tcpServerMapper&lt;/b&gt; = {HttpServer$lambda@5543}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &lt;b&gt;source&lt;/b&gt; = {HttpServerTcpConfig@5541}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;b&gt;tcpServerMapper&lt;/b&gt; = {HttpServer$lambda@5544}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; arg$1 = {HttpProtocol[1]@5536}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;0 = {HttpProtocol@5538} &quot;HTTP11&quot;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;b&gt;source&lt;/b&gt; = {HttpServerTcpConfig@5535}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;tcpServerMapper&lt;/b&gt; = {NettyReactiveWebServerFactory$lambda@5537}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;source&lt;/b&gt; = {HttpServerBind@4821}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;b&gt;tcpServer&lt;/b&gt; = {TcpServerBind@5522}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;serverBootstrap&lt;/b&gt; = {ServerBootstrap@5569}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;childOptions = {ConcurrentHashMap@5572}&amp;nbsp; size = 2&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;childAttrs = {ConcurrentHashMap@5573}&amp;nbsp; size = 0&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;config = {ServerBootstrapConfig@5574}&amp;nbsp;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="-1800" y="800" width="390" height="300" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-214" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;org.springframework.boot.web.embedded.netty.&lt;/font&gt;&lt;span style=&quot;color: rgb(0, 0, 0); background-color: initial;&quot;&gt;&lt;b&gt;NettyWebServer&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 11px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;// webflux HTTP服务器实现类&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;private static final Predicate&amp;lt;HttpServerRequest&amp;gt; ALWAYS = (r) -&amp;gt; true;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;private final &lt;b&gt;HttpServer&lt;/b&gt; &lt;b&gt;httpServer&lt;/b&gt;;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;// 路由定义方式1： HttpHandler适配器&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;private final ReactorHttpHandlerAdapter &lt;b&gt;handlerAdapter&lt;/b&gt;;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;private final Duration &lt;b&gt;lifecycleTimeout&lt;/b&gt;;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;// 路由定义方式2： NettyRouteProvider&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;private List&amp;lt;NettyRouteProvider&amp;gt; &lt;b&gt;routeProviders&lt;/b&gt; = Collections.emptyList();&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;private DisposableServer &lt;b&gt;disposableServer&lt;/b&gt;;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-480" y="1400" width="440" height="180" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-218" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-215" target="QhXQWBFm0-bGqjXrz0u2-217" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-215" value="finishRefresh();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1280.5" y="1590" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-220" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-217" target="QhXQWBFm0-bGqjXrz0u2-219" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-217" value="super.finishRefresh();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1480.5" y="1590" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-222" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-219" target="QhXQWBFm0-bGqjXrz0u2-221" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-226" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-219" target="QhXQWBFm0-bGqjXrz0u2-225" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-219" value="WebServer webServer = startReactiveWebServer();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1480.5" y="1670" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-221" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;publishEvent(new &lt;b&gt;ReactiveWebServerInitializedEvent&lt;/b&gt;(&lt;br&gt;webServer, this));&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;暂时没搜到源码哪里有监听这个事件，先略，或许是给开发者预留的拓展&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1480.5" y="1830" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-229" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-225" target="QhXQWBFm0-bGqjXrz0u2-230" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1919.5" y="1700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0TajKGxzIfMUDPpfPPpd-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-225" target="0TajKGxzIfMUDPpfPPpd-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-225" value="ServerManager serverManager = this.serverManager;&lt;br&gt;ServerManager.&lt;b&gt;start&lt;/b&gt;(&lt;b&gt;serverManager&lt;/b&gt;, this::getHttpHandler);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1679.5" y="1670" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-227" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;ReactiveWebServerApplicationContext&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1459.5" y="1560" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-233" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-230" target="QhXQWBFm0-bGqjXrz0u2-232" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-235" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-230" target="QhXQWBFm0-bGqjXrz0u2-234" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-230" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;manager.&lt;b&gt;handler&lt;/b&gt; = manager.lazyInit ?&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;new LazyHttpHandler(&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;Mono.fromSupplier(handlerSupplier))&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;: &lt;b&gt;handlerSupplier&lt;/b&gt;.get();&lt;/font&gt;&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1920.5" y="1670" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-23" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-232" target="ALvgZmMKo5qc2uUOR07o-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-232" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;manager.server.start();&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1920.5" y="1770" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-234" value="ReactiveWebServerApplicationContext#&lt;br&gt;&lt;b&gt;getHttpHandler&lt;/b&gt;()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;这个时候才初始化请求处理器，是&lt;b&gt;HttpWebHandlerAdapter&lt;/b&gt;类型的Bean, 由&lt;br&gt;HttpHandlerAutoConfiguration创建&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2160.5" y="1670" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-244" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-236" target="QhXQWBFm0-bGqjXrz0u2-241" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="O3d2Nxprm6Z4arKHyfC2-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-236" target="O3d2Nxprm6Z4arKHyfC2-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-236" value="&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;WebFluxAutoConfiguration&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="840" y="280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-238" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;reactor-netty&lt;br&gt;spring-webflux&lt;br&gt;...&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="640" y="280" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-247" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-241" target="QhXQWBFm0-bGqjXrz0u2-246" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-241" value="&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;HttpHandlerAutoConfiguration&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="840" y="360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-243" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-242" target="QhXQWBFm0-bGqjXrz0u2-236" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-242" value="&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;ReactiveWebServerFactoryAutoConfiguration&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="840" y="200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="O3d2Nxprm6Z4arKHyfC2-9" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;dashed=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-246" target="O3d2Nxprm6Z4arKHyfC2-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-246" value="&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;AnnotationConfig#httpHandler()&lt;br&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;AnnotationConfig 是配置类&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1080.5" y="360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="O3d2Nxprm6Z4arKHyfC2-11" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-248" target="QhXQWBFm0-bGqjXrz0u2-250" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-248" value="&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;WebHttpHandlerBuilder&lt;/b&gt;#build();&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1320" y="440" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-254" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-250" target="QhXQWBFm0-bGqjXrz0u2-234" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1660" y="1620" />
              <mxPoint x="2261" y="1620" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QhXQWBFm0-bGqjXrz0u2-250" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;HttpWebHandlerAdapter adapted = new &lt;b&gt;HttpWebHandlerAdapter&lt;/b&gt;(decorated);&lt;br&gt;...&lt;br&gt;&lt;/font&gt;return adapted;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1560" y="440" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="O3d2Nxprm6Z4arKHyfC2-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" parent="1" source="O3d2Nxprm6Z4arKHyfC2-1" target="O3d2Nxprm6Z4arKHyfC2-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="O3d2Nxprm6Z4arKHyfC2-1" value="&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;EnableWebFluxConfiguration&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1080.5" y="280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="O3d2Nxprm6Z4arKHyfC2-3" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;org.springframework.boot.autoconfigure.web.reactive&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="840" y="160" width="260" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-1" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="O3d2Nxprm6Z4arKHyfC2-5" target="O3d2Nxprm6Z4arKHyfC2-12" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1540" y="325" />
              <mxPoint x="1540" y="350" />
              <mxPoint x="1660" y="350" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="O3d2Nxprm6Z4arKHyfC2-5" target="ALvgZmMKo5qc2uUOR07o-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="O3d2Nxprm6Z4arKHyfC2-5" value="&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;WebFluxConfigurationSupport#&lt;br&gt;&lt;b&gt;webHandler&lt;/b&gt;()&lt;br&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;创建DispatcherHandler Bean&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1320" y="280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="O3d2Nxprm6Z4arKHyfC2-10" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="O3d2Nxprm6Z4arKHyfC2-7" target="QhXQWBFm0-bGqjXrz0u2-248" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="O3d2Nxprm6Z4arKHyfC2-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="O3d2Nxprm6Z4arKHyfC2-7" target="O3d2Nxprm6Z4arKHyfC2-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="O3d2Nxprm6Z4arKHyfC2-7" value="&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;WebHttpHandlerBuilder#&lt;br&gt;&lt;b&gt;applicationContext&lt;/b&gt;(&lt;br&gt;this.applicationContext)&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1320" y="360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="O3d2Nxprm6Z4arKHyfC2-12" value="&lt;font style=&quot;font-size: 8px;&quot;&gt;基于 WebHandler 创建WebHttpHandlerBuilder 实例，然后装配上过滤器、统一异常处理、会话管理、编解码器、国际化Resolver、ForwardedHeaderTransformer&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1560" y="360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="O3d2Nxprm6Z4arKHyfC2-14" value="这里创建的FilteringWebHandler" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1760" y="455" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-4" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="1" source="O3d2Nxprm6Z4arKHyfC2-15" target="O3d2Nxprm6Z4arKHyfC2-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-5" value="构建" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="ALvgZmMKo5qc2uUOR07o-4" vertex="1" connectable="0">
          <mxGeometry x="-0.2379" y="4" relative="1" as="geometry">
            <mxPoint y="-5" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="O3d2Nxprm6Z4arKHyfC2-15" value="&lt;div style=&quot;text-align: center; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#330000&quot;&gt;org.springframework.web.server.adapter&lt;/font&gt;&lt;font style=&quot;background-color: initial; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#330000&quot;&gt;.&lt;/font&gt;&lt;/font&gt;&lt;b style=&quot;background-color: initial; color: rgb(51, 0, 0);&quot;&gt;WebHttpHandlerBuilder&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 11px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;HTTP请求分发处理器Builder&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;&lt;b&gt;webHandler&lt;/b&gt; = {&lt;b&gt;DispatcherHandler&lt;/b&gt;@5193}&amp;nbsp;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;&lt;b&gt;applicationContext&lt;/b&gt; = {AnnotationConfigReactiveWebServerApplicationContext@3429}&amp;nbsp;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;&lt;b&gt;filters&lt;/b&gt; = {ArrayList@5194}&amp;nbsp; size = 0&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;&lt;b&gt;exceptionHandlers&lt;/b&gt; = {ArrayList@5195}&amp;nbsp; size = 2&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;&amp;nbsp;0 = {DefaultErrorWebExceptionHandler@5680}&amp;nbsp;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;&amp;nbsp;1 = {WebFluxResponseStatusExceptionHandler@5681}&amp;nbsp;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;&lt;b&gt;sessionManager&lt;/b&gt; = null&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;&lt;b&gt;codecConfigurer&lt;/b&gt; = {DefaultServerCodecConfigurer@5676}&amp;nbsp;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;&lt;b&gt;localeContextResolver&lt;/b&gt; = {AcceptHeaderLocaleContextResolver@5677}&amp;nbsp;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;&lt;b&gt;forwardedHeaderTransformer&lt;/b&gt; = null&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-1480" y="480" width="440" height="220" as="geometry" />
        </mxCell>
        <mxCell id="O3d2Nxprm6Z4arKHyfC2-16" value="&lt;div style=&quot;text-align: center; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#330000&quot;&gt;org.springframework.web.server.adapter&lt;/font&gt;&lt;font style=&quot;background-color: initial; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#330000&quot;&gt;.&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;b style=&quot;color: rgb(51, 0, 0); background-color: initial;&quot;&gt;HttpWebHandlerAdapter&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;extends WebHandlerDecorator implements HttpHandler&lt;br&gt;&lt;/font&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 11px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;实际的HTTP请求分发处理器（装饰器模式, 是装饰过后的DispatcherHandler）&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;&lt;b&gt;sessionManager&lt;/b&gt; = {DefaultWebSessionManager@5737}&amp;nbsp;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;&lt;b&gt;codecConfigurer&lt;/b&gt; = {DefaultServerCodecConfigurer@5676}&amp;nbsp;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;&lt;b&gt;localeContextResolver&lt;/b&gt; = {AcceptHeaderLocaleContextResolver@5677}&amp;nbsp;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;&lt;b&gt;forwardedHeaderTransformer&lt;/b&gt; = null&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;&lt;b&gt;applicationContext&lt;/b&gt; = {AnnotationConfigReactiveWebServerApplicationContext@3429}&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;enableLoggingRequestDetails = false&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//继承自WebHandlerDecorator 是装饰后的DispatcherHandler&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;&lt;b&gt;delegate&lt;/b&gt; = {ExceptionHandlingWebHandler@5696}&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;&amp;nbsp;&lt;b&gt;exceptionHandlers&lt;/b&gt; = {Collections$UnmodifiableRandomAccessList@5746}&amp;nbsp; size = 3&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;&amp;nbsp;delegate = {FilteringWebHandler@5691}&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;&amp;nbsp; &lt;b&gt;chain&lt;/b&gt; = {DefaultWebFilterChain@5748}&amp;nbsp;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;&amp;nbsp; delegate = {DispatcherHandler@5193}&amp;nbsp;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;b&gt;handlerMappings&lt;/b&gt; = {Collections$UnmodifiableRandomAccessList@5203}&amp;nbsp; size = 3&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;b&gt;handlerAdapters&lt;/b&gt; = {ArrayList@5204}&amp;nbsp; size = 3&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#330000&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;b style=&quot;&quot;&gt;resultHandlers&lt;/b&gt; = {ArrayList@5205}&amp;nbsp; size = 4&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-1960" y="440" width="440" height="260" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-3" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;endArrow=diamondThin;endFill=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-2" target="O3d2Nxprm6Z4arKHyfC2-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-2" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;org.springframework.web.reactive&lt;/font&gt;&lt;font style=&quot;font-size: 11px; background-color: initial;&quot;&gt;&lt;font style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;.&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;b style=&quot;background-color: initial; color: rgb(51, 0, 0);&quot;&gt;DispatcherHandler&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 11px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;请求分发处理器, 对标Servlet服务器的 &lt;b&gt;DispatcherServlet， &lt;/b&gt;继承WebHandler接口&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;//定义 请求路由 -&amp;gt; 请求处理方法 的映射（Map）&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private List&amp;lt;&lt;b&gt;HandlerMapping&lt;/b&gt;&amp;gt; &lt;b&gt;handlerMappings&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;//请求处理适配器，适配不同的请求处理器定义方式（比如@RequestMapping、&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;RouterFunction&lt;span style=&quot;background-color: initial;&quot;&gt;）&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private List&amp;lt;&lt;b&gt;HandlerAdapter&lt;/b&gt;&amp;gt; &lt;b&gt;handlerAdapters&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;//响应结果处理器，比如结果序列化&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private List&amp;lt;&lt;b&gt;HandlerResultHandler&lt;/b&gt;&amp;gt; &lt;b&gt;resultHandlers&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-1480" y="300" width="440" height="160" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-6" target="ALvgZmMKo5qc2uUOR07o-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-6" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;return new &lt;b&gt;DispatcherHandler&lt;/b&gt;();&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1560" y="280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-8" target="ALvgZmMKo5qc2uUOR07o-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-8" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;initStrategies(applicationContext);&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;初始化三大组件：&lt;/font&gt;&lt;span style=&quot;&quot;&gt;HandlerMapping、&lt;br&gt;&lt;/span&gt;HandlerAdapter、HandlerResultHandler&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1799.5" y="280" width="200.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-10" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;BeanFactoryUtils&lt;br&gt;&lt;span style=&quot;&quot;&gt;.beansOfTypeIncludingAncestors(...);&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;&quot;&gt;AnnotationAwareOrderComparator.sort(...);&lt;/span&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;这里是获取&lt;/font&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;HandlerMapping、&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;HandlerAdapter、HandlerResultHandler&lt;/span&gt;&lt;/span&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;类型或其子类型的Bean，并排序&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2039.5" y="270" width="200.5" height="80" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-16" value="TODO" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2245" y="295" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-21" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-17" target="ALvgZmMKo5qc2uUOR07o-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-17" value="&lt;div&gt;请求进来先是通过Netty ChannelPipeline传递到&lt;/div&gt;&lt;div&gt;&lt;b&gt;HttpTrafficHandler&lt;/b&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="240" y="1840" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-19" value="&lt;font color=&quot;#007fff&quot;&gt;关于Netty原理参考&lt;br&gt;netty-analysis&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="260" y="1901" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-20" target="u_z_PSljN5TfgaHLhyht-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-20" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;channelRead&lt;/b&gt;(ChannelHandlerContext ctx, Object msg)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="440" y="1840" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-26" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-22" target="ALvgZmMKo5qc2uUOR07o-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-22" target="u_z_PSljN5TfgaHLhyht-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-22" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;this.disposableServer = startHttpServer();&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2160.5" y="1770" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-24" value="NettyWebServer" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2206" y="1739" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-28" value="Y" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-25" target="ALvgZmMKo5qc2uUOR07o-27" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-31" value="N" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="ALvgZmMKo5qc2uUOR07o-25" target="ALvgZmMKo5qc2uUOR07o-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-33" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-25" target="ALvgZmMKo5qc2uUOR07o-32" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-25" value="this.&lt;b&gt;routeProviders&lt;/b&gt;&lt;br&gt;.isEmpty()" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="2421" y="1760" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-38" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-27" target="ALvgZmMKo5qc2uUOR07o-37" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-27" value="server = server.handle(this.handlerAdapter);" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="2600.5" y="1770" width="160.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-29" value="server = server.route(&lt;br&gt;this::applyRouteProviders);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;默认 routeProviders为空，这步先略&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="2600.5" y="1851" width="160.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-40" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-32" target="ALvgZmMKo5qc2uUOR07o-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-32" value="return server.bindNow();" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2401" y="1930" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-35" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-34" target="QhXQWBFm0-bGqjXrz0u2-192" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-34" value="&lt;div style=&quot;text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;reactor.netty.http.server&lt;/font&gt;&lt;font style=&quot;background-color: initial; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;/font&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;&lt;b&gt;HttpServerHandle&lt;/b&gt;&lt;/font&gt;&lt;b style=&quot;color: rgb(0, 0, 0);&quot;&gt;&amp;nbsp;&lt;/b&gt;（&lt;b style=&quot;&quot;&gt;装饰器模式&lt;/b&gt;）&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//封装了前面的HttpWebHandlerAdapter, Adapter也经过层层装饰这里是ReactorHttpHandlerAdapter&lt;/font&gt;&lt;br&gt;&lt;span style=&quot;font-size: 11px; color: rgb(0, 0, 0); background-color: initial;&quot;&gt;final BiFunction&amp;lt;? super HttpServerRequest, ? super&lt;/span&gt;&lt;br&gt;&lt;/font&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#000000&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;HttpServerResponse, ? extends Publisher&amp;lt;Void&amp;gt;&amp;gt; &lt;b style=&quot;&quot;&gt;handler&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-960" y="1281" width="440" height="79" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-37" value="&lt;font style=&quot;&quot;&gt;this.handler = Objects&lt;br&gt;.requireNonNull(handler, &quot;handler&quot;);&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;这里是在原HttpServerTcpConfig基础上装饰了ReactorHttpHandlerAdapter&lt;/font&gt;&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2799.5" y="1770" width="160.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-42" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-39" target="ALvgZmMKo5qc2uUOR07o-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-39" value="&lt;b&gt;bind&lt;/b&gt;().block(timeout)&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;此时server是装饰了很多层的Netty服务器，此bind()也是从内到外一层层执行的，只不过每层并没有额外添加逻辑&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2600.5" y="1930" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-45" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-41" target="ALvgZmMKo5qc2uUOR07o-44" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0TajKGxzIfMUDPpfPPpd-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-41" target="0TajKGxzIfMUDPpfPPpd-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-41" value="&lt;div&gt;delegate.bootstrap(this)&lt;span style=&quot;background-color: initial;&quot;&gt;.bind()&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;.map(&lt;/font&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;CLEANUP_GLOBAL_RESOURCE&lt;/font&gt;&lt;font size=&quot;1&quot;&gt;);&lt;/font&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2800" y="1930" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-43" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;HttpServerBind&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2835" y="1900" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-47" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-44" target="ALvgZmMKo5qc2uUOR07o-46" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-95" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-44" target="ALvgZmMKo5qc2uUOR07o-94" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-44" value="new &lt;b&gt;TcpServerBootstrap&lt;/b&gt;(this, bootstrapMapper);" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2999.75" y="1930" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-49" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-46" target="ALvgZmMKo5qc2uUOR07o-48" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-51" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-46" target="ALvgZmMKo5qc2uUOR07o-50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-46" value="b = &lt;b&gt;configure&lt;/b&gt;();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;此处ServerBootstrap（b）经过了层层装饰&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2999.75" y="2011" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-78" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-48" target="ALvgZmMKo5qc2uUOR07o-77" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-48" value="bootstrapMapper&lt;br&gt;.&lt;b&gt;apply&lt;/b&gt;(source.&lt;b&gt;configure&lt;/b&gt;())&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;这里就是从内到外一层层地执行apply方法&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="3199.25" y="2011" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-104" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-50" target="ALvgZmMKo5qc2uUOR07o-103" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-50" value="return bind(b);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;此bind()也是从内到外一层层执行的，只不过每层并没有额外添加逻辑，只看最内层实现&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2999.75" y="2250" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-58" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-55" target="ALvgZmMKo5qc2uUOR07o-57" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-64" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-55" target="ALvgZmMKo5qc2uUOR07o-63" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-55" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font size=&quot;1&quot;&gt;EventLoopGroup selectorGroup = resources.onServerSelect(preferNative);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;创建Selector线程组（boss线程组），&lt;br&gt;默认还会被当作worker线程组&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="3120" y="979" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-59" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="ALvgZmMKo5qc2uUOR07o-57" target="QhXQWBFm0-bGqjXrz0u2-162" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-69" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-57" target="ALvgZmMKo5qc2uUOR07o-68" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-57" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font size=&quot;1&quot;&gt;EventLoopGroup elg = resources.onServer(preferNative);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;获取工作者线程组，其实还是上一组线程组，这里直接从缓存返回&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="3120" y="1059" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-61" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="QhXQWBFm0-bGqjXrz0u2-147" target="ALvgZmMKo5qc2uUOR07o-60" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2740" y="919" as="sourcePoint" />
            <mxPoint x="2740" y="1119" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-60" value="LoopResources resources = this.&lt;b&gt;resourceFactory&lt;/b&gt;.getLoopResources();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2640" y="1059" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-62" value="NettyReactiveWebServerFactory" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2640" y="829" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-72" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="ALvgZmMKo5qc2uUOR07o-63" target="ALvgZmMKo5qc2uUOR07o-70" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-63" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;return cacheNativeSelectLoops();&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;先从缓存中获取EventLoopGroup,没有则创建，&lt;/font&gt;&lt;font style=&quot;font-weight: bold;&quot; color=&quot;#007fff&quot;&gt;默认boss线程组和worker线程组是一组线程，&lt;/font&gt;&lt;font style=&quot;&quot; color=&quot;#ea6b66&quot;&gt;为何要共用同一组线程&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="3360" y="979" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-65" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;new &lt;b&gt;EpollEventLoopGroup&lt;/b&gt;(threads, factory);&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;本地环境是Linux,所以基于Epoll&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="3840" y="979" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-67" value="&lt;div style=&quot;text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;reactor.netty.resources&lt;/font&gt;&lt;font style=&quot;background-color: initial; font-size: 10px;&quot; color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;b style=&quot;color: rgb(0, 0, 0); background-color: initial;&quot;&gt;DefaultLoopResources&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot; size=&quot;1&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;用于客户端和服务端创建并缓存EventLoopGroup(一组线程)的，&lt;br&gt;&amp;nbsp;可以当作EventLoopGroup的工厂+管理器&lt;/font&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//线程名前缀&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final String&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;prefix&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//是否是守护线程&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final boolean&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;b&gt;daemon&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//selector线程（即boss线程，分发请求）数量&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final int&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;b&gt;selectCount&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//工作线程（处理请求）数量&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final int&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;b&gt;workerCount&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//这三组功能同后面的三组EventLoopGroup,只是基于 &lt;b&gt;NioEventLoopGroup&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;//后面三组基于 projectreactor DefaultLoopEpoll，&lt;/b&gt;不过记得本质都是一样的，底层都是epoll,&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;只是封装不同, 默认用 useNative = true, 即用DefaultLoopEpoll&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final AtomicReference&amp;lt;EventLoopGroup&amp;gt; &lt;b&gt;serverLoops&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final AtomicReference&amp;lt;EventLoopGroup&amp;gt; &lt;b&gt;clientLoops&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final AtomicReference&amp;lt;EventLoopGroup&amp;gt; &lt;b&gt;serverSelectLoops&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//客户端线程组（并不等同于连接线程）&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final AtomicReference&amp;lt;EventLoopGroup&amp;gt; &lt;b&gt;cacheNativeClientLoops&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//服务端worker线程组，默认情况下和boss线程组是同一组线程，&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//调试可以发现和下面的cacheNativeSelectLoops中的线程组是同一个对象&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final AtomicReference&amp;lt;EventLoopGroup&amp;gt; &lt;b&gt;cacheNativeServerLoops&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//服务端Selector(boss)线程组&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final AtomicReference&amp;lt;EventLoopGroup&amp;gt; &lt;b&gt;cacheNativeSelectLoops&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final AtomicBoolean&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;running;&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-480" y="1600" width="440" height="360" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-68" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;return cacheNativeServerLoops();&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="3360" y="1059" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-73" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="ALvgZmMKo5qc2uUOR07o-70" target="ALvgZmMKo5qc2uUOR07o-65" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-70" value="&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;div style=&quot;&quot;&gt;DefaultLoop defaultLoop = DefaultLoopNativeDetector.getInstance();&lt;/div&gt;&lt;div style=&quot;&quot;&gt;EventLoopGroup newEventLoopGroup = defaultLoop.&lt;b&gt;newEventLoopGroup&lt;/b&gt;(&lt;/div&gt;&lt;div style=&quot;&quot;&gt;workerCount,&lt;/div&gt;&lt;div style=&quot;&quot;&gt;threadFactory(this, defaultLoop.getName()));&lt;/div&gt;&lt;div style=&quot;&quot;&gt;cacheNativeServerLoops.compareAndSet(null, newEventLoopGroup)&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=6;" parent="1" vertex="1">
          <mxGeometry x="3599.5" y="969.5" width="200" height="79" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-74" value="&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;这里 AtomicReference + CAS 实现锁的效果&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="3599.5" y="935" width="220" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-75" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;DefaultLoopNativeDetector.getInstance()&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;.&lt;b&gt;getServerChannel&lt;/b&gt;(group)&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;这个是native实现（projectreactor的封装）&lt;br&gt;&lt;b&gt;EpollServerSocketChannel&lt;/b&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="3360" y="1139" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-80" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-77" target="ALvgZmMKo5qc2uUOR07o-79" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-77" value="TcpServerBind#configure()" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="3399.25" y="2011" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-82" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-79" target="ALvgZmMKo5qc2uUOR07o-81" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-79" value="TcpServerRunOn#configure()" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="3399.25" y="2091" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-88" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="ALvgZmMKo5qc2uUOR07o-81" target="ALvgZmMKo5qc2uUOR07o-83" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3600" y="2200" />
              <mxPoint x="3600" y="1740" />
              <mxPoint x="3110" y="1740" />
              <mxPoint x="3110" y="1449" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-89" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="ALvgZmMKo5qc2uUOR07o-81" target="QhXQWBFm0-bGqjXrz0u2-204" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3600" y="2200" />
              <mxPoint x="3600" y="1740" />
              <mxPoint x="3110" y="1740" />
              <mxPoint x="3110" y="1524" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-90" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="ALvgZmMKo5qc2uUOR07o-81" target="ALvgZmMKo5qc2uUOR07o-86" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3600" y="2200" />
              <mxPoint x="3600" y="1740" />
              <mxPoint x="3580" y="1740" />
              <mxPoint x="3580" y="1605" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-92" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="ALvgZmMKo5qc2uUOR07o-81" target="ALvgZmMKo5qc2uUOR07o-91" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-100" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="ALvgZmMKo5qc2uUOR07o-81" target="ALvgZmMKo5qc2uUOR07o-94" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3600" y="2200" />
              <mxPoint x="3600" y="2000" />
              <mxPoint x="3190" y="2000" />
              <mxPoint x="3190" y="1975" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-81" value="bootstrapMapper.apply()" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="3399.25" y="2170" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-83" value="&lt;div style=&quot;&quot;&gt;&lt;b&gt;HttpServerConfiguration&lt;/b&gt; hcc = b.config().attrs().get(CONF_KEY);&lt;br&gt;b.&lt;b&gt;attr&lt;/b&gt;(CONF_KEY, hcc);&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;hcc.&lt;b&gt;protocols&lt;/b&gt; = _protocols;&lt;/div&gt;&lt;font color=&quot;#007fff&quot;&gt;配置HTTP协议版本CONF_KEY:&amp;nbsp;&lt;/font&gt;&lt;span style=&quot;color: rgb(0, 127, 255); background-color: initial;&quot;&gt;httpServerConf&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="3120" y="1389" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-86" value="&lt;div style=&quot;&quot;&gt;&lt;div&gt;hcc.&lt;b&gt;decoder&lt;/b&gt; =&amp;nbsp;decoder&lt;span style=&quot;background-color: initial;&quot;&gt;;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;同上&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="3599.5" y="1560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-91" value="b.&lt;b&gt;childOption&lt;/b&gt;(OBSERVER_OPTION, connectionObserver);" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="3640" y="2170" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-93" value="HttpServerHandle" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="3680" y="2139.5" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-97" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-94" target="ALvgZmMKo5qc2uUOR07o-96" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-94" value="apply()" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="3199.25" y="1930" width="100.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-98" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="ALvgZmMKo5qc2uUOR07o-79" target="ALvgZmMKo5qc2uUOR07o-55" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="3800" y="2121" as="sourcePoint" />
            <mxPoint x="3120" y="1024" as="targetPoint" />
            <Array as="points">
              <mxPoint x="3580" y="2121" />
              <mxPoint x="3580" y="1750" />
              <mxPoint x="3100" y="1750" />
              <mxPoint x="3100" y="1024" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-99" value="触发执行" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#97D077;" parent="ALvgZmMKo5qc2uUOR07o-98" vertex="1" connectable="0">
          <mxGeometry x="-0.9583" relative="1" as="geometry">
            <mxPoint x="30" y="2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-102" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-96" target="ALvgZmMKo5qc2uUOR07o-101" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-96" value="&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;BootstrapHandlers.updateConfiguration(b,&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; NettyPipeline.&lt;b&gt;HttpInitializer&lt;/b&gt;,&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; new &lt;b&gt;Http1Initializer&lt;/b&gt;(conf.decoder.maxInitialLineLength(),&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; conf.decoder.maxHeaderSize(),&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; conf.decoder.maxChunkSize(),&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; conf.decoder.validateHeaders(),&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; conf.decoder.initialBufferSize(),&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; conf.minCompressionSize,&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; compressPredicate(conf.compressPredicate, conf.minCompressionSize),&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; conf.forwarded,&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; conf.cookieEncoder,&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; conf.cookieDecoder));&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px;&quot;&gt;注册处理器&lt;/font&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;arcSize=4;align=left;" parent="1" vertex="1">
          <mxGeometry x="3338.75" y="1851" width="220.5" height="140" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-101" value="&lt;div style=&quot;&quot;&gt;b.childHandler(updateConfiguration(&lt;/div&gt;&lt;div style=&quot;&quot;&gt;b.config().childHandler(), name, c));&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#d5e8d4;strokeColor=#82b366;arcSize=13;align=center;" parent="1" vertex="1">
          <mxGeometry x="3640" y="1891" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-106" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ALvgZmMKo5qc2uUOR07o-103" target="ALvgZmMKo5qc2uUOR07o-105" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-103" value="判断是否需要支持SSL, 是的话&lt;br&gt;SslProvider.setBootstrap(b, ssl);" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="3199.25" y="2250" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ALvgZmMKo5qc2uUOR07o-105" value="return Mono.create(sink -&amp;gt; {...})" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="3199.25" y="2330" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0TajKGxzIfMUDPpfPPpd-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="0TajKGxzIfMUDPpfPPpd-1" target="0TajKGxzIfMUDPpfPPpd-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0TajKGxzIfMUDPpfPPpd-1" value="&lt;div&gt;block(timeout)&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;阻塞等待bind操作完成&lt;/font&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2800" y="2400" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0TajKGxzIfMUDPpfPPpd-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="0TajKGxzIfMUDPpfPPpd-3" target="0TajKGxzIfMUDPpfPPpd-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0TajKGxzIfMUDPpfPPpd-3" value="&lt;div&gt;BlockingMonoSubscriber&amp;lt;T&amp;gt; subscriber = new BlockingMonoSubscriber();&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="2999.5" y="2400" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0TajKGxzIfMUDPpfPPpd-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="0TajKGxzIfMUDPpfPPpd-5" target="0TajKGxzIfMUDPpfPPpd-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0TajKGxzIfMUDPpfPPpd-5" value="&lt;div&gt;this.&lt;b&gt;subscribe&lt;/b&gt;(&lt;/div&gt;&lt;div&gt;(Subscriber)subscriber);&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="2999.5" y="2480" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0TajKGxzIfMUDPpfPPpd-7" value="Mono" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="3054.5" y="2370" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="0TajKGxzIfMUDPpfPPpd-8" value="return subscriber.blockingGet(&lt;br&gt;timeout.toMillis(), TimeUnit.MILLISECONDS);" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="2999.5" y="2560" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0TajKGxzIfMUDPpfPPpd-10" value="return ServerManager.getWebServer(&lt;br&gt;serverManager);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1679.5" y="1750" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0TajKGxzIfMUDPpfPPpd-12" value="&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;这里用到了 ProjectReactor &lt;br&gt;MonoCreate 发布者&lt;br&gt;BlockingMonoSubscriber 订阅者&lt;br&gt;用于阻塞等待Bind操作完成&lt;br&gt;&lt;/b&gt;&lt;br&gt;代码提取到单元测试了，参考：&lt;br&gt;java-async/async-reactive/&lt;br&gt;BlockingMonoSubscriberTest#&lt;br&gt;testWebFluxBindMono()&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2599.5" y="1995" width="210" height="140" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-1" target="u_z_PSljN5TfgaHLhyht-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-1" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;startDaemonAwaitThread(&lt;br&gt;this.disposableServer);&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;font size=&quot;1&quot;&gt;启动一个&lt;b&gt;非守护线程&lt;/b&gt;阻塞等待&lt;br&gt;Netty服务器（HttpServer）&lt;/font&gt;&lt;span style=&quot;font-size: x-small; background-color: initial;&quot;&gt;关闭回调dispose()&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2161" y="2119" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-3" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;disposableServer&lt;br&gt;.onDispose().block();&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2399.5" y="2119" width="160.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-5" value="注册 SpringBoot 应用关闭的钩子&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;参考其他流程图&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1081" y="880" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-7" value="HttpTrafficHandler" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="480" y="1810" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-8" target="u_z_PSljN5TfgaHLhyht-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-8" value="通过 HAProxyMessageReader 获取请求来源地址，没有就从channel获取" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="680" y="1840" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="u_z_PSljN5TfgaHLhyht-10" target="u_z_PSljN5TfgaHLhyht-12" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="900" y="1981" />
              <mxPoint x="900" y="1931" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-21" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="u_z_PSljN5TfgaHLhyht-10" target="u_z_PSljN5TfgaHLhyht-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-10" value="支持两种请求协议（格式）" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="680" y="1951" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-24" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-12" target="u_z_PSljN5TfgaHLhyht-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-12" value="HttpRequest&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;HTTP，支持长连接、异步响应&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="920" y="1901" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-18" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;DecoderResultProvider&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;自定义协议&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="920" y="2000" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-22" value="&lt;div style=&quot;text-align: center; font-size: 10px;&quot;&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&lt;b&gt;HttpTrafficHandler&lt;/b&gt; extends ChannelDuplexHandler&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;implements Runnable, ChannelFutureListener&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot; size=&quot;1&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;请求处理器&lt;/font&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;final ConnectionObserver&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;listener;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;//是否是SSL请求&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;Boolean&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; secure;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;InetSocketAddress&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; remoteAddress;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;final boolean&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; readForwardHeaders;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;final BiPredicate&amp;lt;HttpServerRequest, HttpServerResponse&amp;gt; compress;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;final ServerCookieEncoder&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; cookieEncoder;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;final ServerCookieDecoder&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; cookieDecoder;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;//是否是长连接，这里制定true还不算还需要请求头中指定&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;boolean persistentConnection = true;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;//待返回响应的数量&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;int pendingResponses;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;Queue&amp;lt;Object&amp;gt; pipelined;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;ChannelHandlerContext ctx;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;boolean overflow;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;boolean nonInformationalResponse;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-520" y="2000" width="480" height="320" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-26" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-23" target="u_z_PSljN5TfgaHLhyht-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-23" value="更新状态：是否是长连接、待响应请求数量、是否溢出（待响应数量超过1就是溢出）" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1080" y="1901" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-28" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-25" target="u_z_PSljN5TfgaHLhyht-27" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-25" value="DecoderResult decoderResult = request.decoderResult();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;即使用Http解码器读取请求内容&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1080" y="1980" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-30" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-27" target="u_z_PSljN5TfgaHLhyht-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-32" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-27" target="u_z_PSljN5TfgaHLhyht-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-27" value="HttpServerOperations ops = new &lt;b&gt;HttpServerOperations&lt;/b&gt;(...);&lt;br&gt;ops.&lt;b&gt;bind&lt;/b&gt;();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;本质是连接，封装了HttpTrafficHandler的属性&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1080" y="2060" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-34" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-29" target="u_z_PSljN5TfgaHLhyht-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-29" value="listener.onStateChange(ops, ConnectionObserver.State.&lt;b&gt;CONFIGURED&lt;/b&gt;);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;调用 TcpServerBind$ChildObserver 监听方法&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1080" y="2139.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-43" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="u_z_PSljN5TfgaHLhyht-31" target="u_z_PSljN5TfgaHLhyht-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-31" value="&lt;div&gt;channel().&lt;b&gt;attr&lt;/b&gt;(&lt;br&gt;ReactorNetty.CONNECTION)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.set(this);&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;bind仅仅是将当前ops添加到属性，便于后面取&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1320" y="2060" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-36" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-33" target="u_z_PSljN5TfgaHLhyht-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-33" value="ctx.fireChannelRead(msg);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;交给pipeline中handler责任链下一个节点处理&lt;br&gt;即 ChannelOperationsHandler&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1080" y="2220" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-39" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-35" target="u_z_PSljN5TfgaHLhyht-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-35" value="invokeChannelRead(findContextInbound(&lt;br&gt;MASK_CHANNEL_READ), msg);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1320" y="2220" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-37" value="&lt;font color=&quot;#007fff&quot;&gt;此时Pipeline中的默认的处理器链表：&lt;br&gt;&lt;/font&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;pipeline = {DefaultChannelPipeline@6923}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;head = {&lt;b&gt;DefaultChannelPipeline$HeadContext&lt;/b&gt;@6922}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; next = {DefaultChannelHandlerContext@6918}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;handler = {&lt;b&gt;HttpServerCodec&lt;/b&gt;@6921}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;next = {DefaultChannelHandlerContext@6916}&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; handler = {&lt;b&gt;HttpTrafficHandler&lt;/b&gt;@6915}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; next = {DefaultChannelHandlerContext@6929}&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;handler = {&lt;b&gt;ChannelOperationsHandler&lt;/b&gt;@6964}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;next = {&lt;b&gt;DefaultChannelPipeline$TailContext&lt;/b&gt;@6930}&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; next = null&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;即 &lt;b&gt;HttpServerCodec&lt;/b&gt;&amp;nbsp;&amp;lt;-&amp;gt; &lt;b&gt;HttpTrafficHandler&lt;/b&gt;&amp;nbsp;&amp;lt;-&amp;gt; &lt;b&gt;ChannelOperationsHandler&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="240" y="1946" width="450" height="200" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-42" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-38" target="u_z_PSljN5TfgaHLhyht-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-38" value="&lt;b&gt;channelRead&lt;/b&gt;(ChannelHandlerContext ctx, Object msg)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1560" y="2220" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-40" value="ChannelOperationsHandler" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1575" y="2190" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-45" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-41" target="u_z_PSljN5TfgaHLhyht-44" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-41" value="ChannelOperations&amp;lt;?, ?&amp;gt; ops = ChannelOperations.get(ctx.channel());" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1800" y="2220" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-47" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-44" target="u_z_PSljN5TfgaHLhyht-46" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-44" value="ops.&lt;b&gt;onInboundNext&lt;/b&gt;(ctx, msg);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1800" y="2300" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-49" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-46" target="u_z_PSljN5TfgaHLhyht-48" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-46" value="listener().onStateChange(this, HttpServerState.REQUEST_RECEIVED);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2040" y="2300" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-51" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="u_z_PSljN5TfgaHLhyht-48" target="u_z_PSljN5TfgaHLhyht-50" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2260" y="2410" />
              <mxPoint x="2260" y="2450" />
              <mxPoint x="1060" y="2450" />
              <mxPoint x="1060" y="2520" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-48" value="&lt;b&gt;listener&lt;/b&gt;().onStateChange(this, HttpServerState.&lt;b&gt;REQUEST_RECEIVED&lt;/b&gt;);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;listener 即&amp;nbsp;TcpServerBind$ChildObserver&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2039.5" y="2380" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-53" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-50" target="u_z_PSljN5TfgaHLhyht-52" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-50" value="&lt;b&gt;TcpServerBind$ChildObserver&lt;/b&gt;#&lt;br&gt;&lt;b&gt;onStateChange&lt;/b&gt;(Connection connection, State newState)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;这个才是真正的请求处理器入口&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1080.5" y="2490" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-56" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-52" target="u_z_PSljN5TfgaHLhyht-55" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-52" value="&lt;b&gt;childObs&lt;/b&gt;.&lt;b&gt;onStateChange&lt;/b&gt;(connection, newState);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1320" y="2490" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-59" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-55" target="u_z_PSljN5TfgaHLhyht-58" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-61" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-55" target="u_z_PSljN5TfgaHLhyht-60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-55" value="&lt;div&gt;HttpServerOperations &lt;b&gt;ops&lt;/b&gt; = (HttpServerOperations) connection;&lt;/div&gt;&lt;div&gt;Mono.&lt;b&gt;fromDirect&lt;/b&gt;(&lt;b&gt;handler&lt;/b&gt;.apply(ops, ops))&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: initial;&quot;&gt;.&lt;b&gt;subscribe&lt;/b&gt;(ops.disposeSubscriber());&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;每个请求都会新建Mono做响应式处理&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="1560" y="2480" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-57" value="HttpServerHandle" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1600" y="2450" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-66" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-58" target="u_z_PSljN5TfgaHLhyht-65" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-58" value="&lt;div&gt;&lt;b&gt;ReactorHttpHandlerAdapter&lt;/b&gt;#apply()&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1800.5" y="2490" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-63" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-60" target="u_z_PSljN5TfgaHLhyht-62" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-60" value="&lt;div&gt;ops.disposeSubscriber()&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;指定订阅者&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1560" y="2800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-105" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-62" target="Y-guQ-IVwzbNjJsSQv7C-104" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-62" value="return this;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;this是ChannelOperations 类型&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1799.5" y="2800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-64" value="&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;关于Mono.fromDirect().subscribe()&lt;br&gt;原理，参考 ProjectReactor流程图&lt;br&gt;&lt;br&gt;&lt;div style=&quot;&quot;&gt;关于WebFlux响应式处理HTTP请求的大概流程&lt;br&gt;参考测试：HttpReactiveHandlerTest#testHandle()&amp;nbsp;&lt;/div&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1560" y="2560" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-68" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-65" target="u_z_PSljN5TfgaHLhyht-67" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-65" value="&lt;div&gt;ReactorServerHttpRequest request = new ReactorServerHttpRequest(reactorRequest, bufferFactory);&lt;/div&gt;&lt;div&gt;ServerHttpResponse response = new ReactorServerHttpResponse(reactorResponse, bufferFactory);&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2040" y="2485" width="240" height="70" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-70" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-67" target="u_z_PSljN5TfgaHLhyht-69" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-67" value="this.&lt;b&gt;httpHandler&lt;/b&gt;.&lt;b&gt;handle&lt;/b&gt;(request, response)&lt;br&gt;.doOnError(...)&lt;br&gt;.doOnSuccess(...)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;ReactiveWebServerApplicationContext$&lt;br&gt;ServerManager&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="2060" y="2580" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-73" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-69" target="u_z_PSljN5TfgaHLhyht-72" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-69" value="ServerWebExchange &lt;b&gt;exchange&lt;/b&gt; = createExchange(request, response);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;就是请求上下文&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=10;" parent="1" vertex="1">
          <mxGeometry x="2320" y="2580" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-71" value="&lt;b&gt;HttpWebHandlerAdapter&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2340" y="2550" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-81" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="u_z_PSljN5TfgaHLhyht-72" target="u_z_PSljN5TfgaHLhyht-80" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-72" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;return &lt;b&gt;getDelegate&lt;/b&gt;().&lt;b&gt;handle&lt;/b&gt;(exchange)&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;.doOnSuccess(aVoid -&amp;gt; logResponse(exchange))&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;.onErrorResume(ex -&amp;gt; handleUnresolvedError(exchange, ex))&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;.then(Mono.defer(response::&lt;b&gt;setComplete&lt;/b&gt;));&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;getDelegate()获取的是经过层层修饰后的&lt;b&gt;DispatcherHandler&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=6;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2320" y="2660" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-74" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;org.springframework.web.server.handler.&lt;/font&gt;&lt;span style=&quot;color: rgb(51, 0, 0); background-color: initial;&quot;&gt;&lt;b&gt;WebHandlerDecorator&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 11px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final WebHandler delegate;&lt;/font&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-1960" y="340" width="440" height="80" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-76" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;delegate&lt;/b&gt; = {ExceptionHandlingWebHandler@5696}&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;&lt;b&gt;exceptionHandlers&lt;/b&gt; = {Collections$UnmodifiableRandomAccessList@5746}&amp;nbsp; size = 3&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;delegate = {FilteringWebHandler@5691}&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &lt;b&gt;chain&lt;/b&gt; = {DefaultWebFilterChain@5748}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; delegate = {DispatcherHandler@5193}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;b&gt;handlerMappings&lt;/b&gt; = {Collections$UnmodifiableRandomAccessList@5203}&amp;nbsp; size = 3&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;b&gt;handlerAdapters&lt;/b&gt; = {ArrayList@5204}&amp;nbsp; size = 3&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;&amp;nbsp;&lt;/b&gt; &amp;nbsp;&lt;b&gt;resultHandlers&lt;/b&gt; = {ArrayList@5205}&amp;nbsp; size = 4&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1920.5" y="2660" width="400" height="110" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-77" value="&lt;font style=&quot;font-size: 8px;&quot; color=&quot;#007fff&quot;&gt;至此后面和SpringMVC的流程类似，只是接口是响应式的&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2321" y="2740" width="220" height="30" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-83" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-80" target="u_z_PSljN5TfgaHLhyht-82" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-85" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-80" target="u_z_PSljN5TfgaHLhyht-84" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-80" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;Mono&amp;lt;Void&amp;gt; completion;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;div&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;try {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; completion = super.&lt;b&gt;handle&lt;/b&gt;(exchange);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;} catch (Throwable ex) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; completion = Mono.error(ex);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=9;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="2560.5" y="2660" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-82" value="for this.&lt;b&gt;exceptionHandlers&lt;/b&gt;:&lt;br&gt;completion = completion.&lt;b&gt;onErrorResume&lt;/b&gt;(ex -&amp;gt; handler.handle(exchange, ex));&lt;br&gt;return completion;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;统一异常处理&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2541" y="2760" width="239" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-90" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-84" target="u_z_PSljN5TfgaHLhyht-89" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-84" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;return this.chain.filter(exchange);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=15;" parent="1" vertex="1">
          <mxGeometry x="2800" y="2670" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-87" value="ExceptionHandlingWebHandler" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2565.75" y="2630" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-88" value="FilteringWebHandler" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2835" y="2640" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-92" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-89" target="u_z_PSljN5TfgaHLhyht-91" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-95" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="u_z_PSljN5TfgaHLhyht-89" target="u_z_PSljN5TfgaHLhyht-93" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-89" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;div&gt;return Mono.&lt;b&gt;defer&lt;/b&gt;(() -&amp;gt;&lt;/div&gt;&lt;div&gt;this.currentFilter != null &amp;amp;&amp;amp; this.chain != null ?&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;invokeFilter&lt;/b&gt;(this.currentFilter, this.chain, exchange) :&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; this.handler.&lt;b&gt;handle&lt;/b&gt;(exchange));&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;过滤器不为空就执行过滤器逻辑，否则直接执行请求处理&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=15;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="3040" y="2670" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-91" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;执行过滤器逻辑&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;过滤器最后一个节点是handler&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="3338.75" y="2670" width="200.75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-105" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-93" target="u_z_PSljN5TfgaHLhyht-104" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-108" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-93" target="u_z_PSljN5TfgaHLhyht-106" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-111" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-93" target="u_z_PSljN5TfgaHLhyht-109" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-93" value="&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;div&gt;Flux.fromIterable(this.handlerMappings)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .concatMap(mapping -&amp;gt; mapping.&lt;b&gt;getHandler&lt;/b&gt;(&lt;b&gt;exchange&lt;/b&gt;))&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .next()&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .switchIfEmpty(createNotFoundError())&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .flatMap(handler -&amp;gt; &lt;b&gt;invokeHandler&lt;/b&gt;(exchange, handler))&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .flatMap(result -&amp;gt; &lt;b&gt;handleResult&lt;/b&gt;(exchange, result));&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;请求适配，请求处理器调用，响应处理&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=9;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="3319.25" y="2760" width="240.75" height="80" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-96" value="DispatcherHandler" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="3379.13" y="2730" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-97" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;&lt;b&gt;DefaultServerWebExchange&lt;/b&gt; implements ServerWebExchange&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot; size=&quot;1&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;就是请求上下文&lt;/font&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final ServerHttpRequest &lt;b style=&quot;&quot;&gt;request&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final ServerHttpResponse &lt;b&gt;response&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final Map&amp;lt;String, Object&amp;gt; &lt;b&gt;attributes&lt;/b&gt; = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final Mono&amp;lt;WebSession&amp;gt; &lt;b&gt;sessionMono&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final LocaleContextResolver &lt;b&gt;localeContextResolver&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final Mono&amp;lt;MultiValueMap&amp;lt;String, String&amp;gt;&amp;gt; &lt;b&gt;formDataMono&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final Mono&amp;lt;MultiValueMap&amp;lt;String, Part&amp;gt;&amp;gt; &lt;b&gt;multipartDataMono&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final ApplicationContext &lt;b&gt;applicationContext&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private volatile boolean notModified;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private Function&amp;lt;String, String&amp;gt; &lt;b&gt;urlTransformer&lt;/b&gt; = url -&amp;gt; url;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private Object logId;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private String logPrefix = &quot;&quot;;&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-1000" y="2000" width="440" height="320" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-113" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-104" target="u_z_PSljN5TfgaHLhyht-112" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-118" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="u_z_PSljN5TfgaHLhyht-104" target="u_z_PSljN5TfgaHLhyht-114" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-119" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="u_z_PSljN5TfgaHLhyht-104" target="u_z_PSljN5TfgaHLhyht-116" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3820" y="2800" />
              <mxPoint x="3820" y="2960" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-104" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;mapping.getHandler(exchange)&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;获取与请求匹配的处理器&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="3599.5" y="2770" width="200.75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-129" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-106" target="u_z_PSljN5TfgaHLhyht-128" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-134" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="u_z_PSljN5TfgaHLhyht-106" target="u_z_PSljN5TfgaHLhyht-130" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-135" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="u_z_PSljN5TfgaHLhyht-106" target="u_z_PSljN5TfgaHLhyht-132" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-106" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;invokeHandler(exchange, handler)&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;调用处理器处理请求&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="3599.5" y="3000" width="200.75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-46" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-109" target="Y-guQ-IVwzbNjJsSQv7C-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-53" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="u_z_PSljN5TfgaHLhyht-109" target="Y-guQ-IVwzbNjJsSQv7C-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-54" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="u_z_PSljN5TfgaHLhyht-109" target="Y-guQ-IVwzbNjJsSQv7C-49" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-55" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="u_z_PSljN5TfgaHLhyht-109" target="Y-guQ-IVwzbNjJsSQv7C-51" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-109" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;handleResult(exchange, result)&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;处理请求响应结果&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="3599.5" y="4160" width="200.75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-112" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;RouterFunctionMapping&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;匹配 RouterFunction 定义的Handler Bean&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="3840" y="2770" width="200.75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-121" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-114" target="u_z_PSljN5TfgaHLhyht-120" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-114" value="&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;RequestMappingHandlerMapping&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;匹配@RequestMapping及其子注解，如：&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;@GetMapping(&quot;/list&quot;)&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;主要分析这个的实现&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="3840" y="2850" width="200.75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-116" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;SimpleUrlHandlerMapping&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="3839.25" y="2930" width="200.75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-125" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-120" target="u_z_PSljN5TfgaHLhyht-124" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="5zkAXpEHr8CIqhBs2lp0-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-120" target="5zkAXpEHr8CIqhBs2lp0-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-120" value="&lt;div style=&quot;&quot;&gt;handlerMethod = &lt;b&gt;lookupHandlerMethod&lt;/b&gt;(exchange);&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;通过exchange中的请求信息与mappingRegistry中注册的RequestMappingInfo匹配，找到对应的HandlerMethod, 即 request -&amp;gt; mappingLookup -&amp;gt;&amp;nbsp; HandlerMethod&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="4080" y="2850" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-122" value="AbstractHandlerMethodMapping" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="4100" y="2820" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-123" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px;&quot;&gt;&lt;b&gt;lookupHandlerMethod&amp;nbsp;&lt;/b&gt;&lt;b style=&quot;&quot;&gt;匹配原理和SpringMVC实现基本相同，SpringMVC的流程图中已经讲过了，这里不重复了，匹配条件包括：请求类型method（POST\GET\...）、路由pattern、参数、请求头、consumes、produce、自定义匹配条件。&lt;/b&gt;&lt;br&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;this = {RequestMappingHandlerMapping@6325}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;b&gt;exchange&lt;/b&gt; = {DefaultServerWebExchange@6546}&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp;&lt;b&gt;request&lt;/b&gt; = {ReactorServerHttpRequest@6721}&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &lt;b&gt;request&lt;/b&gt; = {HttpServerOperations@6564}&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;b&gt;nettyRequest&lt;/b&gt; = {DefaultHttpRequest@6774}&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;method&lt;/b&gt; = {HttpMethod@6782} &quot;GET&quot;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;uri&lt;/b&gt; = &quot;/users/list&quot;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; version = {HttpVersion@6784} &quot;HTTP/1.1&quot;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;headers&lt;/b&gt; = {DefaultHttpHeaders@6785}&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; decoderResult = {DecoderResult@6786} &quot;success&quot;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp;connectionInfo = {ConnectionInfo@6775}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp;cookieEncoder = {ServerCookieEncoder@6231}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp;cookieDecoder = {ServerCookieDecoder@6232}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp;connection = {ReactorNetty$SimpleConnection@6776} &quot;SimpleConnection{channel=[id: 0x9a89de94, L:/127.0.0.1:8080 - R:/127.0.0.1:59574]}&quot;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp;inbound = {FluxReceive@6777} &quot;FluxReceive{receiverQueueSize=0, inboundDone=false,inboundError=null}&quot;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp;listener = {TcpServerBind$ChildObserver@6230}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp;...&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; bufferFactory = {NettyDataBufferFactory@6753} &quot;NettyDataBufferFactory (PooledByteBufAllocator(directByDefault: true))&quot;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; uri = {URI@6755} &quot;http://localhost:8080/users/list&quot;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; path = {DefaultRequestPath@6756} &quot;/users/list&quot;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &lt;b&gt;headers&lt;/b&gt; = {ReadOnlyHttpHeaders@6757}&amp;nbsp; size = 6&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &lt;b&gt;queryParams&lt;/b&gt; = null&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; cookies = null&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; sslInfo = null&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;id = &quot;9a89de94&quot;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;...&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;this.&lt;b&gt;mappingRegistry&lt;/b&gt; = {AbstractHandlerMethodMapping$MappingRegistry@6680}&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp;&lt;b&gt;registry&lt;/b&gt; = {HashMap@6691}&amp;nbsp; size = 7&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; {RequestMappingInfo@6709} &quot;{GET /users/list}&quot; -&amp;gt; {AbstractHandlerMethodMapping$MappingRegistration@6710}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;b&gt;key&lt;/b&gt; = {RequestMappingInfo@6709} &quot;{GET /users/list}&quot;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;b&gt;value&lt;/b&gt; = {AbstractHandlerMethodMapping$MappingRegistration@6710}&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; {RequestMappingInfo@6711} &quot;{GET /users/get}&quot; -&amp;gt; {AbstractHandlerMethodMapping$MappingRegistration@6712}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; {RequestMappingInfo@6713} &quot;{POST /users/delete}&quot; -&amp;gt; {AbstractHandlerMethodMapping$MappingRegistration@6714}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; {RequestMappingInfo@6715} &quot;{GET /users/v2/get}&quot; -&amp;gt; {AbstractHandlerMethodMapping$MappingRegistration@6716}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; {RequestMappingInfo@6717} &quot;{POST /users/add2}&quot; -&amp;gt; {AbstractHandlerMethodMapping$MappingRegistration@6718}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp;&lt;b&gt;mappingLookup&lt;/b&gt; = {LinkedHashMap@6692}&amp;nbsp; size = 7&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; {RequestMappingInfo@6715} &quot;{GET /users/v2/get}&quot; -&amp;gt; {&lt;b&gt;HandlerMethod&lt;/b&gt;@6745} &quot;cn.iocoder.springboot.lab27.springwebflux.controller.&lt;b&gt;UserController&lt;/b&gt;#&lt;b&gt;get2&lt;/b&gt;(Integer)&quot;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; {RequestMappingInfo@6717} &quot;{POST /users/add2}&quot; -&amp;gt; {HandlerMethod@6746} &quot;cn.iocoder.springboot.lab27.springwebflux.controller.UserController#add2(Mono)&quot;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; {RequestMappingInfo@6707} &quot;{POST /users/add}&quot; -&amp;gt; {HandlerMethod@6747} &quot;cn.iocoder.springboot.lab27.springwebflux.controller.UserController#add(Publisher)&quot;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; {RequestMappingInfo@6711} &quot;{GET /users/get}&quot; -&amp;gt; {HandlerMethod@6748} &quot;cn.iocoder.springboot.lab27.springwebflux.controller.UserController#get(Integer)&quot;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; {RequestMappingInfo@6705} &quot;{POST /users/update}&quot; -&amp;gt; {HandlerMethod@6749} &quot;cn.iocoder.springboot.lab27.springwebflux.controller.UserController#update(Publisher)&quot;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; {RequestMappingInfo@6713} &quot;{POST /users/delete}&quot; -&amp;gt; {HandlerMethod@6750} &quot;cn.iocoder.springboot.lab27.springwebflux.controller.UserController#delete(Integer)&quot;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; {RequestMappingInfo@6709} &quot;{GET /users/list}&quot; -&amp;gt; {HandlerMethod@6469} &quot;cn.iocoder.springboot.lab27.springwebflux.controller.UserController#list()&quot;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;...&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="4080" y="2375" width="620" height="450" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-124" value="&lt;div style=&quot;&quot;&gt;handlerMethod = handlerMethod.createWithResolvedBean();&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;上一步获取的handlerMethod内部初始只是存的bean名，第一次需要从spring容器获取对应的Bean&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="4080" y="2930" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-126" value="&lt;font color=&quot;#007fff&quot;&gt;即@RequetMapping注解的Bean第一次请求的时候才会实例化&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="4315" y="2945" width="350" height="30" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-128" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;HandlerFunctionAdapter&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="3840" y="3000" width="200.75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-137" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-130" target="u_z_PSljN5TfgaHLhyht-136" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-130" value="&lt;b&gt;RequestMappingHandlerAdapter&lt;/b&gt;&lt;br&gt;#handle(ServerWebExchange exchange, Object handler)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="3840" y="3080" width="200.75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-132" value="SimpleHandlerAdapter" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="3840" y="3160" width="200.75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-139" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-136" target="u_z_PSljN5TfgaHLhyht-138" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-146" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-136" target="u_z_PSljN5TfgaHLhyht-145" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-136" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;InitBinderBindingContext &lt;b&gt;bindingContext&lt;/b&gt; = new InitBinderBindingContext(&lt;/font&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;getWebBindingInitializer(), this.&lt;b&gt;methodResolver&lt;/b&gt;.&lt;b&gt;getInitBinderMethods&lt;/b&gt;(handlerMethod));&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4080" y="3080" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-141" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-138" target="u_z_PSljN5TfgaHLhyht-140" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-157" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-138" target="u_z_PSljN5TfgaHLhyht-156" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-138" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;InvocableHandlerMethod &lt;b&gt;invocableMethod&lt;/b&gt; = this.&lt;b&gt;methodResolver&lt;/b&gt;&lt;br&gt;.&lt;b&gt;getRequestMappingMethod&lt;/b&gt;(handlerMethod);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;给原来的HandlerMethod加上参数解析器等&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4080" y="3280" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-143" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-140" target="u_z_PSljN5TfgaHLhyht-142" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-140" value="&lt;div style=&quot;&quot;&gt;&lt;div&gt;Function&amp;lt;Throwable, Mono&amp;lt;HandlerResult&amp;gt;&amp;gt; &lt;b&gt;exceptionHandler&lt;/b&gt; =&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;ex -&amp;gt; handleException(ex, handlerMethod, bindingContext, exchange);&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;内部调用Controller Method中以及全局定义的异常处理器处理异常&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4080" y="3360" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-161" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-142" target="u_z_PSljN5TfgaHLhyht-160" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-142" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;div&gt;return this.modelInitializer&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .&lt;b&gt;initModel&lt;/b&gt;(handlerMethod, bindingContext, exchange)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .&lt;b&gt;then&lt;/b&gt;(Mono.defer(() -&amp;gt; invocableMethod.invoke(exchange, bindingContext)))&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .&lt;b&gt;doOnNext&lt;/b&gt;(result -&amp;gt; result.setExceptionHandler(exceptionHandler))&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .&lt;b&gt;doOnNext&lt;/b&gt;(result -&amp;gt; bindingContext.saveModel())&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .&lt;b&gt;onErrorResume&lt;/b&gt;(exceptionHandler);&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="4080" y="3460" width="240" height="100" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-150" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;endArrow=diamondThin;endFill=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="u_z_PSljN5TfgaHLhyht-144" target="u_z_PSljN5TfgaHLhyht-149" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-144" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;&lt;b&gt;RequestMappingHandlerAdapter&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot; size=&quot;1&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;@RequestMapping请求处理器的适配器&lt;br&gt;&lt;/font&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private List&amp;lt;HttpMessageReader&amp;lt;?&amp;gt;&amp;gt; &lt;b&gt;messageReaders&lt;/b&gt; = Collections.emptyList();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private WebBindingInitializer &lt;b&gt;webBindingInitializer&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private ArgumentResolverConfigurer &lt;b&gt;argumentResolverConfigurer&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private ReactiveAdapterRegistry &lt;b&gt;reactiveAdapterRegistry&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private ConfigurableApplicationContext &lt;b&gt;applicationContext&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//处理器方法解析器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private ControllerMethodResolver &lt;b&gt;methodResolver&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private ModelInitializer &lt;b style=&quot;&quot;&gt;modelInitializer&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-520" y="2360" width="480" height="200" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-152" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-145" target="u_z_PSljN5TfgaHLhyht-151" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-145" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;b&gt;getInitBinderMethods&lt;/b&gt;(handlerMethod)&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;解析InitBinder方法&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=13;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="4360" y="3080" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-147" value="ControllerMethodResolver" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="4380" y="3050" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-148" value="&lt;div style=&quot;text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;b style=&quot;&quot;&gt;InitBinderBindingContext&lt;/b&gt; extends BindingContext&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot; size=&quot;1&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;&lt;/font&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;请求处理器&lt;/font&gt;&lt;/font&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final List&amp;lt;SyncInvocableHandlerMethod&amp;gt; binderMethods;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final BindingContext binderMethodContext;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final SessionStatus sessionStatus = new SimpleSessionStatus();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private Runnable saveModelOperation;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//BindingContext&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final WebBindingInitializer initializer;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final Model model = new BindingAwareConcurrentModel();&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-520" y="2600" width="480" height="200" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-149" value="&lt;div style=&quot;text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;b style=&quot;&quot;&gt;ControllerMethodResolver&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot; size=&quot;1&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;&lt;/font&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;请求处理器&lt;/font&gt;&lt;/font&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//InitBinder 解析器，如@InitBinder注解解析&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final List&amp;lt;SyncHandlerMethodArgumentResolver&amp;gt; &lt;b&gt;initBinderResolvers&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final List&amp;lt;HandlerMethodArgumentResolver&amp;gt; modelAttributeResolvers;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final List&amp;lt;HandlerMethodArgumentResolver&amp;gt; requestMappingResolvers;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final List&amp;lt;HandlerMethodArgumentResolver&amp;gt; exceptionHandlerResolvers;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final ReactiveAdapterRegistry reactiveAdapterRegistry;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//InitBinder 解析结果缓存&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final Map&amp;lt;Class&amp;lt;?&amp;gt;, Set&amp;lt;Method&amp;gt;&amp;gt; &lt;b&gt;initBinderMethodCache&lt;/b&gt; = new ConcurrentHashMap&amp;lt;&amp;gt;(64);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final Map&amp;lt;Class&amp;lt;?&amp;gt;, Set&amp;lt;Method&amp;gt;&amp;gt; modelAttributeMethodCache = new ConcurrentHashMap&amp;lt;&amp;gt;(64);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final Map&amp;lt;Class&amp;lt;?&amp;gt;, ExceptionHandlerMethodResolver&amp;gt; exceptionHandlerCache = new ConcurrentHashMap&amp;lt;&amp;gt;(64);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final Map&amp;lt;ControllerAdviceBean, Set&amp;lt;Method&amp;gt;&amp;gt; initBinderAdviceCache = new LinkedHashMap&amp;lt;&amp;gt;(64);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final Map&amp;lt;ControllerAdviceBean, Set&amp;lt;Method&amp;gt;&amp;gt; modelAttributeAdviceCache = new LinkedHashMap&amp;lt;&amp;gt;(64);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final Map&amp;lt;ControllerAdviceBean, ExceptionHandlerMethodResolver&amp;gt; exceptionHandlerAdviceCache =&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; new LinkedHashMap&amp;lt;&amp;gt;(64);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;private final Map&amp;lt;Class&amp;lt;?&amp;gt;, SessionAttributesHandler&amp;gt; sessionAttributesHandlerCache = new ConcurrentHashMap&amp;lt;&amp;gt;(64);&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-1120" y="2600" width="560" height="280" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-154" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-151" target="u_z_PSljN5TfgaHLhyht-153" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-151" value="&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;div style=&quot;text-align: left;&quot;&gt;this.&lt;b&gt;initBinderAdviceCache&lt;/b&gt;.forEach((adviceBean, methods) -&amp;gt; {&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&amp;nbsp; &amp;nbsp; if (adviceBean.isApplicableToBeanType(handlerType)) {&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Object bean = adviceBean.resolveBean();&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; methods.forEach(method -&amp;gt; result.add(&lt;b&gt;getInitBinderMethod&lt;/b&gt;(bean, method)));&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;});&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;获取通过 &lt;b&gt;@ControllerAdvice&lt;/b&gt; 注册的全局InitBinder方法&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=6;" parent="1" vertex="1">
          <mxGeometry x="4600" y="3070" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-153" value="&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;div&gt;this.initBinderMethodCache.computeIfAbsent(handlerType,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; clazz -&amp;gt; MethodIntrospector.selectMethods(handlerType, INIT_BINDER_METHODS))&lt;/div&gt;&lt;div&gt;.forEach(method -&amp;gt; {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Object bean = handlerMethod.getBean();&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; result.add(&lt;b&gt;getInitBinderMethod&lt;/b&gt;(bean, method));&lt;/div&gt;&lt;div&gt;});&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;获取局部的 InitBinder方法(即Handler Bean中定义的InitBiner方法)&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=6;" parent="1" vertex="1">
          <mxGeometry x="4600" y="3170" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-155" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;这里可以看到 &lt;b style=&quot;&quot;&gt;@ControllerAdvice&lt;/b&gt;&lt;span style=&quot;&quot;&gt; 不仅可以注册全局的 &lt;/span&gt;&lt;b style=&quot;&quot;&gt;InitBinder&lt;/b&gt;&lt;span style=&quot;&quot;&gt; 方法，&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;&quot;&gt;还可以注册全局的&amp;nbsp;&lt;/span&gt;&lt;b style=&quot;&quot;&gt;ModelAttribute&lt;/b&gt;&lt;span style=&quot;&quot;&gt; 方法和&amp;nbsp;&lt;/span&gt;&lt;b style=&quot;&quot;&gt;ExceptionHandler&lt;/b&gt;&lt;span style=&quot;&quot;&gt; 方法&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;&quot;&gt;Map&amp;lt;ControllerAdviceBean, Set&amp;lt;Method&amp;gt;&amp;gt; initBinderAdviceCache&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=top;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="4840" y="3075" width="350" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-27" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="u_z_PSljN5TfgaHLhyht-156" target="Y-guQ-IVwzbNjJsSQv7C-19" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4480" y="3350" />
              <mxPoint x="4580" y="3350" />
              <mxPoint x="4580" y="3830" />
              <mxPoint x="4510" y="3830" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-156" value="&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;div&gt;InvocableHandlerMethod invocable = new InvocableHandlerMethod(handlerMethod);&lt;/div&gt;&lt;div&gt;invocable.setArgumentResolvers(this.&lt;b&gt;requestMappingResolvers&lt;/b&gt;);&lt;/div&gt;&lt;div&gt;invocable.setReactiveAdapterRegistry(this.&lt;b&gt;reactiveAdapterRegistry&lt;/b&gt;);&lt;/div&gt;&lt;div&gt;return invocable;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4360" y="3280" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-163" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-160" target="u_z_PSljN5TfgaHLhyht-162" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-20" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-160" target="Y-guQ-IVwzbNjJsSQv7C-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-160" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;this.modelInitializer&lt;span style=&quot;background-color: initial;&quot;&gt;.&lt;/span&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;initModel&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;(&lt;/span&gt;&lt;/div&gt;&lt;div&gt;handlerMethod, bindingContext, exchange)&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;由后面的得知主要就是调用@ModelAttribute和@SessionAttributes 方法，并将结果保存到Model对象&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="4360" y="3480" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="u_z_PSljN5TfgaHLhyht-162" target="Y-guQ-IVwzbNjJsSQv7C-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-16" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="u_z_PSljN5TfgaHLhyht-162" target="Y-guQ-IVwzbNjJsSQv7C-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u_z_PSljN5TfgaHLhyht-162" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;List&amp;lt;InvocableHandlerMethod&amp;gt; &lt;b&gt;modelMethods&lt;/b&gt; =&lt;/div&gt;&lt;div&gt;this.methodResolver&lt;/div&gt;&lt;div&gt;.&lt;span style=&quot;background-color: initial;&quot;&gt;getModelAttributeMethods(handlerMethod);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;解析获取全局（@ControllerAdvice ）以及局部定义的&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;@ModelAttribute 方法&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="4600" y="3480" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-1" value="&lt;font color=&quot;#007fff&quot; style=&quot;&quot;&gt;存储结构是外层是CHM, 内部是 LinkedHashMao$LinkedKeySet 集合&lt;br&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;Map&amp;lt;Class&amp;lt;?&amp;gt;, Set&amp;lt;Method&amp;gt;&amp;gt; initBinderMethodCache&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;Hander Class 类型 -&amp;gt; InitBinder 方法 Method对象的集合&amp;nbsp;&lt;/span&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="4840" y="3180" width="390" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-2" target="Y-guQ-IVwzbNjJsSQv7C-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-2" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;SessionAttributesHandler sessionAttributesHandler =&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;this.methodResolver&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;.getSessionAttributesHandler(handlerMethod);&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;font size=&quot;1&quot;&gt;同理获取 @&lt;/font&gt;&lt;font size=&quot;1&quot;&gt;SessionAttributes 方法&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="4600" y="3560" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-4" target="Y-guQ-IVwzbNjJsSQv7C-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-8" value="N" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="Y-guQ-IVwzbNjJsSQv7C-7" vertex="1" connectable="0">
          <mxGeometry x="-0.1932" relative="1" as="geometry">
            <mxPoint y="-12" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-12" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-4" target="Y-guQ-IVwzbNjJsSQv7C-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-13" value="Y" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="Y-guQ-IVwzbNjJsSQv7C-12" vertex="1" connectable="0">
          <mxGeometry x="0.153" y="1" relative="1" as="geometry">
            <mxPoint x="-1" y="-9" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-4" value="sessionAttributesHandler&lt;br&gt;.hasSessionAttributes()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;是否有带session属性&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4640" y="3690" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-15" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-6" target="Y-guQ-IVwzbNjJsSQv7C-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-6" value="return invokeModelAttributeMethods(&lt;br&gt;bindingContext, modelMethods, exchange);" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=8;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="4880" y="3650" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-9" value="return exchange.getSession()&lt;br&gt;.flatMap(...);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;暂略&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4880" y="3745" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-18" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-14" target="Y-guQ-IVwzbNjJsSQv7C-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-14" value="&lt;b&gt;modelMethods&lt;/b&gt;.forEach(invocable -&amp;gt; &lt;b&gt;resultList&lt;/b&gt;.add(invocable.&lt;b&gt;invoke&lt;/b&gt;(exchange, bindingContext)));" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=8;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="5180" y="3650" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-25" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-17" target="Y-guQ-IVwzbNjJsSQv7C-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-17" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;Mono.zip(resultList, objectArray -&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Arrays.stream(objectArray)&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .map(object -&amp;gt; &lt;b&gt;handleResult&lt;/b&gt;(((HandlerResult) object), bindingContext))&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .collect(Collectors.toList()))&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; .flatMap(Mono::when);&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;Mono.zip 用于聚合多个Mono的数据，这里就是聚合多个@ModelAttribute定义的方法的执行结果数据, Mono::when用于等待所有handleResult Mono结束&lt;/font&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=8;align=left;" parent="1" vertex="1">
          <mxGeometry x="5120" y="3730" width="320" height="90" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-29" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-19" target="Y-guQ-IVwzbNjJsSQv7C-28" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-19" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;Mono.defer(() -&amp;gt; &lt;b&gt;invocableMethod&lt;/b&gt;.invoke(&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;&lt;b&gt;exchange&lt;/b&gt;, &lt;b&gt;bindingContext&lt;/b&gt;))&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;调用Handler方法&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="4360" y="3840" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-21" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;bindingContext.&lt;b&gt;getModel&lt;/b&gt;()&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;.asMap().putIfAbsent(name, value);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;即将执行结果保存到了&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;InitBinderBindingContext 的&amp;nbsp;BindingAwareConcurrentModel 对象中&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=8;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="5480" y="3830" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-23" value="ModelInitializer" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="4670" y="3450" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-26" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-24" target="Y-guQ-IVwzbNjJsSQv7C-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-24" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;Object value = handlerResult.getReturnValue();&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;String name = getAttributeName(&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;handlerResult.getReturnTypeSource());&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=8;align=center;" parent="1" vertex="1">
          <mxGeometry x="5480" y="3745" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-31" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-28" target="Y-guQ-IVwzbNjJsSQv7C-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-28" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;getMethodArgumentValues(exchange, bindingContext, providedArgs)&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;1 参数解析，即将请求中的参数解析成Handler 方法需要的参数，返回Mono List&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="4600" y="3840" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-35" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-30" target="Y-guQ-IVwzbNjJsSQv7C-34" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-30" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;value = method.invoke(getBean(), args);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;2 反射调用Handler Method&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="4600" y="3920" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-39" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-34" target="Y-guQ-IVwzbNjJsSQv7C-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-43" value="Y" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="Y-guQ-IVwzbNjJsSQv7C-39" vertex="1" connectable="0">
          <mxGeometry x="0.1045" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-42" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-34" target="Y-guQ-IVwzbNjJsSQv7C-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-44" value="N" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="Y-guQ-IVwzbNjJsSQv7C-42" vertex="1" connectable="0">
          <mxGeometry x="0.1043" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-34" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;是否通过异步返回结果&lt;br&gt;或无返回值&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4640" y="4040" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-38" value="return (asyncVoid ? Mono.from(adapter.toPublisher(value)) : Mono.empty());&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;//TODO&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4840" y="4010" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-40" value="HandlerResult result = new HandlerResult(&lt;br&gt;this, value, returnType, bindingContext);&lt;br&gt;return &lt;b&gt;Mono&lt;/b&gt;.&lt;b&gt;just&lt;/b&gt;(result);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;3 返回结果响应式对象&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4840" y="4092" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-45" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;ResponseEntityResultHandler&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;/div&gt;&lt;font color=&quot;#007fff&quot; style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;处理返回值Class类型或泛型类型为&lt;b&gt;ResponseEntity&lt;/b&gt;、&lt;b&gt;PublisherEntity&lt;/b&gt;的结果，这些是Spring提供的返回值对象&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="3840" y="4160" width="200.75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-47" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;ServerResponseResultHandler&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;处理返回值Class类型为&lt;b&gt;ServerResponse&lt;/b&gt;的结果&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="3839.25" y="4240" width="200.75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-58" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-49" target="Y-guQ-IVwzbNjJsSQv7C-57" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-49" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;ResponseBodyResultHandler&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;处理Handler类注释有&lt;b&gt;ResponseBody&lt;/b&gt;注解的方法的返回结果&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="3840" y="4320" width="200.75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-51" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;ViewResolutionResultHandler&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;处理方法参数类型或泛型类型带有&lt;b&gt;ModelAttribute&lt;/b&gt;注解或者类型为 &lt;b&gt;CharSequence&lt;/b&gt;、&lt;b&gt;Rendering&lt;/b&gt;、&lt;b&gt;Model&lt;/b&gt;、&lt;b&gt;Map&lt;/b&gt;、&lt;b&gt;View&lt;/b&gt;、以及一些&lt;b&gt;简单类型&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="3840" y="4400" width="200.75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-56" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;private boolean isSupportedType(@Nullable Class&amp;lt;?&amp;gt; clazz) {&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; return (clazz != null &amp;amp;&amp;amp; ((HttpEntity.class.isAssignableFrom(clazz) &amp;amp;&amp;amp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; !RequestEntity.class.isAssignableFrom(clazz)) ||&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; HttpHeaders.class.isAssignableFrom(clazz)));&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;看其适配条件：需要是&lt;/font&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;HttpEntity的子类并且（不是RequestEntity的子类或者是HttpHeaders的子类），搜索源码只找到 ResponseEntity 和 PublisherEntity&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="4045" y="4150" width="630" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-61" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-57" target="Y-guQ-IVwzbNjJsSQv7C-60" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="4320.75" y="4350" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-99" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-57" target="Y-guQ-IVwzbNjJsSQv7C-98" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-57" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;div&gt;Object body = result.getReturnValue();&lt;/div&gt;&lt;div&gt;MethodParameter bodyTypeParameter = result.&lt;b&gt;getReturnTypeSource&lt;/b&gt;();&lt;/div&gt;&lt;div&gt;return &lt;b&gt;writeBody&lt;/b&gt;(body, bodyTypeParameter, exchange);&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4080" y="4320" width="200.75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-59" value="HandlerResultHandler 的四种实现" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="3840" y="4130" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-63" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-60" target="Y-guQ-IVwzbNjJsSQv7C-62" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-60" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;ReactiveAdapter adapter = getAdapterRegistry()&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;.getAdapter(bodyType.resolve(), body);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;bodyType 可能为Mono Flux Publisher CompletionStage&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4360" y="4320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-65" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-62" target="Y-guQ-IVwzbNjJsSQv7C-64" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-62" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;publisher = adapter.toPublisher(body);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;用响应数据创建一个FluxIterable发布者&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4360" y="4400" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-76" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-64" target="Y-guQ-IVwzbNjJsSQv7C-75" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-64" value="&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;for (HttpMessageWriter&amp;lt;?&amp;gt; writer : &lt;b&gt;getMessageWriters&lt;/b&gt;()) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (writer.&lt;b&gt;canWrite&lt;/b&gt;(actualElementType, bestMediaType)) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return writer.&lt;b&gt;write&lt;/b&gt;((Publisher) publisher, actualType, elementType,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; bestMediaType, exchange.getRequest(), exchange.&lt;b&gt;getResponse&lt;/b&gt;(),&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Hints.from(Hints.LOG_PREFIX_HINT, logPrefix));&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;根据媒体类型选择合适的HttpMessageWriter实现，使用此Write将数据写回Response对象&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4320" y="4480" width="280" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-70" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;此测试中用到 &lt;b&gt;Jackson2JsonEncoder&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="4880" y="4545" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-84" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-71" target="Y-guQ-IVwzbNjJsSQv7C-83" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-71" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;将Flux&amp;lt;UserVO&amp;gt;数据转成Flux&amp;lt;DataBuffer&amp;gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4880" y="4580" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-78" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-75" target="Y-guQ-IVwzbNjJsSQv7C-77" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-75" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;MediaType contentType = updateContentType(message, mediaType);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4640" y="4500" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-80" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-77" target="Y-guQ-IVwzbNjJsSQv7C-71" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-86" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-77" target="Y-guQ-IVwzbNjJsSQv7C-85" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-77" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;Flux&amp;lt;&lt;b&gt;DataBuffer&lt;/b&gt;&amp;gt; body = this.&lt;b&gt;encoder&lt;/b&gt;.&lt;b&gt;encode&lt;/b&gt;(&lt;span style=&quot;background-color: initial;&quot;&gt;inputStream, message.bufferFactory(), elementType, contentType, hints);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4640" y="4580" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-79" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;此测试中用到 &lt;b&gt;EncoderHttpMessageWriter&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="4640" y="4470" width="220" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-81" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;return message.writeAndFlushWith(&lt;/div&gt;&lt;div&gt;body.map(buffer -&amp;gt;&lt;/div&gt;&lt;div&gt;Mono.just(buffer).doOnDiscard(&lt;/div&gt;&lt;div&gt;PooledDataBuffer.class, PooledDataBuffer::release)));&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4880" y="4740" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-94" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-83" target="Y-guQ-IVwzbNjJsSQv7C-93" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-83" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;APPLICATION_STREAM_JSON = new &lt;b&gt;MediaType&lt;/b&gt;(&quot;application&quot;, &quot;stream+json&quot;);&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="5120" y="4580" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-88" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-85" target="Y-guQ-IVwzbNjJsSQv7C-81" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-90" value="Y" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="Y-guQ-IVwzbNjJsSQv7C-88" vertex="1" connectable="0">
          <mxGeometry x="0.0277" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-89" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-85" target="Y-guQ-IVwzbNjJsSQv7C-87" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-91" value="N" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="Y-guQ-IVwzbNjJsSQv7C-89" vertex="1" connectable="0">
          <mxGeometry x="0.0338" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-85" value="isStreamingMediaType(&lt;br&gt;contentType)" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4660" y="4770" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-96" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-87" target="Y-guQ-IVwzbNjJsSQv7C-95" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-87" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;return message.writeWith(body);&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;此处的message即exchange中的Response对象，返回 Mono&amp;lt;Void&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="4880" y="4820" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-92" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;MediaType&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="5185" y="4550" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-93" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;Flux.from(inputStream).collectList().map(&lt;/div&gt;&lt;div&gt;list -&amp;gt;&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;b&gt;encodeValue&lt;/b&gt;(list, bufferFactory,&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;listType, mimeType, hints, encoding))&lt;/div&gt;&lt;div&gt;.flux();&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="5120" y="4660" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-108" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-95" target="Y-guQ-IVwzbNjJsSQv7C-107" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-95" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;return new ChannelSendOperator&amp;lt;&amp;gt;(body,&amp;nbsp;&lt;/div&gt;&lt;div&gt;inner -&amp;gt; &lt;b&gt;doCommit&lt;/b&gt;(() -&amp;gt; &lt;b&gt;writeWithInternal&lt;/b&gt;(inner)))&lt;/div&gt;&lt;div&gt;.doOnError(t -&amp;gt; removeContentLength());&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;inner 是&amp;nbsp;Publisher&amp;lt;T&amp;gt; 对象&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="5120" y="4820" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-97" value="EncoderHttpMessageWriter" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="4895" y="4710" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-101" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-98" target="Y-guQ-IVwzbNjJsSQv7C-100" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-98" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;.checkpoint(&quot;Handler &quot; + result.getHandler() + &quot; [DispatcherHandler]&quot;)&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4080" y="4600" width="200.75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-100" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;&lt;b&gt;.onErrorResume&lt;/b&gt;(ex -&amp;gt;&amp;nbsp;&lt;br&gt;&lt;/font&gt;result.applyExceptionHandler(ex)&lt;/div&gt;&lt;div style=&quot;&quot;&gt;.flatMap(exResult -&amp;gt; {...}));&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4080" y="4680" width="200.75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-103" value="&lt;div style=&quot;text-align: center; font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;div&gt;&lt;b&gt;ChannelOperations&lt;/b&gt;&amp;lt;INBOUND extends NettyInbound, OUTBOUND extends NettyOutbound&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;implements NettyInbound, NettyOutbound, Connection, CoreSubscriber&amp;lt;Void&amp;gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot; size=&quot;1&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;既是&lt;b&gt;Inbound、OutBound (?)&lt;/b&gt;, 又是&lt;b&gt;Netty连接&lt;/b&gt;，又是&lt;/font&gt;&lt;/font&gt;&lt;b&gt;Subscriber&lt;/b&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;// Netty连接对象&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final Connection&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; connection;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;// InBound&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final FluxReceive&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;inbound;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final ConnectionObserver&amp;nbsp; listener;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final MonoProcessor&amp;lt;Void&amp;gt; onTerminate;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//&amp;nbsp;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;volatile Subscription outboundSubscription;&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-520" y="2960" width="480" height="200" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-104" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;public final void onSubscribe(Subscription s) {&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; if (Operators.&lt;b&gt;setOnce&lt;/b&gt;(OUTBOUND_CLOSE, this, s)) {&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; s.request(Long.MAX_VALUE);&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;即通过FieldUpdater只修改当前对象&amp;nbsp;Subscription outboundSubscription 字段一次，成功就触发Publisher发送&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;setOnce() 可以避免请求被重复处理&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=7;" parent="1" vertex="1">
          <mxGeometry x="2039.5" y="2780" width="240.5" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-106" value="AbstractServerHttpResponse" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="5130" y="4790" width="180" height="30" as="geometry" />
        </mxCell>
        <mxCell id="IVSfiaFSnUMNmgRAi2Nb-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Y-guQ-IVwzbNjJsSQv7C-107" target="IVSfiaFSnUMNmgRAi2Nb-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y-guQ-IVwzbNjJsSQv7C-107" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;return this.response.send(toByteBufs(publisher))&lt;br&gt;.then();&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="5360" y="4820" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="IVSfiaFSnUMNmgRAi2Nb-1" value="&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;定义了两种定义路由的方式&lt;br&gt;这里选择一种&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2405" y="1835" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="IVSfiaFSnUMNmgRAi2Nb-4" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;webflux提供了两种路由定义方式：&lt;br&gt;1 &lt;b&gt;ReactorHttpHandlerAdapter&lt;/b&gt;&lt;br&gt;2 &lt;b&gt;NettyRouteProvider&lt;/b&gt;&lt;br&gt;分别对应 reactor-netty handle() 方法和 &lt;br&gt;routes() 方法定义请求处理的方式&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2171" y="979" width="190" height="90" as="geometry" />
        </mxCell>
        <mxCell id="IVSfiaFSnUMNmgRAi2Nb-7" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;这里额外创建一个线程是因为主线程&lt;br&gt;后面还有很多事要处理，不能阻塞到这里，&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;用&lt;/font&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;非守护线程是避免主线程执行完毕退出后子线程也退出&lt;/font&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2159.5" y="2179" width="270" height="60" as="geometry" />
        </mxCell>
        <mxCell id="IVSfiaFSnUMNmgRAi2Nb-8" value="&lt;div style=&quot;text-align: center; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#330000&quot;&gt;&lt;b&gt;ReactorHttpHandlerAdapter&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: center; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 11px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;//请求处理的入口类，会调用到 HttpWebHandlerAdapter&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#330000&quot;&gt;private final HttpHandler &lt;b&gt;httpHandler&lt;/b&gt;;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 11px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-2320" y="440" width="320" height="100" as="geometry" />
        </mxCell>
        <mxCell id="IVSfiaFSnUMNmgRAi2Nb-9" value="ReactorServerHttpResponse" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="5370" y="4790" width="180" height="30" as="geometry" />
        </mxCell>
        <mxCell id="IVSfiaFSnUMNmgRAi2Nb-10" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;NettyOutbound send(Publisher&amp;lt;? extends ByteBuf&amp;gt; source)&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="5600" y="4820" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="IVSfiaFSnUMNmgRAi2Nb-12" value="HttpOperations" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="5630" y="4790" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="5zkAXpEHr8CIqhBs2lp0-1" value="&lt;div style=&quot;&quot;&gt;for mappings:&lt;/div&gt;&lt;div style=&quot;&quot;&gt;T match = getMatchingMapping(mapping, exchange);&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="4360" y="2850" width="240" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
