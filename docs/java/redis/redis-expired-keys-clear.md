# Redis Key过期策略

Redis 默认会同时开启**定期删除（主动删除）**和**惰性删除（被动删除）**; 

**定期删除**是在单独的线程中触发的，会定期扫描过期的key，默认每10秒从带过期时间的键集合中随机选择20个键，如果键已经过期则加入待删除队列，如果发现过期的键占比超过25%再扫描一批过期的key进行加入待删除队列，直到过期key比例下降到25%或者任务执行耗时超过了25ms；但是删除操作是通过删除命令执行的，而**删除命令还是在主线程中执行的**。 

> 定期删除之所以执行上面的少量多次地删除，主要是因为删除操作还是在主线程中执行的，为了防止阻塞客户端命令的执行。

**惰性删除**是在访问key的时候先进行过期检查，如果已经过期则删除键并立即释放内存。



## Redis 定期删除实现原理

暂时参考[Redis的定期删除与主线程有并发问题吗](https://zhuanlan.zhihu.com/p/636586910) 这篇文章吧，里面的图画的不错。

> TODO：有空自己再梳理一遍源码流程。

