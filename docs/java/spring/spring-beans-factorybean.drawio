<mxfile host="Electron" modified="2024-01-02T14:13:15.518Z" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/21.6.5 Chrome/114.0.5735.243 Electron/25.3.1 Safari/537.36" etag="-44Fe5N4gdyymhZ0CMuH" version="21.6.5" type="device">
  <diagram name="第 1 页" id="CV3swc8oUeR03U3lH2sZ">
    <mxGraphModel dx="2716" dy="651" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="w4FkYv5Shg38tEnAdtc6-482" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.1;entryY=0.5;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;entryPerimeter=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-479" target="w4FkYv5Shg38tEnAdtc6-540">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1830" y="1630" />
              <mxPoint x="1830" y="660" />
              <mxPoint x="1740" y="660" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-455" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.1;entryY=0.5;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;entryPerimeter=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-453" target="w4FkYv5Shg38tEnAdtc6-540">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2550" y="2200" />
              <mxPoint x="2550" y="660" />
              <mxPoint x="1740" y="660" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-2" target="w4FkYv5Shg38tEnAdtc6-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-2" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;doGetBean&lt;/b&gt;(name, null, null, false)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;这里只分析只传beanName的情况&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="440" y="120" width="159" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-3" value="&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;b&gt;AbstractBeanFactory&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#007FFF;" vertex="1" parent="1">
          <mxGeometry x="459.5" y="90" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-5" target="w4FkYv5Shg38tEnAdtc6-8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-5" value="&lt;span&gt;beanName = transformedBeanName(name)&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;如果name是&quot;&amp;amp;某工厂Bean名称“, 去掉前面的&quot;&amp;amp;&quot;, 如果是别名，从aliasMap获取真实的名字&lt;/font&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="641" y="120" width="199" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-8" target="w4FkYv5Shg38tEnAdtc6-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-8" target="w4FkYv5Shg38tEnAdtc6-14">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-8" value="&lt;font&gt;Object sharedInstance = getSingleton(beanName);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;按beanName尝试先从singleObject获取&lt;br&gt;DEMO此步骤获取的CarFactoryBean这个工厂Bean实例&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="640" y="200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-216" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-10" target="w4FkYv5Shg38tEnAdtc6-215">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-10" value="&lt;font&gt;return getSingleton(beanName, true);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;true 参数表示正在创建的Bean可以提前暴露&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="880" y="200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-11" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;Y&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-14" target="w4FkYv5Shg38tEnAdtc6-16">
          <mxGeometry x="-0.1429" relative="1" as="geometry">
            <mxPoint x="921" y="819" as="targetPoint" />
            <Array as="points">
              <mxPoint x="840" y="839" />
              <mxPoint x="840" y="750" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-14" target="w4FkYv5Shg38tEnAdtc6-22">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="740.0000000000005" y="1560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-290" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="w4FkYv5Shg38tEnAdtc6-13">
          <mxGeometry x="-0.8859" y="4" relative="1" as="geometry">
            <mxPoint x="67" y="20" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-293" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-14" target="w4FkYv5Shg38tEnAdtc6-18">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="840" y="839" />
              <mxPoint x="840" y="950" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-294" value="N" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="w4FkYv5Shg38tEnAdtc6-293">
          <mxGeometry x="-0.1399" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-14" value="&lt;font style=&quot;font-size: 8px&quot;&gt;sharedInstance != null &lt;br&gt;&amp;amp;&amp;amp; args == null&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;args指构造方法传参&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="660" y="809" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-237" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-16" target="w4FkYv5Shg38tEnAdtc6-236">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-16" value="&lt;font&gt;bean = &lt;b&gt;getObjectForBeanInstance&lt;/b&gt;(&lt;br&gt;sharedInstance, name, beanName, null)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;如果sharedInstance是FactoryBean就调用工厂方法创建Bean并返回，如果不是工厂Bean就直接返回sharedInstance&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="880" y="720" width="201" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-17" value="&lt;font style=&quot;font-size: 8px&quot;&gt;没有parentBeanFactory&amp;nbsp;|| 当前beanFactory包含此Bean定义&lt;br&gt;&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontColor=#007FFF;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-18" target="w4FkYv5Shg38tEnAdtc6-65">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="945.0000000000005" y="979" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-18" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;BeanFactory parentBeanFactory = getParentBeanFactory();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;&quot;&gt;存在父BeanFactory&lt;/span&gt;&lt;span style=&quot;&quot;&gt;且当前BeanFactory没有此beanName指定的BeanDefinition, 就交给父BeanFactory创建&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="880" y="920" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-297" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-22" target="w4FkYv5Shg38tEnAdtc6-296">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-22" value="&lt;font&gt;return adaptBeanInstance(name, beanInstance, requiredType);&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="640" y="1781" width="200" height="59" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-23" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;下面这块逻辑主要是为了解决循环依赖：&lt;br&gt;&lt;br&gt;&lt;b&gt;singletonObjects&lt;/b&gt;：被称作一级缓存，存储&lt;b&gt;已经完成初始化&lt;/b&gt;的Bean&lt;br&gt;&lt;b&gt;earlySingletonObjects&lt;/b&gt;：被称作二级缓存，存储&lt;b&gt;已经实例化但未完成初始化且已经执行过单例工厂方法&lt;/b&gt;的Bean&lt;br&gt;&lt;b&gt;singletonFactories&lt;/b&gt;： 被称作三级缓存，存储&lt;b&gt;已经实例化但未完成初始化&lt;/b&gt;的Bean的单例工厂&lt;br&gt;&lt;br&gt;&lt;b&gt;singletonsCurrentlyInCreation&lt;/b&gt;: 记录正在创建的Bean&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=8;fontColor=#007FFF;" vertex="1" parent="1">
          <mxGeometry x="1335" y="160" width="545" height="100" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-24" value="Y&lt;br&gt;Bean正在创建" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-26" target="w4FkYv5Shg38tEnAdtc6-28">
          <mxGeometry y="-10" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-25" value="N&lt;br&gt;两种情况：&lt;br&gt;1 Bean已经创建且初始化完成, 返回完整态Bean&lt;br&gt;2 Bean未创建且未正在创建, 返回null" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-26" target="w4FkYv5Shg38tEnAdtc6-30">
          <mxGeometry x="-0.7143" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1220" y="380" />
              <mxPoint x="1220" y="380" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-26" value="&lt;font style=&quot;font-size: 8px&quot;&gt;singletonObject == null &amp;amp;&amp;amp; &lt;br&gt;isSingletonCurrentlyInCreation(&lt;br&gt;beanName)&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="1120" y="280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-27" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-28" target="w4FkYv5Shg38tEnAdtc6-33">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-28" value="&lt;font style=&quot;font-size: 9px&quot;&gt;singletonObject = this.&lt;b&gt;earlySingletonObjects&lt;/b&gt;.get(beanName)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;测试DEMO中此容器并没有使用到，总是为空&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=16;" vertex="1" parent="1">
          <mxGeometry x="1400" y="280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-30" value="return singletonObject;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="1120" y="620" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-31" value="N&lt;br&gt;两种情况：&lt;br&gt;1 不允许提前暴露，返回null;&lt;br&gt;2&amp;nbsp;singletonObject 不为空，返回未初始化完成的Bean&lt;br&gt;（可能初始化了一部分）。" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-33" target="w4FkYv5Shg38tEnAdtc6-30">
          <mxGeometry x="-0.5417" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1500" y="560" />
              <mxPoint x="1220" y="560" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-32" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-33" target="w4FkYv5Shg38tEnAdtc6-35">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-223" value="Y" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="w4FkYv5Shg38tEnAdtc6-32">
          <mxGeometry x="-0.2333" y="3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-33" value="&lt;font style=&quot;font-size: 8px&quot;&gt;singletonObject == null &lt;br&gt;&amp;amp;&amp;amp; allowEarlyReference&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=16;" vertex="1" parent="1">
          <mxGeometry x="1420" y="360" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-525" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-35" target="w4FkYv5Shg38tEnAdtc6-524">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-35" value="&lt;font size=&quot;1&quot;&gt;ObjectFactory&amp;lt;?&amp;gt; singletonFactory = this.&lt;b&gt;singletonFactories&lt;/b&gt;.get(beanName)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;查看这个beanName的单例工厂Bean&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=16;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="1640" y="360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-36" value="Y" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-38" target="w4FkYv5Shg38tEnAdtc6-527">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-37" value="N, 返回null" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-38" target="w4FkYv5Shg38tEnAdtc6-30">
          <mxGeometry x="-0.9655" y="-10" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1740" y="580" />
              <mxPoint x="1220" y="580" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-38" value="singletonFactory != null" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="1680" y="500" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-39" value="返回通过三级别缓存单例工厂获取的bean" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-40" target="w4FkYv5Shg38tEnAdtc6-30">
          <mxGeometry x="-0.8271" y="-10" relative="1" as="geometry">
            <mxPoint as="offset" />
            <Array as="points">
              <mxPoint x="1980" y="600" />
              <mxPoint x="1220" y="600" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-523" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-40" target="w4FkYv5Shg38tEnAdtc6-28">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-40" value="&lt;div style=&quot;font-size: 9px&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;this.&lt;/span&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;earlySingletonObjects&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;.put(beanName, singletonObject);&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&gt;&lt;font size=&quot;1&quot;&gt;this.&lt;b&gt;singletonFactories&lt;/b&gt;.remove(beanName)&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;使用三级缓存的早期包装对象创建的纯洁态的bean并存入二级缓存&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=16;align=left;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1880" y="500" width="200" height="70" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-45" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;参考官网：3.5. Spring Type Conversion&lt;br&gt;类型转换的使用案例：https://www.jianshu.com/p/0a484d887b75&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#007FFF;" vertex="1" parent="1">
          <mxGeometry x="1085" y="1790.5" width="280" height="40" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-46" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;2 上一步结果：&lt;br&gt;&lt;b&gt;1）sharedInstance 不为空（Bean实例已经创建或正在创建）&lt;br&gt;&lt;/b&gt;&lt;span style=&quot;&quot;&gt;1.1）完整态Bean &lt;/span&gt;&lt;br&gt;&lt;span style=&quot;&quot;&gt;注意：可能是FactoryBean所以需要额外处理；&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;&quot;&gt;1.2）两种半成品Bean&lt;/span&gt;&lt;br&gt;&lt;b&gt;&lt;span style=&quot;&quot;&gt;2）&lt;/span&gt;sharedInstance 为空（Bean实例还未创建）&lt;br&gt;&lt;/b&gt;&lt;span style=&quot;&quot;&gt;DEMO获取的CarFactoryBean这个工厂Bean实例&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=8;fontColor=#007FFF;" vertex="1" parent="1">
          <mxGeometry x="440" y="783.25" width="220" height="121.5" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-47" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-48" target="w4FkYv5Shg38tEnAdtc6-51">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="960" y="1150" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-48" value="&lt;font&gt;RootBeanDefinition mbd = getMergedLocalBeanDefinition(beanName);&lt;br&gt;&lt;div&gt;dependsOn = mbd.getDependsOn();&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;查询Bean依赖的Bean&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="880" y="1101" width="200" height="59" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-49" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-51" target="w4FkYv5Shg38tEnAdtc6-55">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-301" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;然后再继续创建当前Bean&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="w4FkYv5Shg38tEnAdtc6-49">
          <mxGeometry x="-0.7349" y="-1" relative="1" as="geometry">
            <mxPoint x="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-50" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-51" target="w4FkYv5Shg38tEnAdtc6-57">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-300" value="Y" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="w4FkYv5Shg38tEnAdtc6-50">
          <mxGeometry x="-0.281" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-51" value="dependsOn &lt;br&gt;!= null ?" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="920" y="1180" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-52" value="&lt;font color=&quot;#007fff&quot;&gt;单例&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-55" target="w4FkYv5Shg38tEnAdtc6-60">
          <mxGeometry x="0.5917" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1081" y="1550" />
              <mxPoint x="1081" y="1390" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-53" value="原型" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#007FFF;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-55" target="w4FkYv5Shg38tEnAdtc6-61">
          <mxGeometry x="0.5" y="10" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1060" y="1550" />
              <mxPoint x="1060" y="1550" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-54" value="其他(请求、会话)" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#007FFF;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-55" target="w4FkYv5Shg38tEnAdtc6-306">
          <mxGeometry x="0.4137" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1080" y="1550" />
              <mxPoint x="1080" y="1711" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-55" value="按Bean作用域创建" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="920" y="1520" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-57" value="&lt;font&gt;for (String dep : dependsOn)：&lt;br&gt;&lt;div&gt;registerDependentBean(dep, beanName);&lt;/div&gt;&lt;div&gt;&lt;b&gt;getBean&lt;/b&gt;(dep);&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;需要先创建依赖的Bean实例，如果依赖的Bean还依赖其他Bean,就先创建依赖的其他Bean&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="1120" y="1180" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-58" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-60" target="w4FkYv5Shg38tEnAdtc6-72">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-59" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-60" target="w4FkYv5Shg38tEnAdtc6-446">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-60" value="&lt;font&gt;sharedInstance = getSingleton(beanName, () -&amp;gt; {...});&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;先查询一级缓存singletonObjects是否已经存在此Bean,是直接返回，否则通过Lambda表达式（singletonFactory）创建&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="1120" y="1360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-305" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-61" target="w4FkYv5Shg38tEnAdtc6-76">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1330" y="1550" />
              <mxPoint x="1330" y="1670" />
              <mxPoint x="1580" y="1670" />
              <mxPoint x="1580" y="1469" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-307" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-61" target="w4FkYv5Shg38tEnAdtc6-62">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-61" value="&lt;font&gt;beforePrototypeCreation(beanName);&lt;br&gt;prototypeInstance = &lt;b&gt;createBean&lt;/b&gt;(beanName, mbd, args);&lt;br&gt;afterPrototypeCreation(beanName);&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="1120" y="1520" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-308" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-62" target="w4FkYv5Shg38tEnAdtc6-236">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1340" y="1630" />
              <mxPoint x="1340" y="880" />
              <mxPoint x="1100" y="880" />
              <mxPoint x="1100" y="765" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-62" value="&lt;font&gt;beanInstance = getObjectForBeanInstance(&lt;br&gt;prototypeInstance, name, beanName, mbd);&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="1120" y="1599" width="200" height="61" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-63" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-65" target="w4FkYv5Shg38tEnAdtc6-66">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-64" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontColor=#007FFF;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-65" target="w4FkYv5Shg38tEnAdtc6-48">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-65" value="&lt;font&gt;markBeanAsCreated(beanName)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;记录下beanName防止重复创建&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="880" y="1020" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-66" value="&lt;font&gt;&lt;div&gt;synchronized (&lt;/div&gt;&lt;div&gt;this.mergedBeanDefinitions)：&amp;nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;clearMergedBeanDefinition(beanName);&lt;/div&gt;&lt;div&gt;this.&lt;b&gt;alreadyCreated&lt;/b&gt;.add(beanName);&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1120" y="1020" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-67" value="交给父BeanFactory处理和下面流程一样" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#007FFF;" vertex="1" parent="1">
          <mxGeometry x="1085" y="939" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-304" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-72" target="w4FkYv5Shg38tEnAdtc6-236">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1340" y="1470" />
              <mxPoint x="1340" y="880" />
              <mxPoint x="1100" y="880" />
              <mxPoint x="1100" y="765" />
              <mxPoint x="1120" y="765" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-72" value="&lt;font&gt;getObjectForBeanInstance(sharedInstance, name, beanName, mbd)&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="1120" y="1440" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-73" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-74" target="w4FkYv5Shg38tEnAdtc6-76">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-449" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-74" target="w4FkYv5Shg38tEnAdtc6-447">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-74" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;singletonObject = &lt;/font&gt;&lt;b style=&quot;font-size: 9px;&quot;&gt;singletonFactory&lt;/b&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;.&lt;/font&gt;&lt;b style=&quot;font-size: 9px;&quot;&gt;getObject&lt;/b&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;();&lt;/font&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;newSingleton = true;&lt;/font&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;singletonFactory是前面的Lambda表达式&lt;/font&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;arcSize=8;" vertex="1" parent="1">
          <mxGeometry x="1360" y="1439" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-310" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-76" target="w4FkYv5Shg38tEnAdtc6-431">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1840" y="1390" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1820" y="1469" />
              <mxPoint x="1820" y="1390" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-76" value="&lt;font&gt;return &lt;b&gt;createBean&lt;/b&gt;(beanName, mbd, args);&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="1600" y="1439" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-189" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;先尝试从singletonObjects查，不为空或者正在创建中，直接返回；&lt;br&gt;否则尝试从earlySingletonObjects查，不为空&lt;br&gt;或者为空但是allowEarlyReference 且 singletonFactories包含&lt;br&gt;此beanName的原始对象就通过原始对象创建，&lt;br&gt;并存入earlySingletonObjects&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=top;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="860" y="260" width="320" height="90" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-190" value="&lt;h1 style=&quot;font-size: 18px&quot;&gt;&lt;font style=&quot;font-size: 18px&quot;&gt;Spring FactoryBean 工作原理（5.3.29）&lt;/font&gt;&lt;/h1&gt;&lt;div&gt;Spring IOC完整流程参考 spring-context.drawio 流程，这里从FactoryBean角度看FactoryBean创建Bean的原理。版本虽然不一样，但是差别不大。&lt;/div&gt;&lt;div&gt;顺便把循环依赖的处理重新梳理下。&lt;/div&gt;&lt;p&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="40" y="10" width="760" height="80" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-195" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-191" target="w4FkYv5Shg38tEnAdtc6-194">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-191" value="前置流程参考&lt;br&gt;spring-context.drawio" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="40" y="120" width="159" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-196" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-194" target="w4FkYv5Shg38tEnAdtc6-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-197" value="..." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="w4FkYv5Shg38tEnAdtc6-196">
          <mxGeometry x="-0.1289" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-194" value="&lt;font style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;Object aCar = context&lt;br&gt;.getBean(&quot;carFactoryBean&quot;);&lt;/font&gt;&lt;br&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;carFacotryBean是CarFactoryBean实例的名字，这里是指通过CarFactoryBean获取Car Bean实例&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="240" y="120" width="159" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-206" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;SimpleAliasRegistry &lt;/b&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;Bean别名CHM容器&lt;/font&gt;&lt;/font&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;//CHM别名容器, 为何用CHM?&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final Map&amp;lt;String, String&amp;gt; &lt;b style=&quot;font-size: 10px;&quot;&gt;aliasMap&lt;/b&gt; = new ConcurrentHashMap(16);&lt;/font&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;//比较重要的方法&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;public void registerAlias(String name, String alias)&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;public String canonicalName(String name)&lt;/font&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="-980" y="140" width="360" height="120" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-210" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-207" target="w4FkYv5Shg38tEnAdtc6-206">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-207" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;DefaultSingletonBeanRegistry&lt;/b&gt; &lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;单例Bean容器&lt;/font&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private static final int SUPPRESSED_EXCEPTIONS_LIMIT = 100;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;// 保存已经完成初始化的单例Bean对象&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final Map&amp;lt;String, Object&amp;gt; &lt;b style=&quot;font-size: 10px;&quot;&gt;singletonObjects&lt;/b&gt; = new &lt;b&gt;ConcurrentHashMap&lt;/b&gt;(256);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//&amp;nbsp;&lt;/font&gt;存储已经实例化但未初始化的Bean的单例工厂&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final Map&amp;lt;String, ObjectFactory&amp;lt;?&amp;gt;&amp;gt; &lt;b style=&quot;font-size: 10px;&quot;&gt;singletonFactories&lt;/b&gt; = new &lt;b&gt;HashMap&lt;/b&gt;(16);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;// 保存&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;已经实例化但未初始化且已经执行过单例工厂方法的单例Bean对象&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final Map&amp;lt;String, Object&amp;gt; &lt;b style=&quot;font-size: 10px;&quot;&gt;earlySingletonObjects&lt;/b&gt; = new &lt;b&gt;ConcurrentHashMap&lt;/b&gt;(16);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final Set&amp;lt;String&amp;gt; &lt;b style=&quot;font-size: 10px;&quot;&gt;registeredSingletons&lt;/b&gt; = new LinkedHashSet(256);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;// 保存正在创建的Bean对象&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final Set&amp;lt;String&amp;gt; &lt;b style=&quot;font-size: 10px;&quot;&gt;singletonsCurrentlyInCreation&lt;/b&gt; = Collections.newSetFromMap(new ConcurrentHashMap(16));&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final Set&amp;lt;String&amp;gt; inCreationCheckExclusions = Collections.newSetFromMap(new ConcurrentHashMap(16));&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private Set&amp;lt;Exception&amp;gt; suppressedExceptions;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private boolean singletonsCurrentlyInDestruction = false;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final Map&amp;lt;String, Object&amp;gt; disposableBeans = new LinkedHashMap();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final Map&amp;lt;String, Set&amp;lt;String&amp;gt;&amp;gt; containedBeanMap = new ConcurrentHashMap(16);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;// 记录Bean依赖的Bean&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final Map&amp;lt;String, Set&amp;lt;String&amp;gt;&amp;gt; dependentBeanMap = new ConcurrentHashMap(64);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;// 记录Bean被依赖的Bean&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final Map&amp;lt;String, Set&amp;lt;String&amp;gt;&amp;gt; dependenciesForBeanMap = new ConcurrentHashMap(64);&lt;/font&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="-1080" y="300" width="560" height="260" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-211" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-208" target="w4FkYv5Shg38tEnAdtc6-207">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-208" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;FactoryBeanRegistrySupport&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//工厂Bean创建的单例对象缓存，注意不是工厂Bean的缓存，比如DEMO中这里缓存的是Car实例（需要设置工厂Bean为单例Bean工厂）&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;private final Map&amp;lt;String, Object&amp;gt; &lt;b&gt;factoryBeanObjectCache&lt;/b&gt; = new ConcurrentHashMap(16);&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="-1080" y="599" width="560" height="81" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-212" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-209" target="w4FkYv5Shg38tEnAdtc6-208">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-209" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;AbstractBeanFactory &lt;/b&gt;&lt;font style=&quot;&quot; color=&quot;#007fff&quot;&gt;所有BeanFactory实例都继承此类&lt;/font&gt;&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private BeanFactory parentBeanFactory;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private ClassLoader beanClassLoader = ClassUtils.getDefaultClassLoader();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private ClassLoader tempClassLoader;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private boolean cacheBeanMetadata = true;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private BeanExpressionResolver beanExpressionResolver;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private ConversionService conversionService;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final Set&amp;lt;PropertyEditorRegistrar&amp;gt; propertyEditorRegistrars = new LinkedHashSet(4);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final Map&amp;lt;Class&amp;lt;?&amp;gt;, Class&amp;lt;? extends PropertyEditor&amp;gt;&amp;gt; customEditors = new HashMap(4);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private TypeConverter typeConverter;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final List&amp;lt;StringValueResolver&amp;gt; embeddedValueResolvers = new CopyOnWriteArrayList();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final List&amp;lt;BeanPostProcessor&amp;gt; beanPostProcessors = new BeanPostProcessorCacheAwareList();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private BeanPostProcessorCache beanPostProcessorCache;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final Map&amp;lt;String, Scope&amp;gt; scopes = new LinkedHashMap(8);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private SecurityContextProvider securityContextProvider;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final Map&amp;lt;String, RootBeanDefinition&amp;gt; mergedBeanDefinitions = new ConcurrentHashMap(256);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;//已经创建的Bean的名字集合，为了防止并发重复创建Bean, 这里的Bean不一定已经创建完成，但是有创建的动作&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final Set&amp;lt;String&amp;gt; &lt;b&gt;alreadyCreated&lt;/b&gt; = Collections.newSetFromMap(new ConcurrentHashMap(256));&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final ThreadLocal&amp;lt;Object&amp;gt; prototypesCurrentlyInCreation = new NamedThreadLocal(&quot;Prototype beans currently in creation&quot;);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private ApplicationStartup applicationStartup;&lt;/font&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="-1080" y="719.5" width="560" height="280" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-213" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;DefaultSingletonBeanRegistry&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="895" y="170" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-217" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-215" target="w4FkYv5Shg38tEnAdtc6-26">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-215" value="&lt;font&gt;Object singletonObject = this.&lt;b&gt;singletonObjects&lt;/b&gt;.get(beanName)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;DEMO此步骤获取carFacotryBean工厂Bean&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="1120" y="200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-221" value="说明：&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;ul style=&quot;font-size: 10px;&quot;&gt;&lt;li style=&quot;font-size: 10px;&quot;&gt;工厂Bean也是Bean, 也拥有和普通Bean一样的生命周期，Bean实例也会被保存到各个List、Map容器&lt;/li&gt;&lt;/ul&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="880" y="10" width="560" height="120" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-224" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;CarFactoryBean实例在应用上下文初始化阶段被创建&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="240" y="180" width="260" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-244" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-226" target="w4FkYv5Shg38tEnAdtc6-243">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-245" value="Y" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="w4FkYv5Shg38tEnAdtc6-244">
          <mxGeometry x="-0.2375" y="-3" relative="1" as="geometry">
            <mxPoint x="9" y="-3" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-248" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-226" target="w4FkYv5Shg38tEnAdtc6-247">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-249" value="N" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="w4FkYv5Shg38tEnAdtc6-248">
          <mxGeometry x="-0.225" y="3" relative="1" as="geometry">
            <mxPoint x="-3" y="5" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-226" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;BeanFactoryUtils&lt;br&gt;.isFactoryDereference(name)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;即判断name是否是工厂Bean&lt;br&gt;的名称&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="1400" y="799" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-229" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-228" target="w4FkYv5Shg38tEnAdtc6-209">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-228" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;AbstractAutowireCapableBeanFactory&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private InstantiationStrategy instantiationStrategy;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ParameterNameDiscoverer parameterNameDiscoverer;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private boolean allowCircularReferences;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private boolean allowRawInjectionDespiteWrapping;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Set&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt; ignoredDependencyTypes;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Set&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt; ignoredDependencyInterfaces;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final NamedThreadLocal&amp;lt;String&amp;gt; &lt;b&gt;currentlyCreatedBean&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConcurrentMap&amp;lt;String, BeanWrapper&amp;gt; factoryBeanInstanceCache;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConcurrentMap&amp;lt;Class&amp;lt;?&amp;gt;, Method[]&amp;gt; factoryMethodCandidateCache;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConcurrentMap&amp;lt;Class&amp;lt;?&amp;gt;, PropertyDescriptor[]&amp;gt; filteredPropertyDescriptorsCache;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="-1080" y="1041" width="560" height="180" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-230" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;AbstractApplicationContext&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String id = ObjectUtils.identityToString(this);&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String displayName = ObjectUtils.identityToString(this);&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ApplicationContext parent;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ConfigurableEnvironment environment;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final List&amp;lt;BeanFactoryPostProcessor&amp;gt; beanFactoryPostProcessors = new ArrayList&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private long startupDate;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final AtomicBoolean active = new AtomicBoolean();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final AtomicBoolean closed = new AtomicBoolean();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Object startupShutdownMonitor = new Object();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Thread shutdownHook;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ResourcePatternResolver resourcePatternResolver;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private LifecycleProcessor lifecycleProcessor;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private MessageSource messageSource;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ApplicationEventMulticaster applicationEventMulticaster;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Set&amp;lt;ApplicationListener&amp;lt;?&amp;gt;&amp;gt; applicationListeners = new LinkedHashSet&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Set&amp;lt;ApplicationListener&amp;lt;?&amp;gt;&amp;gt; earlyApplicationListeners;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Set&amp;lt;ApplicationEvent&amp;gt; earlyApplicationEvents;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="-480" y="660" width="440" height="240" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-233" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-231" target="w4FkYv5Shg38tEnAdtc6-230">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-231" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;GenericApplicationContext&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final &lt;b&gt;DefaultListableBeanFactory&lt;/b&gt; &lt;b&gt;beanFactory&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ResourceLoader resourceLoader;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private boolean customClassLoader;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final AtomicBoolean refreshed;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="-480" y="941" width="440" height="100" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-234" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-232" target="w4FkYv5Shg38tEnAdtc6-231">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-232" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;AnnotationConfigApplicationContext&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final AnnotatedBeanDefinitionReader reader;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ClassPathBeanDefinitionScanner scanner;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="-480" y="1081" width="440" height="80" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-235" value="AbstractAutowireCapableBeanFactory" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="1105" y="690" width="230" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-240" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-236" target="w4FkYv5Shg38tEnAdtc6-239">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-236" value="&lt;div&gt;String currentlyCreatedBean = (String)this.&lt;b&gt;currentlyCreatedBean&lt;/b&gt;.get();&lt;/div&gt;&lt;div&gt;if (currentlyCreatedBean != null)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; this.&lt;b&gt;registerDependentBean&lt;/b&gt;(beanName, currentlyCreatedBean);&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="1120" y="719.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-241" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-239" target="w4FkYv5Shg38tEnAdtc6-226">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-239" value="return super.getObjectForBeanInstance(&lt;br&gt;beanInstance, name, beanName, mbd);" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="1120" y="799" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-243" value="主要就是在 mbd 中记录此 BeanDefinition 是工厂Bean的定义，然后立即返回" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="1640" y="799" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-246" value="普通Bean(非FactoryBean)&lt;br&gt;立即返回" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="1640" y="899" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-250" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-247" target="w4FkYv5Shg38tEnAdtc6-246">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-251" value="Y" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="w4FkYv5Shg38tEnAdtc6-250">
          <mxGeometry x="-0.0292" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-253" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-247" target="w4FkYv5Shg38tEnAdtc6-252">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-254" value="N" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="w4FkYv5Shg38tEnAdtc6-253">
          <mxGeometry x="-0.122" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-247" value="&lt;font style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;!(beanInstance instanceof FactoryBean)&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="1400" y="899" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-258" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-252" target="w4FkYv5Shg38tEnAdtc6-257">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-252" value="最后一种情况就是通过FactoryBean实例创建&lt;br&gt;目标类型Bean实例&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;DEMO中是通过CarFactoryBean实例创建Car Bean实例&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="1380" y="1000" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-255" value="返回工厂Bean实例" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" vertex="1" parent="1">
          <mxGeometry x="1535" y="829" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-256" value="返回普通Bean实例" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" vertex="1" parent="1">
          <mxGeometry x="1535" y="932" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-262" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-257" target="w4FkYv5Shg38tEnAdtc6-261">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-264" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-257" target="w4FkYv5Shg38tEnAdtc6-265">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1740" y="1080" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-257" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;object = this.getCachedObjectForFactoryBean(&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;beanName);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;还是优先从factoryBeanObjectCache中查找&lt;b&gt;单例Bean&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="1640" y="1000" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-260" value="AbstractBeanFactory" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="1410" y="769" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-261" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;return this.&lt;b&gt;factoryBeanObjectCache&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;.get(beanName);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;注意这个缓存中存的是FactoryBean创建的单例Bean对象&lt;/font&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="1880" y="1000" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-269" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-265" target="w4FkYv5Shg38tEnAdtc6-268">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-265" value="&lt;font style=&quot;font-size: 8px;&quot;&gt;&lt;font size=&quot;1&quot;&gt;object == null&lt;br&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 8px;&quot; color=&quot;#007fff&quot;&gt;还没用FactoryBean创建单例Bean ||&amp;nbsp;FactoryBean实例不是单例工厂&lt;br&gt;都会导致从上面缓存中获取为空&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="1660" y="1080" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-271" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-268" target="w4FkYv5Shg38tEnAdtc6-270">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-268" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;FactoryBean&amp;lt;?&amp;gt; factory = (FactoryBean)beanInstance;&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;mbd = this.getMergedLocalBeanDefinition(&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;beanName);&lt;br&gt;&lt;/font&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="1880" y="1080" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-273" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-270" target="w4FkYv5Shg38tEnAdtc6-274">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2120" y="1190" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-270" value="&lt;div style=&quot;&quot;&gt;&lt;div&gt;boolean synthetic = (mbd != null &amp;amp;&amp;amp; mbd.isSynthetic());&lt;/div&gt;&lt;div&gt;object = &lt;b&gt;getObjectFromFactoryBean&lt;/b&gt;(&lt;br&gt;factory, beanName, !synthetic);&lt;/div&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1880" y="1160" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-276" value="Y" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-274" target="w4FkYv5Shg38tEnAdtc6-275">
          <mxGeometry x="-0.7895" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2220" y="1030" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-280" value="N" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-274" target="w4FkYv5Shg38tEnAdtc6-279">
          <mxGeometry x="-0.8519" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2220" y="1270" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-274" value="&lt;font style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;factory.isSingleton() &amp;amp;&amp;amp; &lt;br&gt;containsSingleton(beanName)&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="2140" y="1080" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-289" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-275" target="w4FkYv5Shg38tEnAdtc6-287">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-275" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;synchronized (getSingletonMutex()) {&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt; //获取的是&amp;nbsp;singletonObjects&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; Object object = this.&lt;b&gt;factoryBeanObjectCache&lt;/b&gt;.get(beanName);&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; if (object == null) {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;    &lt;/span&gt;&lt;/span&gt;//内部主要是调用FactoryBean实例的getObject()方法创建Bean&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; object = &lt;b&gt;doGetObjectFromFactoryBean&lt;/b&gt;(factory, beanName);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 9px;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;    &lt;/span&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;//这里为何又查一遍？&lt;/font&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;Object alreadyThere = this.&lt;/span&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;factoryBeanObjectCache&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;.get(beanName);&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (alreadyThere != null) {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; object = alreadyThere;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (shouldPostProcess) { &lt;font color=&quot;#007fff&quot;&gt;//后置处理&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (isSingletonCurrentlyInCreation(beanName)) {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // Temporarily return non-post-processed object, not storing it yet..&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return object;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;beforeSingletonCreation&lt;/b&gt;(beanName);&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; try {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; &amp;nbsp; //就是调用后置处理器，比如执行一些初始化等操作&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; object = &lt;b&gt;postProcessObjectFromFactoryBean&lt;/b&gt;(object, beanName);&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; catch (Throwable ex) {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; throw new BeanCreationException(...&lt;span style=&quot;background-color: initial;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; finally {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;afterSingletonCreation&lt;/b&gt;(beanName);&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (containsSingleton(beanName)) {&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; this.&lt;b&gt;factoryBeanObjectCache&lt;/b&gt;.put(beanName, object);&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; return object;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;}&lt;/div&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=2;align=left;" vertex="1" parent="1">
          <mxGeometry x="2360" y="840" width="320" height="380" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-278" value="&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;是&lt;b&gt;单例&lt;/b&gt;工厂Bean &amp;amp;&amp;amp;&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;此工厂Bean&lt;b&gt;已经初始化&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" vertex="1" parent="1">
          <mxGeometry x="2220" y="1035" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-286" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-279" target="w4FkYv5Shg38tEnAdtc6-285">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-288" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-279" target="w4FkYv5Shg38tEnAdtc6-287">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-279" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;Object object = &lt;b&gt;doGetObjectFromFactoryBean&lt;/b&gt;(factory, beanName);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;传beanName只是为了检查防止其他线程正在创建同名的Bean&lt;/font&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="2360" y="1240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-283" value="&lt;font color=&quot;#007fff&quot; style=&quot;&quot;&gt;Object alreadyThere = this.factoryBeanObjectCache.get(beanName);&lt;br&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;关于这里为何又查询一遍的思考&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;factoryBeanObjectCache 是私有成员，没有Getter方法（不会在其他类中对factoryBeanObjectCache进行增删改操作&lt;span style=&quot;font-size: 10px;&quot;&gt;），本类中唯一的put() 操作也是在&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;synchronized(singletonObjects) 同步控制下执行的；&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;不太可能因为其他线程的操作导致 alreadyThere != null;&amp;nbsp;&lt;br&gt;&lt;/span&gt;这里还有什么其他原因么？&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="2690" y="840" width="390" height="100" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-284" value="&lt;div style=&quot;font-size: 8px;&quot;&gt;即非单例工厂Bean&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" vertex="1" parent="1">
          <mxGeometry x="2230" y="1167.5" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-285" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;if (shouldPostProcess)&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;object = &lt;b&gt;postProcessObjectFromFactoryBean&lt;/b&gt;(&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;object, beanName);&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;后置处理，&lt;/font&gt;&lt;/div&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;就是调用后置处理器，比如执行一些初始化等操作&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="2360" y="1320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-287" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;object = factory.getObject();&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;通过工厂Bean创建目标Bean&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;这里省略了系统安全管理器忽略权限限制的代码&lt;/font&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="2720" y="1240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-291" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;sharedInstance不为空&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;不为空情况下有两种可能：&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;1. sharedInstance就是需要Bean&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;2. sharedInstance是创建需要的Bean&lt;/font&gt;&lt;span style=&quot;color: rgb(0, 127, 255); background-color: initial;&quot;&gt;的FactoryBean&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="860" y="779.5" width="250" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-295" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;sharedInstance为空&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;即之前没有创建Bean&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="860" y="880" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-296" value="&lt;font&gt;if (requiredType != null &amp;amp;&amp;amp; !requiredType.isInstance(bean))&lt;br&gt;Object convertedBean = getTypeConverter()&lt;br&gt;.convertIfNecessary(bean, requiredType);&lt;br&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;如果要求的返回类型不为空就转换下Bean的类型&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="881" y="1781" width="200" height="59" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-298" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;3 按要求的返回类型 requiredType &lt;br&gt;对 Bean实例进行类型转换&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=8;fontColor=#007FFF;" vertex="1" parent="1">
          <mxGeometry x="440" y="1780" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-299" value="&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;1 先尝试从singletonObjects查，因为要获取的Bean可能已经创建或正在被创建&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=8;fontColor=#007FFF;" vertex="1" parent="1">
          <mxGeometry x="440" y="200" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-303" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;beforeSingletonCreation afterSingletonCreation &lt;br&gt;是记录下创建状态，用于防止重复Bean重复创建&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="1360" y="1315" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-306" value="&lt;font&gt;暂略&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1120" y="1680" width="200" height="61" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-314" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-313" target="w4FkYv5Shg38tEnAdtc6-16">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-313" value="&lt;div&gt;&lt;b&gt;&lt;font color=&quot;#007fff&quot;&gt;FactoryBean 创建 Bean实例&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;font color=&quot;#007fff&quot;&gt;原理主要就是这块&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="900" y="650" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-316" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;即Bean正在创建&lt;br&gt;且允许提前暴露&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="1545" y="400" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-318" value="&lt;font color=&quot;#ea6b66&quot;&gt;TODO&amp;nbsp;&lt;br&gt;这里getDependsOn() 并不是所想的成员字段依赖&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="1085" y="1111" width="280" height="40" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-324" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-325" target="w4FkYv5Shg38tEnAdtc6-330">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-435" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-325" target="w4FkYv5Shg38tEnAdtc6-327">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-325" value="&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;Object bean = &lt;b&gt;resolveBeforeInstantiation&lt;/b&gt;(&lt;br&gt;beanName, mbdToUse);&lt;br&gt;&lt;/font&gt;if (bean != null) return bean;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;执行初始化前的后置处理器，&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;这一步可能创建代理Bean, 然后中断后续的创建流程&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="1840" y="1441" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-326" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-327" target="w4FkYv5Shg38tEnAdtc6-342">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-327" value="&lt;font&gt;Object &lt;b&gt;beanInstance&lt;/b&gt; = &lt;b&gt;doCreateBean&lt;/b&gt;(&lt;br&gt;beanName, mbdToUse, args);&lt;br&gt;return &lt;b&gt;beanInstance&lt;/b&gt;;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="1840" y="1680" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-328" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-330" target="w4FkYv5Shg38tEnAdtc6-332">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-329" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-330" target="w4FkYv5Shg38tEnAdtc6-333">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-330" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;bean = applyBeanPostProcessorsBeforeInstantiation(&lt;br&gt;targetType, beanName)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;这一步可能创建代理Bean，实际使用场景？&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="2080" y="1441" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-331" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-332" target="w4FkYv5Shg38tEnAdtc6-335">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-438" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-332" target="w4FkYv5Shg38tEnAdtc6-437">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-332" value="&lt;font&gt;if (bean != null):&amp;nbsp;&lt;br&gt;bean = applyBeanPostProcessorsAfterInitialization(&lt;br&gt;bean, beanName);&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="2080" y="1520" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-333" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;执行所有&lt;b&gt;InstantiationAwareBeanPostProcessor&lt;/b&gt;类型后置处理器的&amp;nbsp;&lt;b&gt;postProcessBeforeInstantiation&lt;/b&gt;(&lt;br&gt;beanClass, beanName) 方法&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2320" y="1441" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-334" value="&lt;div&gt;instantiationAware = {ArrayList@1972}&amp;nbsp; size = 3&lt;/div&gt;&lt;div&gt;&amp;nbsp;0 = {ConfigurationClassPostProcessor$ImportAwareBeanPostProcessor@1955}&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;1 = {CommonAnnotationBeanPostProcessor@1847}&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;2 = {AutowiredAnnotationBeanPostProcessor@1979}&amp;nbsp;&lt;/div&gt;&lt;div&gt;但是这几个后置处理器的&amp;nbsp;postProcessBeforeInstantiation() 都是null&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;以下是 InstantiationAwareBeanPostProcessor 接口的主要方法：&lt;/div&gt;&lt;div&gt;postProcessBeforeInstantiation: 在 bean 实例化之前调用，允许在实例化之前返回一个代理对象或者完全绕过实例化过程。&lt;/div&gt;&lt;div&gt;postProcessAfterInstantiation: 在 bean 实例化之后调用，允许对实例进行定制，例如为特定的字段设置默认值。&lt;/div&gt;&lt;div&gt;postProcessPropertyValues: 在设置 bean 属性之前调用，允许对属性值进行进一步的处理。&lt;/div&gt;&lt;div&gt;postProcessBeforeInitialization: 在调用 bean 的初始化方法之前调用，允许在初始化方法之前执行自定义逻辑。&lt;/div&gt;&lt;div&gt;postProcessAfterInitialization: 在调用 bean 的初始化方法之后调用，允许在初始化方法之后执行自定义逻辑。&lt;/div&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" vertex="1" parent="1">
          <mxGeometry x="2535" y="1439" width="570" height="160" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-335" value="&lt;font&gt;执行所有后置处理器的&lt;br&gt;&lt;b&gt;postProcessAfterInitialization&lt;/b&gt;(result, beanName)&lt;br&gt;方法&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2320" y="1519" width="200" height="51" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-336" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-342" target="w4FkYv5Shg38tEnAdtc6-344">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-337" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-342" target="w4FkYv5Shg38tEnAdtc6-345">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-338" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-342" target="w4FkYv5Shg38tEnAdtc6-346">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-339" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-342" target="w4FkYv5Shg38tEnAdtc6-348">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-340" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-342" target="w4FkYv5Shg38tEnAdtc6-343">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-443" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-342" target="w4FkYv5Shg38tEnAdtc6-442">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-342" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;instanceWrapper = &lt;b&gt;createBeanInstance&lt;/b&gt;(&lt;br&gt;beanName, mbd, args);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;这一步实现&lt;b&gt;Bean的实例化&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;根据BeanDefinition配置有５种获取Bean实例的方式, 从上到下优先级依次降低&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="2080" y="1680" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-343" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;return obtainFromSupplier(instanceSupplier, beanName)&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;TODO&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="2320" y="1680" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-344" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;return instantiateUsingFactoryMethod(beanName, mbd, args)&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;TODO&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="2320" y="1760" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-345" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;return autowireConstructor(beanName, mbd, null, null)&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;TODO&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="2320" y="1840" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-346" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;return autowireConstructor(beanName, mbd, ctors, args);&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;TODO&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="2320" y="1920" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-347" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-348" target="w4FkYv5Shg38tEnAdtc6-352">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-348" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;return instantiateBean(beanName, mbd);&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2320" y="2000" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-349" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-352" target="w4FkYv5Shg38tEnAdtc6-353">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-350" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-352" target="w4FkYv5Shg38tEnAdtc6-355">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-351" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-352" target="w4FkYv5Shg38tEnAdtc6-356">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-352" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;beanInstance = getInstantiationStrategy().&lt;b&gt;instantiate&lt;/b&gt;(&lt;br&gt;mbd, beanName, parent);&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;默认的实例化策略是CglibSubclassingInstantiationStrategy&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="2560" y="2000" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-353" value="&lt;font size=&quot;1&quot;&gt;&lt;div&gt;BeanWrapper bw = new BeanWrapperImpl(beanInstance);&lt;/div&gt;&lt;div&gt;&lt;span&gt;&#x9;&#x9;&#x9;&lt;/span&gt;initBeanWrapper(bw);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;包装了类型转换器，属性编辑器等等&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="2560" y="2080" width="200" height="51" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-355" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;final Class&amp;lt;?&amp;gt; &lt;b&gt;clazz&lt;/b&gt; = bd.getBeanClass();&lt;br&gt;&lt;b&gt;constructorToUse&lt;/b&gt; = clazz.getDeclaredConstructor();&lt;br&gt;BeanUtils.&lt;b&gt;instantiateClass&lt;/b&gt;(constructorToUse)&lt;br&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;通过反射调用构造方法创建&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="2800" y="2000" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-356" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;font size=&quot;1&quot;&gt;instantiateWithMethodInjection(bd, beanName, owner)&lt;br&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;&lt;span style=&quot;&quot;&gt;如果Bean定义有使用方法注入&lt;/span&gt;&lt;span style=&quot;&quot;&gt;，通过CGLib创建代理对象&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="2800" y="2080" width="200" height="51" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-357" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-358" target="w4FkYv5Shg38tEnAdtc6-361">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-454" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-358" target="w4FkYv5Shg38tEnAdtc6-453">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-358" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;if (earlySingletonExposure)&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/font&gt;&lt;b style=&quot;font-size: 9px;&quot;&gt;addSingletonFactory&lt;/b&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;(beanName, () -&amp;gt; &lt;b style=&quot;font-size: 9px;&quot;&gt;getEarlyBeanReference&lt;/b&gt;(beanName, mbd, bean));&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;Bean实例化后将单例工厂加入&lt;b style=&quot;font-size: 9px;&quot;&gt;singletonFactories&lt;/b&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;earlySingletonExposure为true表示要提前暴露已经实例化的Bean&lt;/font&gt;&lt;/font&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;arcSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="2070" y="2160" width="220" height="80" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-359" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-361" target="w4FkYv5Shg38tEnAdtc6-364">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-360" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-361" target="w4FkYv5Shg38tEnAdtc6-372">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-361" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;Object exposedObject = bean;&lt;br&gt;&lt;/font&gt;&lt;b&gt;populateBean&lt;/b&gt;(beanName, mbd, instanceWrapper);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;属性填充&lt;/b&gt;：依赖注入、PropertyValues&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="2080" y="2280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-362" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-364" target="w4FkYv5Shg38tEnAdtc6-465">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2180" y="3360" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-363" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-364" target="w4FkYv5Shg38tEnAdtc6-386">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-364" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;exposedObject = &lt;b&gt;initializeBean&lt;/b&gt;(beanName, exposedObject, mbd)&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;执行初始化方法&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="2080" y="2880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-365" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-465" target="w4FkYv5Shg38tEnAdtc6-369">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2180" y="3400" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-367" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-369" target="w4FkYv5Shg38tEnAdtc6-370">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-368" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-369" target="w4FkYv5Shg38tEnAdtc6-409">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-369" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;registerDisposableBeanIfNecessary(&lt;br&gt;beanName, bean, mbd);&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 8px&quot;&gt;有些Bean销毁时需要执行销毁方法&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 8px&quot;&gt;释放资源,这里将要执行销毁方法的Bean注册到disposableBeans Map容器&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2080" y="3560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-370" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;return exposedObject;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="2080" y="3880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-460" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-372" target="w4FkYv5Shg38tEnAdtc6-456">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-372" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;先执行所有&lt;b&gt;InstantiationAwareBeanPostProcessor&lt;/b&gt;类型后置处理器的&lt;b&gt;postProcessAfterInstantiation&lt;/b&gt;()&lt;br&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;内置的后置处理器此方法里面啥都没做，留给子类拓展&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="2320" y="2280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-377" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;autowireByName(beanName, mbd, bw, newPvs)&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="2560" y="2320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-378" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;autowireByType(beanName, mbd, bw, newPvs)&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="2560" y="2400" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-381" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-382" target="w4FkYv5Shg38tEnAdtc6-383">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-382" value="&lt;font size=&quot;1&quot;&gt;&lt;div&gt;if (pvs != null)&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; applyPropertyValues(&lt;/div&gt;&lt;div&gt;beanName, mbd, bw, pvs);&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2320" y="2800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-383" value="&lt;font size=&quot;1&quot;&gt;bw.setPropertyValues(new MutablePropertyValues(deepCopy));&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2560" y="2800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-384" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-386" target="w4FkYv5Shg38tEnAdtc6-389">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-385" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-386" target="w4FkYv5Shg38tEnAdtc6-393">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-463" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-386" target="w4FkYv5Shg38tEnAdtc6-395">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-464" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-386" target="w4FkYv5Shg38tEnAdtc6-396">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-386" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;invokeAwareMethods(beanName, bean)&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;如果Bean有实现Aware及其子类接口则执行这些接口方法&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2320" y="2880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-387" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-389" target="w4FkYv5Shg38tEnAdtc6-399">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-388" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-389" target="w4FkYv5Shg38tEnAdtc6-401">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-389" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;执行所有&lt;b&gt;BeanPostProcessor&lt;/b&gt;类型后置处理器的&lt;b&gt;postProcessBeforeInitialization&lt;/b&gt;() 方法&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="2320" y="3080" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-391" value="＠PropertySource" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#007FFF;" vertex="1" parent="1">
          <mxGeometry x="2530" y="2290" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-393" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;BeanNameAware&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="2560" y="2890" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-395" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;BeanClassLoaderAware&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="2560" y="2950" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-396" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;BeanFactoryAware&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="2560" y="3010" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-397" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-399" target="w4FkYv5Shg38tEnAdtc6-404">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-398" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-399" target="w4FkYv5Shg38tEnAdtc6-406">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-399" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;invokeInitMethods(beanName, wrappedBean, mbd);&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;调用@PostConstruct、init-method等制定的初始化方法、以及实现 InitializingBean 接口的&amp;nbsp;afterPropertiesSet() 方法&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2320" y="3180" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-401" value="&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;font style=&quot;font-size: 8px&quot;&gt;Spring内置后置处理器的&lt;b&gt;postProcessBeforeInitialization&lt;/b&gt;都做了啥&lt;br&gt;&lt;/font&gt;&lt;div&gt;0 = {ApplicationContextAwareProcessor@2474}&amp;nbsp;&lt;/div&gt;&lt;div&gt;1 = {ConfigurationClassPostProcessor$ImportAwareBeanPostProcessor@2050}&amp;nbsp;&lt;/div&gt;&lt;div&gt;2 = {PostProcessorRegistrationDelegate$BeanPostProcessorChecker@2535}&amp;nbsp;&lt;/div&gt;&lt;div&gt;3 = {CommonAnnotationBeanPostProcessor@2091}&amp;nbsp;&lt;/div&gt;&lt;div&gt;4 = {AutowiredAnnotationBeanPostProcessor@1994}&amp;nbsp;&lt;/div&gt;&lt;div&gt;5 = {RequiredAnnotationBeanPostProcessor@2157}&amp;nbsp;&lt;/div&gt;&lt;div&gt;6 = {ApplicationListenerDetector@2578}&amp;nbsp;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=7;" vertex="1" parent="1">
          <mxGeometry x="2560" y="3070" width="300" height="80" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-403" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-404" target="w4FkYv5Shg38tEnAdtc6-405">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-404" value="&lt;font&gt;((InitializingBean)bean).afterPropertiesSet()&lt;br&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;实现了InitializingBean接口就调用afterPropertiesSet()&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2560" y="3180" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-405" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;String initMethodName = mbd.getInitMethodName();&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/font&gt;&lt;b&gt;invokeCustomInitMethod&lt;/b&gt;(beanName, bean, mbd);&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;若通过XML或注解指定了init-method方法，就执行指定的方法&lt;/font&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;arcSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2550" y="3260" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-406" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;执行所有&lt;b&gt;BeanPostProcessor&lt;/b&gt;类型后置处理器的&lt;b&gt;postProcessAfterInitialization&lt;/b&gt;()&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="2320" y="3280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-407" value="&lt;font color=&quot;#007fff&quot;&gt;Y&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-409" target="w4FkYv5Shg38tEnAdtc6-413">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-408" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;dashed=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-409" target="w4FkYv5Shg38tEnAdtc6-422">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2310" y="3605" />
              <mxPoint x="2310" y="3830" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-409" value="!mbd.isPrototype() &amp;amp;&amp;amp; &lt;b&gt;requiresDestruction&lt;/b&gt;(&lt;br&gt;bean, mbd)" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="2345" y="3560" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-410" value="&lt;font color=&quot;#000000&quot;&gt;&lt;b&gt;requiresDestruction&lt;/b&gt;：&lt;br&gt;1) DisposableBeanAdapter.hasDestroyMethod(bean, mbd)&lt;/font&gt;&lt;br&gt;是DisposableBean的实例；&lt;br&gt;是AutoCloseable的实例；&lt;br&gt;Bean定义中拥有&lt;b&gt;destroyMethod&lt;/b&gt;方法（destoryMethodName不为空）；&lt;br&gt;&lt;br&gt;&lt;font color=&quot;#000000&quot;&gt;2)&amp;nbsp;&lt;span&gt;hasDestructionAwareBeanPostProcessors() &amp;amp;&amp;amp;&lt;/span&gt;&lt;/font&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&lt;span&gt;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&lt;/span&gt;DisposableBeanAdapter.hasApplicableProcessors(bean, getBeanPostProcessors())&lt;/font&gt;&lt;/div&gt;&lt;div&gt;BeanFactory有注册DestructionAwareBeanPostProcessor；&lt;/div&gt;&lt;div&gt;且&lt;/div&gt;&lt;div&gt;注册的DestructionAwareBeanPostProcessor中有适用于当前Bean的后置处理器（通过 requiresDestruction() 返回值一一判断是否有适用的）&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#007FFF;" vertex="1" parent="1">
          <mxGeometry x="2350" y="3620" width="310" height="150" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-411" value="&lt;font color=&quot;#007fff&quot;&gt;Y&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-413" target="w4FkYv5Shg38tEnAdtc6-415">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-412" value="&lt;font color=&quot;#007fff&quot;&gt;N&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-413" target="w4FkYv5Shg38tEnAdtc6-416">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-413" value="mbd.isSingleton()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;是否是单例？&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="2600" y="3560" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-414" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-415" target="w4FkYv5Shg38tEnAdtc6-417">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-415" value="&lt;div&gt;&lt;b&gt;registerDisposableBean&lt;/b&gt;(beanName,&lt;/div&gt;&lt;div&gt;&lt;span&gt;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&lt;/span&gt;new &lt;b&gt;DisposableBeanAdapter&lt;/b&gt;(bean, beanName, mbd, getBeanPostProcessors(), acc))&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="2800" y="3560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-416" value="&lt;div&gt;&lt;b&gt;scope&lt;/b&gt;.&lt;b&gt;registerDestructionCallback&lt;/b&gt;(&lt;br&gt;beanName,&lt;span&gt;new &lt;b&gt;DisposableBeanAdapter&lt;/b&gt;(bean, beanName, mbd, getBeanPostProcessors(), acc))&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="2800" y="3640" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-417" value="this.&lt;b&gt;disposableBeans&lt;/b&gt;.put(&lt;br&gt;beanName, bean)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;这里的bean是&amp;nbsp;&lt;b&gt;DisposableBeanAdapter&lt;/b&gt; 类型&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="3040" y="3560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-418" value="disposableBeans并不是单指实现了&lt;br&gt;DisposableBean接口的Bean,&lt;br&gt;满足前面条件的Bean都会存到这个Map中" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#007FFF;" vertex="1" parent="1">
          <mxGeometry x="3050" y="3620" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-419" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-422" target="w4FkYv5Shg38tEnAdtc6-424">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-420" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-422" target="w4FkYv5Shg38tEnAdtc6-429">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-421" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#000000;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-422" target="w4FkYv5Shg38tEnAdtc6-430">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-422" value="&lt;font&gt;&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;destoryMethod&lt;/font&gt;&lt;font style=&quot;font-size: 8px&quot;&gt;方法来源&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;查setDestroyMethodName调用位置&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="2320" y="3800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-424" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;@Bean destoryMethod属性&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2560" y="3780" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-429" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;XML Bean destory-method&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2560" y="3840" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-430" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;@PreDestroy&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2560" y="3900" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-434" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-431" target="w4FkYv5Shg38tEnAdtc6-325">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1940" y="1440" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-431" value="&lt;font&gt;RootBeanDefinition mbdToUse = mbd;&lt;br&gt;Class&amp;lt;?&amp;gt; resolvedClass = &lt;b&gt;resolveBeanClass&lt;/b&gt;(mbd, beanName);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;从Bean定义中获取Bean Class类型&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="1840" y="1360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-433" value="&lt;font color=&quot;#007fff&quot;&gt;下面省略一些不重要的操作&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="1855" y="1320" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-436" value="&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;DEMO这一步并不会创建Bean&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="1855" y="1501" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-437" value="&lt;font&gt;mbd.beforeInstantiationResolved = (bean != null);&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="2080" y="1590" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-441" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;CglibSubclassingInstantiationStrategy 继承 SimpleInstantiationStrategy&lt;br&gt;主要是为了支持方法注入。&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="2560" y="1940" width="340" height="40" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-444" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-442" target="w4FkYv5Shg38tEnAdtc6-358">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-442" value="&lt;font style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;applyMergedBeanDefinitionPostProcessors(&lt;br&gt;mbd, beanType, beanName);&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;执行postProcessMergedBeanDefinition()&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="2080" y="2080" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-448" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-446" target="w4FkYv5Shg38tEnAdtc6-74">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-451" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-446" target="w4FkYv5Shg38tEnAdtc6-450">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-446" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;b&gt;beforeSingletonCreation&lt;/b&gt;(beanName);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;即主要记录名为 beanName 的Bean正在被创建&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" vertex="1" parent="1">
          <mxGeometry x="1360" y="1360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-478" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-447" target="w4FkYv5Shg38tEnAdtc6-477">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-447" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;b&gt;afterSingletonCreation&lt;/b&gt;(beanName);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;和beforeSingletonCreation相反，清除beanName的Bean正在创建的记录&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" vertex="1" parent="1">
          <mxGeometry x="1360" y="1520" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-450" value="&lt;font style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;if (!this.inCreationCheckExclusions.contains(beanName) &lt;br&gt;&amp;amp;&amp;amp; !this.&lt;b&gt;singletonsCurrentlyInCreation&lt;/b&gt;.add(beanName))&lt;br&gt;&lt;/font&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;throw new BeanCurrentlyInCreationException(beanName);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;实例化Bean前会将beanName记录到&amp;nbsp;&lt;b&gt;singletonsCurrentlyInCreation&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=8;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1590" y="1360" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-453" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;div style=&quot;&quot;&gt;synchronized (this.singletonObjects) {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; if (!this.singletonObjects.containsKey(beanName))&amp;nbsp; {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; this.&lt;b&gt;singletonFactories&lt;/b&gt;.&lt;b&gt;put&lt;/b&gt;(beanName, singletonFactory);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; this.&lt;b&gt;earlySingletonObjects&lt;/b&gt;.&lt;b&gt;remove&lt;/b&gt;(beanName);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; this.&lt;b&gt;registeredSingletons&lt;/b&gt;.&lt;b&gt;add&lt;/b&gt;(beanName);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;&quot;&gt;}&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=4;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="2310" y="2150" width="230" height="100" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-457" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-456" target="w4FkYv5Shg38tEnAdtc6-377">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-458" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-456" target="w4FkYv5Shg38tEnAdtc6-378">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-461" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-456" target="w4FkYv5Shg38tEnAdtc6-380">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-456" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;@Autowired注入处理&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;这里处理按名称和类型的&lt;b&gt;Setter方法注入&lt;/b&gt;&lt;br&gt;DEMO中暂未用这两种注入，暂略&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2320" y="2360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-483" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-380" target="w4FkYv5Shg38tEnAdtc6-382">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-488" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-380" target="w4FkYv5Shg38tEnAdtc6-487">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-380" value="&lt;font size=&quot;1&quot;&gt;&lt;div&gt;执行所有&lt;b&gt;InstantiationAwareBeanPostProcessor&lt;/b&gt;类型后置处理器的&amp;nbsp;&lt;b&gt;postProcessProperties&lt;/b&gt;()&amp;nbsp;&lt;br&gt;&lt;b&gt;postProcessPropertyValues&lt;/b&gt;()&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="2320" y="2480" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-467" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-465" target="w4FkYv5Shg38tEnAdtc6-466">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-465" value="&lt;font style=&quot;&quot;&gt;earlySingletonExposure&lt;br&gt;&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="2110" y="3360" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-468" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=-0.001;entryY=0.67;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-466" target="w4FkYv5Shg38tEnAdtc6-215">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3020" y="3390" />
              <mxPoint x="3020" y="270" />
              <mxPoint x="1100" y="270" />
              <mxPoint x="1100" y="240" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-472" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-466" target="w4FkYv5Shg38tEnAdtc6-471">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-466" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;Object earlySingletonReference = &lt;b&gt;getSingleton&lt;/b&gt;(beanName, false);&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="2320" y="3360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-474" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-471" target="w4FkYv5Shg38tEnAdtc6-475">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2580" y="3470" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-476" value="Y" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="w4FkYv5Shg38tEnAdtc6-474">
          <mxGeometry x="-0.0114" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-471" value="&lt;font style=&quot;&quot;&gt;earlySingletonReference&lt;br&gt;&amp;nbsp;!= null&lt;br&gt;&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="2350" y="3440" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-475" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;arcSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2560" y="3440" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-480" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-477" target="w4FkYv5Shg38tEnAdtc6-479">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-477" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;if (newSingleton) {&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;addSingleton&lt;/b&gt;(beanName, singletonObject);&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;和beforeSingletonCreation相反，清除beanName的Bean正在创建的记录&lt;/font&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;arcSize=8;" vertex="1" parent="1">
          <mxGeometry x="1360" y="1600" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-479" value="&lt;font style=&quot;font-size: 8px;&quot;&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;synchronized (this.singletonObjects) {&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; this.&lt;b&gt;singletonObjects&lt;/b&gt;.put(beanName, singletonObject);&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; this.&lt;b&gt;singletonFactories&lt;/b&gt;.remove(beanName);&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; this.&lt;b&gt;earlySingletonObjects&lt;/b&gt;.remove(beanName);&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; this.&lt;b&gt;registeredSingletons&lt;/b&gt;.add(beanName);&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;}&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;align=left;arcSize=8;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1590" y="1592.5" width="220" height="75" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-484" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;instantiationAware = {ArrayList@1972}&amp;nbsp; size = 3&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;0 = {ConfigurationClassPostProcessor$ImportAwareBeanPostProcessor@1955}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;1 = {CommonAnnotationBeanPostProcessor@1847}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;2 = {AutowiredAnnotationBeanPostProcessor@1979}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#007FFF;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="2280" y="2550" width="390" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-490" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-487" target="w4FkYv5Shg38tEnAdtc6-489">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-487" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;&lt;b&gt;CommonAnnotationBeanPostProcessor&lt;/b&gt;&lt;br&gt;&lt;/font&gt;#&lt;b&gt;postProcessProperties&lt;/b&gt;(pvs, bw.getWrappedInstance(), beanName)&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="2560" y="2480" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-492" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-489" target="w4FkYv5Shg38tEnAdtc6-491">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-495" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-489" target="w4FkYv5Shg38tEnAdtc6-494">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-496" value="..." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="w4FkYv5Shg38tEnAdtc6-495">
          <mxGeometry x="-0.125" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-489" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;&lt;span style=&quot;font-weight: normal;&quot;&gt;InjectionMetadata metadata = this.&lt;/span&gt;findResourceMetadata&lt;span style=&quot;font-weight: normal;&quot;&gt;(beanName, bean.getClass(), pvs);&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;这里可以查找 @Resource 注解的依赖&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fontStyle=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2800" y="2480" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-500" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-491" target="w4FkYv5Shg38tEnAdtc6-499">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-491" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;metadata.inject(bean, beanName, pvs);&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;获取依赖的Bean并注入&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fontStyle=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2800" y="2620" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-493" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;CommonAnnotationBeanPostProcessor&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="2800" y="2450" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-494" value="&lt;font style=&quot;&quot; size=&quot;1&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-weight: normal;&quot;&gt;if (field.isAnnotationPresent(&lt;/span&gt;Resource&lt;span style=&quot;font-weight: normal;&quot;&gt;.class)) {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-weight: normal;&quot;&gt;&amp;nbsp; &amp;nbsp; if (!this.ignoredResourceTypes.contains(field.getType().getName())) {&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-weight: normal;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;currElements&lt;span style=&quot;font-weight: normal;&quot;&gt;.add(new &lt;/span&gt;ResourceElement&lt;span style=&quot;font-weight: normal;&quot;&gt;(field, field, null));&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-weight: normal;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;font-weight: normal;&quot;&gt;}&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=12;fontStyle=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="3080" y="2470" width="320" height="80" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-497" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;代码依旧很深，这里只展示最关键的一步&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="3120" y="2550" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-498" value="&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;metadata&lt;/b&gt; = {InjectionMetadata@1888}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;targetClass = {Class@1564} &quot;class top.kwseeker.spring.basic.beans.circular.ServiceA&quot;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;//需要注入的属性元素&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;&lt;b&gt;injectedElements&lt;/b&gt; = {ArrayList@1942}&amp;nbsp; size = 1&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; 0 = {CommonAnnotationBeanPostProcessor$&lt;b&gt;ResourceElement&lt;/b&gt;@1887}&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;lazyLookup = false&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;this$0 = {CommonAnnotationBeanPostProcessor@1861}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;b&gt;name&lt;/b&gt; = &quot;serviceB&quot;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;//需要注入的字段名&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;isDefaultName = true&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;b&gt;lookupType&lt;/b&gt; = {Class@1721} &quot;class top.kwseeker.spring.basic.beans.circular.ServiceB&quot; // 需要注入的字段类型&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;mappedName = &quot;&quot;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;b&gt;member&lt;/b&gt; = {Field@1947} &quot;private top.kwseeker.spring.basic.beans.circular.ServiceB top.kwseeker.spring.basic.beans.circular.ServiceA.serviceB&quot;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;isField = true&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;pd = null&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;skip = null&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;checkedElements = {LinkedHashSet@1943}&amp;nbsp; size = 1&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="3080" y="2230" width="800" height="240" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-503" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-499" target="w4FkYv5Shg38tEnAdtc6-505">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="3360" y="2650" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-499" value="&lt;font style=&quot;&quot; size=&quot;1&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-weight: normal;&quot;&gt;Field field = (Field) this.&lt;/span&gt;member&lt;span style=&quot;font-weight: normal;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-weight: normal;&quot;&gt;ReflectionUtils.makeAccessible(field);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;field&lt;span style=&quot;font-weight: normal;&quot;&gt;.&lt;/span&gt;set&lt;span style=&quot;font-weight: normal;&quot;&gt;(target, &lt;/span&gt;getResourceToInject&lt;span style=&quot;font-weight: normal;&quot;&gt;(target, requestingBeanName));&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-weight: 400;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;通过反射设置值，这里就直接把依赖的Bean填充进去了&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=12;fontStyle=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="3080" y="2620" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-501" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;InjectionMetadata&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="3150" y="2590" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-507" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-505" target="w4FkYv5Shg38tEnAdtc6-506">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-510" value="Y" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="w4FkYv5Shg38tEnAdtc6-507">
          <mxGeometry x="0.253" y="-4" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-509" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-505" target="w4FkYv5Shg38tEnAdtc6-508">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-511" value="N" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="w4FkYv5Shg38tEnAdtc6-509">
          <mxGeometry x="0.05" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-505" value="&lt;font style=&quot;&quot;&gt;this.lazyLookup&lt;br&gt;&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="3360" y="2620" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-506" value="buildLazyResourceProxy(this, requestingBeanName)" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="3521.5" y="2620" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-514" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-508" target="w4FkYv5Shg38tEnAdtc6-513">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-508" value="&lt;b&gt;getResource&lt;/b&gt;(this, requestingBeanName))" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="3520" y="2700" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-512" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;CommonAnnotationBeanPostProcessor&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="3360" y="2590" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-516" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-513" target="w4FkYv5Shg38tEnAdtc6-515">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-513" value="return &lt;b&gt;autowireResource&lt;/b&gt;(this.resourceFactory, element, requestingBeanName);" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="3760" y="2700" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-518" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-515" target="w4FkYv5Shg38tEnAdtc6-517">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-515" value="resource = beanFactory.&lt;b&gt;resolveBeanByName&lt;/b&gt;(name, descriptor);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;根据依赖的Bean名和类型等描述信息获取依赖的Bean&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="4000" y="2700" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-520" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-517" target="w4FkYv5Shg38tEnAdtc6-519">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-517" value="return getBean(name, descriptor.getDependencyType());" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="3520" y="2800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-519" value="return &lt;b&gt;doGetBean&lt;/b&gt;(name, requiredType, null, false);" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="3760" y="2800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-521" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;mergedDefinition = {ArrayList@2092}&amp;nbsp; size = 3&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;0 = {CommonAnnotationBeanPostProcessor@1861}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;1 = {AutowiredAnnotationBeanPostProcessor@2024}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;2 = {ApplicationListenerDetector@2096}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" vertex="1" parent="1">
          <mxGeometry x="2280" y="2080" width="270" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-522" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;调试循环依赖时关键断点:&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;DefaultSingletonBeanRegistry.java:183&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;CommonAnnotationBeanPostProcessor.java:359&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;CommonAnnotationBeanPostProcessor.java:307&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;CommonAnnotationBeanPostProcessor.java:391&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;CommonAnnotationBeanPostProcessor.java:327&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;CommonAnnotationBeanPostProcessor.java:332&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;AbstractAutowireCapableBeanFactory.java:617&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;AbstractBeanFactory.java:345&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;Application.java:11&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;AbstractAutowireCapableBeanFactory.java:514&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;AbstractAutowireCapableBeanFactory.java:613&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;DefaultSingletonBeanRegistry.java:139&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;DefaultSingletonBeanRegistry.java:158&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;DefaultSingletonBeanRegistry.java:195&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;AbstractBeanFactory.java:256&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="40" y="220" width="240" height="210" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-526" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-524" target="w4FkYv5Shg38tEnAdtc6-38">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-524" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;同步检查，暂略&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1680" y="440" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-528" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-527" target="w4FkYv5Shg38tEnAdtc6-40">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-530" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-527" target="w4FkYv5Shg38tEnAdtc6-529">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-527" value="&lt;font size=&quot;1&quot;&gt;&lt;div&gt;singletonObject = singletonFactory.getObject();&lt;/div&gt;&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=16;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="1880" y="440" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-532" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-529" target="w4FkYv5Shg38tEnAdtc6-531">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-529" value="&lt;font size=&quot;1&quot;&gt;&lt;div&gt;getEarlyBeanReference(&lt;/div&gt;&lt;div&gt;beanName, mbd, &lt;b&gt;bean&lt;/b&gt;)&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=16;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2120" y="430" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-536" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-531" target="w4FkYv5Shg38tEnAdtc6-535">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-531" value="遍历后置处理器中所有SmartInstantiationAwareBeanPostProcessor类型的后置处理器，执行&amp;nbsp;getEarlyBeanReference() 方法" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=16;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="2360" y="430" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-533" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;smartInstantiationAware = {ArrayList@2505}&amp;nbsp; size = 1&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;0 = {AutowiredAnnotationBeanPostProcessor@2024}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;DEMO中只有一个&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="2360" y="490" width="270" height="50" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-538" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="w4FkYv5Shg38tEnAdtc6-535" target="w4FkYv5Shg38tEnAdtc6-537">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-535" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;div&gt;&lt;b&gt;AutowiredAnnotationBeanPostProcessor&lt;/b&gt;#&lt;/div&gt;&lt;b&gt;getEarlyBeanReference&lt;/b&gt;(exposedObject, beanName)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;exposedObject 即实例化但未完成初始化的Bean&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=16;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2600" y="430" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-537" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;div&gt;&lt;/div&gt;return bean;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;默认是直接返回&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;arcSize=16;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2840" y="430" width="80" height="60" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-539" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;AbstractAutowireCapableBeanFactory&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="2125" y="400" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-540" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;flipH=1;labelPosition=right;verticalLabelPosition=middle;align=left;verticalAlign=middle;size=0.5;rotation=90;strokeColor=#3333FF;" vertex="1" parent="1">
          <mxGeometry x="1729.88" y="290" width="20.25" height="679.5" as="geometry" />
        </mxCell>
        <mxCell id="w4FkYv5Shg38tEnAdtc6-541" value="&lt;font color=&quot;#3333ff&quot;&gt;这里只是没有代理时的逻辑&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="2360" y="390" width="170" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
