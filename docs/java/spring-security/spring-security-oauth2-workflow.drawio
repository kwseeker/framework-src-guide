<mxfile host="Electron" modified="2024-03-12T09:00:02.657Z" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/21.6.5 Chrome/114.0.5735.243 Electron/25.3.1 Safari/537.36" etag="pV2G40VJml-2vXhuW84C" version="21.6.5" type="device" pages="2">
  <diagram name="SpringSecurityOAuth2工作流程" id="BB3JgpRIZgwQwiqXOJlF">
    <mxGraphModel dx="3915" dy="879" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="dtGfbLZROhE4GbIlcdWK-29" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-44" target="dtGfbLZROhE4GbIlcdWK-26" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-83" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-70" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="880" y="1120" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-76" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0;exitDx=0;exitDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-54" target="Jysl4UP8jRCQiMBeIVnq-72" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-75" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-33" target="Jysl4UP8jRCQiMBeIVnq-72" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bewY3FNtBYAkQc0WHg5f-1" value="&lt;h1 style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;Spring Security OAuth2 工作流程&amp;nbsp;&lt;/font&gt;&lt;/h1&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;版本：spring-security-oauth2-autoconfigure:2.1.10.RELEASE (spring-security-oauth现在已经废弃，功能迁移到了spring-security和spring-authorization-server两个项目)&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 12px;&quot;&gt;这里只分析两种常用的模式：密码模式（通常用于统一的认证授权中心）、认证码模式（通常用于第三方授权）&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 12px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 12px;&quot;&gt;&lt;b&gt;密码模式&lt;/b&gt;：&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 12px;&quot;&gt;生产场景的密码模式交互流程举例：（详细参考第2页的涌道图）&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 12px;&quot;&gt;用户输入用户名密码请求网关服务的/login; 网关额外添加自己的client-id、client-secret（如果认证服务器不开放到外网不需要） 然后转发给认证服务器/oauth/token;&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;认证服务器对client-secret以及用户密码与传参进行比对，校验成功后返回访问令牌、令牌类型、过期时间、客户端应用授权范围等信息；&lt;/div&gt;&lt;div style=&quot;&quot;&gt;后续的业务请求先由网关将AccessToken转发给认证服务进行校验，校验成功后获取用户信息再转发给后台业务服务。&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 12px;&quot;&gt;&lt;b&gt;认证码模式&lt;/b&gt;：&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 12px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 12px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="40" y="20" width="960" height="180" as="geometry" />
        </mxCell>
        <mxCell id="bewY3FNtBYAkQc0WHg5f-5" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;rounded=1;" parent="1" source="bewY3FNtBYAkQc0WHg5f-2" target="bewY3FNtBYAkQc0WHg5f-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bewY3FNtBYAkQc0WHg5f-12" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=1;" parent="1" source="bewY3FNtBYAkQc0WHg5f-2" target="bewY3FNtBYAkQc0WHg5f-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="gpTnpa3g8ZrnLY71u2b0-3" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="bewY3FNtBYAkQc0WHg5f-2" target="gpTnpa3g8ZrnLY71u2b0-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bewY3FNtBYAkQc0WHg5f-2" value="OAuth2初始化" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="40" y="240" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bewY3FNtBYAkQc0WHg5f-7" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;rounded=1;" parent="1" source="bewY3FNtBYAkQc0WHg5f-3" target="bewY3FNtBYAkQc0WHg5f-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bewY3FNtBYAkQc0WHg5f-3" value="认证码模式" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="40" y="3173" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ekV5xUxB1UH4FCtE4HuT-2" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="bewY3FNtBYAkQc0WHg5f-4" target="ekV5xUxB1UH4FCtE4HuT-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-53" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="bewY3FNtBYAkQc0WHg5f-4" target="Jysl4UP8jRCQiMBeIVnq-52" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bewY3FNtBYAkQc0WHg5f-4" value="OAuth2自动配置" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="240" y="240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bewY3FNtBYAkQc0WHg5f-6" value="" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="240" y="3173" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bewY3FNtBYAkQc0WHg5f-14" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="bewY3FNtBYAkQc0WHg5f-8" target="bewY3FNtBYAkQc0WHg5f-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bewY3FNtBYAkQc0WHg5f-8" value="客户端应用请求&lt;br&gt;认证服务器获取授权&lt;br&gt;&lt;b&gt;/oauth/token&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;此接口是Spring Security源码中注册的&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="240" y="2880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-39" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="bewY3FNtBYAkQc0WHg5f-11" target="Jysl4UP8jRCQiMBeIVnq-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-42" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="bewY3FNtBYAkQc0WHg5f-11" target="Jysl4UP8jRCQiMBeIVnq-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-46" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="bewY3FNtBYAkQc0WHg5f-11" target="Jysl4UP8jRCQiMBeIVnq-44" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-74" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="bewY3FNtBYAkQc0WHg5f-11" target="Jysl4UP8jRCQiMBeIVnq-72" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bewY3FNtBYAkQc0WHg5f-11" value="自定义 OAuth2 配置" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="240" y="960" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-26" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="bewY3FNtBYAkQc0WHg5f-13" target="Jysl4UP8jRCQiMBeIVnq-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-62" value="..." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="Jysl4UP8jRCQiMBeIVnq-26" vertex="1" connectable="0">
          <mxGeometry x="-0.25" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bewY3FNtBYAkQc0WHg5f-13" value="FilterChainProxy#doFilter(...)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;springSecurityFilterChain&lt;br&gt;仍然会经过安全过滤器链&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="480" y="2880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-22" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="bewY3FNtBYAkQc0WHg5f-15" target="bewY3FNtBYAkQc0WHg5f-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bewY3FNtBYAkQc0WHg5f-15" value="AccessToken校验&lt;br&gt;&lt;b&gt;/oauth/check_token&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;&quot; color=&quot;#007fff&quot;&gt;此接口是Spring Security源码中注册的&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="240" y="2980" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-2" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="ekV5xUxB1UH4FCtE4HuT-1" target="Jysl4UP8jRCQiMBeIVnq-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-4" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=1;" parent="1" source="ekV5xUxB1UH4FCtE4HuT-1" target="Jysl4UP8jRCQiMBeIVnq-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-6" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=1;" parent="1" source="ekV5xUxB1UH4FCtE4HuT-1" target="Jysl4UP8jRCQiMBeIVnq-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ekV5xUxB1UH4FCtE4HuT-1" value="OAuth2AutoConfiguration" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="480" y="240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-1" target="Jysl4UP8jRCQiMBeIVnq-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-11" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-1" target="Jysl4UP8jRCQiMBeIVnq-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-16" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-1" target="Jysl4UP8jRCQiMBeIVnq-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-17" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-1" target="Jysl4UP8jRCQiMBeIVnq-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-1" value="@Import" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="720" y="240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-21" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-3" target="Jysl4UP8jRCQiMBeIVnq-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-3" value="@Bean" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="720" y="640" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-19" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-5" target="Jysl4UP8jRCQiMBeIVnq-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-5" value="@EnableConfigurationProperties" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="720" y="560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-34" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-7" target="Jysl4UP8jRCQiMBeIVnq-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-37" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-7" target="Jysl4UP8jRCQiMBeIVnq-35" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1180" y="270" />
              <mxPoint x="1180" y="350" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-7" value="OAuth2AuthorizationServerConfiguration" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="960" y="240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-9" value="OAuth2MethodSecurityConfiguration" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="960" y="320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-12" value="OAuth2ResourceServerConfiguration" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="960" y="400" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-14" value="OAuth2RestOperationsConfiguration" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="960" y="480" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-18" value="OAuth2ClientProperties" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="960" y="560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-20" value="new ResourceServerProperties(&lt;br&gt;this.credentials.getClientId(), this.credentials.getClientSecret());" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="960" y="640" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-23" value="&lt;font color=&quot;#007fff&quot;&gt;调试发现安全过滤器链中有两个过滤器链&lt;br&gt;/oauth/token、 /oauth/token_key、&lt;br&gt;/oauth/check_token 走一条&lt;br&gt;其他请求走另外一条&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="480" y="2940" width="240" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-28" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-25" target="Jysl4UP8jRCQiMBeIVnq-27" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-25" value="&lt;div&gt;WebAsyncManagerIntegrationFilter&lt;/div&gt;&lt;div&gt;SecurityContextPersistenceFilter&lt;/div&gt;&lt;div&gt;HeaderWriterFilter&lt;/div&gt;&lt;div&gt;LogoutFilter&lt;/div&gt;&lt;div&gt;&lt;b&gt;BasicAuthenticationFilter&lt;/b&gt;&lt;/div&gt;&lt;div&gt;RequestCacheAwareFilter&lt;/div&gt;&lt;div&gt;SecurityContextHolderAwareRequestFilter&lt;/div&gt;&lt;div&gt;AnonymousAuthenticationFilter&lt;/div&gt;&lt;div&gt;SessionManagementFilter&lt;/div&gt;&lt;div&gt;ExceptionTranslationFilter&lt;/div&gt;&lt;div&gt;&lt;b&gt;FilterSecurityInterceptor&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;/oauth/token、 /oauth/token_key、&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;/oauth/check_token 走的过滤器链&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=4;" parent="1" vertex="1">
          <mxGeometry x="720" y="2830" width="200" height="160" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-30" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-27" target="Jysl4UP8jRCQiMBeIVnq-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-24" value="..." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="Jysl4UP8jRCQiMBeIVnq-30" vertex="1" connectable="0">
          <mxGeometry x="-0.2247" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-16" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-27" target="BTdmhbfbiTqf7HtIRt79-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-27" value="&lt;b&gt;BasicAuthenticationFilter&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;对于AuthorizationServer这里认证的是客户端应用而不是用户&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="960" y="2880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="gpTnpa3g8ZrnLY71u2b0-26" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-29" target="gpTnpa3g8ZrnLY71u2b0-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-131" value="..." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="gpTnpa3g8ZrnLY71u2b0-26" vertex="1" connectable="0">
          <mxGeometry x="-0.016" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-100" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-29" target="BTdmhbfbiTqf7HtIRt79-99" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-29" value="&lt;b&gt;FilterSecurityInterceptor&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="960" y="3840" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-31" target="yOIgcuZ7kVqAaMvxTEpn-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-31" value="String clientId = getClientId(principal);&lt;br&gt;ClientDetails &lt;b&gt;authenticatedClient&lt;/b&gt; = &lt;b&gt;getClientDetailsService&lt;/b&gt;()&lt;br&gt;.&lt;b&gt;loadClientByClientId&lt;/b&gt;(clientId);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;principal是经过认证的客户端应用信息&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1440" y="5280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-47" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-50" target="Jysl4UP8jRCQiMBeIVnq-38" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1650" y="270" />
              <mxPoint x="1650" y="940" />
              <mxPoint x="460" y="940" />
              <mxPoint x="460" y="975" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-51" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-33" target="Jysl4UP8jRCQiMBeIVnq-50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-86" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-33" target="Jysl4UP8jRCQiMBeIVnq-85" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1420" y="270" />
              <mxPoint x="1420" y="350" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-88" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-33" target="Jysl4UP8jRCQiMBeIVnq-87" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-97" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-33" target="Jysl4UP8jRCQiMBeIVnq-93" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-100" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-33" target="Jysl4UP8jRCQiMBeIVnq-98" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-33" value="AuthorizationServerEndpointsConfiguration&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;端点配置，注册了几个断点，&lt;br&gt;比如 /oauth/token&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1200" y="240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-35" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;AuthorizationServerTokenServicesConfiguration&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1190" y="320" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-38" value="&lt;div&gt;void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; endpoints.&lt;b&gt;authenticationManager&lt;/b&gt;(authenticationManager);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="480" y="960" width="400" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-40" value="&lt;div&gt;void configure(AuthorizationServerSecurityConfigurer oauthServer) throws Exception {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; oauthServer.&lt;b&gt;checkTokenAccess&lt;/b&gt;(&quot;isAuthenticated()&quot;);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="480" y="1040" width="400" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-43" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;OAuth2AuthorizationServerConfig extends&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;b&gt;AuthorizationServerConfigurerAdapter&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="240" y="920" width="210" height="40" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-44" target="dtGfbLZROhE4GbIlcdWK-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-3" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;如果选择&lt;br style=&quot;&quot;&gt;基于内存配置&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" parent="dtGfbLZROhE4GbIlcdWK-2" vertex="1" connectable="0">
          <mxGeometry x="-0.223" y="1" relative="1" as="geometry">
            <mxPoint x="9" y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-44" value="&lt;div&gt;void configure(&lt;b&gt;ClientDetailsServiceConfigurer&lt;/b&gt; clients) throws Exception {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; clients.&lt;b&gt;withClientDetails&lt;/b&gt;(clientDetailsService);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;这里的clients&amp;nbsp;ClientDetailsServiceConfiguration 中创建的&amp;nbsp;ClientDetailsServiceConfigurer&amp;nbsp;&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="480" y="1121" width="400" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-50" value="&lt;div&gt;@PostConstruct&lt;/div&gt;&lt;div&gt;void init()&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1440" y="240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-55" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-60" target="Jysl4UP8jRCQiMBeIVnq-54" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-52" value="@EnableAuthorizationServer" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="480" y="720" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-64" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-54" target="Jysl4UP8jRCQiMBeIVnq-63" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-68" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-54" target="Jysl4UP8jRCQiMBeIVnq-67" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-54" value="&lt;b&gt;AuthorizationServerSecurityConfiguration&lt;/b&gt;&lt;br&gt;extends&amp;nbsp;&lt;b&gt;WebSecurityConfigurerAdapter&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;&quot; color=&quot;#007fff&quot;&gt;用于配置认证服务器的过滤器链&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="960" y="720" width="199" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-71" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-58" target="Jysl4UP8jRCQiMBeIVnq-70" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-28" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-58" target="dtGfbLZROhE4GbIlcdWK-26" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-58" value="ClientDetailsServiceConfiguration" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1440" y="720" width="199" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-61" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-52" target="Jysl4UP8jRCQiMBeIVnq-60" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="680" y="750" as="sourcePoint" />
            <mxPoint x="960" y="750" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-62" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-60" target="Jysl4UP8jRCQiMBeIVnq-33" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="930" y="750" />
              <mxPoint x="930" y="310" />
              <mxPoint x="1170" y="310" />
              <mxPoint x="1170" y="285" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-60" value="@Import" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="720" y="720" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-65" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-63" target="Jysl4UP8jRCQiMBeIVnq-58" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-66" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-63" target="Jysl4UP8jRCQiMBeIVnq-33" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1419" y="735" />
              <mxPoint x="1419" y="710" />
              <mxPoint x="1170" y="710" />
              <mxPoint x="1170" y="285" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-63" value="@Import" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1200" y="720" width="199" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-69" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fillColor=#dae8fc;strokeColor=#6c8ebf;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-67" target="Jysl4UP8jRCQiMBeIVnq-44" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="470" y="1140" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1670" y="840" />
              <mxPoint x="1670" y="1110" />
              <mxPoint x="470" y="1110" />
              <mxPoint x="470" y="1136" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-67" value="&lt;div&gt;&lt;b&gt;@Autowired&lt;/b&gt;&lt;/div&gt;&lt;div&gt;public void configure(&lt;b&gt;ClientDetailsServiceConfigurer&lt;/b&gt; clientDetails) throws Exception {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; for (&lt;b&gt;AuthorizationServerConfigurer&lt;/b&gt; configurer : configurers) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; configurer.configure(clientDetails);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="1200" y="800" width="440" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-70" value="&lt;div&gt;@Bean&lt;/div&gt;ClientDetailsServiceConfigurer configurer = new &lt;b&gt;ClientDetailsServiceConfigurer&lt;/b&gt;(new ClientDetailsServiceBuilder());" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1680" y="720" width="199" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-72" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;AuthorizationServerConfigurerAdapter&lt;br&gt;就是自定义OAuth2配置的窗口&lt;br&gt;很多配置类会注入此类，通过它可以修改各个&lt;br&gt;自动配置配置类的配置，然后自动配置使用&lt;br&gt;修改后的配置创建Bean&lt;br&gt;然后再看配置类代码就会感觉很清晰了&lt;/b&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="230" y="525" width="220" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-78" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-77" target="bewY3FNtBYAkQc0WHg5f-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-79" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-77" target="bewY3FNtBYAkQc0WHg5f-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-77" value="密码模式" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="40" y="2880" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-90" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-85" target="Jysl4UP8jRCQiMBeIVnq-89" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-85" value="@Bean&lt;br&gt;&lt;b&gt;AuthorizationEndpoint&lt;/b&gt; authorizationEndpoint()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1440" y="320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-92" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-87" target="Jysl4UP8jRCQiMBeIVnq-91" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-87" value="@Bean&lt;br&gt;&lt;b&gt;TokenEndpoint &lt;/b&gt;tokenEndpoint()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1440" y="400" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-89" value="任意RequestMethod /oauth/authorize&lt;br&gt;POST&amp;nbsp;/oauth/authorize" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;" parent="1" vertex="1">
          <mxGeometry x="1680" y="320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-91" value="GET /oauth/token&lt;br&gt;POST /oauth/token" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;" parent="1" vertex="1">
          <mxGeometry x="1680" y="400" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-96" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-93" target="Jysl4UP8jRCQiMBeIVnq-95" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-93" value="@Bean&lt;br&gt;&lt;b&gt;CheckTokenEndpoint &lt;/b&gt;checkTokenEndpoint()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1440" y="480" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-95" value="任意RequestMethod /oauth/check_token" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;" parent="1" vertex="1">
          <mxGeometry x="1680" y="480" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-102" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Jysl4UP8jRCQiMBeIVnq-98" target="Jysl4UP8jRCQiMBeIVnq-101" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-98" value="@Bean&lt;br&gt;&lt;b&gt;WhitelabelApprovalEndpoint &lt;/b&gt;whitelabelApprovalEndpoint()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1440" y="560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Jysl4UP8jRCQiMBeIVnq-101" value="任意RequestMethod /oauth/confirm_access" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1680" y="560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="dtGfbLZROhE4GbIlcdWK-1" target="dtGfbLZROhE4GbIlcdWK-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-1" value="&lt;div&gt;clients.&lt;b&gt;inMemory&lt;/b&gt;()&lt;/div&gt;&lt;div&gt;.withClient(&quot;client-gateway&quot;)&lt;/div&gt;&lt;div&gt;.secret(&quot;secret-123&quot;)&lt;/div&gt;&lt;div&gt;.authorizedGrantTypes(&quot;password&quot;)&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;.scopes(&quot;read_userinfo&quot;, &quot;read_contacts&quot;);&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="959" y="1121" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="dtGfbLZROhE4GbIlcdWK-5" target="dtGfbLZROhE4GbIlcdWK-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="dtGfbLZROhE4GbIlcdWK-5" target="dtGfbLZROhE4GbIlcdWK-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-5" value="&lt;b&gt;InMemoryClientDetailsServiceBuilder&lt;/b&gt; next = getBuilder().inMemory();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="1200" y="1121" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="dtGfbLZROhE4GbIlcdWK-7" target="dtGfbLZROhE4GbIlcdWK-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="dtGfbLZROhE4GbIlcdWK-7" target="dtGfbLZROhE4GbIlcdWK-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-7" value="&lt;div&gt;.withClient(&quot;client-gateway&quot;)&lt;/div&gt;&lt;div&gt;.secret(&quot;secret-123&quot;)&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1200" y="1200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-9" value="return new InMemoryClientDetailsServiceBuilder();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="1440" y="1121" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-11" value="&lt;div&gt;ClientBuilder clientBuilder = new ClientBuilder(clientId);&lt;/div&gt;&lt;div&gt;this.clientBuilders.add(clientBuilder);&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1440" y="1200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-16" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="dtGfbLZROhE4GbIlcdWK-13" target="dtGfbLZROhE4GbIlcdWK-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-18" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="dtGfbLZROhE4GbIlcdWK-13" target="dtGfbLZROhE4GbIlcdWK-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-13" value="&lt;div&gt;.authorizedGrantTypes(&quot;password&quot;)&amp;nbsp;&amp;nbsp;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1200" y="1280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-15" value="&lt;div&gt;&lt;div&gt;for (String grant : authorizedGrantTypes) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; this.authorizedGrantTypes.add(grant);&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="1440" y="1280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-20" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="dtGfbLZROhE4GbIlcdWK-17" target="dtGfbLZROhE4GbIlcdWK-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-17" value="&lt;div&gt;.scopes(&quot;read_userinfo&quot;, &quot;read_contacts&quot;)&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1200" y="1360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-19" value="&lt;div&gt;for (String authority : authorities) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; this.authorities.add(authority);&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="1440" y="1360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-24" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;endArrow=diamondThin;endFill=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="dtGfbLZROhE4GbIlcdWK-21" target="dtGfbLZROhE4GbIlcdWK-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-21" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;ClientDetailsServiceBuilder&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//注册的客户端应用Builder&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private List&amp;lt;ClientBuilder&amp;gt; clientBuilders = new ArrayList&amp;lt;ClientBuilder&amp;gt;();&lt;br&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-520" y="240" width="480" height="80" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-25" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;" parent="1" source="dtGfbLZROhE4GbIlcdWK-22" target="dtGfbLZROhE4GbIlcdWK-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-22" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;InMemoryClientDetailsServiceBuilder&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//客户端应用详情信息Map, key为clientId&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Map&amp;lt;String, ClientDetails&amp;gt; clientDetails = new HashMap&amp;lt;String, ClientDetails&amp;gt;();&lt;br&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-520" y="360" width="480" height="80" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-23" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;ClientBuilder &lt;/b&gt;构建客户端应用&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final String clientId;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Collection&amp;lt;String&amp;gt; authorizedGrantTypes = new LinkedHashSet&amp;lt;String&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Collection&amp;lt;String&amp;gt; authorities = new LinkedHashSet&amp;lt;String&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Integer accessTokenValiditySeconds;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Integer refreshTokenValiditySeconds;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Collection&amp;lt;String&amp;gt; scopes = new LinkedHashSet&amp;lt;String&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Collection&amp;lt;String&amp;gt; autoApproveScopes = new HashSet&amp;lt;String&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String secret;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Set&amp;lt;String&amp;gt; registeredRedirectUris = new HashSet&amp;lt;String&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Set&amp;lt;String&amp;gt; resourceIds = new HashSet&amp;lt;String&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private boolean autoApprove;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Map&amp;lt;String, Object&amp;gt; additionalInformation = new LinkedHashMap&amp;lt;String, Object&amp;gt;();&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-1040" y="240" width="480" height="200" as="geometry" />
        </mxCell>
        <mxCell id="dtGfbLZROhE4GbIlcdWK-26" value="&lt;div&gt;@Bean&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;@Lazy&lt;/span&gt;&lt;/div&gt;&lt;div&gt;@Scope(proxyMode=ScopedProxyMode.INTERFACES)&lt;/div&gt;&lt;div&gt;public &lt;b&gt;ClientDetailsService&lt;/b&gt; clientDetailsService() throws Exception {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return configurer.and().&lt;b&gt;build&lt;/b&gt;();&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;arcSize=6;" parent="1" vertex="1">
          <mxGeometry x="1680" y="800" width="260" height="100" as="geometry" />
        </mxCell>
        <mxCell id="gpTnpa3g8ZrnLY71u2b0-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="gpTnpa3g8ZrnLY71u2b0-1" target="gpTnpa3g8ZrnLY71u2b0-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="480" y="1490" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="gpTnpa3g8ZrnLY71u2b0-1" value="过滤器链的创建&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;这部分是Spring Security的源码&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="240" y="1460" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-28" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="gpTnpa3g8ZrnLY71u2b0-6" target="DjIQ4SRXJKjCJ7x8OOmH-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="gpTnpa3g8ZrnLY71u2b0-6" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;@Bean &lt;br&gt;&lt;/b&gt;Filter &lt;b&gt;springSecurityFilterChain&lt;/b&gt;()&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;详细流程参考spring security 流程图&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="480" y="1460" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="gpTnpa3g8ZrnLY71u2b0-10" value="WebSecurityConfiguration" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="500" y="1430" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-17" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="gpTnpa3g8ZrnLY71u2b0-25" target="C9ku3EbWxnKkE-glZPp3-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-20" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="gpTnpa3g8ZrnLY71u2b0-25" target="C9ku3EbWxnKkE-glZPp3-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="gpTnpa3g8ZrnLY71u2b0-25" value="端点请求处理&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;入参、返回值、异常处理器都是写死的&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="960" y="5280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-1" value="&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;看实际的过滤器链可能会产生疑问：&lt;br&gt;AuthorizationServerSecurityConfiguration配置的&lt;br&gt;那条过滤器链中 BasicAuthenticationFilter 是怎么来的？&lt;br&gt;这里反过来溯源这个过滤器的注册流程&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="719" y="2760" width="270" height="70" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-6" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="DjIQ4SRXJKjCJ7x8OOmH-7" target="DjIQ4SRXJKjCJ7x8OOmH-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-7" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;webSecurity&lt;/b&gt;.&lt;b&gt;build&lt;/b&gt;()&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;构造安全过滤器链，&lt;b&gt;WebSecurity 中可能有多个HttpSecurity&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="720" y="1460" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="DjIQ4SRXJKjCJ7x8OOmH-9" target="DjIQ4SRXJKjCJ7x8OOmH-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-29" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="DjIQ4SRXJKjCJ7x8OOmH-9" target="uCyp3sCYdSISI6nv47Nj-28" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-9" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;beforeInit();&lt;/div&gt;&lt;div&gt;&lt;b&gt;init&lt;/b&gt;();&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1320" y="2160" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="DjIQ4SRXJKjCJ7x8OOmH-11" target="DjIQ4SRXJKjCJ7x8OOmH-12" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1397.57" y="2480" as="sourcePoint" />
            <mxPoint x="1397.57" y="2660" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-31" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="DjIQ4SRXJKjCJ7x8OOmH-11" target="uCyp3sCYdSISI6nv47Nj-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-11" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;beforeConfigure();&lt;/div&gt;&lt;div&gt;&lt;b&gt;configure&lt;/b&gt;();&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1320" y="2420" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-33" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="DjIQ4SRXJKjCJ7x8OOmH-12" target="uCyp3sCYdSISI6nv47Nj-32" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-12" value="&lt;font style=&quot;font-size: 10px&quot;&gt;O result = &lt;b&gt;performBuild&lt;/b&gt;();&lt;br&gt;return result;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;创建过滤器链&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1320" y="2520" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-13" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;AbstractConfiguredSecurityBuilder&lt;br&gt;执行的是HttpSecurity覆盖的方法&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1320" y="2120" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="DjIQ4SRXJKjCJ7x8OOmH-15" target="DjIQ4SRXJKjCJ7x8OOmH-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-30" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="DjIQ4SRXJKjCJ7x8OOmH-15" target="DjIQ4SRXJKjCJ7x8OOmH-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-15" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;beforeInit();&lt;/div&gt;&lt;div&gt;&lt;b&gt;init&lt;/b&gt;();&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="920" y="1460" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="DjIQ4SRXJKjCJ7x8OOmH-17" target="DjIQ4SRXJKjCJ7x8OOmH-19" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1000" y="2120" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-17" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;beforeConfigure();&lt;/div&gt;&lt;div&gt;configure();&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="920" y="1560" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-18" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="DjIQ4SRXJKjCJ7x8OOmH-19" target="DjIQ4SRXJKjCJ7x8OOmH-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-19" value="&lt;font style=&quot;font-size: 10px&quot;&gt;O result = &lt;b&gt;performBuild&lt;/b&gt;();&lt;br&gt;return result;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;创建过滤器链&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="920" y="2160" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-20" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;AbstractConfiguredSecurityBuilder&lt;br&gt;执行的是WebSecurity覆盖的方法&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="910" y="1425" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-21" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="DjIQ4SRXJKjCJ7x8OOmH-25" target="DjIQ4SRXJKjCJ7x8OOmH-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-22" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="DjIQ4SRXJKjCJ7x8OOmH-23" target="DjIQ4SRXJKjCJ7x8OOmH-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-23" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;&quot;&gt;List&amp;lt;SecurityFilterChain&amp;gt; securityFilterChains = new ArrayList&amp;lt;&amp;gt;(&lt;span style=&quot;background-color: initial;&quot;&gt;chainSize);&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1120" y="2160" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-24" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="DjIQ4SRXJKjCJ7x8OOmH-25" target="DjIQ4SRXJKjCJ7x8OOmH-27" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-25" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;for &lt;b&gt;securityFilterChainBuilders&lt;/b&gt;:&amp;nbsp;&lt;br&gt;&lt;/font&gt;securityFilterChains.add(&lt;br&gt;securityFilterChainBuilder.&lt;b&gt;build&lt;/b&gt;());&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;securityFilterChainBuilder 即 &lt;b&gt;HttpSecurity&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1120" y="2240" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-26" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;这个方法主要的作用就是WebSecurity中&lt;br&gt;配置了几个HttpSecurity 就创建几个过滤器链&lt;br&gt;然后创建过滤器链代理&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="890" y="2220" width="230" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-27" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;FilterChainProxy filterChainProxy = new &lt;b&gt;FilterChainProxy&lt;/b&gt;(&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;securityFilterChains)&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1120" y="2340" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-36" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="DjIQ4SRXJKjCJ7x8OOmH-29" target="DjIQ4SRXJKjCJ7x8OOmH-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-29" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;for configurers:&lt;br&gt;configurer.init((B) this);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;此DEMO有两个配置类，这里只分析AuthorizationServerSecurityConfiguration&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1120" y="1460" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-39" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="DjIQ4SRXJKjCJ7x8OOmH-35" target="DjIQ4SRXJKjCJ7x8OOmH-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-35" value="&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;HttpSecurity http = getHttp();&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1360" y="1460" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-41" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="DjIQ4SRXJKjCJ7x8OOmH-38" target="DjIQ4SRXJKjCJ7x8OOmH-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-27" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=1.005;entryY=0.3;entryDx=0;entryDy=0;entryPerimeter=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="DjIQ4SRXJKjCJ7x8OOmH-38" target="uCyp3sCYdSISI6nv47Nj-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-38" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;div&gt;同样创建 AuthenticationManager、HttpSecurity&lt;/div&gt;&lt;div&gt;并往HttpSecurity 中注册一些默认的过滤器配置类&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1600" y="1460" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-44" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="DjIQ4SRXJKjCJ7x8OOmH-40" target="DjIQ4SRXJKjCJ7x8OOmH-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-40" value="&lt;font style=&quot;&quot;&gt;configure(http);&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;执行认证服务器安全配置拓展&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1600" y="1540" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-42" value="WebSecurityConfigurerAdapter" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1610" y="1430" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="DjIQ4SRXJKjCJ7x8OOmH-43" target="uCyp3sCYdSISI6nv47Nj-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-43" value="&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;AuthorizationServerSecurityConfigurer &lt;b&gt;configurer&lt;/b&gt; = new AuthorizationServerSecurityConfigurer();&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1840" y="1540" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DjIQ4SRXJKjCJ7x8OOmH-45" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;默认配置类有10个&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;CsrfConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;ExceptionHandlingConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;HeadersConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;SessionManagementConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;SecurityContextConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;RequestCacheConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;AnonymousConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;ServletApiConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;DefaultLoginPageConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;LogoutConfigurer&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1810" y="1370" width="160" height="150" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-1" value="AuthorizationServerSecurityConfiguration" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1820" y="1510" width="240" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-4" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;" parent="1" source="uCyp3sCYdSISI6nv47Nj-2" target="uCyp3sCYdSISI6nv47Nj-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-2" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;AuthorizationServerSecurityConfiguration&amp;nbsp;&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;构建客户端应用&lt;/span&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// 认证服务器拓展配置&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private List&amp;lt;AuthorizationServerConfigurer&amp;gt; &lt;b&gt;configurers&lt;/b&gt; = Collections.emptyList();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// 客户端应用详情信息服务&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ClientDetailsService &lt;b&gt;clientDetailsService&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// 认证服务请求端点配置&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private &lt;b&gt;AuthorizationServerEndpointsConfiguration&lt;/b&gt; &lt;b&gt;endpoints&lt;/b&gt;;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-560" y="760" width="520" height="120" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-3" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;WebSecurityConfigurerAdapter&lt;/b&gt;&lt;i style=&quot;&quot;&gt;&amp;nbsp;修改&lt;/i&gt;&lt;i style=&quot;background-color: initial;&quot;&gt;配置&lt;/i&gt;&lt;i style=&quot;background-color: initial;&quot;&gt;的窗口类，新版本已经废弃&lt;/i&gt;&lt;/font&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private ApplicationContext context;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private ContentNegotiationStrategy &lt;b&gt;contentNegotiationStrategy&lt;/b&gt; = new HeaderContentNegotiationStrategy();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private ObjectPostProcessor&amp;lt;Object&amp;gt; &lt;b&gt;objectPostProcessor&lt;/b&gt; = new ObjectPostProcessor&amp;lt;Object&amp;gt;() {...};&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private AuthenticationConfiguration &lt;b&gt;authenticationConfiguration&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;//DefaultPasswordEncoderAuthenticationManagerBuilder 用于构造密码编码器和认证管理器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private AuthenticationManagerBuilder &lt;b&gt;authenticationBuilder&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;color: rgb(0 , 127 , 255)&quot;&gt;&amp;nbsp; //DefaultPasswordEncoderAuthenticationManagerBuilder&lt;/span&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(0 , 127 , 255)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private AuthenticationManagerBuilder &lt;b&gt;localConfigureAuthenticationBldr&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private boolean disableLocalConfigureAuthenticationBldr;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private boolean authenticationManagerInitialized;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;//构造的认证管理器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private AuthenticationManager &lt;b&gt;authenticationManager&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;//用于对用户信息鉴权，详细参考后面&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private AuthenticationTrustResolver &lt;b&gt;trustResolver&lt;/b&gt; = new AuthenticationTrustResolverImpl();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private &lt;b&gt;HttpSecurity&lt;/b&gt; &lt;b&gt;http&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private boolean disableDefaults;&lt;/font&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot; size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-560" y="480" width="520" height="240" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="uCyp3sCYdSISI6nv47Nj-5" target="uCyp3sCYdSISI6nv47Nj-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-5" value="&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;FrameworkEndpointHandlerMapping handlerMapping = endpoints.oauth2EndpointHandlerMapping();&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1840" y="1620" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="uCyp3sCYdSISI6nv47Nj-7" target="uCyp3sCYdSISI6nv47Nj-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="uCyp3sCYdSISI6nv47Nj-7" target="uCyp3sCYdSISI6nv47Nj-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-7" value="&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;configure(&lt;b&gt;configurer&lt;/b&gt;);&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;给configurer添加自定义配置&amp;nbsp;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1840" y="1700" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-20" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.942;entryY=-0.013;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="uCyp3sCYdSISI6nv47Nj-9" target="uCyp3sCYdSISI6nv47Nj-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-21" value="&lt;font color=&quot;#007fff&quot;&gt;修改访问条件&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="uCyp3sCYdSISI6nv47Nj-20" vertex="1" connectable="0">
          <mxGeometry x="-0.6592" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-9" value="&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;oauthServerConfigurer&lt;br&gt;.&lt;b&gt;checkTokenAccess&lt;/b&gt;(&quot;isAuthenticated()&quot;);&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;为了修改 /oauth/check_token访问条件：&lt;br&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;非匿名认证用户可访问&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2080" y="1700" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-15" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="uCyp3sCYdSISI6nv47Nj-11" target="uCyp3sCYdSISI6nv47Nj-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-25" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;fillColor=#d5e8d4;strokeColor=#82b366;entryX=0.992;entryY=0.374;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="uCyp3sCYdSISI6nv47Nj-11" target="uCyp3sCYdSISI6nv47Nj-24" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1710" y="1790" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-11" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;http.apply(&lt;b&gt;configurer&lt;/b&gt;);&lt;br&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;将&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;AuthorizationServerSecurityConfigurer&lt;/b&gt;&lt;br&gt;&lt;/font&gt;注册到 HttpSecurity 过滤器配置类列表&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1840" y="1780" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-13" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;OAuth2AuthorizationServerConfig&lt;br&gt;自定义配置类&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2095" y="1665" width="170" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="uCyp3sCYdSISI6nv47Nj-14" target="uCyp3sCYdSISI6nv47Nj-16" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1940" y="1930" />
              <mxPoint x="2020" y="1930" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-14" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;AuthorizationServerEndpointsConfiguration&lt;br&gt;&lt;/font&gt;相关配置&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1840" y="1860" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-26" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="uCyp3sCYdSISI6nv47Nj-16" target="uCyp3sCYdSISI6nv47Nj-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-21" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="uCyp3sCYdSISI6nv47Nj-16" target="J0giTLENruao22hqI6kO-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-16" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;http&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;//此方法会注册&amp;nbsp;&lt;b&gt;ExpressionUrlAuthorizationConfigurer&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;.&lt;b&gt;authorizeRequests&lt;/b&gt;()&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#007fff&quot;&gt;//非匿名和记住我的认证用户可以访问（这里的用户应该指的是客户端应用）&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .antMatchers(tokenEndpointPath).&lt;b&gt;fullyAuthenticated&lt;/b&gt;()&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .antMatchers(tokenKeyPath).access(configurer.getTokenKeyAccess())&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; //默认是denyAll()，要想访问此端点必须修改，上面自定义配置中改成了&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; // isAuthenticated()&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .antMatchers(checkTokenPath).access(configurer.getCheckTokenAccess())&lt;/div&gt;&lt;div&gt;.and()&lt;/div&gt;&lt;div&gt;.requestMatchers()&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .antMatchers(tokenEndpointPath, tokenKeyPath, checkTokenPath)&lt;/div&gt;&lt;div&gt;.and()&lt;/div&gt;&lt;div&gt;.sessionManagement().sessionCreationPolicy(SessionCreationPolicy.NEVER);&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;http.setSharedObject(ClientDetailsService.class, clientDetailsService);&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=4;" parent="1" vertex="1">
          <mxGeometry x="1840" y="1940" width="360" height="180" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-18" value="&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;端点安全配置&lt;br&gt;/oauth/token&lt;br&gt;/oauth/token_key&lt;br&gt;/oauth/check_token&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1730" y="1960" width="110" height="70" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-24" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;配置类共有12个&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;CsrfConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;ExceptionHandlingConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;HeadersConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;SessionManagementConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;SecurityContextConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;RequestCacheConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;AnonymousConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;ServletApiConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;DefaultLoginPageConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;&quot;&gt;LogoutConfigurer&lt;br&gt;&lt;b&gt;AuthorizationServerSecurityConfigurer&lt;/b&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;&quot;&gt;ExpressionUrlAuthorizationConfigurer&lt;br&gt;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1500" y="1720" width="210" height="170" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-35" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="uCyp3sCYdSISI6nv47Nj-28" target="uCyp3sCYdSISI6nv47Nj-34" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-28" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;&quot;&gt;for configurers:&amp;nbsp;&lt;br&gt;&lt;span style=&quot;&quot;&gt;configurer.init((B) this);&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;遍历过滤器配置类( 测试中有12个)执行初始化&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1520" y="2160" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-44" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="uCyp3sCYdSISI6nv47Nj-30" target="uCyp3sCYdSISI6nv47Nj-45" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1720" y="2440" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-52" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="uCyp3sCYdSISI6nv47Nj-30" target="uCyp3sCYdSISI6nv47Nj-50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-30" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;&quot;&gt;for configurers:&amp;nbsp;&lt;br&gt;&lt;span style=&quot;&quot;&gt;configurer.configure((B) this);&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;遍历过滤器配置类执行配置&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;只关注其中两个过滤器配置类&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1520" y="2420" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-32" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;&quot;&gt;Collections.sort(filters, comparator);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;return new &lt;b&gt;DefaultSecurityFilterChain&lt;/b&gt;(&lt;/div&gt;&lt;div style=&quot;&quot;&gt;requestMatcher, filters);&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1520" y="2520" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-37" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="uCyp3sCYdSISI6nv47Nj-34" target="uCyp3sCYdSISI6nv47Nj-36" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-34" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;AuthorizationServerSecurityConfigurer&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;#init(HttpSecurity http)&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;主要关注这个&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1720" y="2160" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-39" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="uCyp3sCYdSISI6nv47Nj-36" target="uCyp3sCYdSISI6nv47Nj-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-36" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;registerDefaultAuthenticationEntryPoint(http);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1960" y="2160" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-41" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="uCyp3sCYdSISI6nv47Nj-38" target="uCyp3sCYdSISI6nv47Nj-40" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2060" y="2310" />
              <mxPoint x="2120" y="2310" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-38" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;http.userDetailsService(new ClientDetailsUserDetailsService(&lt;br&gt;clientDetailsService()));&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1960" y="2240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-40" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;http&lt;/div&gt;&lt;div&gt;&amp;nbsp; .securityContext()&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .securityContextRepository(new NullSecurityContextRepository())&lt;/div&gt;&lt;div&gt;&amp;nbsp; .and()&lt;/div&gt;&lt;div&gt;&amp;nbsp; .csrf().disable()&lt;/div&gt;&lt;div&gt;&amp;nbsp; .httpBasic().realmName(realm);&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;这里关闭了CSRF配置，添加了BASIC配置&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;arcSize=7;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1960" y="2320" width="320" height="80" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-42" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;配置类变更为：&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;color: rgb(0, 127, 255); background-color: initial;&quot;&gt;ExceptionHandlingConfigurer&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;HeadersConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;SessionManagementConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;SecurityContextConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;RequestCacheConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;AnonymousConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;ServletApiConfigurer&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;strike&gt;DefaultLoginPageConfigurer&lt;/strike&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;&quot;&gt;LogoutConfigurer&lt;br&gt;&lt;b&gt;AuthorizationServerSecurityConfigurer&lt;/b&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;&quot;&gt;ExpressionUrlAuthorizationConfigurer&lt;br&gt;HttpBasicConfigurer&lt;br&gt;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1720" y="2230" width="210" height="170" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-47" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="uCyp3sCYdSISI6nv47Nj-45" target="uCyp3sCYdSISI6nv47Nj-46" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-45" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;AuthorizationServerSecurityConfigurer&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;&quot;&gt;#&lt;/b&gt;&lt;b&gt;configure&lt;/b&gt;&lt;b style=&quot;&quot;&gt;(HttpSecurity http)&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1720" y="2420" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-49" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="uCyp3sCYdSISI6nv47Nj-46" target="uCyp3sCYdSISI6nv47Nj-48" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-46" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;frameworkEndpointHandlerMapping();&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1960" y="2420" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-48" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;div style=&quot;&quot;&gt;http.exceptionHandling()&lt;/div&gt;&lt;div style=&quot;&quot;&gt;.accessDeniedHandler(accessDeniedHandler);&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;替换&amp;nbsp;ExceptionHandlingConfigurer&amp;nbsp;&lt;br&gt;accessDeniedHandler 为 &lt;b&gt;OAuth2AccessDeniedHandler&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1960" y="2500" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-54" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="uCyp3sCYdSISI6nv47Nj-50" target="uCyp3sCYdSISI6nv47Nj-53" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-50" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;ExpressionUrlAuthorizationConfigurer&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;#&lt;/b&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;configure&lt;/b&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;(H http)&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;b&gt;&lt;font color=&quot;#007fff&quot;&gt;将基于SpEL表达式和URL的授权添加到应用程序&lt;/font&gt;&lt;/b&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1720" y="2580" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-56" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="uCyp3sCYdSISI6nv47Nj-53" target="uCyp3sCYdSISI6nv47Nj-55" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-137" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="uCyp3sCYdSISI6nv47Nj-53" target="BTdmhbfbiTqf7HtIRt79-134" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1940" y="2640" />
              <mxPoint x="1940" y="3920" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="eSneWQZtIDrDD-FYfVUk-12" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="uCyp3sCYdSISI6nv47Nj-53" target="eSneWQZtIDrDD-FYfVUk-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-53" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;FilterInvocationSecurityMetadataSource &lt;b&gt;metadataSource&lt;/b&gt; = createMetadataSource(http);&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1960" y="2580" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-59" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="uCyp3sCYdSISI6nv47Nj-55" target="uCyp3sCYdSISI6nv47Nj-58" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-55" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;FilterSecurityInterceptor securityInterceptor = &lt;b&gt;createFilterSecurityInterceptor&lt;/b&gt;(&lt;span style=&quot;background-color: initial;&quot;&gt;http, &lt;b&gt;metadataSource&lt;/b&gt;, http.getSharedObject(&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;AuthenticationManager.class));&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1960" y="2660" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-57" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;{AntPathRequestMatcher@8160} &quot;Ant [pattern=&#39;/oauth/token&#39;]&quot; -&amp;gt; {ArrayList@8161}&amp;nbsp; size = 1&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;key = {AntPathRequestMatcher@8160} &quot;&lt;b&gt;Ant [pattern=&#39;/oauth/token&#39;]&lt;/b&gt;&quot;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;value = {ArrayList@8161}&amp;nbsp; size = 1&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; 0 = {SecurityConfig@8170} &quot;&lt;b&gt;fullyAuthenticated&lt;/b&gt;&quot;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;{AntPathRequestMatcher@8162} &quot;Ant [pattern=&#39;/oauth/token_key&#39;]&quot; -&amp;gt; {ArrayList@8163}&amp;nbsp; size = 1&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;key = {AntPathRequestMatcher@8162} &quot;Ant [pattern=&#39;/oauth/token_key&#39;]&quot;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;value = {ArrayList@8163}&amp;nbsp; size = 1&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; 0 = {SecurityConfig@8174} &quot;denyAll()&quot;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;{AntPathRequestMatcher@8164} &quot;Ant [pattern=&#39;/oauth/check_token&#39;]&quot; -&amp;gt; {ArrayList@8165}&amp;nbsp; size = 1&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;key = {AntPathRequestMatcher@8164} &quot;Ant [&lt;b&gt;pattern=&#39;/oauth/check_token&#39;&lt;/b&gt;]&quot;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;value = {ArrayList@8165}&amp;nbsp; size = 1&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; 0 = {SecurityConfig@8177} &quot;&lt;b&gt;isAuthenticated&lt;/b&gt;()&quot;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=top;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2440" y="2480" width="470" height="160" as="geometry" />
        </mxCell>
        <mxCell id="uCyp3sCYdSISI6nv47Nj-58" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;http.&lt;b&gt;addFilter&lt;/b&gt;(securityInterceptor);&lt;/div&gt;&lt;div&gt;http.setSharedObject(&lt;/div&gt;&lt;div&gt;FilterSecurityInterceptor.class, securityInterceptor);&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1960" y="2740" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-17" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-4" target="BTdmhbfbiTqf7HtIRt79-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-4" value="OncePerRequestFilter#doFilter()&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;大部分过滤器都继承此过滤器&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1200.5" y="2880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-19" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-11" target="BTdmhbfbiTqf7HtIRt79-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-11" value="BasicAuthenticationFilter#&lt;b&gt;doFilterInternal&lt;/b&gt;()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1440" y="2880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-23" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-18" target="BTdmhbfbiTqf7HtIRt79-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-18" value="String header = request.getHeader(&quot;&lt;b&gt;Authorization&lt;/b&gt;&quot;);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1680" y="2880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-26" value="N" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-22" target="BTdmhbfbiTqf7HtIRt79-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-28" value="Y" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-22" target="BTdmhbfbiTqf7HtIRt79-27" edge="1">
          <mxGeometry x="0.6667" y="-10" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-22" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;header != null &amp;amp;&amp;amp; header.toLowerCase()&lt;br&gt;.startsWith(&quot;&lt;b&gt;basic&lt;/b&gt; &quot;)&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="1720" y="2960" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-25" value="直接走下一个过滤器" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="1920" y="2970" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-34" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-27" target="BTdmhbfbiTqf7HtIRt79-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-27" value="String[] tokens = this.extractAndDecodeHeader(header, request);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;提取用于Basic认证的信息，tokens[0]是用户名，tokens[1]是密码&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1680" y="3060" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-30" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;Basic认证信息是将用户名密码通过“:”连接，&lt;br&gt;然后经过Base64编码，然后添加“Basic ”前缀生成&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1888" y="3070" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-36" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-33" target="BTdmhbfbiTqf7HtIRt79-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-41" value="N" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="BTdmhbfbiTqf7HtIRt79-36" vertex="1" connectable="0">
          <mxGeometry x="-0.1208" y="-2" relative="1" as="geometry">
            <mxPoint x="5" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-46" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-33" target="BTdmhbfbiTqf7HtIRt79-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-33" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;this&lt;br&gt;.authenticationIsRequired(&lt;br&gt;username)&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="1720" y="3140" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-35" value="直接走下一个过滤器" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="1920" y="3150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-44" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-39" target="BTdmhbfbiTqf7HtIRt79-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-39" value="&lt;div&gt;UsernamePasswordAuthenticationToken authRequest = new &lt;b&gt;UsernamePasswordAuthenticationToken&lt;/b&gt;(&lt;/div&gt;&lt;div&gt;username, tokens[1]);&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1920" y="3240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-42" value="&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;是否需要认证&lt;/b&gt;：&lt;br&gt;检查安全上下文是否已经存在认证信息，&lt;br&gt;不存在或信息未经过认证或认证的信息是匿名认证信息&lt;br&gt;或认证信息是用户名密码认证信息但不是当前用户的认证信息&lt;br&gt;都需要认证&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1455" y="3145" width="290" height="70" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-49" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-43" target="BTdmhbfbiTqf7HtIRt79-48" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-65" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-43" target="BTdmhbfbiTqf7HtIRt79-64" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-43" value="authRequest.setDetails(this&lt;br&gt;.authenticationDetailsSource&lt;br&gt;.&lt;b&gt;buildDetails&lt;/b&gt;(request));" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1920" y="3320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-47" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-45" target="BTdmhbfbiTqf7HtIRt79-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-57" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-45" target="BTdmhbfbiTqf7HtIRt79-56" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-45" value="&lt;div&gt;BASIC认证流程&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1680" y="3240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-51" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-48" target="BTdmhbfbiTqf7HtIRt79-50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-69" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-48" target="BTdmhbfbiTqf7HtIRt79-68" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-48" value="Authentication authResult = this.authenticationManager&lt;br&gt;.authenticate(authRequest);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;调用认证管理器中的认证服务进行认证&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1920" y="3420" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-53" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-50" target="BTdmhbfbiTqf7HtIRt79-52" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-143" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;entryX=0.996;entryY=0.056;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;entryPerimeter=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-50" target="BTdmhbfbiTqf7HtIRt79-141" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2130" y="3560" />
              <mxPoint x="2130" y="4003" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-50" value="SecurityContextHolder.getContext()&lt;br&gt;.setAuthentication(authResult);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;保存认证结果到安全上下文&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1920" y="3500" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-52" value="this.&lt;b&gt;rememberMeServices&lt;/b&gt;&lt;br&gt;.loginSuccess(request, response, authResult);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1920" y="3580" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-56" value="&lt;div&gt;走下一个过滤器&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1680" y="3320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-67" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;endArrow=diamondThin;endFill=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-61" target="BTdmhbfbiTqf7HtIRt79-66" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-74" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-61" target="BTdmhbfbiTqf7HtIRt79-70" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-75" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-61" target="BTdmhbfbiTqf7HtIRt79-71" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-61" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;AbstractAuthenticationToken&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;// 权限列表，如角色等,认证通过后获取&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final Collection&amp;lt;GrantedAuthority&amp;gt; &lt;b&gt;authorities&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;// 身份认证细节信息(比如请求来源IP、SessionId等)&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private Object &lt;b&gt;details&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;// 是否已经认证过&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private boolean &lt;b&gt;authenticated&lt;/b&gt; = false;&lt;/font&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-400" y="2720" width="360" height="120" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-62" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;endArrow=block;endFill=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-63" target="BTdmhbfbiTqf7HtIRt79-61" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-63" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;UsernamePasswordAuthenticationToken&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;// 意为“当事人&lt;/font&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;”，此处是用户名&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;// 此单词容易和principle（原则）混淆发音相同&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private final Object principal;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;// 凭证，即密码信息&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;private Object credentials;&lt;/font&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-400" y="2880" width="360" height="120" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-64" value="authRequest.setDetails(this&lt;br&gt;.authenticationDetailsSource&lt;br&gt;.&lt;b&gt;buildDetails&lt;/b&gt;(request));" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2160" y="3320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-66" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;WebAuthenticationDetails&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;// 请求来源IP地址&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final String &lt;b&gt;remoteAddress&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// 会话ID&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final String &lt;b&gt;sessionId&lt;/b&gt;;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-800" y="2720" width="360" height="120" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-79" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-68" target="BTdmhbfbiTqf7HtIRt79-78" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-68" value="for&amp;nbsp;getProviders():&lt;br&gt;&lt;div&gt;if (!provider.supports(toTest)) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; continue;&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="2160" y="3420" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-73" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-70" target="BTdmhbfbiTqf7HtIRt79-72" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-70" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;Authentication &lt;/b&gt;(I)&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-240" y="2640" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-71" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;CredentialsContainer&lt;/b&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;(I)&lt;/span&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-480" y="2640" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-72" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;Principal&lt;/b&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;(I)&lt;/span&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-240" y="2580" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-77" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;ProviderManager&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2210" y="3390" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-82" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-78" target="BTdmhbfbiTqf7HtIRt79-81" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-88" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-78" target="BTdmhbfbiTqf7HtIRt79-87" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-78" value="result = provider.authenticate(authentication);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2160" y="3500" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-80" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;DaoAuthenticationProvider&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2190" y="3477" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-84" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-81" target="BTdmhbfbiTqf7HtIRt79-83" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-81" value="&lt;div&gt;user = &lt;b&gt;retrieveUser&lt;/b&gt;(username,&lt;/div&gt;&lt;div&gt;(UsernamePasswordAuthenticationToken) authentication);&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2400" y="3500" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-86" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-83" target="BTdmhbfbiTqf7HtIRt79-85" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-83" value="UserDetails loadedUser = this.&lt;b&gt;getUserDetailsService&lt;/b&gt;()&lt;br&gt;.loadUserByUsername(username);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;此处的UserDetailsService是ClientDetailsUserDetailsService&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2640" y="3500" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-85" value="return new User(username, clientSecret, clientDetails.getAuthorities());" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2640" y="3580" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-90" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-87" target="BTdmhbfbiTqf7HtIRt79-89" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-87" value="preAuthenticationChecks.check(user);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;认证前置检查：检查用户是否有效（isEnabled()、isAccountNonExpired()）&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2160" y="3580" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-92" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-89" target="BTdmhbfbiTqf7HtIRt79-91" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-89" value="&lt;div&gt;additionalAuthenticationChecks(user,&lt;/div&gt;&lt;div&gt;(UsernamePasswordAuthenticationToken) authentication);&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;检查输入的密码和保存的密码是否相同&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2160" y="3660" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-94" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-91" target="BTdmhbfbiTqf7HtIRt79-93" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-91" value="postAuthenticationChecks.check(user);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;检查凭证是否过期&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2160" y="3740" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-96" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-93" target="BTdmhbfbiTqf7HtIRt79-95" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-98" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-93" target="BTdmhbfbiTqf7HtIRt79-97" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-93" value="return createSuccessAuthentication(&lt;br&gt;principalToReturn, authentication, user);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;添加上权限信息&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="2160" y="3820" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-95" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;usernamePasswordAuthenticationToken result = new &lt;b&gt;UsernamePasswordAuthenticationToken&lt;/b&gt;(&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;principal, authentication.getCredentials(),&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;authoritiesMapper.&lt;b&gt;mapAuthorities&lt;/b&gt;(&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;user.getAuthorities()));&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot; style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;result.setDetails(authentication.getDetails());&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;return result;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2390" y="3810" width="220" height="80" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-97" value="&lt;div&gt;if (eraseCredentialsAfterAuthentication&lt;/div&gt;&lt;div&gt;&amp;amp;&amp;amp; (result instanceof CredentialsContainer)) {&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;((CredentialsContainer)result).eraseCredentials();&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;}&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;清除认证信息中的密码信息，为了安全，默认总是清除&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="2150" y="3900" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-102" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-99" target="BTdmhbfbiTqf7HtIRt79-110" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1300" y="3923" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-99" value="FilterInvocation fi = new FilterInvocation(request, response, chain);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1200" y="3840" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-103" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;FilterInvocation&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;private FilterChain &lt;/span&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;chain&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;;&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private HttpServletRequest &lt;b&gt;request&lt;/b&gt;;&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private HttpServletResponse &lt;b&gt;response&lt;/b&gt;;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-400" y="3040" width="360" height="100" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-108" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-110" target="BTdmhbfbiTqf7HtIRt79-112" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-110" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;&lt;b&gt;invoke&lt;/b&gt;(fi)&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;鉴权失败就发失败事件并抛异常；&lt;br&gt;鉴权成功发布成功事件生成 TOKEN 并存储到安全上下文&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1200" y="3920" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-133" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-112" target="BTdmhbfbiTqf7HtIRt79-132" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-135" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-112" target="BTdmhbfbiTqf7HtIRt79-134" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-112" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;InterceptorStatusToken &lt;b&gt;token&lt;/b&gt; = super.&lt;b&gt;beforeInvocation&lt;/b&gt;(fi);&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1439" y="3920" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-113" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-114" target="BTdmhbfbiTqf7HtIRt79-117" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-142" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-114" target="BTdmhbfbiTqf7HtIRt79-141" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-114" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;Authentication authenticated = this.authenticateIfRequired()&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;读取认证信息&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1680" y="4000" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-115" value="鉴权失败" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;exitX=0.943;exitY=0.511;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-145" target="BTdmhbfbiTqf7HtIRt79-121" edge="1">
          <mxGeometry x="-0.1498" y="11" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-116" value="鉴权成功" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-145" target="BTdmhbfbiTqf7HtIRt79-123" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-146" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-117" target="BTdmhbfbiTqf7HtIRt79-145" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-148" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-117" target="BTdmhbfbiTqf7HtIRt79-147" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-117" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;this.&lt;b&gt;accessDecisionManager&lt;/b&gt;.decide(&lt;br&gt;authenticated, object, attributes);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;上面了获取了&lt;b&gt;认证信息&lt;/b&gt;和&lt;b&gt;访问权限要求&lt;/b&gt;，&lt;br&gt;执行&lt;b&gt;访问权限判定&lt;/b&gt;（鉴权）&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1680" y="4080" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-118" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-132" target="BTdmhbfbiTqf7HtIRt79-120" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1400" y="4030.000000000001" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-120" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;super.&lt;b&gt;afterInvocation&lt;/b&gt;(token, null);&lt;br&gt;finally:&lt;br&gt;super.finallyInvocation(token);&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1439" y="4080" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-121" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;catch AccessDeniedException:&amp;nbsp;&lt;br&gt;发布 AuthorizationFailureEvent&lt;br&gt;&lt;/span&gt;然后重新抛 throw&amp;nbsp;AccessDeniedException&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1920" y="4710" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-122" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-123" target="BTdmhbfbiTqf7HtIRt79-125" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-123" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;发布 AuthorizedEvent&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1681" y="4820" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-124" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-125" target="BTdmhbfbiTqf7HtIRt79-128" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-46" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-125" target="J0giTLENruao22hqI6kO-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-125" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;Authentication runAs = this.&lt;b&gt;runAsManager&lt;/b&gt;.&lt;b&gt;buildRunAs&lt;/b&gt;(&lt;br&gt;authenticated, object, attributes);&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1680.5" y="4900" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-126" value="Y" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-128" target="BTdmhbfbiTqf7HtIRt79-129" edge="1">
          <mxGeometry x="0.425" relative="1" as="geometry">
            <mxPoint x="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-149" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-128" target="BTdmhbfbiTqf7HtIRt79-130" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-150" value="&lt;font color=&quot;#007fff&quot;&gt;N&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="BTdmhbfbiTqf7HtIRt79-149" vertex="1" connectable="0">
          <mxGeometry x="-0.15" y="2" relative="1" as="geometry">
            <mxPoint x="-3" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-128" value="&lt;font style=&quot;font-size: 10px&quot;&gt;runAs == null&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="1740" y="4980" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-129" value="&lt;font style=&quot;font-size: 10px&quot;&gt;return new &lt;b&gt;InterceptorStatusToken&lt;/b&gt;(&lt;br&gt;SecurityContextHolder.getContext(), &lt;br&gt;false, attributes, object);&lt;/font&gt;" style="whiteSpace=wrap;html=1;rounded=1;arcSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1920" y="4990" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-48" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-130" target="J0giTLENruao22hqI6kO-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-130" value="&lt;div style=&quot;font-size: 8px&quot;&gt;&lt;div&gt;SecurityContext origCtx = SecurityContextHolder.getContext();&lt;/div&gt;&lt;div&gt;SecurityContextHolder.&lt;b&gt;setContext&lt;/b&gt;(SecurityContextHolder&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&#x9;&lt;/span&gt;.createEmptyContext());&lt;/div&gt;&lt;div&gt;SecurityContextHolder.getContext().&lt;b&gt;setAuthentication&lt;/b&gt;(runAs);&lt;/div&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;align=left;arcSize=9;" parent="1" vertex="1">
          <mxGeometry x="1660" y="5100" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-132" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;fi.getChain().doFilter(fi.getRequest(), fi.getResponse());&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1439" y="4000" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-136" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-134" target="BTdmhbfbiTqf7HtIRt79-114" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-134" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;&lt;div&gt;Collection&amp;lt;ConfigAttribute&amp;gt; attributes = this.&lt;b&gt;obtainSecurityMetadataSource&lt;/b&gt;()&lt;/div&gt;&lt;div&gt;.getAttributes(object);&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;object 是 FilterInvocation，这里是获取 object 内请求对应的配置属性（访问权限）&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1680" y="3920" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-140" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;就是查 metadataSource 中当前请求URL对应的&lt;br&gt;ConfigAttrubute&lt;br&gt;比如 /oauth/token &lt;b&gt;访问权限要求&lt;/b&gt;&lt;br&gt;{SecurityConfig@8170} &quot;&lt;b&gt;fullyAuthenticated&lt;/b&gt;&quot;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1882" y="3915" width="230" height="70" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-141" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;&lt;div style=&quot;&quot;&gt;Authentication authentication = SecurityContextHolder.getContext()&lt;/div&gt;&lt;div style=&quot;&quot;&gt;.getAuthentication();&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;从安全上下文中读取认证信息&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1920" y="4000" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-144" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;FilterSecurityInterceptor&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-400" y="2360" width="360" height="120" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-145" value="&lt;font style=&quot;font-size: 10px&quot;&gt;鉴权通过？&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="1739.5" y="4700" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-156" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-147" target="BTdmhbfbiTqf7HtIRt79-155" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-147" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;for (AccessDecisionVoter voter : getDecisionVoters())&lt;br&gt;&lt;/font&gt;" style="whiteSpace=wrap;html=1;rounded=1;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="1920" y="4105" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-151" value="AffirmativeBased" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1965" y="4075" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-152" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;for end&lt;br&gt;&lt;/font&gt;" style="whiteSpace=wrap;html=1;rounded=1;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="1920" y="4660" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-158" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-155" target="BTdmhbfbiTqf7HtIRt79-157" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-165" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-155" target="BTdmhbfbiTqf7HtIRt79-164" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-155" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;int result = voter.vote(authentication, object, configAttributes);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;投票3种结果：GRANTED(赞成)、ABSTAIN（弃权）、DENIED（拒绝）&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1920" y="4160" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-160" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-157" target="BTdmhbfbiTqf7HtIRt79-159" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-157" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;switch (result) {&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;case AccessDecisionVoter.ACCESS_GRANTED:&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; return;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;case AccessDecisionVoter.ACCESS_DENIED:&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; deny++;&amp;nbsp;&lt;/font&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;break;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;default:&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; break;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;}&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;arcSize=7;" parent="1" vertex="1">
          <mxGeometry x="1920" y="4360" width="200" height="90" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-162" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-159" target="BTdmhbfbiTqf7HtIRt79-161" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-159" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;if (deny &amp;gt; 0) {&lt;br&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; throw new AccessDeniedException(...)&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;&quot;&gt;}&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="1920" y="4470" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-163" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-161" target="BTdmhbfbiTqf7HtIRt79-152" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-44" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-161" target="J0giTLENruao22hqI6kO-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-161" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;checkAllowIfAllAbstainDecisions();&lt;br&gt;&lt;span style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;所有Voter都没有投ACCESS_GRANTED和ACCESS_DENIED，5.1.7版本暂时是&lt;/font&gt;&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;" parent="1" vertex="1">
          <mxGeometry x="1920" y="4570" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-173" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-164" target="BTdmhbfbiTqf7HtIRt79-172" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2260" y="4230" />
              <mxPoint x="2260" y="4230" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-164" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;WebExpressionConfigAttribute weca = &lt;b&gt;findConfigAttribute&lt;/b&gt;(attributes);&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;if (weca == null) {&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; return &lt;b&gt;ACCESS_ABSTAIN&lt;/b&gt;;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;访问权限要求为空就投弃权票&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;arcSize=9;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2160" y="4150" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-166" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&lt;b&gt;认证信息：&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;authentication = {UsernamePasswordAuthenticationToken@8757}&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;&lt;b&gt;principal&lt;/b&gt; = {User@8760}&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; password = null&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; username = &quot;client-gateway&quot;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; authorities = {Collections$UnmodifiableSet@8766}&amp;nbsp; size = 0&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; accountNonExpired = true&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; accountNonLocked = true&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; credentialsNonExpired = true&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; enabled = true&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;&lt;b&gt;credentials&lt;/b&gt; = null&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;&lt;b&gt;authorities&lt;/b&gt; = {Collections$UnmodifiableRandomAccessList@8761}&amp;nbsp; size = 0&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;&lt;b&gt;details&lt;/b&gt; = {WebAuthenticationDetails@8762}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;&lt;b&gt;authenticated&lt;/b&gt; = true&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1560" y="4160" width="370" height="180" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-167" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;WebExpressionVoter&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;测试案例中只注册了这个Voter&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2185" y="4110" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-168" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&lt;b&gt;权限判定规则：&lt;br&gt;&lt;/b&gt;1. 有任一一个Voter投ACCESS_GRANTED就认定是权限判定通过；&lt;br&gt;2. 若没有Voter投ACCESS_GRANTED, 有任一Voter投&lt;/font&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;ACCESS_DENIED就认定权限判定不通过，抛AccessDeniedException；&lt;br&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;3. 所有Voter都投ABSTAIN弃权，执行加持判定&amp;nbsp;&lt;/font&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;checkAllowIfAllAbstainDecisions()，默认全弃权是不通过&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1560" y="4420" width="330" height="105" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-176" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-172" target="BTdmhbfbiTqf7HtIRt79-175" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eSneWQZtIDrDD-FYfVUk-5" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-172" target="eSneWQZtIDrDD-FYfVUk-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-172" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;&quot;&gt;EvaluationContext ctx = expressionHandler&lt;/div&gt;&lt;div style=&quot;&quot;&gt;.&lt;b&gt;createEvaluationContext&lt;/b&gt;(&lt;span style=&quot;background-color: initial;&quot;&gt;authentication,fi);&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;ctx = weca.postProcess(ctx, fi);&lt;/span&gt;&lt;/div&gt;&lt;font color=&quot;#007fff&quot;&gt;创建评估上下文,&amp;nbsp; 这里对SpEL做了封装&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2160" y="4250" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-174" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;labelPosition=left;verticalLabelPosition=middle;align=right;verticalAlign=middle;" parent="1" vertex="1">
          <mxGeometry x="1890" y="4360" width="20" height="270" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-178" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="BTdmhbfbiTqf7HtIRt79-175" target="BTdmhbfbiTqf7HtIRt79-177" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-175" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;return ExpressionUtils.&lt;b&gt;evaluateAsBoolean&lt;/b&gt;(&lt;/div&gt;&lt;div&gt;weca.getAuthorizeExpression(), ctx) ? ACCESS_GRANTED&lt;/div&gt;&lt;div&gt;: ACCESS_DENIED;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;结合认证信息和权限要求评估结果&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2160" y="4490" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-38" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-177" target="J0giTLENruao22hqI6kO-37" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-25" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="BTdmhbfbiTqf7HtIRt79-177" target="C9ku3EbWxnKkE-glZPp3-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-177" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;return ((Boolean) expr.&lt;b&gt;getValue&lt;/b&gt;(ctx, Boolean.class)).booleanValue();&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;执行表达式获取结果&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="2400" y="4490" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BTdmhbfbiTqf7HtIRt79-179" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;理解这部分需要对SpEL用法有所了解&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2405" y="4220" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="eSneWQZtIDrDD-FYfVUk-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="eSneWQZtIDrDD-FYfVUk-4" target="eSneWQZtIDrDD-FYfVUk-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eSneWQZtIDrDD-FYfVUk-4" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;SecurityExpressionOperations root = createSecurityExpressionRoot(&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;authentication,&amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;invocation);&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;这个作为SpEL上下文根对象，即表达式执行基于这个对象&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2400" y="4250" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eSneWQZtIDrDD-FYfVUk-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="eSneWQZtIDrDD-FYfVUk-6" target="J0giTLENruao22hqI6kO-12" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2640" y="4360" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-15" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="eSneWQZtIDrDD-FYfVUk-6" target="J0giTLENruao22hqI6kO-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eSneWQZtIDrDD-FYfVUk-6" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;div&gt;StandardEvaluationContext ctx = &lt;b&gt;createEvaluationContextInternal&lt;/b&gt;(&lt;/div&gt;&lt;div&gt;authentication,invocation);&lt;/div&gt;&lt;div&gt;ctx.&lt;b&gt;setBeanResolver&lt;/b&gt;(br);&lt;/div&gt;&lt;div&gt;ctx.&lt;b&gt;setRootObject&lt;/b&gt;(root);&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2400" y="4330" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-27" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="eSneWQZtIDrDD-FYfVUk-11" target="eSneWQZtIDrDD-FYfVUk-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eSneWQZtIDrDD-FYfVUk-11" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;LinkedHashMap&amp;lt;RequestMatcher, Collection&amp;lt;ConfigAttribute&amp;gt;&amp;gt; requestMap = REGISTRY&lt;/div&gt;&lt;div&gt;.&lt;b&gt;createRequestMap&lt;/b&gt;();&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2200" y="2580" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eSneWQZtIDrDD-FYfVUk-16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="eSneWQZtIDrDD-FYfVUk-13" target="eSneWQZtIDrDD-FYfVUk-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-26" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="eSneWQZtIDrDD-FYfVUk-13" target="J0giTLENruao22hqI6kO-25" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2300" y="3040" />
              <mxPoint x="2330" y="3040" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="eSneWQZtIDrDD-FYfVUk-13" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;SecurityExpressionHandler&amp;lt;FilterInvocation&amp;gt;&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;handler = &lt;b&gt;getExpressionHandler&lt;/b&gt;(H http);&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2200" y="2660" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="eSneWQZtIDrDD-FYfVUk-15" target="J0giTLENruao22hqI6kO-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eSneWQZtIDrDD-FYfVUk-15" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;DefaultWebSecurityExpressionHandler defaultHandler = new &lt;b&gt;DefaultWebSecurityExpressionHandler&lt;/b&gt;();&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2500" y="2660" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J3NxKL5-JepfH3MhewFd-3" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=1;dashed=1;" parent="1" source="J3NxKL5-JepfH3MhewFd-1" target="J3NxKL5-JepfH3MhewFd-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="J3NxKL5-JepfH3MhewFd-5" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=1;dashed=1;" parent="1" source="J3NxKL5-JepfH3MhewFd-1" target="J3NxKL5-JepfH3MhewFd-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="J3NxKL5-JepfH3MhewFd-1" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;AntPathReqeustMatcher &lt;/b&gt;ant格式的URL匹配器&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// 匹配所有URL的样式&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private static final String MATCH_ALL = &quot;/**&quot;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Matcher &lt;b&gt;matcher&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//匹配样式&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final String &lt;b&gt;pattern&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//匹配的HTTP Method&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final HttpMethod &lt;b&gt;httpMethod&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//是否区分大小写&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final boolean &lt;b&gt;caseSensitive&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final UrlPathHelper &lt;b&gt;urlPathHelper&lt;/b&gt;;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-760" y="1460" width="320" height="180" as="geometry" />
        </mxCell>
        <mxCell id="J3NxKL5-JepfH3MhewFd-2" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;RequestMatcher&lt;/b&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;(I)&lt;/span&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-600" y="1380" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="J3NxKL5-JepfH3MhewFd-4" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;RequestVariablesExtractor&lt;/b&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;(I)&lt;/span&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-780" y="1380" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="J3NxKL5-JepfH3MhewFd-8" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=1;dashed=1;" parent="1" source="J3NxKL5-JepfH3MhewFd-6" target="J3NxKL5-JepfH3MhewFd-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="J3NxKL5-JepfH3MhewFd-6" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;SecurityConfig&lt;/b&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;保存安全配置属性&lt;/span&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//属性，就一个字符串&lt;br&gt;&lt;/font&gt;private final String attrib;&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-1120" y="1460" width="320" height="80" as="geometry" />
        </mxCell>
        <mxCell id="J3NxKL5-JepfH3MhewFd-7" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;ConfigAttribute&lt;/b&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;(I)&lt;/span&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-1040" y="1380" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="J3NxKL5-JepfH3MhewFd-14" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;endArrow=diamondThin;endFill=1;" parent="1" source="J3NxKL5-JepfH3MhewFd-9" target="J3NxKL5-JepfH3MhewFd-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="J3NxKL5-JepfH3MhewFd-9" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;ExpressionUrlAuthorizationConfigurer &lt;/b&gt;注册基于SpEL的授权逻辑&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// 匹配所有URL的样式&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;static final String permitAll = &quot;permitAll&quot;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private static final String denyAll = &quot;denyAll&quot;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private static final String anonymous = &quot;anonymous&quot;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private static final String authenticated = &quot;authenticated&quot;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private static final String fullyAuthenticated = &quot;fullyAuthenticated&quot;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private static final String rememberMe = &quot;rememberMe&quot;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//URL映射信息，包括 &lt;b&gt;AntPathRequestMatcher&lt;/b&gt; -&amp;gt; &lt;b&gt;SecurityConfig&lt;/b&gt; 的列表&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ExpressionInterceptUrlRegistry &lt;b&gt;REGISTRY&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private SecurityExpressionHandler&amp;lt;FilterInvocation&amp;gt; &lt;b&gt;expressionHandler&lt;/b&gt;;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-400" y="1460" width="360" height="180" as="geometry" />
        </mxCell>
        <mxCell id="J3NxKL5-JepfH3MhewFd-13" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;dashed=1;endArrow=block;endFill=1;" parent="1" source="J3NxKL5-JepfH3MhewFd-11" target="J3NxKL5-JepfH3MhewFd-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="J3NxKL5-JepfH3MhewFd-11" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;DefaultWebSecurityExpressionHandler&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;private AuthenticationTrustResolver &lt;/span&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;trustResolver&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt; = new AuthenticationTrustResolverImpl();&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private String defaultRolePrefix = &quot;ROLE_&quot;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#3333ff&quot;&gt;//继承自 AbstractSecurityExpressionHandler&amp;lt;T&amp;gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ExpressionParser &lt;b&gt;expressionParser&lt;/b&gt; = new &lt;b&gt;SpelExpressionParser&lt;/b&gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//用于查询Bean实例，实现类是BeanFactoryResolver, 猜也可以猜到里面肯定包含BeanFactory&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private BeanResolver &lt;b&gt;br&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//测试DEMO中是空的，todo&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private RoleHierarchy &lt;b&gt;roleHierarchy&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//测试DEMO中是空的，todo&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private PermissionEvaluator &lt;b&gt;permissionEvaluator&lt;/b&gt; = new DenyAllPermissionEvaluator();&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//继承自&amp;nbsp;AbstractSecurityExpressionHandler&amp;lt;T&amp;gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//创建SpEL根对象&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;protected abstract SecurityExpressionOperations &lt;b&gt;createSecurityExpressionRoot&lt;/b&gt;(&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;Authentication authentication, T invocation);&lt;/span&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-880" y="1800" width="440" height="220" as="geometry" />
        </mxCell>
        <mxCell id="J3NxKL5-JepfH3MhewFd-12" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;SecurityExpressionHandler&lt;/b&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;(I)&lt;/span&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//获取SpEL ExpressionParser&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;ExpressionParser &lt;b&gt;getExpressionParser&lt;/b&gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//创建SpEL EvaluationContext&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;EvaluationContext &lt;b&gt;createEvaluationContext&lt;/b&gt;(Authentication authentication, T invocation);&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-880" y="1680" width="440" height="80" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="J0giTLENruao22hqI6kO-1" target="J0giTLENruao22hqI6kO-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-1" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;AuthenticationTrustResolver trustResolver = http&lt;span style=&quot;background-color: initial;&quot;&gt;.getSharedObject(&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;b&gt;AuthenticationTrustResolver&lt;/b&gt;.class);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;defaultHandler.setTrustResolver(trustResolver);&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2490" y="2740" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="J0giTLENruao22hqI6kO-3" target="J0giTLENruao22hqI6kO-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-3" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;defaultHandler.setRoleHierarchy(&lt;/div&gt;&lt;div&gt;context.getBean(roleHiearchyBeanNames[0], &lt;b&gt;RoleHierarchy&lt;/b&gt;.class));&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2500" y="2820" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="J0giTLENruao22hqI6kO-5" target="J0giTLENruao22hqI6kO-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-5" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;defaultHandler.setDefaultRolePrefix(&lt;/div&gt;&lt;div&gt;grantedAuthorityDefaults.getRolePrefix());&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;grantedAuthorityDefaults是从bean容器中获取的&lt;/font&gt;&lt;b style=&quot;&quot;&gt;GrantedAuthorityDefaults.class&lt;/b&gt;&lt;font color=&quot;#007fff&quot;&gt; Bean&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2500" y="2900" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-7" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;defaultHandler.setPermissionEvaluator(&lt;/div&gt;&lt;div&gt;permissionEvaluator);&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;permissionEvaluator 是从Bean容器中获取的&lt;/font&gt;&lt;br&gt;&lt;b style=&quot;&quot;&gt;PermissionEvaluator.class&lt;/b&gt;&lt;font color=&quot;#007fff&quot;&gt; Bean&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2500" y="2980" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-9" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;b&gt;WebExpressionConfigAttribute&lt;/b&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;权限要求表达式配置属性&lt;/span&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;// 授权要求的权限SpEL表达式&lt;/font&gt;&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final Expression &lt;b&gt;authorizeExpression&lt;/b&gt;;&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;&quot;&gt;private final EvaluationContextPostProcessor&amp;lt;FilterInvocation&amp;gt; postProcessor;&lt;/span&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-400" y="2040" width="360" height="100" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-11" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;root = {&lt;b&gt;WebSecurityExpressionRoot&lt;/b&gt;@7659}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;request = {HttpServlet3RequestFactory$Servlet3SecurityContextHolderAwareRequestWrapper@7682}&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;&lt;b&gt;authentication&lt;/b&gt; = {UsernamePasswordAuthenticationToken@7627}&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;&lt;b&gt;trustResolver&lt;/b&gt; = {AuthenticationTrustResolverImpl@7044}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;&lt;b&gt;roleHierarchy&lt;/b&gt; = null&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;&lt;b&gt;roles&lt;/b&gt; = null&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;defaultRolePrefix = &quot;ROLE_&quot;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;permitAll = true&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;denyAll = false&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;&lt;b&gt;permissionEvaluator&lt;/b&gt; = {DenyAllPermissionEvaluator@7049}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;read = &quot;read&quot;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;write = &quot;write&quot;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;create = &quot;create&quot;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;delete = &quot;delete&quot;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;admin = &quot;administration&quot;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2610" y="4120" width="480" height="190" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-12" value="&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;return new &lt;b&gt;StandardEvaluationContext&lt;/b&gt;();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="2640" y="4330" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="J0giTLENruao22hqI6kO-14" target="J0giTLENruao22hqI6kO-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-14" value="&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;ctx = weca.postProcess(ctx, fi);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;装饰器模式给ctx拓展&lt;b&gt;查询请求变量&lt;/b&gt;的方法&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2400" y="4410" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-16" value="&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;new DelegatingEvaluationContext(context) {&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 10px; background-color: initial;&quot;&gt;...}&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2640" y="4410" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-23" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="J0giTLENruao22hqI6kO-20" target="J0giTLENruao22hqI6kO-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-20" value="&lt;font style=&quot;&quot;&gt;fullyAuthenticated()&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;arcSize=13;" parent="1" vertex="1">
          <mxGeometry x="2240" y="1940" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-22" value="&lt;font style=&quot;&quot;&gt;interceptUrl(requestMatchers, SecurityConfig.createList(attribute));&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;arcSize=13;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2481" y="1940" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-24" value="AuthorizedUrl" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2531" y="1910" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-29" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="J0giTLENruao22hqI6kO-25" target="J0giTLENruao22hqI6kO-28" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-25" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;return new ExpressionBasedFilterInvocationSecurityMetadataSource(&lt;br&gt;requestMap, &lt;b&gt;handler&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2200" y="3060" width="260" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-31" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="J0giTLENruao22hqI6kO-28" target="J0giTLENruao22hqI6kO-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-28" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;super(&lt;b&gt;processMap&lt;/b&gt;(requestMap, expressionHandler.getExpressionParser()));&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2500" y="3060" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-30" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;&lt;div&gt;for&amp;nbsp;requestMap.entrySet() :&lt;/div&gt;&lt;div&gt;&lt;b&gt;attributes&lt;/b&gt;.add(new &lt;b&gt;WebExpressionConfigAttribute&lt;/b&gt;(&lt;/div&gt;&lt;div&gt;parser.&lt;b&gt;parseExpression&lt;/b&gt;(expression), postProcessor));&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;将 expression字符串转成 SpEL&amp;nbsp;Expression&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="2740" y="3050" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-32" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;ExpressionBasedFilterInvocationSecurityMetadataSource&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2175" y="2550" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-33" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;比如 /oauth/token 权限要求SpEL表达式是 &quot;fullyAuthenticated&quot;&lt;br&gt;这种写法看起来像是属性，但是在根对象中并没有这个属性，&lt;br&gt;但是有一个方法 boolean &lt;b&gt;isFullyAuthenticated&lt;/b&gt;(); 猜测是自动拼接getter方法并调用&lt;br&gt;经测试确实会调用此方法&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2400" y="4550" width="390" height="70" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-40" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="J0giTLENruao22hqI6kO-37" target="J0giTLENruao22hqI6kO-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-37" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp;&lt;b&gt;WebSecurityExpressionRoot&lt;/b&gt;#&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;b&gt;isFullyAuthenticated&lt;/b&gt;()&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;以&amp;nbsp;/oauth/token 为例，SpEL表达式实际执行的是此方法&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2640" y="4490" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-39" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;return !trustResolver.isAnonymous(authentication)&lt;/div&gt;&lt;div&gt;&amp;amp;&amp;amp; !trustResolver.isRememberMe(authentication);&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;认证用户信息不是匿名用户信息也不是RememberMe信息&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2880" y="4490" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-41" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;此处可见 &lt;b&gt;fullyAuthenticated&lt;/b&gt; 表达&lt;br&gt;&lt;b&gt;除匿名或RememberMe外已经认证&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="3080" y="4500" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-43" value="&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;if (!this.&lt;b&gt;isAllowIfAllAbstainDecisions&lt;/b&gt;())&lt;br&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;throw new AccessDeniedException(...);&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;" parent="1" vertex="1">
          <mxGeometry x="2160" y="4570" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-45" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;/font&gt;&lt;/span&gt;此DEMO默认走的NullRunAsManager&lt;br&gt;返回null&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1920" y="4900" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-47" value="&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;return new &lt;b&gt;InterceptorStatusToken&lt;/b&gt;(origCtx, true, attributes, object);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;align=center;arcSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1679" y="5180" width="201" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-49" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;InterceptorStatusToken&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//安全上下文，里面包含&lt;b&gt;用户认证信息&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private SecurityContext &lt;b&gt;securityContext&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//配置属性，比如WebExpressionConfigAttribute&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Collection&amp;lt;ConfigAttribute&amp;gt; &lt;b&gt;attr&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//安全对象，装饰后的请求、装饰后响应、安全过滤器链&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private Object &lt;b&gt;secureObject&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//是否需要更新安全上下文，因为安全上下文创建后经过一些认证鉴权操作上下文&lt;br&gt;可能有改变&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private boolean &lt;b&gt;contextHolderRefreshRequired&lt;/b&gt;;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-400" y="3200" width="360" height="160" as="geometry" />
        </mxCell>
        <mxCell id="J0giTLENruao22hqI6kO-50" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;token = {InterceptorStatusToken@7762}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;&lt;b&gt;securityContext&lt;/b&gt; = {SecurityContextImpl@7763}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; authentication = {UsernamePasswordAuthenticationToken@7636}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;&lt;b&gt;attr&lt;/b&gt; = {ArrayList@7049}&amp;nbsp; size = 1&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; 0 = {WebExpressionConfigAttribute@7081} &quot;fullyAuthenticated&quot;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;&lt;b&gt;secureObject&lt;/b&gt; = {FilterInvocation@7637} &quot;FilterInvocation: URL: /oauth/token&quot;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &lt;b&gt;chain&lt;/b&gt; = {FilterChainProxy$VirtualFilterChain@7740}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;originalChain = {ApplicationFilterChain@7585}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;additionalFilters = {ArrayList@7778}&amp;nbsp; size = 11&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;firewalledRequest = {StrictHttpFirewall$1@7779}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;size = 11&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;currentPosition = 11&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &lt;b&gt;request&lt;/b&gt; = {HttpServlet3RequestFactory$Servlet3SecurityContextHolderAwareRequestWrapper@7656}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;response = {HeaderWriterFilter$HeaderWriterResponse@7741}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;this$0 = {HttpServlet3RequestFactory@7781}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;trustResolver = {AuthenticationTrustResolverImpl@7657}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; anonymousClass = {Class@5914} &quot;class org.springframework.security.authentication.AnonymousAuthenticationToken&quot;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; rememberMeClass = {Class@6363} &quot;class org.springframework.security.authentication.RememberMeAuthenticationToken&quot;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;rolePrefix = &quot;ROLE_&quot;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;request = {HeaderWriterFilter$HeaderWriterRequest@7782}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &lt;b&gt;response&lt;/b&gt; = {HeaderWriterFilter$HeaderWriterResponse@7741}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;request = {StrictHttpFirewall$1@7779}&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;headerWriters = {ArrayList@7785}&amp;nbsp; size = 5&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;disableOnCommitted = false&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;contentLength = 0&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;contentWritten = 0&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;response = {FirewalledResponse@7786}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;&lt;b&gt;contextHolderRefreshRequired&lt;/b&gt; = false&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="-920" y="3200" width="520" height="320" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yOIgcuZ7kVqAaMvxTEpn-1" target="yOIgcuZ7kVqAaMvxTEpn-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-1" value="TokenRequest &lt;b&gt;tokenRequest&lt;/b&gt; = getOAuth2RequestFactory()&lt;br&gt;.createTokenRequest(parameters, authenticatedClient);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1440" y="5360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yOIgcuZ7kVqAaMvxTEpn-3" target="yOIgcuZ7kVqAaMvxTEpn-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-3" value="oAuth2RequestValidator.validateScope(&lt;br&gt;tokenRequest, authenticatedClient);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;校验请求的scope是否全存在于可授权的scope&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1440" y="5440" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yOIgcuZ7kVqAaMvxTEpn-5" target="yOIgcuZ7kVqAaMvxTEpn-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-5" value="校验授权模式 grant_type&amp;nbsp;&lt;br&gt;不能为空， 不能为简化模式（2.3.5版本暂不支持）" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1440" y="5520" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-7" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;如果请求参数中没有 scope, 默认在 TokenRequest 中填充&lt;br&gt;authenticatedClient 中授权的 scope&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1640" y="5370" width="280" height="40" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yOIgcuZ7kVqAaMvxTEpn-8" target="yOIgcuZ7kVqAaMvxTEpn-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-8" value="如果是认证码模式需要将 TokenRequest 对象中的scope集合清空，因为认证码模式scope在认证阶段已经校验" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1440" y="5600" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yOIgcuZ7kVqAaMvxTEpn-10" target="yOIgcuZ7kVqAaMvxTEpn-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-10" value="是否是刷新令牌请求及处理" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1440" y="5680" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-15" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yOIgcuZ7kVqAaMvxTEpn-12" target="yOIgcuZ7kVqAaMvxTEpn-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yOIgcuZ7kVqAaMvxTEpn-12" target="yOIgcuZ7kVqAaMvxTEpn-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-12" value="OAuth2AccessToken token = getTokenGranter()&lt;br&gt;.grant(tokenRequest.getGrantType(), tokenRequest);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1440" y="5760" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-19" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yOIgcuZ7kVqAaMvxTEpn-14" target="yOIgcuZ7kVqAaMvxTEpn-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-14" value="OAuth2AccessToken token = getTokenGranter()&lt;br&gt;.&lt;b&gt;grant&lt;/b&gt;(tokenRequest.getGrantType(), tokenRequest);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1680" y="5760" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-16" value="return getResponse(token);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1440" y="5840" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-21" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yOIgcuZ7kVqAaMvxTEpn-18" target="yOIgcuZ7kVqAaMvxTEpn-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-23" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="yOIgcuZ7kVqAaMvxTEpn-18" target="8Ed1EF93PBzpXC4AOwfi-67" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2159.5" y="5790" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2140.5" y="5790" />
              <mxPoint x="2140.5" y="5550" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-18" value="if (delegate == null)&amp;nbsp;&lt;br&gt;delegate = new CompositeTokenGranter(&lt;br&gt;&lt;b&gt;getDefaultTokenGranters&lt;/b&gt;());" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1920" y="5760" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-26" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yOIgcuZ7kVqAaMvxTEpn-20" target="8Ed1EF93PBzpXC4AOwfi-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-20" value="return delegate.grant(grantType, tokenRequest);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1920" y="6160" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yOIgcuZ7kVqAaMvxTEpn-22" target="8Ed1EF93PBzpXC4AOwfi-2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2379.5" y="5870" />
              <mxPoint x="2379.5" y="5950" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-7" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="yOIgcuZ7kVqAaMvxTEpn-22" target="8Ed1EF93PBzpXC4AOwfi-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-11" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="yOIgcuZ7kVqAaMvxTEpn-22" target="8Ed1EF93PBzpXC4AOwfi-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yOIgcuZ7kVqAaMvxTEpn-22" value="这里针对四种模式注册了4个TokenGranter&lt;br&gt;另外还注册了一个用于刷新令牌的 TokenGranter" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2159.5" y="5840" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-1" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;AuthorizationServerEndpointsConfigurer&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1910" y="5730" width="220" height="30" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-2" target="8Ed1EF93PBzpXC4AOwfi-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-2" value="密码模式" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2399.5" y="5920" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-4" value="&lt;div&gt;tokenGranters.add(new &lt;b&gt;ResourceOwnerPasswordTokenGranter&lt;/b&gt;(&lt;/div&gt;&lt;div&gt;&lt;b&gt;authenticationManager&lt;/b&gt;, &lt;b&gt;tokenServices&lt;/b&gt;,&lt;/div&gt;&lt;div&gt;&lt;b&gt;clientDetails&lt;/b&gt;, requestFactory));&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2559.5" y="5920" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-6" target="8Ed1EF93PBzpXC4AOwfi-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-6" value="授权码模式" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2399.5" y="5840" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-8" value="&lt;div&gt;tokenGranters.add(new &lt;b&gt;AuthorizationCodeTokenGranter&lt;/b&gt;(&lt;/div&gt;&lt;div&gt;&lt;b&gt;tokenServices&lt;/b&gt;, &lt;b&gt;authorizationCodeServices&lt;/b&gt;, &lt;b&gt;clientDetails&lt;/b&gt;,&lt;span style=&quot;background-color: initial;&quot;&gt;requestFactory));&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2554.5" y="5840" width="210" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-10" target="8Ed1EF93PBzpXC4AOwfi-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-10" value="刷新令牌" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2399.5" y="6000" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-12" value="tokenGranters.add(new &lt;b&gt;RefreshTokenGranter&lt;/b&gt;(&lt;b&gt;tokenServices&lt;/b&gt;, &lt;b&gt;clientDetails&lt;/b&gt;, requestFactory));" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2559.5" y="6000" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-14" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;AbstractTokenGranter&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//Token生成、校验的服务&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final AuthorizationServerTokenServices &lt;b&gt;tokenServices&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//客户端应用详细信息服务&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ClientDetailsService &lt;b&gt;clientDetailsService&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final OAuth2RequestFactory &lt;b&gt;requestFactory&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//授权模式类型&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final String &lt;b&gt;grantType&lt;/b&gt;;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-400" y="3560" width="360" height="160" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-18" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=0;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-17" target="8Ed1EF93PBzpXC4AOwfi-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-17" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;ResourceOwnerPasswordTokenGranter&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//认证管理器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final AuthenticationManager &lt;b&gt;authenticationManager&lt;/b&gt;;&lt;br&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-400" y="3760" width="360" height="80" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-20" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=0;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-19" target="8Ed1EF93PBzpXC4AOwfi-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-19" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;AuthorizationCodeTokenGranter&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//认证码生成、校验服务&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final AuthorizationCodeServices authorizationCodeServices;&lt;br&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-800" y="3760" width="360" height="80" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-28" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-25" target="8Ed1EF93PBzpXC4AOwfi-29" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2399.5" y="6190" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-25" value="for&amp;nbsp;tokenGranters:&amp;nbsp;&lt;br&gt;&lt;div&gt;OAuth2AccessToken grant = granter.grant(grantType, tokenRequest);&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;选择grantType对应的 TokenGranter&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2159.5" y="6160" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-32" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-29" target="8Ed1EF93PBzpXC4AOwfi-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-29" value="String clientId = tokenRequest.getClientId();&lt;br&gt;ClientDetails client = clientDetailsService&lt;br&gt;.loadClientByClientId(clientId);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2399.5" y="6160" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-34" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-31" target="8Ed1EF93PBzpXC4AOwfi-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-31" value="validateGrantType(grantType, client);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2399.5" y="6240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-36" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-33" target="8Ed1EF93PBzpXC4AOwfi-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-33" value="return getAccessToken(client, tokenRequest);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2399.5" y="6320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-40" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-35" target="8Ed1EF93PBzpXC4AOwfi-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-53" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-35" target="8Ed1EF93PBzpXC4AOwfi-52" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-35" value="return tokenServices.createAccessToken(&lt;br&gt;&lt;b&gt;getOAuth2Authentication&lt;/b&gt;(client, tokenRequest));" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2639.5" y="6320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-42" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-39" target="8Ed1EF93PBzpXC4AOwfi-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-39" value="密码模式" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2879.5" y="6320" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-44" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-41" target="8Ed1EF93PBzpXC4AOwfi-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-41" value="先从请求参数中读取用户名username密码password" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="3039.5" y="6320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-46" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-43" target="8Ed1EF93PBzpXC4AOwfi-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-43" value="Authentication userAuth = new &lt;b&gt;UsernamePasswordAuthenticationToken&lt;/b&gt;(&lt;br&gt;username, password);&lt;br&gt;((AbstractAuthenticationToken) userAuth).setDetails(parameters);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="3039.5" y="6400" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-48" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-45" target="8Ed1EF93PBzpXC4AOwfi-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-45" value="userAuth = authenticationManager&lt;br&gt;.&lt;b&gt;authenticate&lt;/b&gt;(userAuth);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;这里默认还是借助 authenticationManager 对用户名密码做认证校验&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="3039.5" y="6480" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-50" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-47" target="8Ed1EF93PBzpXC4AOwfi-49" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-47" value="if (userAuth == null || !userAuth.isAuthenticated())&lt;br&gt;throw new &lt;b&gt;InvalidGrantException&lt;/b&gt;()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="3039.5" y="6560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-49" value="OAuth2Request storedOAuth2Request = getRequestFactory().createOAuth2Request(&lt;br&gt;client, tokenRequest);&#x9;&#x9;&lt;br&gt;return new &lt;b&gt;OAuth2Authentication&lt;/b&gt;(&lt;br&gt;storedOAuth2Request, userAuth);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;arcSize=9;" parent="1" vertex="1">
          <mxGeometry x="3039.5" y="6640" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-51" value="&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;到这里原始请求已经被封装了很多层&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="3239.5" y="6665" width="180" height="30" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-55" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-52" target="8Ed1EF93PBzpXC4AOwfi-54" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-52" value="return tokenServices.createAccessToken(&lt;br&gt;oauth2Authentication);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2639.5" y="6760" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-58" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-54" target="8Ed1EF93PBzpXC4AOwfi-57" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-54" value="refreshToken = createRefreshToken(authentication);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;生成刷新令牌&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2879.5" y="6760" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-56" value="DefaultTokenService" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2914.5" y="6730" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-60" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-57" target="8Ed1EF93PBzpXC4AOwfi-59" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-57" value="OAuth2AccessToken accessToken = createAccessToken(authentication, refreshToken);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;生成访问令牌&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2879.5" y="6840" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-62" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-59" target="8Ed1EF93PBzpXC4AOwfi-61" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-59" value="tokenStore.storeAccessToken(accessToken, authentication);&lt;br&gt;tokenStore.storeRefreshToken(refreshToken, authentication);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2879.5" y="6920" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-61" value="return accessToken;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2879.5" y="7000" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-64" value="&lt;font color=&quot;#007fff&quot;&gt;也是先校验然后生成Token(包括访问令牌和刷新令牌)&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2399.5" y="6390" width="300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-72" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-65" target="8Ed1EF93PBzpXC4AOwfi-66" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-65" value="&lt;div&gt;AuthorizationCodeServices authorizationCodeServices = authorizationCodeServices();&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2159.5" y="5680" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-69" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-66" target="yOIgcuZ7kVqAaMvxTEpn-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-66" value="&lt;div&gt;OAuth2RequestFactory requestFactory = requestFactory();&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;用于装饰请求对象&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2159.5" y="5760" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-70" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-67" target="8Ed1EF93PBzpXC4AOwfi-68" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-74" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-67" target="8Ed1EF93PBzpXC4AOwfi-73" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-67" value="&lt;div&gt;ClientDetailsService clientDetails = clientDetailsService();&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;这里获取的就是通过&amp;nbsp;ClientDetailsServiceConfigurer 配置的ClientDetailsService实例&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2159.5" y="5520" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-71" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-68" target="8Ed1EF93PBzpXC4AOwfi-65" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-76" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-68" target="8Ed1EF93PBzpXC4AOwfi-75" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-68" value="&lt;div&gt;AuthorizationServerTokenServices tokenServices = tokenServices();&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;用于生成和校验Token的服务&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2159.5" y="5600" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-73" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;ClientDetailsService Bean实例是怎么&lt;span style=&quot;background-color: initial;&quot;&gt;传递&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-size: 10px; color: rgb(0, 127, 255); background-color: initial;&quot;&gt;到&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;b style=&quot;font-size: 10px; color: rgb(0, 127, 255); background-color: initial;&quot;&gt;AuthorizationServerEndpointsConfigurer &lt;/b&gt;&lt;span style=&quot;font-size: 10px; color: rgb(0, 127, 255); background-color: initial;&quot;&gt;的？&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;自动配置阶段&amp;nbsp;AuthorizationServerEndpointsConfiguration&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;public class &lt;b&gt;AuthorizationServerEndpointsConfiguration&lt;/b&gt; {&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; private AuthorizationServerEndpointsConfigurer endpoints = new &lt;b&gt;AuthorizationServerEndpointsConfigurer&lt;/b&gt;();&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/font&gt;&lt;/span&gt;@PostConstruct&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;public void init() {&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;    ...&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;endpoints.setClientDetailsService(clientDetailsService);&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;}&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;}&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="2379.5" y="5420" width="600" height="160" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-78" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-75" target="8Ed1EF93PBzpXC4AOwfi-77" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-75" value="&lt;div&gt;if (tokenServices != null)&amp;nbsp;&lt;/div&gt;&lt;div&gt;return tokenServices;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2399.5" y="5600" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-82" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-77" target="8Ed1EF93PBzpXC4AOwfi-81" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-77" value="&lt;div&gt;this.tokenServices = createDefaultTokenServices();&lt;/div&gt;&lt;div&gt;return tokenServices;&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2399.5" y="5680" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-83" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="8Ed1EF93PBzpXC4AOwfi-79" target="8Ed1EF93PBzpXC4AOwfi-75" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-79" value="AuthorizationServerEndpointsConfigurer#&lt;br&gt;&lt;b&gt;tokenServices&lt;/b&gt;(&lt;br&gt;AuthorizationServerTokenServices tokenServices)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;可以通过此方法修改成自定义的AuthorizationServerTokenServices&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#f0a30a;fontColor=#000000;strokeColor=#BD7000;" parent="1" vertex="1">
          <mxGeometry x="2619.5" y="5590" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-81" value="new &lt;b&gt;DefaultTokenServices&lt;/b&gt;();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;默认的AuthorizationServerTokenServices实现&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2639.5" y="5680" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8Ed1EF93PBzpXC4AOwfi-84" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;DefaultTokenServices&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;private int refreshTokenValiditySeconds = 60 * 60 * 24 * 30; // default 30 days.&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private int accessTokenValiditySeconds = 60 * 60 * 12; // default 12 hours.&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private boolean supportRefreshToken = false;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private boolean reuseRefreshToken = true;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private TokenStore &lt;b&gt;tokenStore&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private ClientDetailsService &lt;b&gt;clientDetailsService&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private TokenEnhancer &lt;b&gt;accessTokenEnhancer&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private AuthenticationManager &lt;b&gt;authenticationManager&lt;/b&gt;;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-800" y="3520" width="360" height="200" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-1" value="&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;TokenStore默认实现是&lt;b&gt;InMemoryTokenStore&lt;/b&gt;&lt;/span&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="3079.5" y="6935" width="230" height="30" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-2" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;TokenStore (I)&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;包括生成、读取（查找）、删除访问令牌和刷新令牌的各种方法定义&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-580" y="3920" width="360" height="80" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-4" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=1;dashed=1;" parent="1" source="C9ku3EbWxnKkE-glZPp3-3" target="C9ku3EbWxnKkE-glZPp3-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-3" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;InMemoryTokenStore&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;private static final int DEFAULT_FLUSH_INTERVAL = 1000;&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConcurrentHashMap&amp;lt;String, OAuth2AccessToken&amp;gt; accessTokenStore = new ConcurrentHashMap&amp;lt;String, OAuth2AccessToken&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConcurrentHashMap&amp;lt;String, OAuth2AccessToken&amp;gt; authenticationToAccessTokenStore =&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;new ConcurrentHashMap&amp;lt;String, OAuth2AccessToken&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConcurrentHashMap&amp;lt;String, Collection&amp;lt;OAuth2AccessToken&amp;gt;&amp;gt; userNameToAccessTokenStore =&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;new ConcurrentHashMap&amp;lt;String, Collection&amp;lt;OAuth2AccessToken&amp;gt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConcurrentHashMap&amp;lt;String, Collection&amp;lt;OAuth2AccessToken&amp;gt;&amp;gt; clientIdToAccessTokenStore =&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;new ConcurrentHashMap&amp;lt;String, Collection&amp;lt;OAuth2AccessToken&amp;gt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConcurrentHashMap&amp;lt;String, OAuth2RefreshToken&amp;gt; refreshTokenStore = new ConcurrentHashMap&amp;lt;String, OAuth2RefreshToken&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConcurrentHashMap&amp;lt;String, String&amp;gt; accessTokenToRefreshTokenStore = new ConcurrentHashMap&amp;lt;String, String&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConcurrentHashMap&amp;lt;String, OAuth2Authentication&amp;gt; authenticationStore = new ConcurrentHashMap&amp;lt;String, OAuth2Authentication&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConcurrentHashMap&amp;lt;String, OAuth2Authentication&amp;gt; refreshTokenAuthenticationStore = new ConcurrentHashMap&amp;lt;String, OAuth2Authentication&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConcurrentHashMap&amp;lt;String, String&amp;gt; refreshTokenToAccessTokenStore = new ConcurrentHashMap&amp;lt;String, String&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final DelayQueue&amp;lt;TokenExpiry&amp;gt; expiryQueue = new DelayQueue&amp;lt;TokenExpiry&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private final ConcurrentHashMap&amp;lt;String, TokenExpiry&amp;gt; expiryMap = new ConcurrentHashMap&amp;lt;String, TokenExpiry&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private int flushInterval = DEFAULT_FLUSH_INTERVAL;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private AuthenticationKeyGenerator authenticationKeyGenerator = new DefaultAuthenticationKeyGenerator();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;private AtomicInteger flushCounter = new AtomicInteger(0);&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-760" y="4040" width="720" height="280" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-11" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;dashed=1;endArrow=block;endFill=1;" parent="1" source="C9ku3EbWxnKkE-glZPp3-5" target="C9ku3EbWxnKkE-glZPp3-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-5" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;JwtTokenStore&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-1000" y="4040" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-12" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;dashed=1;endArrow=block;endFill=1;" parent="1" source="C9ku3EbWxnKkE-glZPp3-6" target="C9ku3EbWxnKkE-glZPp3-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-6" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;JdbcTokenStore&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-1240" y="4040" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-9" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;dashed=1;endArrow=block;endFill=1;" parent="1" source="C9ku3EbWxnKkE-glZPp3-7" target="C9ku3EbWxnKkE-glZPp3-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-7" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;RedisTokenStore&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-1480" y="4040" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-13" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;dashed=1;endArrow=block;endFill=1;" parent="1" source="C9ku3EbWxnKkE-glZPp3-8" target="C9ku3EbWxnKkE-glZPp3-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-8" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center;&quot;&gt;&lt;b&gt;JwkTokenStore&lt;/b&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-1720" y="4040" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-18" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="C9ku3EbWxnKkE-glZPp3-16" target="Jysl4UP8jRCQiMBeIVnq-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-16" value="/oauth/token" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1199" y="5280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-19" value="&lt;div&gt;/oauth/check_token&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1200.5" y="5920" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-21" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="C9ku3EbWxnKkE-glZPp3-22" target="C9ku3EbWxnKkE-glZPp3-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-22" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;&lt;b&gt;WebSecurityExpressionRoot&lt;/b&gt;#&lt;/div&gt;&lt;b style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;isAuthenticated&lt;/font&gt;&lt;span style=&quot;font-size: 11px;&quot;&gt;()&lt;br&gt;&lt;/span&gt;&lt;/b&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;以&amp;nbsp;/oauth/check_token 为例，SpEL表达式实际执行的是此方法&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2640" y="4620" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-23" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;return !isAnonymous();&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;认证用户信息不是匿名用户信息&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2880" y="4620" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="C9ku3EbWxnKkE-glZPp3-24" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;此处可见 a&lt;b&gt;uthenticated&lt;/b&gt; 表达&lt;br&gt;&lt;b&gt;除匿名外已经认证&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="3095" y="4630" width="150" height="40" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="3ssNuAnr9_rqi4YUogIS" name="各模式交互流程">
    <mxGraphModel dx="1434" dy="879" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-18" value="密码模式交互流程" style="swimlane;childLayout=stackLayout;resizeParent=1;resizeParentMax=0;startSize=20;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="20" y="20" width="800" height="420" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-19" value="用户" style="swimlane;startSize=20;html=1;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-18" vertex="1">
          <mxGeometry y="20" width="160" height="400" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-25" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;登录&lt;br style=&quot;font-size: 10px;&quot;&gt;username、password&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-19" vertex="1">
          <mxGeometry x="20" y="40" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-53" value="登录成功" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-19" vertex="1">
          <mxGeometry x="20" y="100" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-55" value="业务操作&lt;br&gt;携带令牌" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-19" vertex="1">
          <mxGeometry x="20" y="180" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-20" value="网关" style="swimlane;startSize=20;html=1;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-18" vertex="1">
          <mxGeometry x="160" y="20" width="160" height="400" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-26" value="/gateway/login&lt;br&gt;附带client-secret" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-20" vertex="1">
          <mxGeometry x="20" y="40" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-51" value="返回令牌" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-20" vertex="1">
          <mxGeometry x="20" y="100" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-57" value="令牌校验" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-20" vertex="1">
          <mxGeometry x="20" y="180" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-60" value="令牌校验成功&lt;br&gt;获取到用户信息" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-20" vertex="1">
          <mxGeometry x="20" y="260" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-21" value="业务服务" style="swimlane;startSize=20;html=1;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-18" vertex="1">
          <mxGeometry x="320" y="20" width="160" height="400" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-62" value="权限校验&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;不放在网关是防止每次修改业务服务权限配置都要改网关&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-21" vertex="1">
          <mxGeometry x="20" y="260" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-96" value="校验成功后执行业务操作" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-21" vertex="1">
          <mxGeometry x="20" y="340" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-23" value="认证中心" style="swimlane;startSize=20;html=1;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-18" vertex="1">
          <mxGeometry x="480" y="20" width="160" height="400" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-28" value="/oauth/token&lt;br&gt;查询用户信息" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-23" vertex="1">
          <mxGeometry x="20" y="40" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-34" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;/oauth/token&lt;br&gt;校验client-secret、用户密码，成功则生成并返回令牌&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-23" vertex="1">
          <mxGeometry x="20" y="100" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-59" value="/oauth/check_token&lt;br&gt;检查令牌" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-23" vertex="1">
          <mxGeometry x="20" y="180" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-24" value="用户基础服务" style="swimlane;startSize=20;html=1;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-18" vertex="1">
          <mxGeometry x="640" y="20" width="160" height="400" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-32" value="查询用户信息" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-24" vertex="1">
          <mxGeometry x="20" y="40" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-64" value="查询用户权限信息" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-24" vertex="1">
          <mxGeometry x="20" y="260" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-18" source="vrPN_jBtXwNGg4vfSMyD-25" target="vrPN_jBtXwNGg4vfSMyD-26" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;" parent="vrPN_jBtXwNGg4vfSMyD-18" source="vrPN_jBtXwNGg4vfSMyD-26" target="vrPN_jBtXwNGg4vfSMyD-28" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="vrPN_jBtXwNGg4vfSMyD-18" source="vrPN_jBtXwNGg4vfSMyD-28" target="vrPN_jBtXwNGg4vfSMyD-32" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-35" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="vrPN_jBtXwNGg4vfSMyD-18" source="vrPN_jBtXwNGg4vfSMyD-32" target="vrPN_jBtXwNGg4vfSMyD-34" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-52" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="vrPN_jBtXwNGg4vfSMyD-18" source="vrPN_jBtXwNGg4vfSMyD-34" target="vrPN_jBtXwNGg4vfSMyD-51" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-54" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="vrPN_jBtXwNGg4vfSMyD-18" source="vrPN_jBtXwNGg4vfSMyD-51" target="vrPN_jBtXwNGg4vfSMyD-53" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-56" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="vrPN_jBtXwNGg4vfSMyD-18" source="vrPN_jBtXwNGg4vfSMyD-55" target="vrPN_jBtXwNGg4vfSMyD-57" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="169.99999999999955" y="220" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-58" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="vrPN_jBtXwNGg4vfSMyD-18" source="vrPN_jBtXwNGg4vfSMyD-57" target="vrPN_jBtXwNGg4vfSMyD-59" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="509.99999999999955" y="220.33333333333348" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-61" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="vrPN_jBtXwNGg4vfSMyD-18" source="vrPN_jBtXwNGg4vfSMyD-59" target="vrPN_jBtXwNGg4vfSMyD-60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-63" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="vrPN_jBtXwNGg4vfSMyD-18" source="vrPN_jBtXwNGg4vfSMyD-60" target="vrPN_jBtXwNGg4vfSMyD-62" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-65" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="vrPN_jBtXwNGg4vfSMyD-18" source="vrPN_jBtXwNGg4vfSMyD-62" target="vrPN_jBtXwNGg4vfSMyD-64" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="vrPN_jBtXwNGg4vfSMyD-97" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="vrPN_jBtXwNGg4vfSMyD-18" source="vrPN_jBtXwNGg4vfSMyD-64" target="vrPN_jBtXwNGg4vfSMyD-96" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
