<mxfile host="Electron" modified="2023-12-22T11:24:19.193Z" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/21.6.5 Chrome/114.0.5735.243 Electron/25.3.1 Safari/537.36" etag="bmgvOfylFSqyYL92koxa" version="21.6.5" type="device" pages="2">
  <diagram id="izJUiE_6dcGGzq4-B36X" name="SpringSecurity工作流程">
    <mxGraphModel dx="3772" dy="879" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-264" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-262" target="KUAb-_XNP9Eb_uavuq1S-225" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1600" y="2060" />
              <mxPoint x="1600" y="1620" />
              <mxPoint x="2240" y="1620" />
              <mxPoint x="2240" y="586" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-265" value="配置的认证管理器 默认是&amp;nbsp;&lt;b style=&quot;font-size: 10px ; background-color: rgb(248 , 249 , 250)&quot;&gt;DefaultPasswordEncoderAuthenticationManagerBuilder&lt;/b&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=8;fontColor=#007FFF;" parent="KUAb-_XNP9Eb_uavuq1S-264" vertex="1" connectable="0">
          <mxGeometry x="-0.9756" y="-1" relative="1" as="geometry">
            <mxPoint x="162" y="9" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-495" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.88;exitY=0.017;exitDx=0;exitDy=0;entryX=0.88;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=9;fontColor=#007FFF;endArrow=classic;endFill=1;exitPerimeter=0;fillColor=#e51400;strokeColor=#B20000;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-464" target="KUAb-_XNP9Eb_uavuq1S-322" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-468" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0.75;entryY=1;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-386" target="KUAb-_XNP9Eb_uavuq1S-322" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-1" value="&lt;h1&gt;Spring Security 工作流程&amp;nbsp;&lt;/h1&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;版本：&lt;br&gt;spring-boot-starter-security:2.1.10.RELEASE&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;依赖：&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;spring-boot-starter：2.1.0.RELEASE&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;spring-security-config:5.1.7.RELEASE&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;spring-security-web:5.1.7.RELEASE&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="20" y="20" width="400" height="130" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-15" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;@ConditionalOnClass&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="mgh684Ju6QphpoWxp4na-3" target="mgh684Ju6QphpoWxp4na-14" edge="1">
          <mxGeometry y="10" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-24" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;" parent="1" source="mgh684Ju6QphpoWxp4na-3" target="mgh684Ju6QphpoWxp4na-16" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="450" y="830" />
              <mxPoint x="450" y="910" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-25" value="@Import" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=8;entryX=0.1;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="mgh684Ju6QphpoWxp4na-3" target="mgh684Ju6QphpoWxp4na-26" edge="1">
          <mxGeometry x="0.6199" y="10" relative="1" as="geometry">
            <mxPoint x="400" y="1030" as="targetPoint" />
            <mxPoint as="offset" />
            <Array as="points">
              <mxPoint x="450" y="830" />
              <mxPoint x="450" y="1070" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-3" value="&lt;font style=&quot;font-size: 10px&quot;&gt;SecurityAutoConfiguration&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="240" y="800" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-5" value="先分析Maven pom 依赖&lt;br&gt;查到下面自动配置类&lt;br&gt;Security 的自动配置类位于 Spring-boot-starter 内" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="195" y="750" width="290" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-6" value="&lt;font style=&quot;font-size: 9px&quot;&gt;UserDetailsServiceAutoConfiguration&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="240" y="1200" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-255" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="1" source="mgh684Ju6QphpoWxp4na-8" target="KUAb-_XNP9Eb_uavuq1S-254" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-8" value="&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;SecurityFilterAutoConfiguration&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;将Security的过滤器链注册到Spring Web, 可通过 spring.security.filter.order 配置顺序，默认-100&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="240" y="1320" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-12" value="&lt;font style=&quot;font-size: 10px&quot;&gt;其他，暂略&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="240" y="1440" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-28" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;" parent="1" source="mgh684Ju6QphpoWxp4na-14" target="mgh684Ju6QphpoWxp4na-27" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-14" value="&lt;font style=&quot;font-size: 10px&quot;&gt;DefaultAuthenticationEventPublisher&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="500" y="800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-16" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;SecurityProperties&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;自动注入的配置类，前缀spring.security，&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;包含用户认证信息User和过滤器链 Filter信息&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="500" y="880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-30" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;" parent="1" source="mgh684Ju6QphpoWxp4na-18" target="mgh684Ju6QphpoWxp4na-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-18" value="&lt;font style=&quot;font-size: 10px&quot;&gt;SpringBootWebSecurityConfiguration&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="500" y="960" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-32" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;" parent="1" source="mgh684Ju6QphpoWxp4na-20" target="mgh684Ju6QphpoWxp4na-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-20" value="&lt;font style=&quot;font-size: 10px&quot;&gt;WebSecurityEnablerConfiguration&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="500" y="1040" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-34" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;" parent="1" source="mgh684Ju6QphpoWxp4na-22" target="mgh684Ju6QphpoWxp4na-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-22" value="&lt;font style=&quot;font-size: 10px&quot;&gt;SecurityDataConfiguration&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="500" y="1120" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-26" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;fontSize=8;" parent="1" vertex="1">
          <mxGeometry x="480" y="960" width="10" height="220" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-27" value="&lt;font style=&quot;font-size: 10px&quot;&gt;new &lt;b&gt;DefaultAuthenticationEventPublisher&lt;/b&gt;(&lt;br&gt;publisher)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;创建一个认证事件发布器 Bean&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="740" y="800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-36" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="mgh684Ju6QphpoWxp4na-29" target="mgh684Ju6QphpoWxp4na-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-29" value="&lt;font style=&quot;font-size: 10px&quot;&gt;DefaultConfigurerAdapter&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;默认继承&amp;nbsp;&lt;b&gt;WebSecurityConfigurerAdapter&lt;br&gt;&lt;/b&gt;核心上下文Bean对象&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="740" y="960" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-44" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="mgh684Ju6QphpoWxp4na-31" target="mgh684Ju6QphpoWxp4na-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-51" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;" parent="1" source="mgh684Ju6QphpoWxp4na-31" target="mgh684Ju6QphpoWxp4na-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-52" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;" parent="1" source="mgh684Ju6QphpoWxp4na-31" target="mgh684Ju6QphpoWxp4na-49" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-3" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" parent="1" source="mgh684Ju6QphpoWxp4na-31" target="KUAb-_XNP9Eb_uavuq1S-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="970" y="1310" as="targetPoint" />
            <Array as="points">
              <mxPoint x="960" y="1070" />
              <mxPoint x="960" y="1295" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-31" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;@EnableWebSecurity&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;主要就是引入一个注解，表示启用Security功能，里面有个debug字段，设置为true可以打印Spring Security DEBUG日志&lt;/font&gt;&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="740" y="1040" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-33" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;new SecurityEvaluationContextExtension()&lt;/span&gt;&lt;br&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span&gt;创建用于安全拓展的Bean,比如支持&lt;/span&gt;&lt;font face=&quot;Noto Sans SC, SF Pro SC, SF Pro Text, SF Pro Icons, PingFang SC, Helvetica Neue, Helvetica, Arial, sans-serif&quot; style=&quot;font-size: 10px&quot;&gt;&lt;span style=&quot;background-color: rgba(0 , 0 , 0 , 0.05)&quot;&gt;SpEL&lt;/span&gt;&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="740" y="1120" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-35" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;SecurityConfig&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;测试中重写了WebSecurityConfigurerAdapter&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="980" y="960" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-38" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;WebSecurityConfigurerAdapter&lt;i&gt;&amp;nbsp;修改&lt;/i&gt;&lt;i style=&quot;background-color: initial;&quot;&gt;配置&lt;/i&gt;&lt;i style=&quot;background-color: initial;&quot;&gt;的窗口类，新版本已经废弃&lt;/i&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private ApplicationContext context;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private ContentNegotiationStrategy &lt;b&gt;contentNegotiationStrategy&lt;/b&gt; = new HeaderContentNegotiationStrategy();&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private ObjectPostProcessor&amp;lt;Object&amp;gt; &lt;b&gt;objectPostProcessor&lt;/b&gt; = new ObjectPostProcessor&amp;lt;Object&amp;gt;() {...};&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private AuthenticationConfiguration &lt;b&gt;authenticationConfiguration&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//DefaultPasswordEncoderAuthenticationManagerBuilder 用于构造密码编码器和认证管理器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private AuthenticationManagerBuilder &lt;b&gt;authenticationBuilder&lt;/b&gt;;&lt;/p&gt;&lt;span style=&quot;color: rgb(0 , 127 , 255)&quot;&gt;&amp;nbsp; //DefaultPasswordEncoderAuthenticationManagerBuilder&lt;/span&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(0 , 127 , 255)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private AuthenticationManagerBuilder &lt;b&gt;localConfigureAuthenticationBldr&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private boolean disableLocalConfigureAuthenticationBldr;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private boolean authenticationManagerInitialized;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;//构造的认证管理器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private AuthenticationManager &lt;b&gt;authenticationManager&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private AuthenticationTrustResolver trustResolver = new AuthenticationTrustResolverImpl();&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private &lt;b&gt;HttpSecurity&lt;/b&gt; &lt;b&gt;http&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private boolean disableDefaults;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-680" y="240" width="640" height="300" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-25" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="mgh684Ju6QphpoWxp4na-39" target="KUAb-_XNP9Eb_uavuq1S-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-181" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;dashed=1;" parent="1" source="mgh684Ju6QphpoWxp4na-39" target="KUAb-_XNP9Eb_uavuq1S-180" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-39" value="请求拦截器链" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="40" y="1560" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-54" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="mgh684Ju6QphpoWxp4na-43" target="mgh684Ju6QphpoWxp4na-53" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-205" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="mgh684Ju6QphpoWxp4na-43" target="KUAb-_XNP9Eb_uavuq1S-204" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-43" value="&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;WebSecurityConfiguration&lt;/b&gt;&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;这里面做了很多，不过只关注&lt;br&gt;最重要的springSecurityFilterChain&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="980" y="1040" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-47" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;SpringWebMvcImportSelector&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="980" y="1120" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-49" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;OAuth2ImportSelector&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="980" y="1200" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;" parent="1" source="mgh684Ju6QphpoWxp4na-53" target="KUAb-_XNP9Eb_uavuq1S-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-53" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;@Bean &lt;br&gt;&lt;/b&gt;Filter &lt;b&gt;springSecurityFilterChain&lt;/b&gt;()&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;最后创建的所有过滤器链都在此Bean中&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3c800;strokeColor=#B09500;fontColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="1180" y="1040" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mgh684Ju6QphpoWxp4na-55" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;i&gt;WebSecurityConfiguration&lt;/i&gt;&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private &lt;b&gt;WebSecurity&lt;/b&gt; webSecurity;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private Boolean debugEnabled;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//用户自定义的配置类&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private &lt;b&gt;List&amp;lt;SecurityConfigurer&amp;lt;Filter, WebSecurity&amp;gt;&amp;gt;&lt;/b&gt; webSecurityConfigurers;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private ClassLoader beanClassLoader;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private &lt;b&gt;ObjectPostProcessor&amp;lt;Object&amp;gt;&lt;/b&gt; objectObjectPostProcessor;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;void setFilterChainProxySecurityConfigurer()&lt;br&gt;Filter springSecurityFilterChain()&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-520" y="560" width="480" height="180" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-1" target="KUAb-_XNP9Eb_uavuq1S-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-1" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;@EnableGlobalAuthentication&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="980" y="1280" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-4" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;@Import(&lt;br&gt;&lt;b&gt;AuthenticationConfiguration&lt;/b&gt;.class)&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;用于配置认证信息&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1180" y="1280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-14" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="KUAb-_XNP9Eb_uavuq1S-8" target="qwSPwGrAE5PhXKtDNLOx-9">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-8" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;webSecurity&lt;/b&gt;.&lt;b&gt;build&lt;/b&gt;()&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;构造安全过滤器链，&lt;b&gt;WebSecurity 中可能有多个HttpSecurity&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1420" y="1040" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-21" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-18" target="KUAb-_XNP9Eb_uavuq1S-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-220" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-18" target="KUAb-_XNP9Eb_uavuq1S-219" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-18" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;beforeInit();&lt;/div&gt;&lt;div&gt;&lt;b&gt;init&lt;/b&gt;();&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;遍历过滤器的配置类，执行初始化&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2020" y="1200" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-23" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-20" target="KUAb-_XNP9Eb_uavuq1S-22" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2100" y="1400" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="KUAb-_XNP9Eb_uavuq1S-20" target="qwSPwGrAE5PhXKtDNLOx-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-20" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;beforeConfigure();&lt;/div&gt;&lt;div&gt;&lt;b&gt;configure&lt;/b&gt;();&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;遍历过滤器的配置类&lt;b&gt;，&lt;/b&gt;执行配置方法，这里&lt;b&gt;创建过滤器&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2020" y="1300" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-242" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-22" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2220" y="1430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-22" value="&lt;font style=&quot;font-size: 10px&quot;&gt;O result = &lt;b&gt;performBuild&lt;/b&gt;();&lt;br&gt;return result;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;创建过滤器链&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2020" y="1400" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-27" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-24" target="KUAb-_XNP9Eb_uavuq1S-26" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-24" value="&lt;font style=&quot;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;ApplicationFilterChain&lt;/b&gt;#doFilter()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;SpringMVC 的请求拦截器链&lt;/span&gt;&lt;br&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;责任链模式，过滤器数组，doFilter()相当于递归调用，每调用一次过滤器pos++&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="240" y="1560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-39" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-26" target="KUAb-_XNP9Eb_uavuq1S-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-26" value="&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;OrderedCharacterEncodingFilter characterEncodingFilter&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;OrderedHiddenHttpMethodFilter hiddenHttpMethodFilter&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;OrderedFormContentFilter formContentFilter&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;OrderedRequestContextFilter requestContextFilter&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;DelegatingFilterProxyRegistrationBean$1 springSecurityFilterChain&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;WsFilter &quot;Tomcat WebSocket (JSR356) Filter&quot;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="480" y="1540" width="320" height="100" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-28" value="&lt;font color=&quot;#007fff&quot;&gt;前4个过滤器属于Spring MVC，分别负责读取请求 编码类型、请求类型、表单参数、原始请求&lt;br&gt;存储到&amp;nbsp;HttpServletRequest 封装类型对象&lt;br&gt;&lt;b&gt;第5个过滤器就是Spring Security 安全过滤器链&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="480" y="1640" width="440" height="50" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-52" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-29" target="KUAb-_XNP9Eb_uavuq1S-51" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-29" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;WebAsyncManagerIntegrationFilter&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;SecurityContextPersistenceFilter&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;HeaderWriterFilter&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;CsrfFilter&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;LogoutFilter&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;UsernamePasswordAuthenticationFilter&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;DefaultLoginPageGeneratingFilter&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;DefaultLogoutPageGeneratingFilter&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;RequestCacheAwareFilter&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;SecurityContextHolderAwareRequestFilter&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;AnonymousAuthenticationFilter&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;SessionManagementFilter&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;ExceptionTranslationFilter&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;FilterSecurityInterceptor&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;...&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=5;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1340" y="1640" width="240" height="220" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-34" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;dashed=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-32" target="mgh684Ju6QphpoWxp4na-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-35" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-32" target="mgh684Ju6QphpoWxp4na-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-249" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-32" target="mgh684Ju6QphpoWxp4na-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="220" y="830" />
              <mxPoint x="220" y="1230" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-250" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-32" target="mgh684Ju6QphpoWxp4na-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-251" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-32" target="mgh684Ju6QphpoWxp4na-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-32" value="自动配置阶段" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="40" y="800" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-42" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-38" target="KUAb-_XNP9Eb_uavuq1S-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-38" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;FilterChainProxy&lt;/b&gt;#doFilter()&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;执行 springSecurityFilterChain 过滤器链&lt;br&gt;&lt;/font&gt;一层层地过滤&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="840" y="1560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-44" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-41" target="KUAb-_XNP9Eb_uavuq1S-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-305" value="" style="edgeStyle=none;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-41" target="KUAb-_XNP9Eb_uavuq1S-304" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-306" value="" style="edgeStyle=none;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-41" target="KUAb-_XNP9Eb_uavuq1S-304" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-308" value="" style="edgeStyle=none;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-41" target="KUAb-_XNP9Eb_uavuq1S-307" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-41" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;fwRequest = this.firewall.&lt;b&gt;getFirewalledRequest&lt;/b&gt;(&lt;br&gt;(HttpServletRequest)request);&lt;br&gt;filters = this.&lt;b&gt;getFilters&lt;/b&gt;((HttpServletRequest)fwRequest);&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1080" y="1560" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-46" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-43" target="KUAb-_XNP9Eb_uavuq1S-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-43" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;&quot;&gt;FilterChainProxy.VirtualFilterChain vfc = new FilterChainProxy.&lt;b&gt;VirtualFilterChain&lt;/b&gt;(fwRequest, chain, filters);&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;这个过滤器链和前面的过滤器链调用原理一样&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1080" y="1640" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-47" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-45" target="KUAb-_XNP9Eb_uavuq1S-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-45" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;vfc.&lt;b&gt;doFilter&lt;/b&gt;(fwRequest, fwResponse);&lt;br&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;这个测试中SpringSecurity创建了14个过滤器&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1080" y="1720" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-49" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;OncePerRequestFilter&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;左边半数拦截器都继承此过滤器&lt;br&gt;&lt;/font&gt;每个请求只会执行一次的过滤器&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1620" y="1641" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-56" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-51" target="KUAb-_XNP9Eb_uavuq1S-55" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-51" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;WebAsyncManagerIntegrationFilter#&lt;br&gt;&lt;/span&gt;doFilterInternal()&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1620" y="1720" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-53" value="通过在 HttpServletRequest 中添加 Attribute （filterName..FILTERED）&amp;nbsp;&lt;br&gt;记录当前执行器是否已经执行过,已经执行过则直接跳过，继续执行下一个拦截器&lt;br&gt;&lt;br&gt;每次执行拦截处理 doFilterInternal() 之前都会额外判断是否是异步请求以及是否是错误调度请求，&lt;br&gt;如果是异步请求且设置了不需要过滤异步请求或者请求中包含错误属性（发生异常会在request中添加属性 &lt;b&gt;javax.servlet.error.request_uri&lt;/b&gt;）都不会执行实际拦截，而是直接交给下一个拦截器&lt;br&gt;参考：!this.skipDispatch(httpRequest) &amp;amp;&amp;amp; !this.shouldNotFilter(httpRequest)" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1830" y="1630" width="860" height="80" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-54" value="&lt;div style=&quot;text-align: left&quot;&gt;Spring Security 此版本总共提供了 32个过滤器&lt;/div&gt;这些过滤器主要的逻辑基本都在 doFilterInternal()&amp;nbsp;&lt;br&gt;或 doFilter() 方法" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1340" y="1856" width="240" height="50" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-58" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-55" target="KUAb-_XNP9Eb_uavuq1S-57" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-55" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1860" y="1720" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-60" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-57" target="KUAb-_XNP9Eb_uavuq1S-59" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-57" value="&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;div&gt;asyncManager.&lt;b&gt;registerCallableInterceptor&lt;/b&gt;(&lt;br&gt;CALLABLE_INTERCEPTOR_KEY,&lt;/div&gt;&lt;div&gt;&lt;span&gt;&#x9;&#x9;&#x9;&#x9;&#x9;&lt;/span&gt;new &lt;b&gt;SecurityContextCallableProcessingInterceptor&lt;/b&gt;());&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;就是确保注册安全上下文异步结果处理拦截器&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1840" y="1801" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-62" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-59" target="KUAb-_XNP9Eb_uavuq1S-61" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1960" y="1910" />
              <mxPoint x="1720" y="1910" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-59" value="&lt;font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;&#x9;&#x9;&lt;/span&gt;filterChain.doFilter(request, response);&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="1860" y="1880" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-65" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-61" target="KUAb-_XNP9Eb_uavuq1S-64" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-61" value="&lt;font style=&quot;font-size: 10px&quot;&gt;SecurityContextPersistenceFilter&lt;span&gt;#&lt;br&gt;&lt;/span&gt;doFilter()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;用于安全上下文持久化&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3c800;strokeColor=#B09500;fontColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="1620" y="1920" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-63" value="TODO 结合&lt;span style=&quot;font-size: 10px&quot;&gt;WebAsyncManager看其应用&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="2080" y="1821" width="190" height="20" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-67" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-64" target="KUAb-_XNP9Eb_uavuq1S-66" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-64" value="&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;div&gt;&lt;b&gt;HttpRequestResponseHolder&lt;/b&gt; holder = new HttpRequestResponseHolder(request,&lt;/div&gt;&lt;div&gt;&lt;span&gt;&#x9;&#x9;&#x9;&#x9;&lt;/span&gt;response);&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1860" y="1920" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-69" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-66" target="KUAb-_XNP9Eb_uavuq1S-68" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-326" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-66" target="KUAb-_XNP9Eb_uavuq1S-325" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-66" value="&lt;font&gt;&lt;font&gt;&lt;b style=&quot;font-size: 10px&quot;&gt;SecurityContext&lt;/b&gt;&lt;span style=&quot;font-size: 10px&quot;&gt; contextBeforeChainExecution = repo.loadContext(holder);&lt;/span&gt;&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;加载安全上下文信息，首次新建&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1860" y="2000" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-71" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-68" target="KUAb-_XNP9Eb_uavuq1S-70" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-68" value="&lt;font&gt;&lt;font&gt;&lt;b style=&quot;font-size: 11px&quot;&gt;SecurityContextHolder&lt;/b&gt;&lt;span style=&quot;font-size: 11px&quot;&gt;.setContext(&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 11px&quot;&gt;contextBeforeChainExecution);&lt;/span&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;将安全上下文设置到SecurityContextHolder这里是存储到线程本地（ThreadLocal）&lt;/font&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1860" y="2080" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-73" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-70" target="KUAb-_XNP9Eb_uavuq1S-72" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1960" y="2190" />
              <mxPoint x="1720" y="2190" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-75" value="finally" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-70" target="KUAb-_XNP9Eb_uavuq1S-74" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-70" value="&lt;font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;&#x9;&#x9;&lt;/span&gt;filterChain.doFilter(request, response);&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="1860" y="2160" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-77" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-72" target="KUAb-_XNP9Eb_uavuq1S-76" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-72" value="&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;HeaderWriterFilter&lt;/span&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;#doFilterInternal()&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;&lt;span&gt;主要是在Request和Response中包装了&lt;/span&gt;&lt;br&gt;&lt;span&gt;List&amp;lt;HeaderWriter&amp;gt; headerWriters, 并在&lt;br&gt;&lt;/span&gt;请求返回后写header&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1620" y="2200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-74" value="&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;div&gt;SecurityContextHolder.clearContext();&lt;/div&gt;&lt;div&gt;repo.&lt;b&gt;saveContext&lt;/b&gt;(contextAfterChainExecution, holder.getRequest(),&amp;nbsp;&lt;span&gt;holder.getResponse());&lt;/span&gt;&lt;/div&gt;&lt;div&gt;request.removeAttribute(FILTER_APPLIED);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;请求从此Filter返回后，再持久化保存一下&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;arcSize=7;" parent="1" vertex="1">
          <mxGeometry x="2100" y="2080" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-79" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-76" target="KUAb-_XNP9Eb_uavuq1S-78" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-76" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;HeaderWriterResponse headerWriterResponse = new &lt;b&gt;HeaderWriterResponse&lt;/b&gt;(request,&lt;/div&gt;&lt;div&gt;&lt;span&gt;&#x9;&#x9;&#x9;&#x9;&lt;/span&gt;response, this.&lt;b&gt;headerWriters&lt;/b&gt;);&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1860" y="2200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-81" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-78" target="KUAb-_XNP9Eb_uavuq1S-80" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-78" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;HeaderWriterRequest headerWriterRequest = new &lt;b&gt;HeaderWriterRequest&lt;/b&gt;(request,&lt;/div&gt;&lt;div&gt;&lt;span&gt;&#x9;&#x9;&#x9;&#x9;&lt;/span&gt;headerWriterResponse);&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1860" y="2280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-83" value="finally" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-80" target="KUAb-_XNP9Eb_uavuq1S-82" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-85" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-80" target="KUAb-_XNP9Eb_uavuq1S-84" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1960" y="2390" />
              <mxPoint x="1720" y="2390" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-80" value="&lt;font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;&#x9;&#x9;&lt;/span&gt;filterChain.doFilter(request, response);&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="1860" y="2360" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-82" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;headerWriterResponse.&lt;b&gt;writeHeaders&lt;/b&gt;();&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2100" y="2280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-92" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-84" target="KUAb-_XNP9Eb_uavuq1S-91" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-84" value="&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;CsrfFilter&lt;/span&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;#doFilterInternal()&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;用于防止跨站请求伪造攻击&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1620" y="2400" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-86" value="&lt;div style=&quot;font-size: 8px&quot;&gt;&lt;font style=&quot;font-size: 8px&quot;&gt;测试案例中加载了5种HeaderWriter&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px&quot;&gt;&lt;font style=&quot;font-size: 8px&quot;&gt;XContentTypeOptionsHeaderWriter&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px&quot;&gt;&lt;font style=&quot;font-size: 8px&quot;&gt;XXssProtectionHeaderWriter&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px&quot;&gt;&lt;font style=&quot;font-size: 8px&quot;&gt;CacheControlHeadersWriter&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px&quot;&gt;&lt;font style=&quot;font-size: 8px&quot;&gt;HstsHeaderWriter&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px&quot;&gt;&lt;font style=&quot;font-size: 8px&quot;&gt;XFrameOptionsHeaderWriter&lt;br&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px&quot;&gt;&lt;font style=&quot;font-size: 8px&quot;&gt;具体参考&amp;nbsp;&lt;br&gt;X-Content-Type-Options, X-XSS-Protection, &lt;br&gt;Cache-Control, X-Frame-Options, &lt;br&gt;Content-Security-Policy等标头&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1620" y="2260" width="180" height="120" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-88" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;数据从持久化仓库中加载出来后有3种存储策略&lt;br&gt;&lt;br&gt;GlobalSecurityContextHolderStrategy&amp;nbsp; 就是本地对象&lt;br&gt;ThreadLocalSecurityContextHolderStrategy 线程本地&lt;br&gt;InheritableThreadLocalSecurityContextHolderStrategy&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=8;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1620" y="1980" width="230" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-95" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-91" target="KUAb-_XNP9Eb_uavuq1S-94" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-91" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;CsrfToken csrfToken = this.tokenRepository.loadToken(request);&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;读取服务端存储的csrfToken, 有三种存储方式 cookie 、session、lazy&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1860" y="2400" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-97" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-94" target="KUAb-_XNP9Eb_uavuq1S-96" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-94" value="&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;div&gt;csrfToken 不存在就创建并保存&lt;br&gt;csrfToken = this.tokenRepository.&lt;b&gt;generateToken&lt;/b&gt;(request);&lt;/div&gt;&lt;div&gt;this.tokenRepository.&lt;b&gt;saveToken&lt;/b&gt;(csrfToken, request, response);&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1860" y="2480" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-99" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-96" target="KUAb-_XNP9Eb_uavuq1S-98" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-96" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;this.requireCsrfProtectionMatcher&lt;br&gt;.matches(request)&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;判断当前请求路径是否需要防CSRF,不需要的话就直接执行下一个过滤器&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1860" y="2560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-101" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-98" target="KUAb-_XNP9Eb_uavuq1S-100" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-98" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;this.requireCsrfProtectionMatcher&lt;br&gt;.matches(request)&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;判断当前请求路径是否需要防CSRF,不需要的话就直接执行下一个过滤器&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1860" y="2640" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-103" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-100" target="KUAb-_XNP9Eb_uavuq1S-102" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-100" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;String actualToken = request.getHeader(&lt;/span&gt;&lt;br&gt;&lt;span&gt;csrfToken.getHeaderName());&lt;/span&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;读取客户端传递的CsrfToken&lt;/font&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1860" y="2720" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-107" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-102" target="KUAb-_XNP9Eb_uavuq1S-106" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-102" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;csrfToken.getToken().equals(actualToken)&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;比较token是否相等，不等的话异常处理&lt;br&gt;&lt;/font&gt;参考AccessDeniedHandlerImpl&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1860" y="2800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-105" value="如果有指定 errorPage 就重定向到异常页面，否则返回 403" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="2070" y="2800" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-109" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-106" target="KUAb-_XNP9Eb_uavuq1S-108" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1960" y="2910" />
              <mxPoint x="1720" y="2910" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-106" value="&lt;font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;&#x9;&#x9;&lt;/span&gt;filterChain.doFilter(request, response);&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="1860" y="2880" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-114" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-108" target="KUAb-_XNP9Eb_uavuq1S-113" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-108" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;LogoutFilter#doFilter()&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;退出登录请求处理，只匹配 /logout&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1620" y="2920" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-110" value="服务端保存 CsrfToken 的3种实现&lt;br&gt;&lt;br&gt;CookieCsrfTokenRepository&lt;br&gt;HttpSessionCsrfTokenRepository&lt;br&gt;LazyCsrfTokenRepository" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=8;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1620" y="2460" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-118" value="N" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-113" target="KUAb-_XNP9Eb_uavuq1S-117" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-120" value="Y" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-113" target="KUAb-_XNP9Eb_uavuq1S-119" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2000" y="2980" />
              <mxPoint x="2115" y="2980" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-113" value="&lt;font style=&quot;font-size: 9px ; line-height: 1&quot;&gt;requiresLogout(&lt;br&gt;request, response&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;是否是logout请求&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="1880" y="2920" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-115" value="RequestMatcher logoutRequestMatcher" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="2070" y="2935" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-122" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-117" target="KUAb-_XNP9Eb_uavuq1S-121" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1960" y="3110" />
              <mxPoint x="1720" y="3110" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-117" value="&lt;font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;&#x9;&#x9;&lt;/span&gt;filterChain.doFilter(request, response);&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="1860" y="3080" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-119" value="&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;div&gt;Authentication auth = SecurityContextHolder.getContext().getAuthentication();&lt;/div&gt;&lt;div&gt;this.handler.&lt;b&gt;logout&lt;/b&gt;(request, response, auth);&lt;/div&gt;&lt;div&gt;logoutSuccessHandler.&lt;b&gt;onLogoutSuccess&lt;/b&gt;(request, response, auth);&lt;br&gt;&lt;b&gt;return&lt;/b&gt;;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;arcSize=6;" parent="1" vertex="1">
          <mxGeometry x="2000" y="3000" width="230" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-124" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-121" target="KUAb-_XNP9Eb_uavuq1S-123" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-121" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;UsernamePasswordAuthenticationFilter&lt;br&gt;#doFilter()&lt;/span&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;用户名密码方式身份认证,&amp;nbsp;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;只匹配 /login&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3c800;strokeColor=#B09500;fontColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="1620" y="3120" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-127" value="Y" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-123" target="KUAb-_XNP9Eb_uavuq1S-126" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2000" y="3180" />
              <mxPoint x="2110" y="3180" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-129" value="N" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-123" target="KUAb-_XNP9Eb_uavuq1S-128" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-123" value="&lt;font style=&quot;font-size: 9px ; line-height: 1&quot;&gt;requiresAuthentication(&lt;br&gt;request, response&lt;br&gt;&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="1880" y="3120" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-125" value="判断是否需要认证（一般都是登录请求）" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="2050" y="3130" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-135" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-126" target="KUAb-_XNP9Eb_uavuq1S-134" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-506" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-126" target="KUAb-_XNP9Eb_uavuq1S-505" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-126" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;authResult = attemptAuthentication(request, response);&lt;br&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;内部读取预设的用户名密码与请求参数中的用户名密码对比&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=6;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2000" y="3200" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-131" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-128" target="KUAb-_XNP9Eb_uavuq1S-130" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1960" y="3870" />
              <mxPoint x="1720" y="3870" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-128" value="&lt;font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;&#x9;&#x9;&lt;/span&gt;filterChain.doFilter(request, response);&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="1860" y="3840" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-141" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-130" target="KUAb-_XNP9Eb_uavuq1S-140" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-130" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;DefaultLoginPageGeneratingFilter&lt;br&gt;&lt;/font&gt;#doFilter()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;针对/login请求、logout成功、login失败3种情况展示 spring security 配置的登录页面&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1620" y="3880" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-521" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-132" target="KUAb-_XNP9Eb_uavuq1S-520" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-132" value="&lt;font style=&quot;font-size: 10px&quot;&gt;return this.getAuthenticationManager()&lt;br&gt;.&lt;b&gt;authenticate&lt;/b&gt;(authRequest);&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=6;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2260" y="3360" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-137" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-134" target="KUAb-_XNP9Eb_uavuq1S-136" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-554" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-134" target="KUAb-_XNP9Eb_uavuq1S-553" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-134" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;sessionStrategy.onAuthentication(authResult, request, response)&lt;br&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;认证成功的话使用对应的session策略创建session，DEMO 中没用到暂略&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=6;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2000" y="3600" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-139" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-136" target="KUAb-_XNP9Eb_uavuq1S-138" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-136" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;catch:&lt;br&gt;&lt;/span&gt;unsuccessfulAuthentication(request, response, failed);&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;认证失败处理&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=6;" parent="1" vertex="1">
          <mxGeometry x="2000" y="3680" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-545" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-138" target="KUAb-_XNP9Eb_uavuq1S-544" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-138" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;successfulAuthentication(request, response, chain, authResult)&lt;/span&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;认证成功后置处理，认证结果储存、token、cookie生成、清除认证临时数据等&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=6;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2000" y="3760" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-143" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-140" target="KUAb-_XNP9Eb_uavuq1S-142" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1960" y="3990" />
              <mxPoint x="1720" y="3990" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-140" value="&lt;font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;&#x9;&#x9;&lt;/span&gt;filterChain.doFilter(request, response);&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="1860" y="3960" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-145" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-142" target="KUAb-_XNP9Eb_uavuq1S-144" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-142" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;DefaultLogoutPageGeneratingFilter&lt;br&gt;&lt;/font&gt;#doFilterInternal()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;针对/logout请求展示 spring security 配置的登录退出页面&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1620" y="4000" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-148" value="N" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-144" target="KUAb-_XNP9Eb_uavuq1S-147" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-150" value="Y" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-144" target="KUAb-_XNP9Eb_uavuq1S-149" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2000" y="4060" />
              <mxPoint x="2110" y="4060" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-144" value="&lt;font style=&quot;font-size: 10px&quot;&gt;this.matcher.matches(request)&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="1880" y="4000" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-146" value="/logout" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="2040" y="4020" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-152" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-147" target="KUAb-_XNP9Eb_uavuq1S-151" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1960" y="4190" />
              <mxPoint x="1720" y="4190" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-147" value="&lt;font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;&#x9;&#x9;&lt;/span&gt;filterChain.doFilter(request, response);&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="1860" y="4160" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-149" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;renderLogout(request, response)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=6;" parent="1" vertex="1">
          <mxGeometry x="2000" y="4080" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-156" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-151" target="KUAb-_XNP9Eb_uavuq1S-155" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-151" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;RequestCacheAwareFilter&lt;br&gt;&lt;/font&gt;#doFilter()&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1620" y="4200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-154" value="&lt;font style=&quot;font-size: 9px&quot;&gt;使用场景是在用户访问资源受到保护的Web应用程序时，如果用户未经身份验证，将请求缓存起来，并将用户重定向到登录页。当用户成功进行身份验证后，RequestCacheAwareFilter可以将之前缓存的请求恢复并继续处理，从而提供更好的用户体验。&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1620" y="4260" width="200" height="90" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-158" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-155" target="KUAb-_XNP9Eb_uavuq1S-157" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-155" value="&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;div&gt;HttpServletRequest &lt;b&gt;wrappedSavedRequest&lt;/b&gt; = requestCache.getMatchingRequest(&lt;/div&gt;&lt;div&gt;(HttpServletRequest) request, (HttpServletResponse) response);&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1860" y="4200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-160" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-157" target="KUAb-_XNP9Eb_uavuq1S-159" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1960" y="4390" />
              <mxPoint x="1720" y="4390" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-157" value="&lt;font size=&quot;1&quot;&gt;&lt;div&gt;chain.doFilter(wrappedSavedRequest == null ? request : wrappedSavedRequest,&lt;/div&gt;&lt;div&gt;response)&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1860" y="4320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-162" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-159" target="KUAb-_XNP9Eb_uavuq1S-161" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-159" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;SecurityContextHolderAwareRequestFilter&lt;br&gt;&lt;/font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;#doFilter()&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;将当前用户的安全上下文信息存储到请求中&lt;br&gt;&lt;/font&gt;&lt;/span&gt;包括身份认证和授权信息&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1620" y="4400" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-165" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-161" target="KUAb-_XNP9Eb_uavuq1S-163" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1960" y="4480" />
              <mxPoint x="1720" y="4480" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-363" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-161" target="KUAb-_XNP9Eb_uavuq1S-362" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-161" value="&lt;font size=&quot;1&quot;&gt;&lt;div&gt;chain.doFilter(this.&lt;b&gt;requestFactory&lt;/b&gt;.create(&lt;br&gt;(HttpServletRequest) req,&lt;/div&gt;&lt;div&gt;(HttpServletResponse) res), res);&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="1860" y="4400" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-168" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-163" target="KUAb-_XNP9Eb_uavuq1S-167" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-163" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;AnonymousAuthenticationFilter&lt;br&gt;&lt;/font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;#doFilter()&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;匿名认证过滤器&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1620" y="4500" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-166" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;AnonymousAuthenticationFilter会检查当前的安全上下文中是否存在已认证的用户身份信息。如果不存在，AnonymousAuthenticationFilter会为访问设置一个匿名用户身份，并将其存储到安全上下文中。&lt;/font&gt;&lt;br&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;http.anonymous().principal(&quot;guest&quot;)&lt;br&gt;.authorities(&quot;ROLE_GUEST&quot;);&amp;nbsp;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1620" y="4562" width="200" height="118" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-170" value="N" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-167" target="KUAb-_XNP9Eb_uavuq1S-169" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-175" value="Y" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-167" target="KUAb-_XNP9Eb_uavuq1S-174" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2000" y="4560" />
              <mxPoint x="2100" y="4560" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-167" value="&lt;font style=&quot;font-size: 9px&quot;&gt;SecurityContextHolder.getContext()&lt;br&gt;.getAuthentication() == null&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="1880" y="4500" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-172" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-169" target="KUAb-_XNP9Eb_uavuq1S-171" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1960" y="4710" />
              <mxPoint x="1720" y="4710" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-169" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;chain.doFilter(req, res);&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="1860" y="4680" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-368" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-171" target="KUAb-_XNP9Eb_uavuq1S-177" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-171" value="&lt;font&gt;&lt;font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;SessionManagementFilter&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;#doFilter()&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;过滤器&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1620" y="4720" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-173" value="即检查下安全上下文中是否已经有认证信息" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="2050" y="4515" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-176" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-174" target="KUAb-_XNP9Eb_uavuq1S-169" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-367" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-174" target="KUAb-_XNP9Eb_uavuq1S-366" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-174" value="&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;div&gt;SecurityContextHolder.getContext()&lt;br&gt;.setAuthentication(&lt;/div&gt;&lt;div&gt;createAuthentication((HttpServletRequest) req))&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;创建匿名认证信息&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2000" y="4580" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-369" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-177" target="KUAb-_XNP9Eb_uavuq1S-178" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-440" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-177" target="KUAb-_XNP9Eb_uavuq1S-439" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-177" value="&lt;font&gt;&lt;font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;ExceptionTranslationFilter&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;#doFilter()&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;异常catch过滤器&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1620" y="4820" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-377" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-178" target="KUAb-_XNP9Eb_uavuq1S-373" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-178" value="&lt;font&gt;&lt;font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;FilterSecurityInterceptor&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;#doFilter()&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;鉴授权过滤器&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3c800;strokeColor=#B09500;fontColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="1620" y="5000" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-179" value="&lt;font style=&quot;font-size: 11px;&quot;&gt;&amp;nbsp;如何理解SpringSecurity原理与使用：&lt;br&gt;&lt;br&gt;1 SpringSecurity 的本质：一个拦截请求的&lt;b&gt;过滤器链&lt;/b&gt;；分析的版本中提供了32个过滤器实现，主要提供三大功能：认证&amp;amp;授权&amp;amp;安全漏洞保护；&lt;br&gt;2 SpringSecurity 过滤器链装配到MVC（也可以是Flux）的方式和位置：通过 &lt;b&gt;DelegatingFilterProxyRegistrationBean&lt;/b&gt; 的方式注册并将 &lt;b&gt;springSecurityFilterChain&lt;/b&gt; 装配在 &lt;b&gt;ApplicationFilterChain&lt;/b&gt; 中；&lt;br&gt;3 过滤器链创建原理：WebSecurity&amp;nbsp; HttpSecurity 和&amp;nbsp;SecurityFilterChain 的关系;&lt;br&gt;4 找几个典型的功能（如：用户名密码认证、接口授权、OAuth、CAS等）从配置代码到认证授权实现调试一下代码的主流程；理解配置的底层数据结构，各种功能的原理主流程&lt;br&gt;4.1 &lt;b&gt;认证&lt;/b&gt;：通过一个凭据换取用户信息（比如用户名密码、Token），官方提供了一个用户名密码认证的例子：UsernamePasswordAuthenticationFilter&amp;nbsp;extends AbstractAuthenticationProcessingFilter&lt;br&gt;4.2 &lt;b&gt;授权&lt;/b&gt;：默认授权处理（权限校验）在&amp;nbsp;&lt;b&gt;FilterSecurityInterceptor&lt;/b&gt; 完成&lt;br&gt;5 学会如何在Spring Security 基础上为自己的业务拓展功能（官方提供的一些默认的实现其实就是最后的参考例子）&lt;br&gt;5.1 &lt;b&gt;自定义认证&lt;/b&gt;：比如现在普遍的认证方式是借助Token令牌认证，比如实现一个 TokenAuthenticationFilter&amp;nbsp;&lt;br&gt;5.2 &lt;b&gt;自定义授权：&lt;/b&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="360" y="20" width="1120" height="180" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-183" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-180" target="KUAb-_XNP9Eb_uavuq1S-182" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-185" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-180" target="KUAb-_XNP9Eb_uavuq1S-184" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-285" style="edgeStyle=none;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;dashed=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-180" target="KUAb-_XNP9Eb_uavuq1S-284" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-180" value="官方用户名密码认证&lt;br&gt;&amp;amp; 接口授权" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="40" y="1920" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-190" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-182" target="KUAb-_XNP9Eb_uavuq1S-189" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-199" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-182" target="KUAb-_XNP9Eb_uavuq1S-198" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-182" value="用户名密码认证配置&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;两种方式：通过接口配置、&lt;br&gt;通过注解配置&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="240" y="1920" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-287" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-184" target="KUAb-_XNP9Eb_uavuq1S-286" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PFjZbSy7WQfFXivyGzdx-4" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0;exitDx=0;exitDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-184" target="KUAb-_XNP9Eb_uavuq1S-38" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="400" y="2240" />
              <mxPoint x="940" y="2240" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="PFjZbSy7WQfFXivyGzdx-5" value="&lt;font color=&quot;#007fff&quot;&gt;所属主流程&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="PFjZbSy7WQfFXivyGzdx-4" vertex="1" connectable="0">
          <mxGeometry x="-0.9623" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-184" value="认证&amp;amp;授权主流程&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;比如 未认证请求/demo/home&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="240" y="2280" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-186" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;i&gt;Authentication 身份认证信息接口&lt;/i&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot; color=&quot;#007fff&quot;&gt;//权限信息列表，默认是GrantedAuthority接口的一些实现类，&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot; color=&quot;#007fff&quot;&gt;通常是代表权限信息的一系列字符串&lt;/font&gt;&lt;br&gt;Collection&amp;lt;? extends GrantedAuthority&amp;gt; getAuthorities();&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 11px&quot;&gt;&amp;nbsp; //密码信息，用户输入的密码字符串，在认证过后通常会被移除，&lt;br&gt;&amp;nbsp; 用于保障安全&lt;/font&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;Object getCredentials();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot; color=&quot;#007fff&quot;&gt;//细节信息，web应用中的实现接口通常为 WebAuthenticationDetails，&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot; color=&quot;#007fff&quot;&gt;它记录了访问者的ip地址和sessionId的值&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;Object getDetails();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot; color=&quot;#007fff&quot;&gt;//身份信息，比如用户名&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;Object getPrincipal();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;boolean isAuthenticated();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;void setAuthenticated(boolean var1)&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&#x9;&lt;/span&gt;throws IllegalArgumentException;&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="-1560" y="1640" width="360" height="240" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-273" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;endArrow=block;endFill=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-187" target="KUAb-_XNP9Eb_uavuq1S-270" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-850" y="1039.9999999999995" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-2" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;endArrow=diamondThin;endFill=1;" edge="1" parent="1" source="KUAb-_XNP9Eb_uavuq1S-187" target="KUAb-_XNP9Eb_uavuq1S-223">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-187" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;i&gt;&lt;b&gt;WebSecurity&lt;/b&gt;&lt;/i&gt;&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;WebSecurity 保存有一组创建安全过滤器链的Builder, 即保存一组 HttpSecurity&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private final List&amp;lt;RequestMatcher&amp;gt; ignoredRequests = new ArrayList&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;// 用于创建安全过滤器链的builder列表，里面其实就是 HttpSecurity&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private final List&amp;lt;SecurityBuilder&amp;lt;? extends SecurityFilterChain&amp;gt;&amp;gt; &lt;b&gt;securityFilterChainBuilders&lt;/b&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp;= new ArrayList&amp;lt;SecurityBuilder&amp;lt;? extends SecurityFilterChain&amp;gt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private IgnoredRequestConfigurer ignoredRequestRegistry;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private FilterSecurityInterceptor &lt;b&gt;filterSecurityInterceptor&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private HttpFirewall &lt;b&gt;httpFirewall&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private boolean debugEnabled;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private WebInvocationPrivilegeEvaluator privilegeEvaluator;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private DefaultWebSecurityExpressionHandler &lt;b&gt;defaultWebSecurityExpressionHandler&lt;/b&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp;= new DefaultWebSecurityExpressionHandler();&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private SecurityExpressionHandler&amp;lt;FilterInvocation&amp;gt; &lt;b&gt;expressionHandler&lt;/b&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp;= defaultWebSecurityExpressionHandler;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private Runnable postBuildAction = new Runnable() {...};&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-600" y="1080" width="560" height="320" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-271" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;endArrow=block;endFill=0;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-188" target="KUAb-_XNP9Eb_uavuq1S-270" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-188" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;i&gt;&lt;b&gt;AuthenticationManagerBuilder&lt;/b&gt;&amp;nbsp; 用于构建用户信息存储、认证的管理器&lt;/i&gt;&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private AuthenticationManager parentAuthenticationManager;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private List&amp;lt;AuthenticationProvider&amp;gt; &lt;b&gt;authenticationProviders&lt;/b&gt; = new ArrayList&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 11px&quot;&gt;//默认的UserDetailsService，查询用户详情信息, 从UserDetailsManagerService 中读取&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;private UserDetailsService &lt;b&gt;defaultUserDetailsService&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private Boolean eraseCredentials;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private AuthenticationEventPublisher eventPublisher;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-1580" y="1081" width="480" height="179" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-193" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-189" target="KUAb-_XNP9Eb_uavuq1S-192" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-189" value="接口配置&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;WebSecurityConfigurerAdapter,&lt;br&gt;spring boot 2.7.0之后已经废弃了这种配置方式&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="440" y="1920" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-195" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-192" target="KUAb-_XNP9Eb_uavuq1S-194" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-263" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-192" target="KUAb-_XNP9Eb_uavuq1S-262" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-192" value="&lt;font style=&quot;font-size: 10px&quot;&gt;WebSecurityConfigurerAdapter&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;继承此类，通过@Configuration自动加载&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="640" y="1920" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-194" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;http&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; // 配置请求要求的权限&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; .authorizeRequests()&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .antMatchers(&quot;/test/demo&quot;).permitAll() // 所有用户可访问&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .antMatchers(&quot;/test/admin&quot;).hasRole(&quot;ADMIN&quot;) // 需要 ADMIN 角色&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .antMatchers(&quot;/test/normal&quot;).access(&quot;hasRole(&#39;ROLE_NORMAL&#39;)&quot;)&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 兜底：其他任何请求，访问的用户都需要经过认证&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .anyRequest().authenticated()&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;.and()&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; // 设置 Form 表单登陆&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; .formLogin()&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .permitAll() // 所有用户可访问&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; .and()&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; // 配置退出相关&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; .logout()&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .permitAll(); // 所有用户可访问&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span style=&quot;color: rgb(0, 127, 255); background-color: initial;&quot;&gt;HttpSecurity自定义配置&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=3;" parent="1" vertex="1">
          <mxGeometry x="840" y="1840" width="320" height="200" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-197" value="bean创建后，注入四个Bean:&lt;br&gt;AuthenticationTrustResolver&lt;br&gt;ContentNegotiationStrategy&lt;br&gt;ObjectPostProcessor&amp;lt;Object&amp;gt;&lt;br&gt;&lt;b&gt;AuthenticationConfiguration&lt;/b&gt;&lt;br&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="640" y="1980" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-198" value="注解配置&lt;br&gt;&lt;div&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;@EnableGlobalMethodSecurity&lt;br&gt;启用，在方法上通过注解配置&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="440" y="2120" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-202" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-200" target="KUAb-_XNP9Eb_uavuq1S-201" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-203" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-200" target="KUAb-_XNP9Eb_uavuq1S-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-200" value="&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;@EnableGlobalMethodSecurity&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;&lt;span&gt;starter 中默认没有启用这个注解，属于一个扩展项，可以在方法上配置安全访问控制，比如&lt;/span&gt;&lt;span&gt;@RolesAllowed、@PreAuthorize等注解&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="740" y="1420" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-201" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;@Import(&lt;br&gt;GlobalMethodSecuritySelector)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="980" y="1420" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-210" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-204" target="KUAb-_XNP9Eb_uavuq1S-209" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-204" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;@Autowired(required = false)&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;setFilterChainProxySecurityConfigurer&lt;/b&gt;()&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1180" y="900" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-207" value="新建 WebSecurity 实例并执行初始化等方法;&lt;br&gt;从Bean容器读取 WebSecurityConfigurer 类型的 Bean,&amp;nbsp; 也就是业务配置的 Bean;&amp;nbsp;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1180" y="840" width="300" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-209" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;webSecurity = objectPostProcessor&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;.postProcess(new &lt;b&gt;WebSecurity&lt;/b&gt;(objectPostProcessor));&lt;/div&gt;for webSecurityConfigurers&lt;span style=&quot;font-size: 10px;&quot;&gt;:&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;webSecurity.&lt;/span&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;apply&lt;/b&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;webSecurityConfigurer)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;webSecurityConfigurers 即自定义的配置类&lt;/font&gt;&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1420" y="890" width="360" height="80" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-218" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-211" target="KUAb-_XNP9Eb_uavuq1S-216" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-226" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-211" target="KUAb-_XNP9Eb_uavuq1S-225" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-211" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;HttpSecurity&lt;/b&gt; http = getHttp()&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2020" y="541" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-229" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-213" target="KUAb-_XNP9Eb_uavuq1S-228" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-213" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;http = new &lt;/span&gt;&lt;b style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;HttpSecurity&lt;/font&gt;&lt;/b&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;(objectPostProcessor, &lt;/span&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;authenticationBuilder&lt;/b&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&#x9;&#x9;&#x9;&#x9;sharedObjects);&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2290" y="621" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-215" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;dashed=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-216" target="KUAb-_XNP9Eb_uavuq1S-217" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-216" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;&quot;&gt;web.&lt;b&gt;addSecurityFilterChainBuilder&lt;/b&gt;(http)&lt;br&gt;.postBuildAction(...)&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;表明HttpSecurity就是 WebSecurity的一个过滤器链Builder&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2020" y="1041" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-217" value="&lt;font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;FilterSecurityInterceptor securityInterceptor = http&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&lt;/span&gt;.&lt;b&gt;getSharedObject&lt;/b&gt;(FilterSecurityInterceptor.class);&lt;/span&gt;&lt;/div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;web.&lt;b&gt;securityInterceptor&lt;/b&gt;(securityInterceptor);&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2290" y="1041" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-219" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;for&amp;nbsp;&lt;b&gt;configurers&lt;/b&gt;:&lt;br&gt;configurer.&lt;b&gt;init&lt;/b&gt;((B) this);&lt;/span&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;configurer是过滤器的配置类&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2220" y="1200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-222" value="里面定义了3个开关，&lt;br&gt;分别对应3种方法安全配置规范" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="440" y="2184" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-272" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;endArrow=block;endFill=0;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-223" target="KUAb-_XNP9Eb_uavuq1S-270" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-281" style="edgeStyle=none;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;endArrow=diamondThin;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-223" target="KUAb-_XNP9Eb_uavuq1S-188" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-28" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;sharedObjects&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="KUAb-_XNP9Eb_uavuq1S-281">
          <mxGeometry x="-0.0657" y="2" relative="1" as="geometry">
            <mxPoint x="-10" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-223" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;i&gt;&lt;b&gt;HttpSecurity&lt;/b&gt;&lt;/i&gt;&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;其实就是用于创建一条Http过滤器链的Builder&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//请求路径匹配规则的配置器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private final RequestMatcherConfigurer &lt;b&gt;requestMatcherConfigurer&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//一组过滤器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private List&amp;lt;Filter&amp;gt; &lt;b&gt;filters&lt;/b&gt; = new ArrayList&amp;lt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// 请求路径匹配器，决定哪些请求会走此HttpSecurity创建的过滤器链&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private RequestMatcher &lt;b&gt;requestMatcher&lt;/b&gt; = AnyRequestMatcher.INSTANCE;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// Filter 排序用的&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private FilterComparator &lt;b&gt;comparator&lt;/b&gt; = new FilterComparator();&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-1060" y="1080" width="420" height="240" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-227" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-225" target="KUAb-_XNP9Eb_uavuq1S-213" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-235" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-225" target="KUAb-_XNP9Eb_uavuq1S-234" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-225" value="&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;AuthenticationManager &lt;/span&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;authenticationManager&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt; = &lt;/span&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;authenticationManager&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;();&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;authenticationBuilder.parentAuthenticationManager(&lt;b&gt;authenticationManager&lt;/b&gt;);&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Map&amp;lt;Class&amp;lt;? extends Object&amp;gt;, Object&amp;gt; &lt;/span&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;sharedObjects&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt; = createSharedObjects();&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2260" y="541" width="300" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-231" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-228" target="KUAb-_XNP9Eb_uavuq1S-230" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9H62B6xVDZifgV9hTqks-9" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.513;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="KUAb-_XNP9Eb_uavuq1S-228" target="9H62B6xVDZifgV9hTqks-8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9H62B6xVDZifgV9hTqks-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="KUAb-_XNP9Eb_uavuq1S-228" target="9H62B6xVDZifgV9hTqks-12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-228" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; http&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .csrf().and()&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 9px; white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;font style=&quot;font-size: 8px;&quot; color=&quot;#007fff&quot;&gt;//只有这个是直接添加的，其他的都是注册的过滤器配置类&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .&lt;b&gt;addFilter&lt;/b&gt;(new WebAsyncManagerIntegrationFilter())&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .exceptionHandling().and()&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .headers().and()&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .sessionManagement().and()&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .securityContext().and()&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .requestCache().and()&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .anonymous().and()&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .servletApi().and()&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .apply(new DefaultLoginPageConfigurer&amp;lt;&amp;gt;()).and()&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .logout();&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;默认添加了一些基本的安全过滤器配置，这里解释了为何后面过滤器链中为何多了那么多Filter&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;arcSize=4;" parent="1" vertex="1">
          <mxGeometry x="2290" y="701" width="240" height="160" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-233" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-230" target="KUAb-_XNP9Eb_uavuq1S-232" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9H62B6xVDZifgV9hTqks-10" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1.067;entryDx=0;entryDy=0;entryPerimeter=0;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="KUAb-_XNP9Eb_uavuq1S-230" target="9H62B6xVDZifgV9hTqks-8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-230" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;for defaultHttpConfigurers:&lt;br&gt;&lt;/span&gt;http.apply(configurer);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;Spring SPI 加载&amp;nbsp;&lt;b&gt;AbstractHttpConfigurer&lt;/b&gt;，并应用配置，TODO&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="2290" y="881" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9H62B6xVDZifgV9hTqks-11" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1.2;entryDx=0;entryDy=0;entryPerimeter=0;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="KUAb-_XNP9Eb_uavuq1S-232" target="9H62B6xVDZifgV9hTqks-8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-232" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;configure&lt;/b&gt;(http);&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;调用自定义的HttpSecurity配置&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2290" y="961" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-267" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-234" target="KUAb-_XNP9Eb_uavuq1S-266" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-234" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;configure&lt;/b&gt;(localConfigureAuthenticationBldr)&lt;br&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;自定义的认证管理器builder配置，默认&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;DefaultPasswordEncoderAuthenticationManagerBuilder&lt;br&gt;&lt;/b&gt;在 setApplicationContext()时创建&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2600" y="541" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-48" value="自动配置阶段做的事情还挺多的，&lt;br&gt;这一步不需要看那么细，可以先看后面&lt;br&gt;请求拦截主流程，需要详细看某个Bean&lt;br&gt;到底是怎么配置以及怎么被调用到的&lt;br&gt;再回来找" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="130" y="870" width="190" height="70" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-252" value="在 &lt;b&gt;SecurityAutoConfiguration&lt;/b&gt; 之后执行" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=8;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="240" y="1380" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-256" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;dashed=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-254" target="mgh684Ju6QphpoWxp4na-53" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="600" y="1290" />
              <mxPoint x="950" y="1290" />
              <mxPoint x="950" y="1110" />
              <mxPoint x="1160" y="1110" />
              <mxPoint x="1160" y="1085" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-260" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;@ConditionalOnBean(name = DEFAULT_FILTER_NAME)&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=8;fontColor=#007FFF;" parent="KUAb-_XNP9Eb_uavuq1S-256" vertex="1" connectable="0">
          <mxGeometry x="-0.9176" y="1" relative="1" as="geometry">
            <mxPoint x="126" y="-9" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-259" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-254" target="KUAb-_XNP9Eb_uavuq1S-258" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-254" value="&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;span&gt;@Bean&lt;/span&gt;&lt;br&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp;DelegatingFilterProxyRegistrationBean securityFilterChainRegistration()&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;依赖springSecurityFilterChain&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="440" y="1320" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-258" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;DelegatingFilterProxyRegistrationBean registration&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; = new &lt;b&gt;DelegatingFilterProxyRegistrationBean&lt;/b&gt;(&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;DEFAULT_FILTER_NAME);&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;registration.setOrder(securityProperties.getFilter().&lt;b&gt;getOrder&lt;/b&gt;());&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;registration.&lt;b&gt;setDispatcherTypes&lt;/b&gt;(&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;getDispatcherTypes(securityProperties));&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;TOOD: 深入了解下这个 RegistrationBean 是怎么将自定义Filter注册到 Tomcat中的？&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;fillColor=#fff2cc;strokeColor=#d6b656;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="640" y="1300" width="280" height="100" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-261" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;SecurityProperties&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//yaml 或 propeties 中的配置项&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//指定 Security Filter 作用的资源访问类型（默认request）&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&#x9;&lt;/span&gt;包括 request,async,error,forward,include&lt;/font&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;spring.security.filter.dispatcher-types&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;spring.security.filter.order&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//配置默认用户名、密码、角色&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;spring.security.user.name&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;spring.security.user.password&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;spring.security.user.roles&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-1040" y="240" width="320" height="180" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-262" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;div&gt;auth.&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; // 使用内存中的 InMemoryUserDetailsManager&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; inMemoryAuthentication()&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 不使用 PasswordEncoder 密码编码器&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;.passwordEncoder(NoOpPasswordEncoder.getInstance())&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 配置 admin 用户&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;.withUser(&quot;admin&quot;).password(&quot;admin&quot;).roles(&quot;ADMIN&quot;)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;// 配置 normal 用户&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;.and().withUser(&quot;normal&quot;).password(&quot;normal&quot;).roles(&quot;NORMAL&quot;);&lt;br&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#007fff&quot;&gt;AuthenticationManagerBuilder 自定义配置&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=3;" parent="1" vertex="1">
          <mxGeometry x="840" y="2060" width="320" height="120" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-269" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-266" target="KUAb-_XNP9Eb_uavuq1S-268" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-296" value="" style="edgeStyle=none;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-266" target="KUAb-_XNP9Eb_uavuq1S-295" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-266" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;auth.inMemoryAuthentication()&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;返回InMemoryUserDetailsManagerConfigurer，这个配置类对象&lt;/font&gt;&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;" parent="1" vertex="1">
          <mxGeometry x="2920" y="541" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-294" value="" style="edgeStyle=none;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-268" target="KUAb-_XNP9Eb_uavuq1S-293" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-268" value="&lt;font&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;apply(new &lt;b&gt;InMemoryUserDetailsManagerConfigurer&lt;/b&gt;&amp;lt;&amp;gt;())&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;" parent="1" vertex="1">
          <mxGeometry x="3160" y="541" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-270" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;b&gt;AbstractConfiguredSecurityBuilder&amp;nbsp;&amp;nbsp;&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;i&gt;SecurityBuilder 的组合&lt;/i&gt;&lt;/span&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;span style=&quot;color: rgb(0 , 127 , 255)&quot;&gt;//对于HttpSecurity是用于创建各种 &lt;b&gt;Filter&lt;/b&gt; 的&lt;b&gt;一组配置器，&lt;/b&gt;对于WebSecurity是创建&lt;b&gt;过滤器链&lt;/b&gt;的&lt;b&gt;一组配置器&lt;/b&gt;&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private final LinkedHashMap&amp;lt;Class&amp;lt;? extends SecurityConfigurer&amp;lt;O, B&amp;gt;&amp;gt;, List&amp;lt;SecurityConfigurer&amp;lt;O, B&amp;gt;&amp;gt;&amp;gt; &lt;b&gt;configurers&lt;/b&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&amp;nbsp; &amp;nbsp; = new &lt;b&gt;LinkedHashMap&lt;/b&gt;&amp;lt;Class&amp;lt;? extends SecurityConfigurer&amp;lt;O, B&amp;gt;&amp;gt;, List&amp;lt;SecurityConfigurer&amp;lt;O, B&amp;gt;&amp;gt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private final List&amp;lt;SecurityConfigurer&amp;lt;O, B&amp;gt;&amp;gt; &lt;b&gt;configurersAddedInInitializing&lt;/b&gt; = new ArrayList&amp;lt;SecurityConfigurer&amp;lt;O, B&amp;gt;&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//多个 SecurityConfigurer 共享的对象集合，比如HttpSecurity通过此集合 组合AuthenticationManagerBuilder对象&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//配置时多通过 objectPostProcessor 传给组件&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private final Map&amp;lt;Class&amp;lt;? extends Object&amp;gt;, Object&amp;gt; &lt;b&gt;sharedObjects&lt;/b&gt; = new HashMap&amp;lt;Class&amp;lt;? extends Object&amp;gt;, Object&amp;gt;();&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private final boolean allowConfigurersOfSameType;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private BuildState buildState = BuildState.UNBUILT;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private ObjectPostProcessor&amp;lt;Object&amp;gt; &lt;b&gt;objectPostProcessor&lt;/b&gt;;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//继承自 AbstractSecurityBuilder&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private AtomicBoolean building = new AtomicBoolean();&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private O object;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="-1190" y="760" width="680" height="280" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-275" value="&lt;div&gt;HttpSecurity 其实是某个Http协议安全拦截器链的Builder包含&lt;span style=&quot;background-color: initial;&quot;&gt;一组安全过滤器配置器的集合，&lt;br&gt;WebSecurity则是HttpSecurity的集合，&lt;/span&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;可以配置多组 HttpSecurity&lt;/b&gt;&lt;/div&gt;&lt;div&gt;最终由 WebSecurity 将多组过滤器链整合在一个Map，通过 FilterChainProxy 选择与 request 对应的过滤器链 chain.matches(request)&lt;/div&gt;&lt;div&gt;比如：配置两组分别基于用户名密码 和 OAuth2 认证方式的过滤器链&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fontColor=#007FFF;align=left;dashed=1;arcSize=5;" parent="1" vertex="1">
          <mxGeometry x="2010" y="1500" width="350" height="80" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-283" value="HttpSecurity 通过&amp;nbsp;sharedObjects 组合 AuthenticationManagerBuilder" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;dashed=1;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-1260" y="1281" width="200" height="29" as="geometry" />
        </mxCell>
        <mxCell id="NMxKPJ_On7xpumNUUqYT-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-284" target="NMxKPJ_On7xpumNUUqYT-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-284" value="用户名密码登录&amp;amp;&lt;br&gt;Token认证&amp;amp;&lt;br&gt;RABC控制授权" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="40" y="3160" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-314" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-286" target="KUAb-_XNP9Eb_uavuq1S-313" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-286" value="&lt;font style=&quot;font-size: 10px&quot;&gt;List&amp;lt;Filter&amp;gt; filters = getFilters(fwRequest);&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="440" y="2280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-288" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;UserDetailsManagerConfigurer &lt;font color=&quot;#007fff&quot;&gt;封装&amp;nbsp;UserDetailsManager (继承 UserDetailService)&lt;/font&gt;&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private final List&amp;lt;UserDetailsBuilder&amp;gt; userBuilders = new ArrayList&amp;lt;&amp;gt;();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private final List&amp;lt;UserDetails&amp;gt; users = new ArrayList&amp;lt;&amp;gt;();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//继承自 AbstractDaoAuthenticationConfigurer&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private DaoAuthenticationProvider provider = new DaoAuthenticationProvider();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private final U userDetailsService;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//继承自 SecurityConfigurerAdapter&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private B securityBuilder;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private CompositeObjectPostProcessor objectPostProcessor = new CompositeObjectPostProcessor();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-940" y="1440" width="620" height="240" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-290" style="edgeStyle=none;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=10;fontColor=#330000;endArrow=block;endFill=0;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-289" target="KUAb-_XNP9Eb_uavuq1S-188" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-289" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;DefaultPasswordEncoderAuthenticationManagerBuilder&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#330000&quot; style=&quot;font-size: 11px&quot;&gt;private final List&amp;lt;UserDetailsBuilder&amp;gt; userBuilders = new ArrayList&amp;lt;&amp;gt;();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#330000&quot; style=&quot;font-size: 11px&quot;&gt;private final List&amp;lt;UserDetails&amp;gt; users = new ArrayList&amp;lt;&amp;gt;();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 11px&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 11px&quot;&gt;//继承自 AbstractDaoAuthenticationConfigurer&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#330000&quot; style=&quot;font-size: 11px&quot;&gt;private DaoAuthenticationProvider provider = new DaoAuthenticationProvider();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#330000&quot; style=&quot;font-size: 11px&quot;&gt;private final U userDetailsService;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 11px&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 11px&quot;&gt;//继承自 SecurityConfigurerAdapter&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#330000&quot; style=&quot;font-size: 11px&quot;&gt;private B securityBuilder;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#330000&quot; style=&quot;font-size: 11px&quot;&gt;private CompositeObjectPostProcessor objectPostProcessor = new CompositeObjectPostProcessor();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-1720" y="1360" width="620" height="240" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-292" style="edgeStyle=none;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;endArrow=block;endFill=0;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-291" target="KUAb-_XNP9Eb_uavuq1S-288" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-291" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;InMemoryUserDetailsManagerConfigurer&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-940" y="1720" width="620" height="50" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-293" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;provider.setPasswordEncoder(&lt;br&gt;passwordEncoder);&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;默认是LazyPasswordEncoder&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;" parent="1" vertex="1">
          <mxGeometry x="3160" y="621" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-298" style="edgeStyle=none;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-295" target="KUAb-_XNP9Eb_uavuq1S-297" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-295" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;.passwordEncoder(&lt;br&gt;NoOpPasswordEncoder.getInstance())&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;替换LazyPasswordEncoder，这个是不加密&lt;br&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 9px&quot; color=&quot;#007fff&quot;&gt;返回InMemoryUserDetailsManagerConfigurer&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;" parent="1" vertex="1">
          <mxGeometry x="2920" y="701" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-300" value="" style="edgeStyle=none;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-297" target="KUAb-_XNP9Eb_uavuq1S-299" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-297" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;.withUser(&quot;admin&quot;).password(&quot;admin&quot;)&lt;br&gt;.roles(&quot;ADMIN&quot;)&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;这个返回的是UserDetailsBuilder&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;" parent="1" vertex="1">
          <mxGeometry x="2920" y="781" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-302" style="edgeStyle=none;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-299" target="KUAb-_XNP9Eb_uavuq1S-301" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-299" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;.and()&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;UserDetailsBuilder中记录了InMemoryUserDetailsManagerConfigurer对象实例，此方法返回此实例&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2920" y="861" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-301" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;.withUser(&quot;admin&quot;).password(&quot;admin&quot;)&lt;br&gt;.roles(&quot;ADMIN&quot;)&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;这个返回的是UserDetailsBuilder&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;" parent="1" vertex="1">
          <mxGeometry x="2920" y="941" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-303" value="中文文档：&lt;br&gt;https://springdoc.cn/spring-security/" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-230" y="175" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-304" value="Firewall (防火墙)用于规范化请求URL, &lt;br&gt;以及防止 HRS \ XST 等恶意请求" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1095" y="1520" width="190" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-307" value="&lt;font&gt;&lt;span style=&quot;font-size: 8px&quot;&gt;for&amp;nbsp;filterChains:&amp;nbsp;&lt;/span&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;font-size: 8px&quot;&gt;if (chain.matches(request)) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 8px&quot;&gt;&lt;span&gt;&#x9;&#x9;&#x9;&#x9;&lt;/span&gt;return chain.getFilters();&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span style=&quot;font-size: 8px&quot;&gt;&lt;span&gt;&#x9;&#x9;&#x9;&lt;/span&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;" parent="1" vertex="1">
          <mxGeometry x="1340" y="1560" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-309" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;i&gt;&lt;b&gt;DefaultSecurityFilterChain&lt;/b&gt;&lt;/i&gt;&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// 验证请求是否匹配当前过滤器链的匹配器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private final RequestMatcher requestMatcher;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// 当前过滤器链的Filter列表&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private final List&amp;lt;Filter&amp;gt; filters;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-960" y="1840" width="400" height="160" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-310" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;&lt;i&gt;&lt;b&gt;FilterChainProxy &lt;/b&gt;过滤器链代理&lt;/i&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private final static String FILTER_APPLIED = FilterChainProxy.class.getName().concat(&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;&quot;.APPLIED&quot;);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// 配置的多个过滤器链&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private List&amp;lt;SecurityFilterChain&amp;gt; &lt;b&gt;filterChains&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private FilterChainValidator filterChainValidator = new NullFilterChainValidator();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private HttpFirewall &lt;b&gt;firewall&lt;/b&gt; = new StrictHttpFirewall();&lt;/font&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="-520" y="1840" width="480" height="160" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-311" value="FilterChainProxy" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="495" y="2260" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-323" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-313" target="KUAb-_XNP9Eb_uavuq1S-322" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-490" value="/demo/home&lt;br&gt;未认证&lt;br&gt;由黑线标识流程" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#007FFF;" parent="KUAb-_XNP9Eb_uavuq1S-323" vertex="1" connectable="0">
          <mxGeometry x="-0.3333" y="-3" relative="1" as="geometry">
            <mxPoint x="20" y="-3" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-313" value="&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;VirtualFilterChain vfc = new &lt;b&gt;VirtualFilterChain&lt;/b&gt;(fwRequest, chain, filters);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;vfc.&lt;b&gt;doFilter&lt;/b&gt;(fwRequest, fwResponse)&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="440" y="2360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-317" value="Demo 中设置的 anyRequest(),&amp;nbsp;&lt;br&gt;创建的 AnyRequestMatcher&lt;br&gt;所以这里 过滤器链匹配器可以匹配任何请求" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;dashed=1;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="640" y="2280" width="170" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-319" value="为了支持异步请求处理" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;dashed=1;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1620" y="1780" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-321" value="首次会新建 WebAsyncManager 对象" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="2065" y="1740" width="180" height="20" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-491" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.375;exitY=1.017;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;fillColor=#e51400;strokeColor=#B20000;exitPerimeter=0;entryX=0.375;entryY=-0.017;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-322" target="KUAb-_XNP9Eb_uavuq1S-464" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PFjZbSy7WQfFXivyGzdx-13" value="8" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="KUAb-_XNP9Eb_uavuq1S-491" vertex="1" connectable="0">
          <mxGeometry x="0.628" y="2" relative="1" as="geometry">
            <mxPoint y="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-492" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.25;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-322" target="KUAb-_XNP9Eb_uavuq1S-337" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PFjZbSy7WQfFXivyGzdx-6" value="1" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="KUAb-_XNP9Eb_uavuq1S-492" vertex="1" connectable="0">
          <mxGeometry x="0.147" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-502" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;endArrow=classic;endFill=1;fillColor=#1ba1e2;strokeColor=#006EAF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-322" target="KUAb-_XNP9Eb_uavuq1S-332" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PFjZbSy7WQfFXivyGzdx-18" value="12" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="KUAb-_XNP9Eb_uavuq1S-502" vertex="1" connectable="0">
          <mxGeometry x="0.7291" y="3" relative="1" as="geometry">
            <mxPoint x="-13" y="4" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-322" value="&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;SecurityContextPersistenceFilter&lt;/b&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;doFilter()&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;用于创建以及持久化安全上下文&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="760" y="2360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-324" value="这里只关注用户名密码认证授权&lt;br&gt;相关的过滤器" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;dashed=1;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="290" y="2360" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-325" value="&lt;font&gt;&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;new SecurityContextImpl();&lt;/b&gt;&lt;/span&gt;&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot; size=&quot;1&quot;&gt;首次执行load会新建造&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="2100" y="2000" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-327" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;&lt;b&gt;&lt;i&gt;SecurityContextImpl&lt;/i&gt;&lt;/b&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private Authentication &lt;b&gt;authentication&lt;/b&gt;;&lt;/font&gt;&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-520" y="2040" width="480" height="80" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-329" value="请求链路中首次执行会新建安全上下文，并存储在线程本地，方便在链路中存取安全信息，请求返回时执行本地缓存清理以及持久化操作，线程安全上下文是 SecurityContextImpl 类型，存储用户身份认证信息" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;dashed=1;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="970" y="2360" width="230" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-330" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;HeaderWriterFilter&lt;/span&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;#doFilterInternal()&lt;br&gt;&lt;/span&gt;&lt;div&gt;&lt;font size=&quot;1&quot;&gt;CsrfFilter#doFilterInternal()&lt;/font&gt;&lt;/div&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;会执行但和认证授权关系不大，略&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="760" y="2440" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-504" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;endArrow=classic;endFill=1;fillColor=#1ba1e2;strokeColor=#006EAF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-332" target="KUAb-_XNP9Eb_uavuq1S-503" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PFjZbSy7WQfFXivyGzdx-19" value="13" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="KUAb-_XNP9Eb_uavuq1S-504" vertex="1" connectable="0">
          <mxGeometry x="-0.3727" relative="1" as="geometry">
            <mxPoint x="7" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-332" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;UsernamePasswordAuthenticationFilter&lt;br&gt;#doFilter()&lt;/span&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;用户名密码方式身份认证&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="760" y="2520" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-412" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.25;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-337" target="KUAb-_XNP9Eb_uavuq1S-340" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PFjZbSy7WQfFXivyGzdx-7" value="2" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="KUAb-_XNP9Eb_uavuq1S-412" vertex="1" connectable="0">
          <mxGeometry x="-0.0818" y="2" relative="1" as="geometry">
            <mxPoint x="-12" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-337" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;SecurityContextHolderAwareRequestFilter&lt;br&gt;&lt;/font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;#doFilter()&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;会执行，给request额外包装了两个属性&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="760" y="2780" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-415" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.25;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-340" target="KUAb-_XNP9Eb_uavuq1S-354" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PFjZbSy7WQfFXivyGzdx-8" value="3" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="KUAb-_XNP9Eb_uavuq1S-415" vertex="1" connectable="0">
          <mxGeometry x="0.6377" y="4" relative="1" as="geometry">
            <mxPoint x="-4" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-340" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;AnonymousAuthenticationFilter&lt;br&gt;&lt;/font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;#doFilter()&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;未登录时请求中没有认证信息，通过此过滤器建个匿名认证信息，并存到安全上下文中&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="760" y="2860" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-353" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1179.999999999999" y="2069.9999999999995" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-408" value="&lt;div style=&quot;font-size: 9px&quot;&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;未登录访问受保护URL,会失败；&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px&quot;&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;发布AuthorizationFailureEvent，&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px&quot;&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;并抛 AccessDeniedException&lt;/font&gt;&lt;/div&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0.75;entryY=1;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-354" target="KUAb-_XNP9Eb_uavuq1S-386" edge="1">
          <mxGeometry x="-0.3333" y="-50" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PFjZbSy7WQfFXivyGzdx-9" value="4" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="KUAb-_XNP9Eb_uavuq1S-408" vertex="1" connectable="0">
          <mxGeometry x="0.4515" y="-3" relative="1" as="geometry">
            <mxPoint x="-13" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-354" value="&lt;font&gt;&lt;font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;FilterSecurityInterceptor&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;#doFilter()&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;根据认证信息对用户鉴权授权&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="760" y="3060" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-362" value="&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;div style=&quot;font-size: 10px&quot;&gt;this.&lt;b&gt;rolePrefix&lt;/b&gt; = rolePrefix;&lt;/div&gt;&lt;div style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;&#x9;&#x9;&lt;/span&gt;this.&lt;b&gt;trustResolver&lt;/b&gt; = trustResolver;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;rolePrefix 默认 &quot;ROLE_&quot;&lt;br&gt;trustResolver 默认 AuthenticationTrustResolverImpl 用于判断是否已经通过认证&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2100" y="4400" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-366" value="&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;div&gt;AnonymousAuthenticationToken auth = new &lt;b&gt;AnonymousAuthenticationToken&lt;/b&gt;(key,&amp;nbsp;&lt;span&gt;principal, authorities);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;auth.setDetails(authenticationDetailsSource&lt;br&gt;.buildDetails(request));&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;" parent="1" vertex="1">
          <mxGeometry x="2240" y="4580" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-372" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-373" target="KUAb-_XNP9Eb_uavuq1S-375" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-373" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;FilterInvocation fi = new FilterInvocation(request, response, chain)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1860" y="5000" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-374" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-375" target="KUAb-_XNP9Eb_uavuq1S-376" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-383" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-375" target="KUAb-_XNP9Eb_uavuq1S-382" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-375" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;&lt;b&gt;invoke&lt;/b&gt;(fi)&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;鉴权失败就发失败事件并抛异常；&lt;br&gt;鉴权成功发布成功事件生成 TOKEN 并存储到安全上下文&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1860" y="5080" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-379" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-376" target="KUAb-_XNP9Eb_uavuq1S-378" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-376" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;InterceptorStatusToken &lt;b&gt;token&lt;/b&gt; = super.beforeInvocation(fi);&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2100" y="5080" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-381" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-378" target="KUAb-_XNP9Eb_uavuq1S-380" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-378" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;Authentication authenticated = this.authenticateIfRequired()&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;读取认证信息&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2338" y="5080" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-390" value="鉴权失败" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-380" target="KUAb-_XNP9Eb_uavuq1S-389" edge="1">
          <mxGeometry x="0.3" y="10" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-392" value="鉴权成功" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-380" target="KUAb-_XNP9Eb_uavuq1S-391" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-380" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;this.accessDecisionManager.decide(&lt;br&gt;authenticated, object, attributes);&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;访问权限判定（鉴权）&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2338" y="5160" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-385" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-382" target="KUAb-_XNP9Eb_uavuq1S-384" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-382" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;fi.getChain().doFilter(fi.getRequest(), fi.getResponse())&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1860" y="5160" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-384" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;&lt;span&gt;super.afterInvocation(token, null);&lt;br&gt;&lt;/span&gt;finally:&lt;br&gt;&lt;span&gt;super.finallyInvocation(token);&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1860" y="5240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-470" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-386" target="KUAb-_XNP9Eb_uavuq1S-469" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PFjZbSy7WQfFXivyGzdx-10" value="5" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="KUAb-_XNP9Eb_uavuq1S-470" vertex="1" connectable="0">
          <mxGeometry x="-0.2818" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-386" value="&lt;font&gt;&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;ExceptionTranslationFilter&lt;br&gt;#catch()&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;鉴权失败抛的AccessDeniedException被捕获，response&lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 127 , 255) ; font-size: 10px&quot;&gt;未提交就处理此异常&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="760" y="2940" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-389" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;发布 AuthorizationFailureEvent&lt;br&gt;&lt;/span&gt;throw&amp;nbsp;AccessDeniedException&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2618" y="5160" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-394" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-391" target="KUAb-_XNP9Eb_uavuq1S-393" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-391" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;发布 AuthorizedEvent&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2620" y="5240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-396" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-393" target="KUAb-_XNP9Eb_uavuq1S-395" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-393" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;Authentication runAs = this.runAsManager.&lt;b&gt;buildRunAs&lt;/b&gt;(&lt;br&gt;authenticated, object, attributes);&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2620" y="5320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-400" value="Y" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-395" target="KUAb-_XNP9Eb_uavuq1S-399" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-403" value="N" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-395" target="KUAb-_XNP9Eb_uavuq1S-401" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2780" y="5440" />
              <mxPoint x="2780" y="5520" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-395" value="&lt;font style=&quot;font-size: 10px&quot;&gt;runAs == null&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="2680" y="5400" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-399" value="&lt;font style=&quot;font-size: 10px&quot;&gt;return new &lt;b&gt;InterceptorStatusToken&lt;/b&gt;(&lt;br&gt;SecurityContextHolder.getContext(), false, attributes, object);&lt;/font&gt;" style="whiteSpace=wrap;html=1;rounded=1;arcSize=6;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2840" y="5410" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-401" value="&lt;div style=&quot;font-size: 8px&quot;&gt;&lt;div&gt;SecurityContext origCtx = SecurityContextHolder.getContext();&lt;/div&gt;&lt;div&gt;SecurityContextHolder.&lt;b&gt;setContext&lt;/b&gt;(SecurityContextHolder&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&#x9;&lt;/span&gt;.createEmptyContext());&lt;/div&gt;&lt;div&gt;SecurityContextHolder.getContext().&lt;b&gt;setAuthentication&lt;/b&gt;(runAs);&lt;/div&gt;&lt;div&gt;return new &lt;b&gt;InterceptorStatusToken&lt;/b&gt;(origCtx, true, attributes, object);&lt;/div&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;align=left;arcSize=9;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2840" y="5490" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-405" value="认证方式有多种，配置不同的认证方式，这一步的Filter就不同。&lt;br&gt;&lt;br&gt;认证成功后，会生成 Cookie Session 以及&lt;br&gt;在安全上下文中保存&amp;nbsp;UsernamePasswordAuthenticationToken&lt;br&gt;用于后续的授权校验" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;dashed=1;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1620" y="3190" width="290" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-406" value="鉴权成功或失败虽然有发事件，但是没看到哪里有监听事件，估计此处事件还是一个拓展点，供用户自行拓展的" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;dashed=1;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1620" y="5060" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-443" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-430" target="KUAb-_XNP9Eb_uavuq1S-442" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-430" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;&lt;div&gt;if (response.isCommitted())&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; throw new ServletException(...);&lt;/div&gt;&lt;div&gt;&lt;b&gt;handleSpringSecurityException&lt;/b&gt;(request, response, chain, ase);&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2338" y="4820" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-431" value="&lt;font style=&quot;font-size: 8px&quot;&gt;SpringSecurityException&lt;br&gt;AccessDeniedException&lt;br&gt;&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-433" target="KUAb-_XNP9Eb_uavuq1S-430" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-432" value="其他异常" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-433" target="KUAb-_XNP9Eb_uavuq1S-434" edge="1">
          <mxGeometry x="0.1" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2200" y="4850" />
              <mxPoint x="2200" y="4930" />
            </Array>
            <mxPoint x="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-433" value="&lt;font style=&quot;font-size: 10px&quot;&gt;Exception 类型&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="2098" y="4820" width="80" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-434" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;throw ex;&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;或&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;throw new RuntimeException(ex);&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;" parent="1" vertex="1">
          <mxGeometry x="2338" y="4900" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-449" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-436" target="KUAb-_XNP9Eb_uavuq1S-448" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-436" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;font size=&quot;1&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;&lt;div style=&quot;font-size: 9px&quot;&gt;&lt;div style=&quot;text-align: center&quot;&gt;&lt;b&gt;sendStartAuthentication&lt;/b&gt;(request, response, chain,&amp;nbsp;&lt;span&gt;(AuthenticationException) exception);&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2780" y="4820" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-447" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-437" target="KUAb-_XNP9Eb_uavuq1S-446" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-437" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;&lt;div&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;Authentication authentication = SecurityContextHolder.getContext()&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;.getAuthentication();&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="2780" y="4900" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-441" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-439" target="KUAb-_XNP9Eb_uavuq1S-433" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-439" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;catch(Exception ex&lt;/span&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;)&lt;/span&gt;&lt;br&gt;&lt;font style=&quot;font-size: 9px&quot; color=&quot;#007fff&quot;&gt;在 try catch 中处理后续流程产生的异常信息，比如后面鉴授权失败的AccessDeniedException&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1860" y="4820" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-444" value="&lt;font style=&quot;font-size: 8px&quot;&gt;AuthenticationException&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-442" target="KUAb-_XNP9Eb_uavuq1S-436" edge="1">
          <mxGeometry x="-0.0007" y="10" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2720" y="4850" />
              <mxPoint x="2720" y="4850" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-445" value="&lt;b&gt;AccessDeniedException&lt;/b&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-442" target="KUAb-_XNP9Eb_uavuq1S-437" edge="1">
          <mxGeometry x="0.4" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2680" y="4850" />
              <mxPoint x="2680" y="4930" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-442" value="&lt;font style=&quot;font-size: 10px&quot;&gt;exception&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;align=center;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="2580" y="4810" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-461" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-446" target="KUAb-_XNP9Eb_uavuq1S-448" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3020" y="5030" />
              <mxPoint x="3020" y="4865" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-446" value="&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;if (authenticationTrustResolver.&lt;b&gt;isAnonymous&lt;/b&gt;(authentication)&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; || authenticationTrustResolver.&lt;b&gt;isRememberMe&lt;/b&gt;(authentication)) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;sendStartAuthentication&lt;/b&gt;(request, response, chain,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; new InsufficientAuthenticationException(...);&lt;/div&gt;&lt;div&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;accessDeniedHandler&lt;/b&gt;.handle(request, response,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; (AccessDeniedException) exception);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;fillColor=#dae8fc;strokeColor=#6c8ebf;arcSize=4;" parent="1" vertex="1">
          <mxGeometry x="2750" y="4980" width="260" height="100" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-451" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-448" target="KUAb-_XNP9Eb_uavuq1S-450" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-448" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;&lt;div&gt;&lt;font&gt;&lt;span style=&quot;font-size: 11px&quot;&gt;SecurityContextHolder.getContext()&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 11px&quot;&gt;.setAuthentication(null);&lt;/span&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;认证信息无效，这里将其从安全上下文清除掉&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="3040" y="4820" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-453" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-450" target="KUAb-_XNP9Eb_uavuq1S-452" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-450" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;&lt;div&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;requestCache.saveRequest(request, response);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;缓存请求，后面重新认证后继续此请求&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="3040" y="4900" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-455" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-452" target="KUAb-_XNP9Eb_uavuq1S-454" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-452" value="&lt;font&gt;&lt;span style=&quot;font-size: 11px&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;/span&gt;&lt;div style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;authenticationEntryPoint.commence(&lt;br&gt;request, response, reason);&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;转发或重定向到认证入口&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="3040" y="4980" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-458" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-454" target="KUAb-_XNP9Eb_uavuq1S-457" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3500" y="5010" />
              <mxPoint x="3500" y="5090" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-460" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-454" target="KUAb-_XNP9Eb_uavuq1S-459" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-454" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;LoginUrlAuthenticationEntryPoint#&lt;/div&gt;&lt;/font&gt;commence()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;DEMO中配置的这个&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;" parent="1" vertex="1">
          <mxGeometry x="3280" y="4980" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-456" value="有多种实现：&lt;br&gt;&lt;div&gt;&lt;b&gt;BasicAuthenticationEntryPoint&lt;/b&gt;&lt;/div&gt;&lt;div&gt;DelegatingAuthenticationEntryPoint&lt;/div&gt;&lt;div&gt;DigestAuthenticationEntryPoint&lt;/div&gt;&lt;div&gt;Http401AuthenticationEntryPoint&lt;/div&gt;&lt;div&gt;Http403ForbiddenEntryPoint&lt;/div&gt;&lt;div&gt;HttpStatusEntryPoint&lt;/div&gt;&lt;div&gt;&lt;b&gt;LoginUrlAuthenticationEntryPoint&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;OAuth2AuthenticationEntryPoint&lt;/b&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="3040" y="5050" width="180" height="110" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-457" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;redirectUrl = &lt;b&gt;buildRedirectUrlToLoginPage&lt;/b&gt;(&lt;br&gt;request, response, authException);&lt;br&gt;redirectStrategy.&lt;b&gt;sendRedirect&lt;/b&gt;(request, response, redirectUrl);&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="3520" y="5060" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-459" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;RequestDispatcher dispatcher = request.&lt;b&gt;getRequestDispatcher&lt;/b&gt;(loginForm);&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;dispatcher.&lt;b&gt;forward&lt;/b&gt;(request, response);&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="3520" y="4980" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-494" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;fillColor=#e51400;strokeColor=#B20000;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-464" target="KUAb-_XNP9Eb_uavuq1S-493" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PFjZbSy7WQfFXivyGzdx-14" value="9" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="KUAb-_XNP9Eb_uavuq1S-494" vertex="1" connectable="0">
          <mxGeometry x="-0.1" y="-4" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-464" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;DefaultLoginPageGeneratingFilter&lt;br&gt;&lt;/font&gt;#doFilter()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;针对/login请求、logout成功、login失败3种情况展示 spring security 配置的登录页面&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="760" y="2680" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-487" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;fillColor=#e51400;strokeColor=#B20000;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-469" target="KUAb-_XNP9Eb_uavuq1S-472" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1260" y="2970" />
              <mxPoint x="1260" y="2310" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-497" value="这里省略了 Spring Web 中的处理流程，只关注 Security 的过滤器链的处理" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;fontColor=#007FFF;" parent="KUAb-_XNP9Eb_uavuq1S-487" vertex="1" connectable="0">
          <mxGeometry x="0.8605" y="3" relative="1" as="geometry">
            <mxPoint x="40" y="27" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PFjZbSy7WQfFXivyGzdx-11" value="6" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="KUAb-_XNP9Eb_uavuq1S-487" vertex="1" connectable="0">
          <mxGeometry x="-0.7823" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-469" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/font&gt;redirectUrl = &lt;b&gt;buildRedirectUrlToLoginPage&lt;/b&gt;(&lt;br&gt;request, response, authException);&lt;br&gt;redirectStrategy.&lt;b&gt;sendRedirect&lt;/b&gt;(request, response, redirectUrl);&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;鉴权失败，重定向到登录页&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1000" y="2930" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-488" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;fillColor=#e51400;strokeColor=#B20000;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-472" target="KUAb-_XNP9Eb_uavuq1S-322" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PFjZbSy7WQfFXivyGzdx-12" value="7" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="KUAb-_XNP9Eb_uavuq1S-488" vertex="1" connectable="0">
          <mxGeometry x="-0.0818" y="1" relative="1" as="geometry">
            <mxPoint x="-11" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-472" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;/login GET 请求&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;红线标识流程&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="ellipse;whiteSpace=wrap;html=1;rounded=1;fontSize=8;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="800" y="2280" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-499" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;endArrow=classic;endFill=1;fillColor=#1ba1e2;strokeColor=#006EAF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-493" target="KUAb-_XNP9Eb_uavuq1S-498" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PFjZbSy7WQfFXivyGzdx-15" value="10" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="KUAb-_XNP9Eb_uavuq1S-499" vertex="1" connectable="0">
          <mxGeometry x="-0.2355" y="1" relative="1" as="geometry">
            <mxPoint y="191" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-493" value="&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;div&gt;String loginPageHtml = &lt;b&gt;generateLoginPageHtml&lt;/b&gt;(request, loginError,&lt;/div&gt;&lt;div&gt;&#x9;&#x9;&#x9;&#x9;&#x9;logoutSuccess);&lt;br&gt;response.getWriter().&lt;b&gt;write&lt;/b&gt;(loginPageHtml);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;返回登录页面&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1000" y="2680" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-500" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;endArrow=classic;endFill=1;fillColor=#1ba1e2;strokeColor=#006EAF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-498" target="KUAb-_XNP9Eb_uavuq1S-322" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1000" y="2350" />
              <mxPoint x="910" y="2350" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="PFjZbSy7WQfFXivyGzdx-17" value="11" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="KUAb-_XNP9Eb_uavuq1S-500" vertex="1" connectable="0">
          <mxGeometry x="-0.658" y="1" relative="1" as="geometry">
            <mxPoint x="-1" y="3" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-498" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;/login POST 请求&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;由蓝线标识流程&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="ellipse;whiteSpace=wrap;html=1;rounded=1;fontSize=8;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="940" y="2230" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-550" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;fillColor=#dae8fc;strokeColor=#3333FF;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-503" target="KUAb-_XNP9Eb_uavuq1S-549" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PFjZbSy7WQfFXivyGzdx-20" value="14" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="KUAb-_XNP9Eb_uavuq1S-550" vertex="1" connectable="0">
          <mxGeometry x="0.6697" y="2" relative="1" as="geometry">
            <mxPoint x="-17" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-503" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;return this.getAuthenticationManager()&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;.&lt;b&gt;authenticate&lt;/b&gt;(authRequest);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;用户名密码认证成功，生成Cookie Session&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;&quot; color=&quot;#007fff&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;UsernamePasswordAuthenticationToken&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1000" y="2520" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-514" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-505" target="KUAb-_XNP9Eb_uavuq1S-513" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-505" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;UsernamePasswordAuthenticationToken authRequest = new &lt;b&gt;UsernamePasswordAuthenticationToken&lt;/b&gt;(&lt;/div&gt;&lt;div&gt;&lt;span&gt;&#x9;&#x9;&#x9;&#x9;&lt;/span&gt;username, password);&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=6;" parent="1" vertex="1">
          <mxGeometry x="2260" y="3200" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-512" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;endArrow=blockThin;endFill=0;dashed=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-509" target="KUAb-_XNP9Eb_uavuq1S-186" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-509" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;b&gt;&lt;i&gt;AbstractAuthenticationToken&lt;/i&gt;&lt;/b&gt;&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 11px&quot;&gt;// 角色等信息列表&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;private final Collection&amp;lt;GrantedAuthority&amp;gt; authorities;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 11px&quot;&gt;// 身份认证细节信息(比如请求来源IP、SessionId等)&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;private Object details;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 11px&quot;&gt;// 是否已经认证过&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;private boolean authenticated = false;&lt;/font&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-1560" y="1920" width="360" height="160" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-511" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;endArrow=block;endFill=0;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-510" target="KUAb-_XNP9Eb_uavuq1S-509" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-510" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;b&gt;&lt;i&gt;UsernamePasswordAuthenticationToken&lt;/i&gt;&lt;/b&gt;&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 11px&quot;&gt;// 身份信息，如用户名&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;private final Object principal;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 11px&quot;&gt;// 凭证，即密码信息&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;private Object credentials;&lt;/font&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-1560" y="2120" width="360" height="120" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-515" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-513" target="KUAb-_XNP9Eb_uavuq1S-132" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-517" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-513" target="KUAb-_XNP9Eb_uavuq1S-516" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-513" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;setDetails(request, authRequest);&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=6;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2260" y="3280" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-516" value="&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;div&gt;this.&lt;b&gt;remoteAddress&lt;/b&gt; = request.getRemoteAddr();&lt;/div&gt;&lt;div&gt;HttpSession session = request.getSession(false);&lt;/div&gt;&lt;div&gt;this.&lt;b&gt;sessionId&lt;/b&gt; = (session != null) ? session.getId() : null;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;session 存储在 StandardManager&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=6;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2520" y="3280" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-518" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;&lt;b&gt;&lt;i&gt;ProviderManager&lt;/i&gt;&lt;/b&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private AuthenticationEventPublisher eventPublisher = new NullEventPublisher();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// 认证服务列表&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private List&amp;lt;AuthenticationProvider&amp;gt; &lt;b&gt;providers&lt;/b&gt; = Collections.emptyList();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;protected MessageSourceAccessor messages = SpringSecurityMessageSource.getAccessor();&lt;/font&gt;&lt;span style=&quot;color: rgb(51 , 0 , 0)&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;/p&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; // 父AuthenticationManager&lt;/font&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private AuthenticationManager &lt;b&gt;parent&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private boolean eraseCredentialsAfterAuthentication = true;&lt;/font&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// 遍历列表选择支持当前认证类型的认证服务进行认证，没有的话使用 parent 进行认证&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;public Authentication &lt;b&gt;authenticate&lt;/b&gt;(Authentication authentication)&amp;nbsp;&lt;span&gt;throws AuthenticationException&lt;/span&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-960" y="2160" width="580" height="200" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-519" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;&lt;b&gt;&lt;i&gt;DaoAuthenticationProvider&lt;/i&gt;&lt;/b&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private PasswordEncoder passwordEncoder;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private volatile String userNotFoundEncodedPassword;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private UserDetailsService userDetailsService;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;private UserDetailsPasswordService userDetailsPasswordService;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//继承AbstractUserDetailsAuthenticationProvider&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;protected MessageSourceAccessor messages = SpringSecurityMessageSource.getAccessor();&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private UserCache userCache = new NullUserCache();&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private boolean forcePrincipalAsString = false;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;protected boolean hideUserNotFoundExceptions = true;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private UserDetailsChecker preAuthenticationChecks = new DefaultPreAuthenticationChecks();&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private UserDetailsChecker postAuthenticationChecks = new DefaultPostAuthenticationChecks();&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;private GrantedAuthoritiesMapper authoritiesMapper = new NullAuthoritiesMapper();&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-960" y="2400" width="580" height="280" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-523" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-520" target="KUAb-_XNP9Eb_uavuq1S-522" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-520" value="&lt;font style=&quot;font-size: 9px&quot;&gt;for&amp;nbsp;&amp;nbsp;getProviders():&amp;nbsp;&lt;br&gt;if (!provider.supports(toTest))&lt;br&gt;result = provider.&lt;b&gt;authenticate&lt;/b&gt;(authentication);&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=6;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2520" y="3360" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-525" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-522" target="KUAb-_XNP9Eb_uavuq1S-524" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-543" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-522" target="KUAb-_XNP9Eb_uavuq1S-542" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-522" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;if (result == null &amp;amp;&amp;amp; parent != null)&lt;br&gt;&lt;/span&gt;result = parentResult = parent.&lt;b&gt;authenticate&lt;/b&gt;(authentication);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;没有合适 provider 使用 parent 认证&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=6;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2520" y="3440" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-529" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-524" target="KUAb-_XNP9Eb_uavuq1S-528" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-533" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-524" target="KUAb-_XNP9Eb_uavuq1S-532" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-524" value="&lt;font style=&quot;font-size: 10px&quot;&gt;UserDetails loadedUser = this.&lt;b&gt;getUserDetailsService&lt;/b&gt;()&lt;br&gt;.&lt;b&gt;loadUserByUsername&lt;/b&gt;(username);&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=6;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2780" y="3440" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-526" value="DaoAuthenticationProvider" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="2800" y="3420" width="140" height="20" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-527" value="ProviderManager" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="2580" y="3340" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-528" value="&lt;span style=&quot;font-size: 10px&quot;&gt;UserDetails user = &lt;b&gt;users&lt;/b&gt;.get(username.toLowerCase());&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=6;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="3000" y="3440" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-530" value="InMemoryUserDetailsManager" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="3010" y="3420" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-531" value="&lt;p style=&quot;margin: 4px 0px 0px ; text-align: center ; font-size: 9px&quot;&gt;&lt;font color=&quot;#330000&quot; style=&quot;font-size: 9px&quot;&gt;&lt;i&gt;&lt;b&gt;User &lt;/b&gt;implements UserDetails, CredentialsContainer&lt;/i&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot; style=&quot;font-size: 9px&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#330000&quot; style=&quot;font-size: 11px&quot;&gt;private String password;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#330000&quot; style=&quot;font-size: 11px&quot;&gt;private final String username;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;// 角色等信息，比如 “ROLE_ADMIN”&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#330000&quot; style=&quot;font-size: 11px&quot;&gt;private final Set&amp;lt;GrantedAuthority&amp;gt; &lt;b&gt;authorities&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#330000&quot; style=&quot;font-size: 11px&quot;&gt;private final boolean accountNonExpired;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#330000&quot; style=&quot;font-size: 11px&quot;&gt;private final boolean accountNonLocked;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#330000&quot; style=&quot;font-size: 11px&quot;&gt;private final boolean credentialsNonExpired;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 11px&quot;&gt;&lt;font color=&quot;#330000&quot; style=&quot;font-size: 11px&quot;&gt;private final boolean enabled;&lt;/font&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;" parent="1" vertex="1">
          <mxGeometry x="-1320" y="2281" width="280" height="170" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-535" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-532" target="KUAb-_XNP9Eb_uavuq1S-534" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-532" value="&lt;span style=&quot;font-size: 10px&quot;&gt;preAuthenticationChecks.check(user);&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;postAuthenticationChecks.check(user);&lt;/span&gt;&lt;br&gt;&lt;font style=&quot;font-size: 9px&quot; color=&quot;#007fff&quot;&gt;比较传参的用户名密码和从UserDetailsService中查出来的是否相同&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=6;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2780" y="3520" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-537" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-534" target="KUAb-_XNP9Eb_uavuq1S-536" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-534" value="&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;if (!cacheWasUsed) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;&#x9;&#x9;&#x9;&lt;/span&gt;this.userCache.&lt;b&gt;putUserInCache&lt;/b&gt;(user);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;&#x9;&#x9;&lt;/span&gt;}&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;arcSize=6;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2780" y="3600" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-536" value="&lt;span style=&quot;font-size: 10px&quot;&gt;return &lt;/span&gt;&lt;b style=&quot;font-size: 10px&quot;&gt;createSuccessAuthentication&lt;/b&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;(&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;principalToReturn, authentication, user);&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 8px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;为UsernamePasswordAuthenticationToken&lt;br&gt;&lt;font style=&quot;font-size: 8px&quot;&gt;填充属性，创建完整的TOKEN&lt;/font&gt;&lt;/font&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;arcSize=6;fillColor=#e3c800;strokeColor=#B09500;fontColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="2780" y="3680" width="180" height="80" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-542" value="&lt;font style=&quot;font-size: 10px&quot;&gt;如果认证成功后要求清除TOKEN中密码信息就清空&amp;nbsp;credentials 字段&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;arcSize=6;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2520" y="3520" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-547" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-544" target="KUAb-_XNP9Eb_uavuq1S-546" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-544" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;SecurityContextHolder.getContext()&lt;br&gt;.setAuthentication(authResult);&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=6;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2260" y="3760" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-546" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;String targetUrl = determineTargetUrl(request, response);&lt;br&gt;&lt;/span&gt;redirectStrategy.sendRedirect(request, response, targetUrl);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;找出之前缓存的目标URL重定向&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=6;fillColor=#e3c800;strokeColor=#B09500;fontColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="2260" y="3840" width="220" height="80" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-549" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;redirectStrategy.&lt;b&gt;sendRedirect&lt;/b&gt;(request, response, targetUrl);&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;重定向回&amp;nbsp;/demo/home&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1000" y="2600" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-557" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;dashed=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-553" target="KUAb-_XNP9Eb_uavuq1S-556" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-559" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;endArrow=classic;endFill=1;" parent="1" source="KUAb-_XNP9Eb_uavuq1S-553" target="KUAb-_XNP9Eb_uavuq1S-558" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-553" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#330000&quot;&gt;&lt;b&gt;ChangeSessionIdAuthenticationStrategy&lt;/b&gt;#&lt;br&gt;onAuthentication()&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;会覆盖旧的Session生成新的Session, Tomcat会自动将sessionID通过Cookie传给客户端&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=6;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2260" y="3600" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-555" value="&lt;font color=&quot;#007fff&quot;&gt;这里 sessionStrategy 是&lt;br&gt;CompositeSessionAuthenticationStrategy 类型，&lt;br&gt;意为组合的 SessionAuthenticationStrategy&lt;br&gt;包含两个策略：&lt;br&gt;&lt;div&gt;0 = {&lt;b&gt;ChangeSessionIdAuthenticationStrategy&lt;/b&gt;@10670}&amp;nbsp;&lt;/div&gt;&lt;div&gt;1 = {&lt;b&gt;CsrfAuthenticationStrategy&lt;/b&gt;@10674}&amp;nbsp;&lt;/div&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#330000;" parent="1" vertex="1">
          <mxGeometry x="1720" y="3600" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-556" value="&lt;div&gt;&lt;b&gt;Tomcat 内部自动将 SessionId 通过 Cookie 传给客户端的简化示例代码如下：&lt;/b&gt;&lt;br&gt;// 获取当前请求的 Session ID，如果没有，则新建一个 Session&lt;/div&gt;&lt;div&gt;String sessionId = request.getSession().getId();&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;// 将 Session ID 存储在一个名为 JSESSIONID 的 Cookie 中&lt;/div&gt;&lt;div&gt;Cookie cookie = new Cookie(&quot;JSESSIONID&quot;, sessionId);&lt;/div&gt;&lt;div&gt;cookie.setMaxAge(-1); // Cookie 永久有效&lt;/div&gt;&lt;div&gt;response.addCookie(cookie);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;// 将 Cookie 发送给客户端&lt;/div&gt;&lt;div&gt;response.setHeader(&quot;Set-Cookie&quot;, &quot;JSESSIONID=&quot; + sessionId + &quot;; Path=/&quot;);&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="2538" y="3780" width="422" height="140" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-558" value="&lt;font style=&quot;font-size: 10px&quot; color=&quot;#330000&quot;&gt;&lt;div&gt;originalSessionId = session.getId();&lt;/div&gt;&lt;div&gt;&lt;span&gt;&#x9;&#x9;&#x9;&#x9;&lt;/span&gt;session = &lt;b&gt;applySessionFixation&lt;/b&gt;(request);&lt;/div&gt;&lt;div&gt;&#x9;&#x9;&#x9;&#x9;newSessionId = session.getId();&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=6;fillColor=#e3c800;strokeColor=#B09500;fontColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="2520" y="3600" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KUAb-_XNP9Eb_uavuq1S-560" value="&lt;div style=&quot;text-align: left&quot;&gt;如何设置这个策略的属性&amp;nbsp;&lt;b&gt;alwaysCreateSession&lt;/b&gt;为true, 就会每次认证重新生成token,可以防止&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;固定会话攻击&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="2260" y="3560" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="G22PBLmXUFhHQ8FubK-l-3" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;" parent="1" source="G22PBLmXUFhHQ8FubK-l-1" target="KUAb-_XNP9Eb_uavuq1S-32" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G22PBLmXUFhHQ8FubK-l-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="G22PBLmXUFhHQ8FubK-l-1" target="G22PBLmXUFhHQ8FubK-l-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G22PBLmXUFhHQ8FubK-l-8" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="G22PBLmXUFhHQ8FubK-l-1" target="G22PBLmXUFhHQ8FubK-l-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="GH47UCEo5jCfzRZnI8sl-5" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="G22PBLmXUFhHQ8FubK-l-1" target="GH47UCEo5jCfzRZnI8sl-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G22PBLmXUFhHQ8FubK-l-1" value="配置&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;实际使用中主要配置两个&lt;/font&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;SecurityBuilder&lt;/font&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="40" y="240" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_mi8EZfeP0kHDRHF6gE_-7" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="G22PBLmXUFhHQ8FubK-l-4" target="G22PBLmXUFhHQ8FubK-l-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_mi8EZfeP0kHDRHF6gE_-8" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="G22PBLmXUFhHQ8FubK-l-4" target="G22PBLmXUFhHQ8FubK-l-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_mi8EZfeP0kHDRHF6gE_-9" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="G22PBLmXUFhHQ8FubK-l-4" target="G22PBLmXUFhHQ8FubK-l-18" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="420" y="270" />
              <mxPoint x="420" y="430" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="IxV6Wpb0yKeQFxCOAp23-4" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="G22PBLmXUFhHQ8FubK-l-4" target="IxV6Wpb0yKeQFxCOAp23-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G22PBLmXUFhHQ8FubK-l-4" value="HttpSecurity&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;它内部配置项对应着后面的安全过滤器,源码注释很详细还有示例&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="240" y="240" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="GH47UCEo5jCfzRZnI8sl-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="G22PBLmXUFhHQ8FubK-l-6" target="GH47UCEo5jCfzRZnI8sl-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G22PBLmXUFhHQ8FubK-l-6" value="AuthenticationManagerBuilder&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;主要配置认证信息服务，即用于获取用户认证详情信息的服务&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="240" y="560" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_mi8EZfeP0kHDRHF6gE_-2" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="G22PBLmXUFhHQ8FubK-l-9" target="_mi8EZfeP0kHDRHF6gE_-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G22PBLmXUFhHQ8FubK-l-9" value="cors()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;会在安全过滤器链中加入 CorsFilter&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="440" y="320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="G22PBLmXUFhHQ8FubK-l-11" value="this.&lt;b&gt;configurers&lt;/b&gt;.put(clazz, configs);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="920" y="240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="G22PBLmXUFhHQ8FubK-l-13" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;AbstractConfiguredSecurityBuilder&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="930" y="210" width="180" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_mi8EZfeP0kHDRHF6gE_-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="G22PBLmXUFhHQ8FubK-l-16" target="_mi8EZfeP0kHDRHF6gE_-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G22PBLmXUFhHQ8FubK-l-16" value="headers().frameOptions().disable()&lt;br&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="440" y="240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_mi8EZfeP0kHDRHF6gE_-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="G22PBLmXUFhHQ8FubK-l-18" target="_mi8EZfeP0kHDRHF6gE_-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G22PBLmXUFhHQ8FubK-l-18" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;exceptionHandling()&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;.authenticationEntryPoint(authenticationEntryPoint)&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;.accessDeniedHandler(accessDeniedHandler)&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;异常处理配置&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="435" y="400" width="210" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_mi8EZfeP0kHDRHF6gE_-3" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="_mi8EZfeP0kHDRHF6gE_-1" target="G22PBLmXUFhHQ8FubK-l-11" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="900" y="350" />
              <mxPoint x="900" y="270" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="_mi8EZfeP0kHDRHF6gE_-1" value="new &lt;b&gt;CorsConfigurer&lt;/b&gt;&amp;lt;&amp;gt;()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="680" y="320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_mi8EZfeP0kHDRHF6gE_-6" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="_mi8EZfeP0kHDRHF6gE_-4" target="G22PBLmXUFhHQ8FubK-l-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_mi8EZfeP0kHDRHF6gE_-4" value="new &lt;b&gt;HeadersConfigurer&lt;/b&gt;&amp;lt;&amp;gt;()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="680" y="240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_mi8EZfeP0kHDRHF6gE_-11" value="&lt;font color=&quot;#007fff&quot;&gt;更多方法参考Markdown&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="465" y="210" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_mi8EZfeP0kHDRHF6gE_-14" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="_mi8EZfeP0kHDRHF6gE_-12" target="G22PBLmXUFhHQ8FubK-l-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_mi8EZfeP0kHDRHF6gE_-12" value="&lt;div style=&quot;&quot;&gt;&lt;font size=&quot;1&quot;&gt;new ExceptionHandlingConfigurer&amp;lt;&amp;gt;()&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="680" y="400" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PFjZbSy7WQfFXivyGzdx-2" value="&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;这里是前后端不分离，使用SS默认表单登录（有个简陋表单页面）&lt;br&gt;以及内存保存用户信息的实现方案，实际项目不会这么实现；&lt;br&gt;但是配置和编码都很简单，方便测试学习Spring Security工作原理&lt;br&gt;&lt;br&gt;实际项目普遍使用Token认证，使用数据库存储用户信息&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="40" y="1980" width="320" height="90" as="geometry" />
        </mxCell>
        <mxCell id="PFjZbSy7WQfFXivyGzdx-23" value="&lt;font color=&quot;#3333ff&quot;&gt;每个过滤器详细处理流程&lt;br&gt;看上一部分&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="585" y="2450" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="NMxKPJ_On7xpumNUUqYT-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="NMxKPJ_On7xpumNUUqYT-1" target="NMxKPJ_On7xpumNUUqYT-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="NMxKPJ_On7xpumNUUqYT-1" value="用户名密码登录&amp;amp;&lt;br style=&quot;font-size: 10px;&quot;&gt;Token签发" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="240" y="3160" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="NMxKPJ_On7xpumNUUqYT-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="NMxKPJ_On7xpumNUUqYT-3" target="NMxKPJ_On7xpumNUUqYT-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="NMxKPJ_On7xpumNUUqYT-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="NMxKPJ_On7xpumNUUqYT-3" target="NMxKPJ_On7xpumNUUqYT-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="NMxKPJ_On7xpumNUUqYT-3" value="Token认证&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;通过自定义过滤器并注入&lt;br style=&quot;font-size: 10px;&quot;&gt;SS安全过滤器链实现&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="240" y="3240" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="NMxKPJ_On7xpumNUUqYT-5" value="&lt;font color=&quot;#3333ff&quot;&gt;生产项目中流行实现的方式&lt;br&gt;实例参考：software-design-proposal&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="10" y="3230" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="NMxKPJ_On7xpumNUUqYT-14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" parent="1" source="NMxKPJ_On7xpumNUUqYT-7" target="NMxKPJ_On7xpumNUUqYT-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HhOwZSwuD1cP-OxSFutj-2" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="NMxKPJ_On7xpumNUUqYT-7" target="HhOwZSwuD1cP-OxSFutj-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="NMxKPJ_On7xpumNUUqYT-7" value="执行 @PreAuthorize() 定义的&lt;br&gt;权限检查" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="240" y="3320" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="NMxKPJ_On7xpumNUUqYT-9" value="内部流程：&lt;br&gt;从请求头读取Token, Token有效性校验；&lt;br&gt;然后通过Token获取用户信息；&lt;br&gt;将用户信息存储到请求的属性（也可以存安全上下文）；" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="440" y="3240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="NMxKPJ_On7xpumNUUqYT-11" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;@PreAuthorize() 原理其实是&lt;b&gt;通过动态代理给Controller的 HandlerMethod 进行了增强&lt;/b&gt;（参考流程图第2页）&lt;br&gt;在增强逻辑中执行权限检查逻辑，而不是在&amp;nbsp;&lt;/font&gt;FilterSecurityInterceptor 中做权限检查&lt;/font&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="640" y="3330" width="500" height="40" as="geometry" />
        </mxCell>
        <mxCell id="NMxKPJ_On7xpumNUUqYT-13" value="@PreAuthorize() 注解原理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="440" y="3320" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="HhOwZSwuD1cP-OxSFutj-1" value="执行请求处理器增强逻辑即权限校验&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;此时的请求处理器是代理类，如UserController$$EnhancerBySpringCGLIB&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="440" y="3400" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="IxV6Wpb0yKeQFxCOAp23-2" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;......&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="440" y="480" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="GH47UCEo5jCfzRZnI8sl-1" value="auth.userDetailsService(userDetailsService)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;定义UserDetailServices实现&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="440" y="560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="GH47UCEo5jCfzRZnI8sl-3" value="&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;默认有缓存、内存、JDBC三种实现&lt;br&gt;由于JDBC实现中表名字段等都是固定的，也没法用于生产环境&lt;br&gt;所以一般都需要自行实现&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="645" y="560" width="300" height="60" as="geometry" />
        </mxCell>
        <mxCell id="GH47UCEo5jCfzRZnI8sl-4" value="PasswordEncoder&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;密码加密器&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="240" y="640" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="GH47UCEo5jCfzRZnI8sl-8" value="&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;如果手动创建Bean, 默认会创建 LazyPasswordEncoder, &lt;br&gt;&lt;span style=&quot;&quot;&gt;实际使用时发现 passwordEncoder 仍然是空的话就会创建一组加密器（存储在DelegatingPasswordEncoder中）&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="410" y="650" width="520" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-1" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;AbstractConfiguredSecurityBuilder&lt;br&gt;执行的是&lt;b&gt;HttpSecurity&lt;/b&gt;覆盖的方法&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="2010" y="1165" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="qwSPwGrAE5PhXKtDNLOx-3" target="qwSPwGrAE5PhXKtDNLOx-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-3" value="&lt;font style=&quot;&quot;&gt;for &lt;b style=&quot;font-size: 10px;&quot;&gt;configurers&lt;/b&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;:&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;configurer.&lt;/span&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;configure&lt;/b&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;((B) this);&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;configurer是过滤器的配置类&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2220" y="1300" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-6" value="&lt;font style=&quot;&quot;&gt;http.&lt;b&gt;addFilter&lt;/b&gt;(...)&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;创建并注册过滤器到 HttpSecurity&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3c800;strokeColor=#B09500;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="2465" y="1300" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" edge="1" parent="1" source="qwSPwGrAE5PhXKtDNLOx-9" target="qwSPwGrAE5PhXKtDNLOx-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9H62B6xVDZifgV9hTqks-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="qwSPwGrAE5PhXKtDNLOx-9" target="9H62B6xVDZifgV9hTqks-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-9" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;beforeInit();&lt;/div&gt;&lt;div&gt;&lt;b&gt;init&lt;/b&gt;();&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1620" y="1040" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="qwSPwGrAE5PhXKtDNLOx-11" target="qwSPwGrAE5PhXKtDNLOx-12">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1700" y="1240" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-11" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;beforeConfigure();&lt;/div&gt;&lt;div&gt;&lt;b&gt;configure&lt;/b&gt;();&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;configure() 都是空的，略&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1620" y="1140" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-17" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="qwSPwGrAE5PhXKtDNLOx-12" target="qwSPwGrAE5PhXKtDNLOx-16">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-12" value="&lt;font style=&quot;font-size: 10px&quot;&gt;O result = &lt;b&gt;performBuild&lt;/b&gt;();&lt;br&gt;return result;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;创建过滤器链，后面省略了不重要的步骤&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1620" y="1340" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-13" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;AbstractConfiguredSecurityBuilder&lt;br&gt;执行的是&lt;b&gt;WebSecurity&lt;/b&gt;覆盖的方法&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="1610" y="1005" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-19" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="qwSPwGrAE5PhXKtDNLOx-20" target="KUAb-_XNP9Eb_uavuq1S-18">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-21" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="qwSPwGrAE5PhXKtDNLOx-16" target="qwSPwGrAE5PhXKtDNLOx-20">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-16" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;&quot;&gt;List&amp;lt;SecurityFilterChain&amp;gt; securityFilterChains = new ArrayList&amp;lt;&amp;gt;(&lt;span style=&quot;background-color: initial;&quot;&gt;chainSize);&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1820" y="1340" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-25" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="qwSPwGrAE5PhXKtDNLOx-20" target="qwSPwGrAE5PhXKtDNLOx-24">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-20" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;for &lt;b&gt;securityFilterChainBuilders&lt;/b&gt;:&amp;nbsp;&lt;br&gt;&lt;/font&gt;securityFilterChains.add(&lt;br&gt;securityFilterChainBuilder.&lt;b&gt;build&lt;/b&gt;());&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;securityFilterChainBuilder 即 &lt;b&gt;HttpSecurity&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1820" y="1420" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-22" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;这个方法主要的作用就是WebSecurity中&lt;br&gt;配置了几个HttpSecurity 就创建几个过滤器链&lt;br&gt;然后创建过滤器链代理&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="1590" y="1400" width="230" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-23" value="&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&lt;b&gt;梳理这部分源码前提是必须搞清楚&lt;br&gt;&amp;nbsp;WebSecurity 和 HttpSecurity 的包含关系&lt;br&gt;否则看后面的代码容易迷糊&lt;br&gt;&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="1175" y="1100" width="210" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-24" value="&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;FilterChainProxy filterChainProxy = new &lt;b&gt;FilterChainProxy&lt;/b&gt;(&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;securityFilterChains)&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1820" y="1520" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-26" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;&quot;&gt;Collections.sort(filters, comparator);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;return new &lt;b&gt;DefaultSecurityFilterChain&lt;/b&gt;(&lt;br&gt;requestMatcher, filters);&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2220" y="1400" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qwSPwGrAE5PhXKtDNLOx-27" value="&lt;div&gt;&lt;b&gt;HttpSecurity&lt;/b&gt; 其实是某个Http协议安全拦截器链的Builder包含&lt;span style=&quot;background-color: initial;&quot;&gt;一组安全过滤器配置器的集合，&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;b&gt;WebSecurity&lt;/b&gt;则是HttpSecurity的集合，&lt;/span&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;可以配置多组 HttpSecurity&lt;/b&gt;&lt;/div&gt;&lt;div&gt;最终由 WebSecurity 将多组过滤器链整合在一个Map，通过 FilterChainProxy 选择与 request 对应的过滤器链 chain.matches(request)&lt;/div&gt;&lt;div&gt;比如：配置两组分别基于用户名密码 和 OAuth2 认证方式的过滤器链&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fontColor=#007FFF;align=left;dashed=1;arcSize=5;" vertex="1" parent="1">
          <mxGeometry x="-480" y="940" width="350" height="100" as="geometry" />
        </mxCell>
        <mxCell id="9H62B6xVDZifgV9hTqks-1" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;WebSecurityConfigurerAdapter&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="2235" y="1165" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9H62B6xVDZifgV9hTqks-3" value="WebSecurityConfigurerAdapter" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="2025" y="510" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9H62B6xVDZifgV9hTqks-6" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="9H62B6xVDZifgV9hTqks-4" target="KUAb-_XNP9Eb_uavuq1S-211">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9H62B6xVDZifgV9hTqks-4" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;&quot;&gt;for configurers:&lt;/div&gt;&lt;div style=&quot;&quot;&gt;configurer.&lt;b&gt;init&lt;/b&gt;((B) this);&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;WebSecurity configurers 存储的是过滤器链的配置类&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3c800;strokeColor=#B09500;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="1820" y="1040" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9H62B6xVDZifgV9hTqks-7" value="&lt;b&gt;&lt;font color=&quot;#007fff&quot;&gt;其实就是把过滤器链配置类转成&lt;br&gt;过滤器链的Builder，即 HttpSecurity&lt;br&gt;里面注册了很多过滤器配置类&lt;br&gt;&lt;/font&gt;&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="1790" y="1100" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9H62B6xVDZifgV9hTqks-8" value="&lt;b&gt;过滤器配置类的三大来源&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="2560" y="855" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9H62B6xVDZifgV9hTqks-12" value="this.&lt;b&gt;configurers&lt;/b&gt;.put(clazz, configs);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="2600" y="751" width="200" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="5KJOA-RfSMnJKgTViGIL" name="@PreAuthorize()工作原理">
    <mxGraphModel dx="1434" dy="879" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="vjm4kIKAECSHUo3N8mKR-1" value="&lt;h1&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;@PreAuthorize() 工作原理&lt;/font&gt;&lt;font style=&quot;font-size: 12px; font-weight: normal;&quot;&gt;（spring-core-5.3.29）&lt;/font&gt;&lt;/h1&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;用在 HandlerMethod 上，表示访问某个请求处理方法需要先通过权限认证。&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;搜索源码中的 PreAuthorize.class 可以发现着手点：PrePostAnnotationSecurityMetadataSource.java, 然后加断点（“preAuthorize != null”）调试。&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="40" y="20" width="720" height="100" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-5" target="hh33vyQ6RJqZMyFvEeoW-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-1" value="Spring 应用上下文初始化每个Bean实例后&lt;br style=&quot;font-size: 10px;&quot;&gt;会执行所有 BeanPostProcessor&lt;br&gt;其中一个后置处理器名为&lt;br&gt;&amp;nbsp;&lt;b&gt;InfrastructureAdvisorAutoProxyCreator&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="40" y="160" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-2" target="hh33vyQ6RJqZMyFvEeoW-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-2" value="return wrapIfNecessary(bean, beanName, cacheKey);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="520" y="160" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-4" value="AbstractAutowireCapableBeanFactory" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="505" y="130" width="230" height="30" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-1" target="hh33vyQ6RJqZMyFvEeoW-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="240" y="190" as="sourcePoint" />
            <mxPoint x="565" y="190" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-5" value="current = processor.postProcessAfterInitialization(&lt;br&gt;result, beanName);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="280" y="160" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-7" value="InfrastructureAdvisorAutoProxyCreator" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="265" y="130" width="230" height="30" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-8" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;这个后置处理器就是用于检查Bean是否有代理逻辑&lt;br&gt;有的话自动生成Bean代理&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="40" y="220" width="250" height="40" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-9" target="hh33vyQ6RJqZMyFvEeoW-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-57" value="..." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="hh33vyQ6RJqZMyFvEeoW-13" vertex="1" connectable="0">
          <mxGeometry y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-60" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-9" target="hh33vyQ6RJqZMyFvEeoW-59" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-9" value="Object[] specificInterceptors = &lt;b&gt;getAdvicesAndAdvisorsForBean&lt;/b&gt;(&lt;br&gt;bean.getClass(), beanName, null);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;扫描增强逻辑(Advisor)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="760" y="160" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-11" value="AbstractAutoProxyCreator" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="780" y="130" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-12" target="hh33vyQ6RJqZMyFvEeoW-15" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1100" y="320" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-39" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-12" target="hh33vyQ6RJqZMyFvEeoW-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-12" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;List&amp;lt;Advisor&amp;gt; candidateAdvisors = findCandidateAdvisors();&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;测试DEMO扫描到3个候选 Advisor,其中有个 &lt;b style=&quot;&quot;&gt;MethodSecurityMetadataSourceAdvisor&lt;/b&gt;&lt;/font&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1000" y="160" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-14" value="AbstractAdvisorAutoProxyCreator" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1000" y="130" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-18" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-15" target="hh33vyQ6RJqZMyFvEeoW-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-56" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-15" target="hh33vyQ6RJqZMyFvEeoW-55" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-15" value="List&amp;lt;Advisor&amp;gt; eligibleAdvisors = findAdvisorsThatCanApply(&lt;br&gt;candidateAdvisors, beanClass, beanName);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;筛选候选Advisor中可执行的&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1000" y="340" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-21" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-17" target="hh33vyQ6RJqZMyFvEeoW-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-22" value="..." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="hh33vyQ6RJqZMyFvEeoW-21" vertex="1" connectable="0">
          <mxGeometry x="-0.4146" y="-1" relative="1" as="geometry">
            <mxPoint x="7" y="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-17" value="&lt;div&gt;if (canApply(candidate, clazz, hasIntroductions)) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; eligibleAdvisors.add(candidate);&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="1241" y="340" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-19" value="AopUtils" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1306" y="310" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-25" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-20" target="hh33vyQ6RJqZMyFvEeoW-24" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1580" y="422" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-20" value="MethodSecurityMetadataSource source = MethodSecurityMetadataSourceAdvisor&lt;br&gt;.this.attributeSource;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="1480" y="340" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-23" value="MethodSecurityMetadataSourceAdvisor" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1465" y="310" width="230" height="30" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-27" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-24" target="hh33vyQ6RJqZMyFvEeoW-26" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-24" value="return !CollectionUtils.isEmpty(source&lt;br&gt;.getAttributes(m, targetClass));" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="1" vertex="1">
          <mxGeometry x="1480" y="442" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-49" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-26" target="hh33vyQ6RJqZMyFvEeoW-48" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-51" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-26" target="hh33vyQ6RJqZMyFvEeoW-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-53" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;fillColor=#d5e8d4;strokeColor=#82b366;dashed=1;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-26" target="hh33vyQ6RJqZMyFvEeoW-52" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-26" value="for (MethodSecurityMetadataSource s : this.methodSecurityMetadataSources) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;attributes&lt;/b&gt; = s.getAttributes(method,&amp;nbsp; &amp;nbsp; targetClass);&lt;br&gt;}" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="1720" y="442" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-28" value="DelegatingMethodSecurityMetadataSource" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1695" y="412" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-33" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-29" target="hh33vyQ6RJqZMyFvEeoW-32" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-29" value="&lt;b&gt;PreAuthorize&lt;/b&gt; preAuthorize = findAnnotation(method, targetClass, PreAuthorize.class);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;扫描类型为targetClass的Bean的method方法, 获取 @PreAuthorize 注解&amp;nbsp;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2200" y="442" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-35" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-32" target="hh33vyQ6RJqZMyFvEeoW-34" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-32" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;String &lt;b&gt;preAuthorizeAttribute&lt;/b&gt; = (preAuthorize != null) ? preAuthorize.value() : null;&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;PreInvocationAttribute pre = this.attributeFactory&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;.&lt;b&gt;createPreInvocationAttribute&lt;/b&gt;(&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;preFilterAttribute,&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;filterObject, preAuthorizeAttribute);&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="2200" y="522" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-34" value="&lt;font size=&quot;1&quot;&gt;attrs.add(pre);&lt;br&gt;&lt;/font&gt;return attrs;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;attrs 是&amp;nbsp;ArrayList&amp;lt;ConfigAttribute&amp;gt; 类型&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="2200" y="626.5" width="200" height="55.5" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-36" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;div&gt;后面的逻辑其实就是&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;先读取所有候选 Advisor 依次校验是否可执行（是否需要自动代理），这里只关注 MethodSecurityMetadataSourceAdvisor&lt;/div&gt;&lt;div&gt;判断 MethodSecurityMetadataSourceAdvisor 是否需要自动代理的规则是&lt;/div&gt;&lt;div&gt;扫描这个Bean所有的方法是否有 MethodSecurityMetadataSourceAdvisor 属性源 attributeSource 中定义的属性&lt;/div&gt;&lt;div&gt;MethodSecurityMetadataSourceAdvisor 属性源中包含两个属性源&lt;/div&gt;&lt;div&gt;0 = {PrePostAnnotationSecurityMetadataSource@10972}&amp;nbsp; 是否&lt;span style=&quot;background-color: initial;&quot;&gt;有@PreFilter @PreAuthorize @PostFilter @PostAuthorize 注解&lt;/span&gt;&lt;/div&gt;&lt;div&gt;1 = {SecuredAnnotationSecurityMetadataSource@10998}&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;最终 current 类型： UserController$$EnhancerBySpringCGLIB$$xxxxxxxxx&lt;/div&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="280" y="230" width="590" height="130" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-42" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-38" target="hh33vyQ6RJqZMyFvEeoW-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-38" value="return this.advisorRetrievalHelper&lt;br&gt;.findAdvisorBeans();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1241" y="160" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-45" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-41" target="hh33vyQ6RJqZMyFvEeoW-44" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-62" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-41" target="hh33vyQ6RJqZMyFvEeoW-61" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1460" y="220" />
              <mxPoint x="1460" y="530" />
              <mxPoint x="380" y="530" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-41" value="String[] advisorNames = this.&lt;b&gt;cachedAdvisorBeanNames&lt;/b&gt;;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1480" y="160" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-43" value="BeanFactoryAdvisorRetrievalHelper" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1475" y="130" width="210" height="30" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-44" value="过滤掉不合格或者正在创建的 Advisor&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;过滤规则暂略&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1480" y="240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-47" value="&lt;b&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;SecuredAnnotationSecurityMetadataSource&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;暂略&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="1960" y="720" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-50" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="hh33vyQ6RJqZMyFvEeoW-48" target="hh33vyQ6RJqZMyFvEeoW-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-48" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;&lt;b&gt;PrePostAnnotationSecurityMetadataSource&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;&lt;b&gt;扫描 @PreFilter @PreAuthorize @PostFilter @PostAuthorize 注解，&lt;br&gt;这里只展示 @PreAuthorize&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="1960" y="442" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-52" value="&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;attributes = {ArrayList@11031}&amp;nbsp; size = 1&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;0 = {&lt;b&gt;PreInvocationExpressionAttribute&lt;/b&gt;@11078} &quot;[authorize: &#39;@ss.hasPermission(&#39;system:user:create&#39;)&#39;, filter: &#39;null&#39;, filterTarget: &#39;null&#39;]&quot;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1440" y="540" width="750" height="40" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-54" value="&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;此DEMO中筛选出&amp;nbsp;MethodSecurityMetadataSourceAdvisor&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1000" y="400" width="280" height="30" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-55" value="extendAdvisors(eligibleAdvisors);&lt;br&gt;eligibleAdvisors = sortAdvisors(eligibleAdvisors);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1000" y="441" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-59" value="&lt;span style=&quot;background-color: initial;&quot;&gt;Object proxy = &lt;b&gt;createProxy&lt;/b&gt;(&lt;/span&gt;&lt;br&gt;&lt;div&gt;bean.getClass(), beanName, specificInterceptors, new SingletonTargetSource(bean));&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;创建代理Bean&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="760" y="340" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-61" value="String[] advisorNames = this.&lt;b&gt;cachedAdvisorBeanNames&lt;/b&gt;;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;TODO 这三个Advisor哪里注册的？&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="280" y="542" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hh33vyQ6RJqZMyFvEeoW-63" value="BeanFactoryAdvisorRetrievalHelper" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="280" y="502" width="210" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
