<mxfile host="Electron" modified="2024-05-02T12:56:23.003Z" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/21.6.5 Chrome/114.0.5735.243 Electron/25.3.1 Safari/537.36" etag="OrFaM8nSHoSkXmxi72jr" version="21.6.5" type="device" pages="5">
  <diagram id="C5RBs43oDa-KdzZeNtuy" name="Nacos注册中心">
    <mxGraphModel dx="3915" dy="842" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-1" parent="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="cKh2JxnRFl6GvmQpNupA-267" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#007FFF;elbow=vertical;dashed=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-240" target="cKh2JxnRFl6GvmQpNupA-243" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3799" y="220" />
              <mxPoint x="1688" y="220" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-95" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=6;fontColor=#007FFF;strokeColor=#007FFF;elbow=vertical;dashed=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-87" target="cKh2JxnRFl6GvmQpNupA-47" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3460" y="940" />
              <mxPoint x="3460" y="990" />
              <mxPoint x="2560" y="990" />
              <mxPoint x="2560" y="1050" />
              <mxPoint x="2481" y="1050" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-164" style="edgeStyle=entityRelationEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=1;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#82b366;elbow=vertical;shape=link;width=3.333333333333332;fillColor=#d5e8d4;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-161" target="cKh2JxnRFl6GvmQpNupA-56" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-12" style="edgeStyle=entityRelationEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;shape=link;elbow=vertical;strokeColor=#33FFFF;width=2;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vd_qBJxyYYtXZSKp8f6n-33" target="Sf5YBq0qI29CyhUMobhk-0" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-0" target="E0nTntA1szs-sMbRV9SV-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-0" value="Client启动" style="ellipse;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="80" y="160" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-1" value="end" style="ellipse;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="80" y="1800" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-2" target="E0nTntA1szs-sMbRV9SV-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-198" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-2" target="cKh2JxnRFl6GvmQpNupA-196" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-2" value="自动配置&lt;br style=&quot;font-size: 10px;&quot;&gt;spring-cloud-alibaba-nacos-discovery -&amp;gt;&amp;nbsp;spring.factories" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="50" y="240" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-4" value="&lt;h1&gt;Nacos注册中心（1.4.1）&lt;/h1&gt;&lt;p&gt;前置知识：&lt;br&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Spring Boot启动流程（如：事件监听机制）、自动配置原理、Spring事件机制&lt;/li&gt;&lt;li&gt;CopyOnWrite 、LookUp 机制&lt;/li&gt;&lt;li&gt;Spring Cloud 规范&amp;amp;工作机制（如：BootstrapConfiguration）&lt;br&gt;&lt;/li&gt;&lt;li&gt;Distro一致性协议、Raft一致性协议&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="40" y="19" width="540" height="141" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-32" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#3333FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" target="cKh2JxnRFl6GvmQpNupA-31" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1340" y="260" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="1340" y="260" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-6" value="REST&lt;br&gt;API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;gradientColor=#97d077;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1300" y="240" width="40" height="1040" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-13" target="E0nTntA1szs-sMbRV9SV-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-24" value="&lt;span style=&quot;font-family: helvetica; font-size: 6px; font-style: normal; font-weight: 400; letter-spacing: normal; text-align: center; text-indent: 0px; text-transform: none; word-spacing: 0px; background-color: rgb(248, 249, 250); display: inline; float: none;&quot;&gt;创建了3个Bean&lt;/span&gt;" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=6;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-13" target="E0nTntA1szs-sMbRV9SV-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-13" value="NacosServiceRegistryAutoConfiguration" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="220" y="240" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-18" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-15" target="E0nTntA1szs-sMbRV9SV-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-85" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-15" target="E0nTntA1szs-sMbRV9SV-84" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-15" value="NacosDiscoveryClient&lt;br&gt;AutoConfiguration" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="230" y="940" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;fontSize=10;curved=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-17" target="E0nTntA1szs-sMbRV9SV-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-91" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#3399FF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-17" target="E0nTntA1szs-sMbRV9SV-90" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-17" value="RibbonNacosAutoConfiguration" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="230" y="1160" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-26" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=6;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-23" target="E0nTntA1szs-sMbRV9SV-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-55" style="edgeStyle=entityRelationEdgeStyle;shape=link;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#FF0080;strokeColor=#82b366;fillColor=#d5e8d4;width=-4;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-23" target="E0nTntA1szs-sMbRV9SV-51" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-23" value="NacosRegistration&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;init()获取部分环境变量存入元数据的Map&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="470" y="240" width="106" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-28" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=6;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-25" target="E0nTntA1szs-sMbRV9SV-27" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-54" style="edgeStyle=entityRelationEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#FF0080;shape=link;strokeColor=#82b366;fillColor=#d5e8d4;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-25" target="E0nTntA1szs-sMbRV9SV-51" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-25" value="NacosServiceRegistry&lt;br&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;实现了ServiceRegistry接口&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="470" y="300" width="106" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-35" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-27" target="E0nTntA1szs-sMbRV9SV-34" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-27" value="NacosAutoServiceRegistration&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;font style=&quot;font-size: 8px&quot;&gt;包含前面两个Bean的引用（依赖注入）&lt;/font&gt;&lt;br&gt;&lt;span style=&quot;font-size: 8px&quot;&gt;继承AbstractAutoServiceRegistration&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 8px&quot;&gt;又间接实现了ApplicationListener，监听WebServerInitializedEvent事件&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="447.75" y="360" width="150.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-36" value="事件发布" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=8;fontColor=#3399FF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-29" edge="1">
          <mxGeometry x="0.3688" relative="1" as="geometry">
            <mxPoint x="640" y="390" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-29" value="publishEvent(new &lt;b&gt;ServletWebServerInitializedEvent&lt;/b&gt;&lt;br&gt;(webServer, this))&lt;br&gt;&lt;font color=&quot;#3399ff&quot; style=&quot;font-size: 8px&quot;&gt;Web服务器（比如Tomcat）启动后发布事件&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="620" y="280" width="161.75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-32" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=8;fontColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-31" target="E0nTntA1szs-sMbRV9SV-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-31" value="WebServer启动后" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="640.88" y="220" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-38" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-34" target="E0nTntA1szs-sMbRV9SV-37" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-34" value="onApplicationEvent(&lt;br&gt;WebServerInitializedEvent event)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="680" y="370" width="145.25" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-40" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-37" target="E0nTntA1szs-sMbRV9SV-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-37" value="this.bind(event);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="847" y="370" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-42" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-39" target="E0nTntA1szs-sMbRV9SV-41" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1080" y="390" />
              <mxPoint x="1080" y="440" />
              <mxPoint x="460" y="440" />
              <mxPoint x="460" y="480" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-39" value="this.start();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="970" y="370" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-44" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-41" target="E0nTntA1szs-sMbRV9SV-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-41" value="this.context.publishEvent(new InstancePreRegisteredEvent(this, this.getRegistration()))" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="473" y="460" width="167" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-46" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-43" target="E0nTntA1szs-sMbRV9SV-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-52" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#FF0080;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-43" target="E0nTntA1szs-sMbRV9SV-51" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-43" value="this.register()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="473" y="540" width="167" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-50" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-45" target="E0nTntA1szs-sMbRV9SV-49" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-45" value="&amp;nbsp;this.context.publishEvent(new InstanceRegisteredEvent(this, this.getConfiguration()));" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="473" y="620" width="167" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-49" value="this.&lt;b&gt;running&lt;/b&gt;.compareAndSet(false, true)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;running记录Nacso客户端状态，以及防止重复启动&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="473" y="700" width="167" height="60" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-59" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;curved=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-51" target="E0nTntA1szs-sMbRV9SV-61" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="880" y="560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-51" value="this.&lt;b&gt;serviceRegistry&lt;/b&gt;&lt;br&gt;.register(this.&lt;b&gt;getRegistration&lt;/b&gt;());&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;进入到NacosServiceRegistry类执行register()方法&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="680" y="535" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-64" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-60" target="E0nTntA1szs-sMbRV9SV-62" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-60" value="Instance instance = this.getNacosInstanceFromRegistration(&lt;br style=&quot;font-size: 9px&quot;&gt;registration)&lt;br&gt;&lt;font color=&quot;#3399ff&quot;&gt;实例化Instance，并初始化IP、Port、权重、集群名、元数据 等信息&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="865" y="610" width="170" height="50" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-63" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-61" target="E0nTntA1szs-sMbRV9SV-60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-61" value="String serviceId = registration.getServiceId();&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;即“spring.application.name”的值&lt;/font&gt;&lt;br&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;具体看NacosDiscoveryProperties.class&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="870" y="533.75" width="160" height="52.5" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-69" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#3399FF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-62" target="E0nTntA1szs-sMbRV9SV-68" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-62" value="this.namingService&lt;br&gt;.registerInstance(serviceId, instance);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="870" y="690" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-65" value="NacosDiscoveryProperties解析自&lt;br&gt;”spring.cloud.nacos.discovery“" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1030" y="545" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-66" value="NacosServiceRegistry.class" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#3399FF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="695" y="515" width="130" height="20" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-67" value="AbstractAutoServiceRegistration.class" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#3399FF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="677.63" y="350" width="150" height="20" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-75" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#3399FF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-68" target="E0nTntA1szs-sMbRV9SV-73" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-68" value="this.registerInstance(serviceName, &quot;DEFAULT_GROUP&quot;, instance);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1070" y="690" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-70" value="NacosNamingService.class" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#3399FF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1095" y="670" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-77" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#3399FF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-73" target="E0nTntA1szs-sMbRV9SV-76" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-79" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#3399FF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-73" target="E0nTntA1szs-sMbRV9SV-78" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-73" value="beatReactor.addBeatInfo(&lt;br&gt;groupedServiceName, beatInfo);&lt;br&gt;&lt;font color=&quot;#3399ff&quot;&gt;提交定时任务每隔5s发送一次心跳&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="750" y="780" width="170" height="50" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-81" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#3399FF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-76" target="E0nTntA1szs-sMbRV9SV-80" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-76" value="serverProxy.registerService(&lt;br&gt;groupedServiceName, groupName, instance);&lt;br&gt;&lt;font color=&quot;#3399ff&quot;&gt;服务注册请求&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="730" y="860" width="210" height="50" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-82" value="HTTP请求（心跳）" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.038;entryY=0.545;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=8;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-78" target="E0nTntA1szs-sMbRV9SV-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-78" value="serverProxy.sendBeat(beatInfo, BeatReactor.this.lightBeatEnabled)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;serverProxy是Http客户端&lt;br&gt;PUT&amp;nbsp;&lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 127 , 255)&quot;&gt;/nacos/v1/ns/instance&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;/instance/beat&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="980" y="780" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-83" value="HTTP请求&lt;br&gt;（服务注册）" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#000000;entryX=0.005;entryY=0.62;entryDx=0;entryDy=0;entryPerimeter=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-80" target="E0nTntA1szs-sMbRV9SV-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1300" y="886" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-80" value="this.reqAPI(UtilAndComs.NACOS_URL_INSTANCE, params, (String)&quot;POST&quot;);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;POST /nacos/v1/ns/instance&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="980" y="860" width="240" height="50" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-87" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#3399FF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-84" target="E0nTntA1szs-sMbRV9SV-86" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-84" value="NacosDiscoveryProperties&lt;br&gt;&lt;font color=&quot;#3399ff&quot;&gt;即前面用到的配置属性&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="443" y="940" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-89" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#3399FF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-86" target="E0nTntA1szs-sMbRV9SV-88" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-86" value="NacosDiscoveryClient&lt;br&gt;&lt;font color=&quot;#3399ff&quot;&gt;依赖注入NacosDiscoveryProperties,继承DiscoveryClient，通过HTTP请求查看服务列表和实例列表&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="445" y="1000" width="157" height="60" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-88" value="NacosWatch&lt;br&gt;&lt;font style=&quot;font-size: 9px&quot; color=&quot;#3399ff&quot;&gt;这个应该是监控，需要开启spring.cloud.nacos.discovery.watch.enabled&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="435" y="1080" width="177" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-93" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#3399FF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-90" target="E0nTntA1szs-sMbRV9SV-92" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-90" value="@RibbonClients(defaultConfiguration = &lt;b&gt;NacosRibbonClientConfiguration&lt;/b&gt;.class)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="429.5" y="1160" width="187" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-95" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#3399FF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="E0nTntA1szs-sMbRV9SV-92" target="E0nTntA1szs-sMbRV9SV-94" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-92" value="NacosServerList" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="660" y="1160" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-94" value="NacosServerIntrospector" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="660" y="1220" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-96" value="spring-cloud-alibaba-nacos-discovery-2.1.0.RELEASE.jar" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=12;fontColor=#3399FF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="160" y="170" width="320" height="20" as="geometry" />
        </mxCell>
        <mxCell id="E0nTntA1szs-sMbRV9SV-97" value="nacos-1.4.1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=12;fontColor=#3399FF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1380" y="160" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-3" value="&lt;b&gt;POST&lt;/b&gt;" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vd_qBJxyYYtXZSKp8f6n-0" target="vd_qBJxyYYtXZSKp8f6n-2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1590" y="260" />
              <mxPoint x="1590" y="260" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-242" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=8;fontColor=#000000;strokeColor=#000000;elbow=vertical;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontStyle=1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vd_qBJxyYYtXZSKp8f6n-0" target="cKh2JxnRFl6GvmQpNupA-243" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1580" y="150" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-245" value="&lt;b&gt;DELETE&lt;/b&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=8;fontColor=#000000;" parent="cKh2JxnRFl6GvmQpNupA-242" vertex="1" connectable="0">
          <mxGeometry x="0.3397" y="-1" relative="1" as="geometry">
            <mxPoint y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-0" value="/nacos/v1/ns&lt;br&gt;/instance" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1478" y="240" width="82" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-12" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vd_qBJxyYYtXZSKp8f6n-2" target="vd_qBJxyYYtXZSKp8f6n-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-2" value="register(HttpServletRequest request)&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;解析请求参数获取命名空间ID、服务名、服务实例&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1618" y="235" width="140" height="50" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-9" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vd_qBJxyYYtXZSKp8f6n-4" target="vd_qBJxyYYtXZSKp8f6n-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1978" y="345" />
              <mxPoint x="1978" y="260" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-4" value="serviceManager.&lt;b&gt;registerInstance&lt;/b&gt;(&lt;br&gt;namespaceId, serviceName, instance)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;注册服务实例&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1798" y="320" width="162" height="50" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-6" value="Instance 数据结构" style="swimlane;fontSize=10;fontColor=#007FFF;startSize=20;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-1798" y="240.5" width="360" height="260" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-7" value="&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;lastBeat = 1654644820891 &lt;/font&gt;//收到的最后一次新跳时间&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;mockValid = false&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;marked = false&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;tenant = null&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;app = &quot;DEFAULT&quot;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;instanceId = &quot;192.168.2.169#9002#nj#DEFAULT_GROUP@@stock-service&quot;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;ip = &quot;192.168.2.169&quot;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;port = 9002&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;weight = 1.0&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;healthy = true&lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 0 , 0) ; white-space: pre&quot;&gt;&#x9;&lt;/span&gt;//实例健康状态，心跳超时15s后设为false&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;enabled = true&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;ephemeral = true&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;clusterName = &quot;nj&quot;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;serviceName = &quot;DEFAULT_GROUP@@stock-service&quot;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;metadata = {LinkedHashMap@12246}&amp;nbsp; size = 2&lt;/font&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=10;fontColor=#007FFF;align=left;" parent="vd_qBJxyYYtXZSKp8f6n-6" vertex="1">
          <mxGeometry y="20" width="360" height="240" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-16" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vd_qBJxyYYtXZSKp8f6n-8" target="vd_qBJxyYYtXZSKp8f6n-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-20" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vd_qBJxyYYtXZSKp8f6n-8" target="vd_qBJxyYYtXZSKp8f6n-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-8" value="createEmptyService(namespaceId, serviceName, instance.isEphemeral())&lt;br&gt;&lt;font color=&quot;#3399ff&quot; style=&quot;font-size: 8px&quot;&gt;服务不存在就创建空Service并存入注册表&lt;br&gt;启动心跳检查计划任务&lt;br&gt;注册服务节点变更监听&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1998" y="225.5" width="162" height="70" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-14" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vd_qBJxyYYtXZSKp8f6n-10" target="vd_qBJxyYYtXZSKp8f6n-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-10" value="instance = parseInstance(request)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1800" y="240" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-18" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vd_qBJxyYYtXZSKp8f6n-15" target="vd_qBJxyYYtXZSKp8f6n-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-15" value="getService(namespaceId, serviceName);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1998" y="1340" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-109" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vd_qBJxyYYtXZSKp8f6n-17" target="cKh2JxnRFl6GvmQpNupA-108" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-17" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;addInstance&lt;/b&gt;(namespaceId, serviceName, instance.isEphemeral(), instance)&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;前面是创建空服务，这里添加服务实例&lt;br&gt;通过一致性协议同步给其他节点&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1996" y="1420" width="162" height="80" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-22" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vd_qBJxyYYtXZSKp8f6n-19" target="vd_qBJxyYYtXZSKp8f6n-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-19" value="createServiceIfAbsent(namespaceId, serviceName, local, null)&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;font style=&quot;font-size: 8px&quot;&gt;从ServiceManager的serviceMap获取命名空间为namespaceId、服务名为serviceName的服务，没有就创建，已经存在就略过&lt;/font&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2198" y="230.5" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-24" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vd_qBJxyYYtXZSKp8f6n-21" target="vd_qBJxyYYtXZSKp8f6n-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vd_qBJxyYYtXZSKp8f6n-21" target="cKh2JxnRFl6GvmQpNupA-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-21" value="getService(namespaceId, serviceName)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2419" y="240.5" width="119" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-23" value="Map&amp;lt;String, Map&amp;lt;String, Service&amp;gt;&amp;gt; &lt;b&gt;serviceMap&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;注解表结构&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2578" y="240.5" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-28" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vd_qBJxyYYtXZSKp8f6n-25" target="vd_qBJxyYYtXZSKp8f6n-27" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2568" y="381" />
              <mxPoint x="2568" y="321" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;fontColor=#007FFF;curved=1;fillColor=#d5e8d4;strokeColor=#82b366;dashed=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vd_qBJxyYYtXZSKp8f6n-25" target="cKh2JxnRFl6GvmQpNupA-179" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2590" y="410" />
              <mxPoint x="2590" y="1483" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-25" value="new Service()&lt;br&gt;putServiceAndInit(service)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;只是建了个空Service实例，直到后面updateIPs() 才完整&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#e3c800;strokeColor=#B09500;fontColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2400" y="360.5" width="160" height="49.5" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-30" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vd_qBJxyYYtXZSKp8f6n-27" target="vd_qBJxyYYtXZSKp8f6n-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-32" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vd_qBJxyYYtXZSKp8f6n-27" target="vd_qBJxyYYtXZSKp8f6n-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-27" value="putService(service)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2588.5" y="300.5" width="119" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-34" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vd_qBJxyYYtXZSKp8f6n-29" target="vd_qBJxyYYtXZSKp8f6n-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Sf5YBq0qI29CyhUMobhk-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#000000;curved=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vd_qBJxyYYtXZSKp8f6n-29" target="Sf5YBq0qI29CyhUMobhk-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2648" y="430" />
              <mxPoint x="2318" y="430" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-29" value="service.init()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2588.5" y="360.5" width="119" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-31" value="serviceMap.get(service.getNamespaceId())&lt;br&gt;.&lt;b&gt;put&lt;/b&gt;(service.getName(), service)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2758" y="300.5" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-36" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vd_qBJxyYYtXZSKp8f6n-33" target="vd_qBJxyYYtXZSKp8f6n-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-33" value="&lt;b&gt;HealthCheckReactor&lt;/b&gt;&lt;br&gt;.scheduleCheck(&lt;b&gt;clientBeatCheckTask&lt;/b&gt;)&lt;br&gt;&lt;font color=&quot;#3399ff&quot;&gt;使用GlobalExecutor定时执行心跳检查任务，GlobalExecutor创建了一批线程池&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2758" y="355.5" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="vd_qBJxyYYtXZSKp8f6n-35" value="GlobalExecutor.scheduleNamingHealth(task, 5000, 5000, TimeUnit.MILLISECONDS)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;使用NAMING_HEALTH_EXECUTOR线程池执行&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2998" y="355.5" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-201" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Sf5YBq0qI29CyhUMobhk-0" target="cKh2JxnRFl6GvmQpNupA-200" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3200" y="240" />
              <mxPoint x="3200" y="120" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Sf5YBq0qI29CyhUMobhk-0" value="&lt;b&gt;ClientBeatCheckTask&lt;/b&gt;$run()&lt;br&gt;&lt;font style=&quot;font-size: 9px&quot; color=&quot;#007fff&quot;&gt;每个Service有一个心跳检查定时任务，5s一次，遍历检查此服务所有实例的心跳状态&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3028" y="220" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-11" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Sf5YBq0qI29CyhUMobhk-1" target="cKh2JxnRFl6GvmQpNupA-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-14" value="" style="edgeStyle=entityRelationEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=none;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Sf5YBq0qI29CyhUMobhk-1" target="cKh2JxnRFl6GvmQpNupA-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;curved=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="Sf5YBq0qI29CyhUMobhk-1" target="cKh2JxnRFl6GvmQpNupA-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Sf5YBq0qI29CyhUMobhk-1" value="&lt;div style=&quot;font-size: 9px&quot;&gt;&lt;b&gt;consistencyService&lt;/b&gt;&lt;span style=&quot;font-size: 9px&quot;&gt;&lt;b&gt;.listen&lt;/b&gt;(&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px&quot;&gt;KeyBuilder.buildInstanceListKey(service.getNamespaceId(), service.getName(), &lt;b&gt;true&lt;/b&gt;), service)&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2198" y="460" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-0" value="ServiceManager.class" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1813" y="300" width="130" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-1" value="ServiceManager　@Component" style="swimlane;fontSize=10;fontColor=#007FFF;startSize=20;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-1362" y="240.5" width="440" height="320" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-2" value="&lt;div&gt;&lt;div&gt;// Service容器：&lt;span&gt;Map(namespace, Map(group::serviceName, Service))&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private final Map&amp;lt;String, Map&amp;lt;String, &lt;b&gt;Service&lt;/b&gt;&amp;gt;&amp;gt; &lt;b&gt;serviceMap&lt;/b&gt; = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private final LinkedBlockingDeque&amp;lt;ServiceKey&amp;gt; &lt;b&gt;toBeUpdatedServicesQueue&lt;/b&gt; = new LinkedBlockingDeque&amp;lt;&amp;gt;(1024 * 1024);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private final Synchronizer synchronizer = new ServiceStatusSynchronizer();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private final Lock lock = new ReentrantLock();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;@Resource(name = &quot;consistencyDelegate&quot;)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private ConsistencyService &lt;b&gt;consistencyService&lt;/b&gt;;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private final SwitchDomain &lt;b&gt;switchDomain&lt;/b&gt;;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private final DistroMapper &lt;b&gt;distroMapper&lt;/b&gt;;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private final ServerMemberManager &lt;b&gt;memberManager&lt;/b&gt;;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private final PushService &lt;b&gt;pushService&lt;/b&gt;;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private final RaftPeerSet &lt;b&gt;raftPeerSet&lt;/b&gt;;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private int maxFinalizeCount = 3;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private final Object putServiceLock = new Object();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;@Value(&quot;${nacos.naming.empty-service.auto-clean:false}&quot;)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private boolean emptyServiceAutoClean;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;@Value(&quot;${nacos.naming.empty-service.clean.initial-delay-ms:60000}&quot;)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private int cleanEmptyServiceDelay;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;@Value(&quot;${nacos.naming.empty-service.clean.period-time-ms:20000}&quot;)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private int cleanEmptyServicePeriod;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=10;fontColor=#007FFF;align=left;" parent="cKh2JxnRFl6GvmQpNupA-1" vertex="1">
          <mxGeometry y="20" width="440" height="300" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-5" value="Y" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontColor=#007FFF;fontSize=8;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-3" target="vd_qBJxyYYtXZSKp8f6n-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-6" value="N" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;curved=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-3" target="vd_qBJxyYYtXZSKp8f6n-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-3" value="service == null" style="rhombus;whiteSpace=wrap;html=1;fontColor=#007FFF;rounded=1;arcSize=9;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2428.5" y="298" width="100" height="45" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-7" value="Service 数据结构" style="swimlane;fontSize=10;fontColor=#007FFF;startSize=20;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-882" y="240.5" width="400" height="230" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-8" value="&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private ClientBeatCheckTask &lt;b&gt;clientBeatCheckTask&lt;/b&gt; = new ClientBeatCheckTask(this);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private int finalizeCount = 0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private String token;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private List&amp;lt;String&amp;gt; owners = new ArrayList&amp;lt;&amp;gt;();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private Boolean resetWeight = false;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private Boolean enabled = true;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private Selector &lt;b&gt;selector&lt;/b&gt; = new NoneSelector();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private String namespaceId;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private long ipDeleteTimeout = 30 * 1000;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private volatile long lastModifiedMillis = 0L;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private volatile String checksum;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private long pushCacheMillis = 0L;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(0 , 0 , 0)&quot;&gt;private Map&amp;lt;String, &lt;/span&gt;&lt;b style=&quot;color: rgb(0 , 0 , 0)&quot;&gt;Cluster&lt;/b&gt;&lt;span style=&quot;color: rgb(0 , 0 , 0)&quot;&gt;&amp;gt; &lt;/span&gt;&lt;b style=&quot;color: rgb(0 , 0 , 0)&quot;&gt;clusterMap&lt;/b&gt;&lt;span style=&quot;color: rgb(0 , 0 , 0)&quot;&gt; = new HashMap&amp;lt;&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=10;fontColor=#007FFF;align=left;" parent="cKh2JxnRFl6GvmQpNupA-7" vertex="1">
          <mxGeometry y="20" width="400" height="210" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-16" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-10" target="cKh2JxnRFl6GvmQpNupA-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-10" value="&lt;div style=&quot;font-size: 9px&quot;&gt;&lt;b&gt;consistencyService&lt;/b&gt;&lt;span style=&quot;font-size: 9px&quot;&gt;&lt;b&gt;.listen&lt;/b&gt;(&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px&quot;&gt;KeyBuilder.buildInstanceListKey(service.getNamespaceId(), service.getName(), &lt;b&gt;false&lt;/b&gt;), service)&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2198" y="540" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-19" value="&lt;pre style=&quot;background-color: rgb(43 , 43 , 43)&quot;&gt;&lt;font face=&quot;jetbrains mono, monospace&quot;&gt;&lt;span style=&quot;font-size: 8.4pt&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-21" target="cKh2JxnRFl6GvmQpNupA-18" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2768" y="530" as="sourcePoint" />
            <mxPoint x="2919" y="520" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2798" y="520" />
              <mxPoint x="2798" y="580" />
              <mxPoint x="2978" y="580" />
              <mxPoint x="2978" y="460" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-20" value="com.alibaba.nacos.naming.iplist.ephemeral." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;fontColor=#3333FF;" parent="cKh2JxnRFl6GvmQpNupA-19" vertex="1" connectable="0">
          <mxGeometry x="0.113" y="2" relative="1" as="geometry">
            <mxPoint x="-54" y="-3" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-22" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#3333FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-13" target="cKh2JxnRFl6GvmQpNupA-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-13" value="&lt;div&gt;&lt;b&gt;DelegateConsistencyServiceImpl&lt;/b&gt;$&lt;br&gt;listen(String key, RecordListener listener)&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2478" y="500" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-35" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#3333FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-18" target="cKh2JxnRFl6GvmQpNupA-34" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-18" value="&lt;div&gt;&lt;b&gt;EphemeralConsistencyService&lt;/b&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2998" y="440" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-23" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#3333FF;strokeColor=#000000;elbow=vertical;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-21" target="cKh2JxnRFl6GvmQpNupA-24" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2978" y="520" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2798" y="520" />
              <mxPoint x="2798" y="480" />
              <mxPoint x="2968" y="480" />
              <mxPoint x="2968" y="540" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-25" value="&lt;span style=&quot;color: rgba(0 , 0 , 0 , 0) ; font-family: monospace ; font-size: 0px ; background-color: rgb(248 , 249 , 250)&quot;&gt;%3CmxGraphModel%3E%3Croot%3E%3CmxCell%20id%3D%220%22%2F%3E%3CmxCell%20id%3D%221%22%20parent%3D%220%22%2F%3E%3CmxCell%20id%3D%222%22%20value%3D%22%26lt%3Bdiv%26gt%3B%26lt%3Bb%26gt%3BDelegateConsistencyServiceImpl%26lt%3B%2Fb%26gt%3B%24%26lt%3Bbr%26gt%3Blisten(String%20key%2C%20RecordListener%20listener)%26lt%3Bbr%26gt%3B%26lt%3B%2Fdiv%26gt%3B%22%20style%3D%22rounded%3D1%3BwhiteSpace%3Dwrap%3Bhtml%3D1%3BfontSize%3D9%3Balign%3Dcenter%3B%22%20vertex%3D%221%22%20parent%3D%221%22%3E%3CmxGeometry%20x%3D%222870%22%20y%3D%22450%22%20width%3D%22180%22%20height%3D%2240%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3C%2Froot%3E%3C%2FmxGraphModel%3&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#3333FF;" parent="cKh2JxnRFl6GvmQpNupA-23" vertex="1" connectable="0">
          <mxGeometry x="0.1972" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-26" value="com.alibaba.nacos.naming.domains.meta." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;fontColor=#3333FF;" parent="cKh2JxnRFl6GvmQpNupA-23" vertex="1" connectable="0">
          <mxGeometry x="0.1483" y="-2" relative="1" as="geometry">
            <mxPoint x="-24" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-27" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#3333FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-21" target="cKh2JxnRFl6GvmQpNupA-18" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2788" y="520" />
              <mxPoint x="2788" y="460" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-28" value="com.alibaba.nacos.naming.domains.meta." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;fontColor=#3333FF;" parent="cKh2JxnRFl6GvmQpNupA-27" vertex="1" connectable="0">
          <mxGeometry x="0.0794" y="-2" relative="1" as="geometry">
            <mxPoint x="18" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-29" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#3333FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-21" target="cKh2JxnRFl6GvmQpNupA-24" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2778" y="520" />
              <mxPoint x="2778" y="600" />
              <mxPoint x="2978" y="600" />
              <mxPoint x="2978" y="540" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-30" value="else" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;fontColor=#3333FF;" parent="cKh2JxnRFl6GvmQpNupA-29" vertex="1" connectable="0">
          <mxGeometry x="0.1016" y="-4" relative="1" as="geometry">
            <mxPoint x="-9" y="-4" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-21" value="key" style="rhombus;whiteSpace=wrap;html=1;fontSize=9;rounded=1;arcSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2678" y="500" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-97" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=6;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-24" target="cKh2JxnRFl6GvmQpNupA-96" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-24" value="&lt;div&gt;&lt;b&gt;PersistentConsistencyServiceDelegateImpl&lt;/b&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2998" y="520" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-33" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#3333FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-31" target="vd_qBJxyYYtXZSKp8f6n-0" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-113" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-31" target="tu7KC7_A9Dg24m53ykQn-110" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-121" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-31" target="tu7KC7_A9Dg24m53ykQn-120" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-31" value="&lt;b&gt;naming&lt;br&gt;模块&lt;br&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1380" y="240.5" width="60" height="39.5" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-40" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#3333FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-34" target="cKh2JxnRFl6GvmQpNupA-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-34" value="&lt;div&gt;&lt;b&gt;ephemeralConsistencyService.listen(key, listener)&lt;br&gt;&lt;/b&gt;实现类：&lt;b&gt;DistroConsistencyServiceImpl&lt;/b&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3240" y="440" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-39" value="&lt;div&gt;&lt;span style=&quot;font-weight: normal&quot;&gt;listeners.get(key).add(listener);&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fontStyle=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3480" y="440" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-41" value="观察者模式，注册事件监听器，&lt;br&gt;Service本身是个事件监听器，&lt;br&gt;监听一致性协议事件" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#3333FF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3260" y="405" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-51" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;dashed=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-42" target="cKh2JxnRFl6GvmQpNupA-50" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2438" y="840" as="sourcePoint" />
            <mxPoint x="2479" y="840" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2470" y="640" />
              <mxPoint x="2470" y="640" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-42" value="&lt;b&gt;DistroConsistencyServiceImpl&lt;/b&gt;$&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;临时节点一致性实现 @Service Bean&lt;br&gt;看有onXxx方法，估计本身也监听事件，所以这个类估计就是个事件中转&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2258" y="620" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-43" value="一致性协议事件中转分发" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#3333FF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2293" y="600" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-46" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-44" target="cKh2JxnRFl6GvmQpNupA-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-48" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-44" target="cKh2JxnRFl6GvmQpNupA-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-44" value="&lt;div&gt;&lt;b&gt;Service 事件处理&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;b&gt;实现RecordListener&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#e3c800;strokeColor=#B09500;fontColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2258" y="1030" width="122" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-174" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=7;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-45" target="cKh2JxnRFl6GvmQpNupA-173" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-45" value="&lt;b&gt;onChange(String key, &lt;/b&gt;&lt;br&gt;&lt;b&gt;T value)&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;实例添加、修改&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2420" y="1000" width="122" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-47" value="&lt;b&gt;onDelete(String key)&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;实例删除&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2420" y="1060" width="122" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-49" value="服务变更同步事件处理" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2264" y="1005" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-53" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-50" target="cKh2JxnRFl6GvmQpNupA-52" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2600" y="840" as="sourcePoint" />
            <mxPoint x="2660" y="840" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-54" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-50" target="cKh2JxnRFl6GvmQpNupA-55" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2640" y="900" as="targetPoint" />
            <mxPoint x="2600" y="840" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-60" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-50" target="cKh2JxnRFl6GvmQpNupA-56" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2600" y="840" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-50" value="@PostConstruct &lt;b&gt;init()&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;Distro一致性服务初始化&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2479" y="620" width="121" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-52" value="向DISTRO_NOTIFY_EXECUTOR线程池提交了Notifier任务" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2660" y="620" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-62" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#3399FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-55" target="cKh2JxnRFl6GvmQpNupA-61" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2840" y="840" />
              <mxPoint x="2840" y="765" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-55" value="&lt;b&gt;Notifier&lt;/b&gt;$run()&lt;br&gt;监听&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;异步处理&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2660" y="820" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-171" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-56" target="cKh2JxnRFl6GvmQpNupA-170" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-56" value="&lt;b&gt;Notifier&lt;/b&gt;$addTask(String datumKey, DataOperation action)&lt;br&gt;&lt;font color=&quot;#3399ff&quot;&gt;发布事件者必调用这个添加数据同步任务&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2660" y="695" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-64" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#3399FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-61" target="cKh2JxnRFl6GvmQpNupA-63" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-61" value="&lt;span style=&quot;font-weight: normal&quot;&gt;for(;;) start&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fontStyle=1" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2878" y="760" width="142" height="10" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-66" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#3399FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-63" target="cKh2JxnRFl6GvmQpNupA-65" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-63" value="Pair&amp;lt;String, DataOperation&amp;gt; pair = tasks.take()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;阻塞等待获取任务&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=9;rounded=1;fontStyle=0;fillColor=#fff2cc;strokeColor=#d6b656;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2878" y="790" width="142" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-68" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#3399FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-65" target="cKh2JxnRFl6GvmQpNupA-67" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-75" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-65" target="cKh2JxnRFl6GvmQpNupA-74" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3050" y="870" />
              <mxPoint x="3050" y="780" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-65" value="handle(pair)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;任务处理&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=9;rounded=1;fontStyle=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2878" y="850" width="142" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-71" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;fontSize=9;fontColor=#3399FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-67" target="cKh2JxnRFl6GvmQpNupA-55" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-67" value="&lt;span style=&quot;font-weight: normal&quot;&gt;for(;;) end&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fontStyle=1" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2878" y="920" width="142" height="10" as="geometry" />
        </mxCell>
        <mxCell id="CK4975RrXwExiHhc40Je-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;curved=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-72" target="CK4975RrXwExiHhc40Je-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-72" value="DistroConsistencyServiceImpl 数据结构" style="swimlane;fontSize=10;fontColor=#007FFF;startSize=20;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-1362" y="600.5" width="360" height="280" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-73" value="&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private final DistroMapper distroMapper;&lt;/font&gt;&lt;/div&gt;//封装了Map&amp;lt;String, Datum&amp;gt;, Datum是包含key,value（Record作为上边界类型）的结构，Instance就实现了Record接口，可以理解为就是key-&amp;gt;Instance的Map&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private final DataStore &lt;b&gt;dataStore&lt;/b&gt;;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private final Serializer serializer;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private final SwitchDomain switchDomain;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private final GlobalConfig globalConfig;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;//&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private final DistroProtocol &lt;b&gt;distroProtocol&lt;/b&gt;;&lt;/font&gt;&lt;br&gt;//执行一致性任务事件分发的异步任务&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private volatile &lt;b&gt;Notifier&lt;/b&gt; &lt;b&gt;notifier&lt;/b&gt; = new Notifier();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;//即服务名-&amp;gt;服务实例的列表（都是临时服务类型）&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private Map&amp;lt;String, ConcurrentLinkedQueue&amp;lt;RecordListener&amp;gt;&amp;gt; listeners = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private Map&amp;lt;String, String&amp;gt; syncChecksumTasks = new ConcurrentHashMap&amp;lt;&amp;gt;(16);&lt;/font&gt;&lt;br&gt;&lt;br&gt;&lt;b&gt;Notifier 数据结构&lt;/b&gt;&lt;br&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private ConcurrentHashMap&amp;lt;String, String&amp;gt; &lt;b&gt;services&lt;/b&gt; = new ConcurrentHashMap&amp;lt;&amp;gt;(10 * 1024);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private BlockingQueue&amp;lt;Pair&amp;lt;String, DataOperation&amp;gt;&amp;gt; &lt;b&gt;tasks&lt;/b&gt; = new ArrayBlockingQueue&amp;lt;&amp;gt;(1024 * 1024);&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=10;fontColor=#007FFF;align=left;" parent="cKh2JxnRFl6GvmQpNupA-72" vertex="1">
          <mxGeometry y="20" width="360" height="260" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-90" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=6;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-74" target="cKh2JxnRFl6GvmQpNupA-76" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-74" value="services.remove(datumKey)" style="whiteSpace=wrap;html=1;fontSize=9;rounded=1;fontStyle=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3080" y="760" width="142" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-79" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-76" target="cKh2JxnRFl6GvmQpNupA-78" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-76" value="for (RecordListener listener : listeners.get(datumKey))" style="whiteSpace=wrap;html=1;fontSize=9;rounded=1;fontStyle=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3080" y="820" width="140" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-85" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-78" target="cKh2JxnRFl6GvmQpNupA-84" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-86" value="DataOperation.CHANGE" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=6;fontColor=#007FFF;" parent="cKh2JxnRFl6GvmQpNupA-85" vertex="1" connectable="0">
          <mxGeometry x="0.2599" y="-1" relative="1" as="geometry">
            <mxPoint x="-19" y="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-88" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=6;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-78" target="cKh2JxnRFl6GvmQpNupA-87" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-89" value="DataOperation.DELETE" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=6;fontColor=#007FFF;" parent="cKh2JxnRFl6GvmQpNupA-88" vertex="1" connectable="0">
          <mxGeometry x="0.385" relative="1" as="geometry">
            <mxPoint x="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-78" value="action" style="rhombus;whiteSpace=wrap;html=1;fontSize=9;rounded=1;fontStyle=0;arcSize=5;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3110" y="860" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-94" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=6;fontColor=#007FFF;strokeColor=#007FFF;elbow=vertical;dashed=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-84" target="cKh2JxnRFl6GvmQpNupA-45" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3460" y="880" />
              <mxPoint x="3460" y="910" />
              <mxPoint x="2481" y="910" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-84" value="listener.onChange(datumKey, &lt;b&gt;dataStore&lt;/b&gt;.get(datumKey).value)" style="whiteSpace=wrap;html=1;fontSize=9;rounded=1;fontStyle=0;arcSize=5;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3300" y="860" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-87" value="listener.onDelete(datumKey)" style="whiteSpace=wrap;html=1;fontSize=9;rounded=1;fontStyle=0;arcSize=5;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3300" y="920" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-92" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;fontSize=6;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-91" target="cKh2JxnRFl6GvmQpNupA-65" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-91" value="for end" style="whiteSpace=wrap;html=1;fontSize=9;rounded=1;fontStyle=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3080" y="960" width="140" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-99" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=6;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-96" target="cKh2JxnRFl6GvmQpNupA-98" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-102" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=6;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-96" target="cKh2JxnRFl6GvmQpNupA-101" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-96" value="&lt;b&gt;oldPersistentConsistencyService.listen(key, listener)&lt;br&gt;&lt;/b&gt;实现类：&lt;b&gt;RaftConsistencyServiceImpl&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3240" y="520" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-104" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=6;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-98" target="cKh2JxnRFl6GvmQpNupA-103" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-98" value="&lt;b&gt;newPersistentConsistencyService.listen(key, listener)&lt;br&gt;&lt;/b&gt;实现类：&lt;b&gt;StandalonePersistentServiceProcessor&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3240" y="580" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-101" value="&lt;span style=&quot;font-weight: normal&quot;&gt;raftCore.listen(key, listener)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fontStyle=1" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3480" y="520" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-103" value="&lt;div&gt;&lt;span style=&quot;font-weight: normal&quot;&gt;notifier.registerListener(key, listener);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-weight: normal&quot;&gt;if (startNotify) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-weight: normal&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;notifierDatumIfAbsent(key, listener);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-weight: normal&quot;&gt;&amp;nbsp;}&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;fontStyle=1" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3480" y="575" width="180" height="50" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-105" value="&lt;b&gt;RaftConsistencyServiceImpl&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2258" y="1140" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-106" value="&lt;b&gt;StandalonePersistentServiceProcessor&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2258" y="1200" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-107" value="前面为该服务分别创建了临时和持久化key,对应的最后将该服务实例往这三个一致性服务都给注册了；&lt;br&gt;&lt;span style=&quot;color: rgb(255 , 0 , 128)&quot;&gt;默认就是临时节点为何&lt;/span&gt;&lt;font color=&quot;#ff0080&quot;&gt;要注册到三个一致性服务？？？只用DistroConsistencyServiceImpl不就行了？&lt;br&gt;为了兼容么？&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3700" y="440" width="280" height="90" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-111" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#3399FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-108" target="cKh2JxnRFl6GvmQpNupA-110" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-108" value="KeyBuilder.buildInstanceListKey(...)&lt;br&gt;&lt;font color=&quot;#3399ff&quot;&gt;获取Service Key, 比如：com.alibaba.nacos.naming.iplist.ephemeral.dev&lt;br&gt;##DEFAULT_GROUP@@stock-service&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2199" y="1400" width="222" height="60" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-113" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#3399FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-110" target="cKh2JxnRFl6GvmQpNupA-112" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-110" value="Service service = getService(namespaceId, serviceName)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2198" y="1480" width="222" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-124" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#3399FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-112" target="cKh2JxnRFl6GvmQpNupA-117" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-112" value="synchronized (service)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2197" y="1540" width="223" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-116" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;fontSize=10;fontColor=#3399FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-114" target="vd_qBJxyYYtXZSKp8f6n-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-114" value="synchronized end" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2198" y="1660" width="223" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-120" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#3399FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-117" target="cKh2JxnRFl6GvmQpNupA-119" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-180" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=7;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-117" target="cKh2JxnRFl6GvmQpNupA-179" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-117" value="instanceList = addIpAddresses(service, ephemeral, ips)" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2499" y="1480" width="159" height="45" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-123" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#3399FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-119" target="cKh2JxnRFl6GvmQpNupA-122" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-119" value="instances.setInstanceList(instanceList)" style="whiteSpace=wrap;html=1;fontSize=9;rounded=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2499" y="1640" width="159" height="45" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-125" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#3399FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-122" target="cKh2JxnRFl6GvmQpNupA-114" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-155" value="默认" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-122" target="cKh2JxnRFl6GvmQpNupA-154" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-122" value="consistencyService.put(key, instances)" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2499" y="1800" width="161" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-132" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#3399FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-129" target="cKh2JxnRFl6GvmQpNupA-131" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-136" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-129" target="cKh2JxnRFl6GvmQpNupA-135" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-129" value="&lt;div&gt;Datum datum = consistencyService&lt;br&gt;&lt;span&gt;.get(...)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;经过一步代理调用&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;font color=&quot;#007fff&quot;&gt;DistroConsistencyServiceImpl$get()方法&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2859" y="1400" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-134" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-131" target="cKh2JxnRFl6GvmQpNupA-133" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-131" value="&lt;div&gt;Datum datum = consistencyService&lt;br&gt;&lt;span&gt;.get(...)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;经过一步代理调用&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;font color=&quot;#007fff&quot;&gt;DistroConsistencyServiceImpl$get()方法&lt;br&gt;刚开始注册服务时这里获取为null&lt;br&gt;&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3099" y="1395" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-133" value="dataStore.get(key)" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3339" y="1405" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-138" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-135" target="cKh2JxnRFl6GvmQpNupA-137" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-135" value="for (Instance instance : ips)&amp;nbsp; start" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2859" y="1480" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-140" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-137" target="cKh2JxnRFl6GvmQpNupA-139" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-137" value="new Cluster(instance.getClusterName(), service)&lt;br&gt;&lt;font style=&quot;font-size: 9px&quot; color=&quot;#3399ff&quot;&gt;没有此集群信息就创建，这时内部数据还是空&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2859" y="1520" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-142" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-139" target="cKh2JxnRFl6GvmQpNupA-141" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-148" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#3399FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-139" target="cKh2JxnRFl6GvmQpNupA-147" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-139" value="cluster.init()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;集群初始化: 创建健康检查异步任务&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2859" y="1580" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-150" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-141" target="cKh2JxnRFl6GvmQpNupA-149" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-141" value="service.getClusterMap().put(&lt;br&gt;instance.getClusterName(), cluster)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;新集群加入Service的clusterMap&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2859" y="1640" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-143" value="Cluster 数据结构" style="swimlane;fontSize=10;fontColor=#007FFF;startSize=20;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-440" y="240.5" width="400" height="230" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-144" value="&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private String sitegroup = StringUtils.EMPTY;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private int defCkport = 80;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private int defIpPort = -1;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;//&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private HealthCheckTask &lt;b&gt;checkTask&lt;/b&gt;;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private Set&amp;lt;&lt;b&gt;Instance&lt;/b&gt;&amp;gt; &lt;b&gt;persistentInstances&lt;/b&gt; = new HashSet&amp;lt;&amp;gt;();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private Set&amp;lt;&lt;b&gt;Instance&lt;/b&gt;&amp;gt; &lt;b&gt;ephemeralInstances&lt;/b&gt; = new HashSet&amp;lt;&amp;gt;();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private &lt;b&gt;Service&lt;/b&gt; &lt;b&gt;service&lt;/b&gt;;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private volatile boolean inited = false;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private Map&amp;lt;String, String&amp;gt; &lt;b&gt;metadata&lt;/b&gt; = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/font&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=10;fontColor=#007FFF;align=left;" parent="cKh2JxnRFl6GvmQpNupA-143" vertex="1">
          <mxGeometry y="20" width="400" height="210" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-145" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;fontSize=9;fontColor=#3399FF;strokeColor=#000000;elbow=vertical;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-8" target="cKh2JxnRFl6GvmQpNupA-144" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-440" y="290.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-146" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;fontSize=9;fontColor=#3399FF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-2" target="cKh2JxnRFl6GvmQpNupA-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-147" value="&lt;div&gt;checkTask = new &lt;b&gt;HealthCheckTask&lt;/b&gt;(this);&lt;/div&gt;&lt;div&gt;HealthCheckReactor.&lt;b&gt;scheduleCheck&lt;/b&gt;(checkTask);&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3099" y="1580" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-152" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-149" target="cKh2JxnRFl6GvmQpNupA-151" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-149" value="instance.setInstanceId(...)&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;生成instanceId:&amp;nbsp;getIp() + &quot;#&quot; + getPort() + &quot;#&quot; + getClusterName() + &quot;#&quot; + getServiceName()&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2859" y="1700" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-183" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-151" target="cKh2JxnRFl6GvmQpNupA-179" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-151" value="for (Instance instance : ips)&amp;nbsp; end" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2859" y="1760" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-157" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-154" target="cKh2JxnRFl6GvmQpNupA-156" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-160" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-154" target="cKh2JxnRFl6GvmQpNupA-159" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-154" value="DistroConsistencyServiceImpl&lt;br&gt;&lt;b&gt;onPut&lt;/b&gt;(key, value)" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2720" y="1800" width="158" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-119" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-156" target="tu7KC7_A9Dg24m53ykQn-118" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-156" value="&lt;div style=&quot;font-size: 8px&quot;&gt;&lt;b&gt;distroProtocol.sync(&lt;/b&gt;new DistroKey(key, KeyBuilder.INSTANCE_LIST_KEY_PREFIX),&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;font-size: 8px&quot;&gt;DataOperation.CHANGE,&lt;/div&gt;&lt;div style=&quot;font-size: 8px&quot;&gt;globalConfig.getTaskDispatchPeriod() / 2)&lt;br&gt;&lt;font color=&quot;#3399ff&quot;&gt;&lt;b&gt;Nacos节点之间进行数据同步&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=8;rounded=1;fillColor=#e3c800;strokeColor=#B09500;align=left;fontColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2707.5" y="1920" width="182.5" height="50" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-158" value="DistroConsistencyServiceImpl.class" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2728" y="1780" width="140" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-162" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-159" target="cKh2JxnRFl6GvmQpNupA-161" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-159" value="datum = new Datum&amp;lt;&amp;gt;()&lt;br&gt;&lt;b&gt;dataStore&lt;/b&gt;.put(key, datum)" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2940" y="1800" width="158" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-161" value="notifier.addTask(key, DataOperation.CHANGE)" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2940" y="1860" width="158" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-163" value="Notifier是一个异步任务，&lt;br&gt;当有服务实例注册或注销时将对应事件&lt;br&gt;分发给监听器也就是各个Serivce异步处理&lt;br&gt;优点：&lt;br&gt;服务注册是服务启动阶段执行的，&lt;br&gt;异步可以降低启动时间" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2473" y="805" width="160" height="70" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-165" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.25;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;curved=1;entryX=1;entryY=0.792;entryDx=0;entryDy=0;entryPerimeter=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-73" target="vd_qBJxyYYtXZSKp8f6n-7" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-1440" y="440.5" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-1398" y="685.5" />
              <mxPoint x="-1398" y="450.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-172" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;dashed=1;fontSize=8;fontColor=#007FFF;strokeColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-170" target="cKh2JxnRFl6GvmQpNupA-63" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-170" value="tasks.offer(Pair.with(datumKey, action))&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 7px&quot;&gt;前面还有一步校验：如果队列该服务已经存在还未处理的事件，会直接忽略当前事件&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2878" y="690" width="142" height="50" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-176" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=7;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-173" target="cKh2JxnRFl6GvmQpNupA-175" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-178" value="for" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=7;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-173" target="cKh2JxnRFl6GvmQpNupA-177" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-173" value="&lt;b&gt;updateIPs&lt;/b&gt;(value.getInstanceList(), KeyBuilder.matchEphemeralInstanceListKey(key))" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2578" y="1000" width="202" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-175" value="recalculateChecksum()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2628" y="1060" width="102" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-192" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-177" target="cKh2JxnRFl6GvmQpNupA-191" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;elbow=vertical;curved=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-177" target="tu7KC7_A9Dg24m53ykQn-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-177" value="&lt;b&gt;updateIps&lt;/b&gt;(List&amp;lt;Instance&amp;gt; ips, boolean ephemeral)&lt;br&gt;&lt;font color=&quot;#3399ff&quot;&gt;&lt;b&gt;CopyOnWrite方式更新集群实例信息&lt;/b&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#e3c800;strokeColor=#B09500;fontColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2840" y="1000" width="202" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-181" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-179" target="cKh2JxnRFl6GvmQpNupA-129" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-179" value="&lt;b&gt;updateIPAddress&lt;/b&gt;(&lt;br&gt;Collection&amp;lt;Instance&amp;gt; instances, boolean ephemeral)" style="whiteSpace=wrap;html=1;fontSize=8;rounded=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2696" y="1482.5" width="122" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-184" value="Service.class" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2727" y="1462.5" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-187" value="Cluster.class" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2906" y="980" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-194" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-191" target="cKh2JxnRFl6GvmQpNupA-193" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-191" value="&lt;b&gt;getPushService().serviceChanged(this)&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2851" y="1080" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--1" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;ServiceChangeEvent&lt;br&gt;的事件监听器&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#007FFF;dashed=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-193" target="i3VVjqCiXnyBUYItkDT--0" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-193" value="this.applicationContext.&lt;b&gt;publishEvent&lt;/b&gt;(new &lt;b&gt;ServiceChangeEvent&lt;/b&gt;(this, service))&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;将数据变更主动推送到业务服务，更新其本地缓存的注册表&lt;/b&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#e3c800;strokeColor=#B09500;fontColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3078" y="1080" width="202" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-195" value="PushService.class" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3149" y="1040" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-199" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-196" target="E0nTntA1szs-sMbRV9SV-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-20" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-196" target="tu7KC7_A9Dg24m53ykQn-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-196" value="客户端通过Ribbon负载均衡调用另一服务，服务发现" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="50" y="1400" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-204" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-200" target="cKh2JxnRFl6GvmQpNupA-203" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-200" value="getDistroMapper()&lt;br&gt;.responsible(service.getName()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3221" y="100" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-207" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-203" target="cKh2JxnRFl6GvmQpNupA-206" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-203" value="getSwitchDomain()&lt;br&gt;.isHealthCheckEnabled()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3222" y="160" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-229" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-206" target="cKh2JxnRFl6GvmQpNupA-209" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-206" value="service.allIPs(true)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3222" y="220" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-211" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=7;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-209" target="cKh2JxnRFl6GvmQpNupA-210" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-209" value="&lt;font style=&quot;font-size: 7px&quot;&gt;for (Instance instance : instances)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3419" y="29" width="122" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-215" value="Y" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-210" target="cKh2JxnRFl6GvmQpNupA-238" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3578" y="99" />
              <mxPoint x="3578" y="39" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-217" value="N" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-210" target="cKh2JxnRFl6GvmQpNupA-216" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-210" value="&lt;font style=&quot;font-size: 8px;&quot;&gt;当实例心跳超时 &lt;br style=&quot;font-size: 8px;&quot;&gt;&amp;amp;&amp;amp; marked＝false &lt;br style=&quot;font-size: 8px;&quot;&gt;&amp;amp;&amp;amp; 未标记为不健康状态&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=8;rounded=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3420" y="69" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-232" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-214" target="cKh2JxnRFl6GvmQpNupA-231" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-236" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#000000;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-214" target="cKh2JxnRFl6GvmQpNupA-235" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-214" value="getPushService()&lt;br&gt;.serviceChanged(service)" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3618" y="79" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-221" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-216" target="cKh2JxnRFl6GvmQpNupA-219" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-216" value="for end" style="whiteSpace=wrap;html=1;fontSize=8;rounded=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3420" y="149" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-230" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-219" target="cKh2JxnRFl6GvmQpNupA-223" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-219" value="!getGlobalConfig().isExpireInstance()" style="whiteSpace=wrap;html=1;fontSize=8;rounded=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3410" y="189" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-222" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=7;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-223" target="cKh2JxnRFl6GvmQpNupA-226" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-223" value="&lt;font style=&quot;font-size: 7px&quot;&gt;for (Instance instance : instances)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3419" y="249" width="122" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-224" value="Y" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-226" target="cKh2JxnRFl6GvmQpNupA-227" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-225" value="N" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-226" target="cKh2JxnRFl6GvmQpNupA-228" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-226" value="&lt;font style=&quot;font-size: 8px&quot;&gt;当实例 marked＝false &lt;br&gt;&amp;amp;&amp;amp; 心跳超时越过删除阈值&lt;br&gt;默认30s&lt;br&gt;&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3420" y="289" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-241" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#000000;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-227" target="cKh2JxnRFl6GvmQpNupA-240" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-227" value="&amp;nbsp;deleteIp(instance)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;删除实例&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3578" y="299" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-244" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;fontSize=8;fontColor=#000000;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-228" target="Sf5YBq0qI29CyhUMobhk-0" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3200" y="391" />
              <mxPoint x="3200" y="265" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-228" value="for end" style="whiteSpace=wrap;html=1;fontSize=8;rounded=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3421" y="380.5" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-233" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-231" target="cKh2JxnRFl6GvmQpNupA-216" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-237" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#000000;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-231" target="cKh2JxnRFl6GvmQpNupA-235" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-231" value="ApplicationUtils.publishEvent(new &lt;b&gt;InstanceHeartbeatTimeoutEvent&lt;/b&gt;(&lt;br&gt;this, instance))" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3594" y="139" width="168" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-235" value="&lt;font color=&quot;#000000&quot; style=&quot;font-size: 10px&quot;&gt;applicationContext&lt;br&gt;.publishEvent(event)&lt;/font&gt;" style="whiteSpace=wrap;html=1;rounded=1;fontSize=10;fillColor=#e3c800;strokeColor=#B09500;fontColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3816" y="139" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-239" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#000000;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-238" target="cKh2JxnRFl6GvmQpNupA-214" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-238" value="instance.setHealthy(false)" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3618" y="19" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-240" value="HttpClient &lt;b&gt;DELETE&lt;/b&gt;请求自己的 /instance 接口" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3738" y="299" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-247" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#000000;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-243" target="cKh2JxnRFl6GvmQpNupA-246" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-243" value="deregister(HttpServletRequest request)&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;解析请求参数获取命名空间ID、服务名、服务实例&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1618" y="50" width="140" height="50" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-250" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#000000;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-246" target="cKh2JxnRFl6GvmQpNupA-249" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-246" value="service = serviceManager.getService(&lt;br&gt;namespaceId, serviceName)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1807" y="55" width="142" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-262" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#000000;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-249" target="cKh2JxnRFl6GvmQpNupA-251" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-249" value="serviceManager.removeInstance(&lt;br&gt;namespaceId, serviceName, instance.isEphemeral(), instance)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1798" y="120" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-254" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#000000;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-251" target="cKh2JxnRFl6GvmQpNupA-253" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-251" value="instanceList = substractIpAddresses(service, ephemeral, ips)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;去除实例&lt;span style=&quot;font-family: monospace ; font-size: 0px&quot;&gt;%3CmxGraphModel%3E%3Croot%3E%3CmxCell%20id%3D%220%22%2F%3E%3CmxCell%20id%3D%221%22%20parent%3D%220%22%2F%3E%3CmxCell%20id%3D%222%22%20value%3D%22%22%20style%3D%22edgeStyle%3DorthogonalEdgeStyle%3Bcurved%3D1%3Brounded%3D0%3BorthogonalLoop%3D1%3BjettySize%3Dauto%3Bhtml%3D1%3BfontSize%3D8%3BfontColor%3D%23007FFF%3BstrokeColor%3D%23000000%3Belbow%3Dvertical%3B%22%20edge%3D%221%22%20source%3D%223%22%20target%3D%224%22%20parent%3D%221%22%3E%3CmxGeometry%20relative%3D%221%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3CmxCell%20id%3D%223%22%20value%3D%22datum%20%3D%20new%20Datum%26amp%3Blt%3B%26amp%3Bgt%3B()%26lt%3Bbr%26gt%3BdataStore.put(key%2C%20datum)%22%20style%3D%22whiteSpace%3Dwrap%3Bhtml%3D1%3BfontSize%3D10%3Brounded%3D1%3BfillColor%3D%23ffe6cc%3BstrokeColor%3D%23d79b00%3B%22%20vertex%3D%221%22%20parent%3D%221%22%3E%3CmxGeometry%20x%3D%222920%22%20y%3D%221800%22%20width%3D%22158%22%20height%3D%2240%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3CmxCell%20id%3D%224%22%20value%3D%22notifier.addTask(key%2C%20DataOperation.CHANGE)%22%20style%3D%22whiteSpace%3Dwrap%3Bhtml%3D1%3BfontSize%3D10%3Brounded%3D1%3BfillColor%3D%23fff2cc%3BstrokeColor%3D%23d6b656%3B%22%20vertex%3D%221%22%20parent%3D%221%22%3E%3CmxGeometry%20x%3D%222920%22%20y%3D%221860%22%20width%3D%22158%22%20height%3D%2240%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3C%2Froot%3E%3C%2FmxGraphModel%3E&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2018" y="40" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-256" value="委托" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#000000;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-253" target="cKh2JxnRFl6GvmQpNupA-255" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2210" y="145" />
              <mxPoint x="2210" y="70" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-253" value="consistencyService.put(key, instances)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2018" y="120" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-258" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#000000;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-255" target="cKh2JxnRFl6GvmQpNupA-257" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-255" value="DistroConsistencyServiceImpl" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2240" y="50" width="142" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-261" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#000000;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-257" target="cKh2JxnRFl6GvmQpNupA-260" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-266" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#000000;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-257" target="cKh2JxnRFl6GvmQpNupA-264" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-257" value="onPut(key, value)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2438" y="50" width="142" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-260" value="&lt;div&gt;distroProtocol.sync(new DistroKey(key, KeyBuilder.INSTANCE_LIST_KEY_PREFIX),&amp;nbsp;&lt;/div&gt;&lt;div&gt;DataOperation.CHANGE,&lt;/div&gt;&lt;div&gt;globalConfig.getTaskDispatchPeriod() / 2)&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2405.25" y="115" width="207.5" height="55" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-263" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="cKh2JxnRFl6GvmQpNupA-264" target="cKh2JxnRFl6GvmQpNupA-265" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-264" value="datum = new Datum&amp;lt;&amp;gt;()&lt;br&gt;&lt;b&gt;dataStore&lt;/b&gt;.put(key, datum)" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2660" y="50" width="158" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-265" value="notifier.&lt;b&gt;addTask&lt;/b&gt;(key, DataOperation.CHANGE)" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2660" y="110" width="158" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cKh2JxnRFl6GvmQpNupA-268" value="&lt;font style=&quot;font-size: 12px&quot;&gt;服务实例变更时，数据更新／同步方式：&lt;br&gt;&lt;br&gt;1) &lt;b&gt;Cluster$updateIps()&lt;/b&gt;&lt;br&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&#x9;&lt;/span&gt;用于更新节点自身的注册表&lt;br&gt;2) &lt;b&gt;applicationContext.publishEvent()&lt;/b&gt;&lt;br&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&#x9;&lt;/span&gt;用于更新客户端缓存的注册表&lt;br&gt;3)&amp;nbsp;&lt;b&gt;distroProtocol.sync&lt;/b&gt;&lt;br&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&#x9;&lt;/span&gt;用于Nacos集群实例间数据同步&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=8;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1700" y="440" width="360" height="200" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--4" value="类初始化阶段" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;curved=1;dashed=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="i3VVjqCiXnyBUYItkDT--0" target="i3VVjqCiXnyBUYItkDT--3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3610" y="1080" />
              <mxPoint x="3610" y="1000" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--11" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="i3VVjqCiXnyBUYItkDT--0" target="i3VVjqCiXnyBUYItkDT--10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--0" value="onApplicationEvent(&lt;br&gt;ServiceChangeEvent event)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3418" y="1080" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--2" value="PushService.class" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3458" y="1060" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--6" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="i3VVjqCiXnyBUYItkDT--3" target="i3VVjqCiXnyBUYItkDT--5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--8" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="i3VVjqCiXnyBUYItkDT--3" target="i3VVjqCiXnyBUYItkDT--7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--3" value="PushService类初始化&lt;br style=&quot;font-size: 8px&quot;&gt;1) 创建UDP Socket(DatagramSocket)&lt;br&gt;2) 创建守护者线程并启动Receiver任务&lt;br&gt;3)&amp;nbsp;RETRANSMITTER_EXECUTOR线程池启动removeClientIfZombie()计划任务" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;align=center;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3636" y="975" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--5" value="Receiver$run()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;align=center;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3854" y="955" width="122" height="40" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--7" value="removeClientIfZombie()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;align=center;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3854" y="995" width="122" height="40" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--16" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="i3VVjqCiXnyBUYItkDT--10" target="i3VVjqCiXnyBUYItkDT--15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--29" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="i3VVjqCiXnyBUYItkDT--10" target="i3VVjqCiXnyBUYItkDT--28" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--10" value="GlobalExecutor&lt;br&gt;.scheduleUdpSender(() -&amp;gt; {...})" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;align=center;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3660" y="1060" width="122" height="40" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--13" value="PushService 数据结构" style="swimlane;fontSize=10;fontColor=#007FFF;startSize=20;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-1362" y="920.5" width="530" height="240" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--14" value="&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;@Autowired&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private SwitchDomain switchDomain;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private ApplicationContext applicationContext;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private static final long ACK_TIMEOUT_NANOS = TimeUnit.SECONDS.toNanos(10L);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private static final int MAX_RETRY_TIMES = 1;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private static volatile ConcurrentMap&amp;lt;String, Receiver.AckEntry&amp;gt; ackMap = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;//serviceName -&amp;gt;&amp;nbsp; -&amp;gt;PushClient&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private static ConcurrentMap&amp;lt;String, ConcurrentMap&amp;lt;String, PushClient&amp;gt;&amp;gt; &lt;b&gt;clientMap&lt;/b&gt; = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private static volatile ConcurrentMap&amp;lt;String, Long&amp;gt; udpSendTimeMap = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;public static volatile ConcurrentMap&amp;lt;String, Long&amp;gt; pushCostMap = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private static int totalPush = 0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private static int failedPush = 0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private static DatagramSocket udpSocket;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private static ConcurrentMap&amp;lt;String, Future&amp;gt; futureMap = new ConcurrentHashMap&amp;lt;&amp;gt;();&lt;/font&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=10;fontColor=#007FFF;align=left;" parent="i3VVjqCiXnyBUYItkDT--13" vertex="1">
          <mxGeometry y="20" width="530" height="220" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--18" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="i3VVjqCiXnyBUYItkDT--15" target="i3VVjqCiXnyBUYItkDT--17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--15" value="&lt;div&gt;clients = clientMap&lt;span&gt;.get(...serviceName...)&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;align=center;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3820" y="1060" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--21" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="i3VVjqCiXnyBUYItkDT--17" target="i3VVjqCiXnyBUYItkDT--20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--17" value="for (PushClient client : clients.values())" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;align=center;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3820" y="1120" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--27" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="i3VVjqCiXnyBUYItkDT--19" target="i3VVjqCiXnyBUYItkDT--10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--19" value="for end" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;align=center;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3820" y="1280" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--23" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="i3VVjqCiXnyBUYItkDT--20" target="i3VVjqCiXnyBUYItkDT--22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--20" value="if (client.zombie()) {&lt;br&gt;clients.remove(client.toString())&lt;br&gt;}" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;align=left;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3820" y="1160" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--31" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="i3VVjqCiXnyBUYItkDT--22" target="i3VVjqCiXnyBUYItkDT--19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-116" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="i3VVjqCiXnyBUYItkDT--22" target="tu7KC7_A9Dg24m53ykQn-115" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--22" value="udpPush(ackEntry)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;UDP广播&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;align=center;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3820" y="1220" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--30" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="i3VVjqCiXnyBUYItkDT--28" target="i3VVjqCiXnyBUYItkDT--0" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i3VVjqCiXnyBUYItkDT--28" value="futureMap更新" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;align=center;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3660" y="1120" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="CK4975RrXwExiHhc40Je-0" value="DistroProtocol 数据结构" style="swimlane;fontSize=10;fontColor=#007FFF;startSize=20;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-880" y="600.5" width="360" height="280" as="geometry" />
        </mxCell>
        <mxCell id="CK4975RrXwExiHhc40Je-1" value="&lt;div&gt;//源码注释说是Nacos集群节点管理器，有个核心的字段ConcurrentSkipListMap&amp;lt;String, Member&amp;gt; &lt;b&gt;serverList&lt;/b&gt;，浏览了下代码看上去大概就是本节点存储所有Nacos节点信息（比如IP端口等）的容器，实现了Spring的事件监听接口，监听WebServerInitializedEvent，即web服务启动后向所有其他节点上报（/cluster/report）自己的信息；另外还向注册发布器注册监听Nacos集群实例变更事件MembersChangeEvent、事件产生后更新本地serverList&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private final ServerMemberManager memberManager;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;//四个Map容器&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private final DistroComponentHolder distroComponentHolder;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;//&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private final DistroTaskEngineHolder distroTaskEngineHolder;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private final DistroConfig distroConfig;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;private volatile boolean isInitialized = false;&lt;/font&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=10;fontColor=#007FFF;align=left;" parent="CK4975RrXwExiHhc40Je-0" vertex="1">
          <mxGeometry y="20" width="360" height="260" as="geometry" />
        </mxCell>
        <mxCell id="CK4975RrXwExiHhc40Je-4" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;TODO（这部分不是核心，先略）:&lt;br&gt;1) 事件发布器又是什么?&lt;br&gt;2) Nacos集群实例间发现彼此、节点增删时数据同步完整流程是怎样的？&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-520" y="640.5" width="202" height="100" as="geometry" />
        </mxCell>
        <mxCell id="CK4975RrXwExiHhc40Je-5" value="&lt;font style=&quot;font-size: 11px&quot;&gt;nacos-core :&amp;nbsp;/core/src/main/java&lt;br&gt;/com/alibaba/nacos/core/distributed/distro&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2688" y="1890" width="220" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Kcw5hnosKVDvHMAoZKsL-1" value="这里复制了一份注册表数据，进行更新，更新完成后赋值给原来的注册表，&lt;br&gt;这样在更新注册表的时候客户端依然读旧的注册表，不会读取到正在更新的中间态数据" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=8;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3281" y="1010" width="178" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-0" value="服务注册操作" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="325" y="550" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-1" value="Web服务器启动后&lt;br&gt;触发服务注册" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="319" y="365.5" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-2" value="发布注册完成事件&lt;br&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="319" y="630" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-3" value="copy并修改Service Map中&lt;br&gt;变化的部分" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2499.5" y="1527.5" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-4" value="更新本节点以及&lt;br&gt;同步给其他Nacos节点" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2513.5" y="1840" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-5" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2230" y="620" width="20" height="620" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-6" value="Nacos节点&lt;br&gt;数据同步" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2165" y="915" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-8" value="注册服务" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1618" y="285" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-9" value="注销服务" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1618" y="100" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-11" value="&lt;font style=&quot;font-size: 10px&quot;&gt;空Service是指没有Instance实例&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2090" y="305" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-12" value="添加一个同步任务&lt;br&gt;用于更新本节点的服务实例信息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3098" y="1865" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-13" value="用于更新其他节点的服务实例信息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2713" y="1970" width="170" height="20" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-16" value="&lt;div&gt;&lt;div&gt;if (ephemeral) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;ephemeralInstances&lt;/b&gt; = toUpdateInstances;&lt;/div&gt;&lt;div&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;persistentInstances&lt;/b&gt; = toUpdateInstances;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;fillColor=#d5e8d4;strokeColor=#82b366;arcSize=8;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3080" y="1000" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-18" value="&lt;div&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;服务注册表结构：&lt;/font&gt;&lt;/div&gt;&lt;div&gt;//ServiceManager&lt;/div&gt;&lt;div&gt;//命名空间（常用做环境隔离：dev/test/prod）-&amp;gt; group(服务分组,比如某个项目服务,如：mall-user) -&amp;gt; 服务实例&lt;/div&gt;&lt;div&gt;Map&amp;lt;String, Map&amp;lt;String, Service&amp;gt;&amp;gt; serviceMap&lt;/div&gt;&lt;div&gt;//Service: 服务实例，服务通常有个多个节点，还可能跨地部署&lt;/div&gt;&lt;div&gt;//服务名 -&amp;gt; 服务集群（一个服务[多实例]可能部署到多个集群，比如异地多机房架构）&lt;/div&gt;&lt;div&gt;Map&amp;lt;String, Cluster&amp;gt; clusterMap&lt;/div&gt;&lt;div&gt;//Cluster&lt;/div&gt;&lt;div&gt;//服务集群是包含多个服务实例的集合&lt;/div&gt;&lt;div&gt;Set&amp;lt;Instance&amp;gt; persistentInstances&lt;/div&gt;&lt;div&gt;Set&amp;lt;Instance&amp;gt; ephemeralInstances&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3520" y="815" width="460" height="130" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-22" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-19" target="tu7KC7_A9Dg24m53ykQn-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-31" value="bean创建" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;elbow=vertical;dashed=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-19" target="tu7KC7_A9Dg24m53ykQn-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-19" value="&lt;b&gt;restTemplate&lt;/b&gt;.getForObject(url, R.class)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;nacos-discovery组件已经引入了ribbion&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="220" y="1390" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-24" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-21" target="tu7KC7_A9Dg24m53ykQn-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-44" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-21" target="tu7KC7_A9Dg24m53ykQn-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-21" value="ClientHttpRequest request = this.createRequest(url, method)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;创建请求（拦截器、初始化器）&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="420" y="1400" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-26" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-23" target="tu7KC7_A9Dg24m53ykQn-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-66" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-23" target="tu7KC7_A9Dg24m53ykQn-65" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-23" value="response = request.execute()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;发送请求&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="420.87" y="1760" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-28" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-25" target="tu7KC7_A9Dg24m53ykQn-27" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-25" value="this.handleResponse(url, method, response)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;获取返回值&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="420.87" y="2220" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-27" value="var14 = responseExtractor != null ? responseExtractor.extractData(&lt;br&gt;response) : null&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;返回值提取与类型转换&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="420.87" y="2277.5" width="160" height="57.5" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-29" value="RestTemplate.java" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="250" y="1370" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-38" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-30" target="tu7KC7_A9Dg24m53ykQn-37" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-30" value="new RestTemplate()&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="420.87" y="1280" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-36" value="&lt;p style=&quot;margin: 4px 0px 0px ; text-align: center ; text-decoration: underline ; font-size: 10px&quot;&gt;&lt;b&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 10px&quot;&gt;RestTemplate&lt;/font&gt;&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;//下面这些是一些开关，表示是否注册对应的HttpMessageConverter&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private static final boolean romePresent;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private static final boolean jaxb2Present;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private static final boolean jackson2Present;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private static final boolean jackson2XmlPresent;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private static final boolean jackson2SmilePresent;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private static final boolean jackson2CborPresent;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private static final boolean gsonPresent;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private static final boolean jsonbPresent;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;//实际装载的HttpMessageConverter列表，用于将对象实例转成Http请求对象，或&lt;br&gt;// 将Http响应转成对象实例&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private final List&amp;lt;HttpMessageConverter&amp;lt;?&amp;gt;&amp;gt; &lt;b&gt;messageConverters&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;//请求失败处理器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private ResponseErrorHandler errorHandler;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;//&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private UriTemplateHandler &lt;b&gt;uriTemplateHandler&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;//&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private final ResponseExtractor&amp;lt;HttpHeaders&amp;gt; headersExtractor;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;//继承自 InterceptingHttpAccessor&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private final List&amp;lt;ClientHttpRequestInterceptor&amp;gt; &lt;b&gt;interceptors&lt;/b&gt; = new ArrayList();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private volatile ClientHttpRequestFactory interceptingRequestFactory;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;//继承自 HttpAccessor&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;//如果有拦截器，requestFactory 就是InterceptingClientHttpRequestFactory 对象&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private ClientHttpRequestFactory &lt;b&gt;requestFactory&lt;/b&gt; = new SimpleClientHttpRequestFactory();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private final List&amp;lt;ClientHttpRequestInitializer&amp;gt; &lt;b&gt;clientHttpRequestInitializers&lt;/b&gt; = new ArrayList();&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-480" y="1400" width="440" height="360" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-40" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-37" target="tu7KC7_A9Dg24m53ykQn-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-37" value="this.messageConverters.add(...)&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="620" y="1280" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-42" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-39" target="tu7KC7_A9Dg24m53ykQn-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-39" value="this.uriTemplateHandler = initUriTemplateHandler()&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="620.87" y="1340" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-41" value="uriFactory = new &lt;b&gt;DefaultUriBuilderFactory&lt;/b&gt;()&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="817" y="1340" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-46" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-43" target="tu7KC7_A9Dg24m53ykQn-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-48" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-43" target="tu7KC7_A9Dg24m53ykQn-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-43" value="request = this.getRequestFactory()&lt;br&gt;.createRequest(url, method)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="620" y="1400" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-63" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-45" target="tu7KC7_A9Dg24m53ykQn-62" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-45" value="this.initialize(request)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;应用配置的初始化器，对request做进一步初始化&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="620" y="1690" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-50" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-47" target="tu7KC7_A9Dg24m53ykQn-49" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-47" value="List&amp;lt;ClientHttpRequestInterceptor&amp;gt; interceptors = this.&lt;b&gt;getInterceptors&lt;/b&gt;()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="820" y="1400" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-52" value="Y" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-49" target="tu7KC7_A9Dg24m53ykQn-51" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-54" value="N" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-49" target="tu7KC7_A9Dg24m53ykQn-53" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-60" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-49" target="tu7KC7_A9Dg24m53ykQn-59" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-49" value="interceptors&lt;br&gt;不为空？" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="860" y="1502.5" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-51" value="factory = new &lt;b&gt;InterceptingClientHttpRequestFactory&lt;/b&gt;(&lt;br&gt;super.getRequestFactory(), interceptors);&lt;br&gt;return (ClientHttpRequestFactory)factory;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="980" y="1470" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-53" value="return super.getRequestFactory()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;即SimpleClientHttpRequestFactory&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="980" y="1550" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-56" value="比如@LoadBalanced&lt;br&gt;引入的负载均衡拦截器" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="980" y="1405" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-58" value="装饰器模式，装饰拦截器" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1010" y="1450" width="130" height="20" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-59" value="new &lt;b&gt;InterceptingClientHttpRequest&lt;/b&gt;(&lt;br&gt;requestFactory, this.&lt;b&gt;interceptors&lt;/b&gt;, uri, httpMethod)" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="810" y="1620" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-61" value="&lt;p style=&quot;margin: 4px 0px 0px ; text-align: center ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;&lt;u&gt;InterceptingClientHttpRequest&lt;/u&gt;&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 10px&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;//即 RestTemplate 的 requestFactory&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private final ClientHttpRequestFactory &lt;b&gt;requestFactory&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;//即 RestTemplate 的 interceptors&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private final List&amp;lt;ClientHttpRequestInterceptor&amp;gt; &lt;b&gt;interceptors&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;//请求方法类型：GET POST 等&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private HttpMethod &lt;b&gt;method&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;//请求URI&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private URI &lt;b&gt;uri&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;//继承的字段&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private ByteArrayOutputStream bufferedOutput = &lt;br&gt;&lt;span&gt;&#x9;&lt;/span&gt;&lt;span&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&#x9;&lt;/span&gt;new ByteArrayOutputStream(1024);&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private final HttpHeaders headers = new HttpHeaders();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 8px ; font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;private boolean executed = false;&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-800" y="1400" width="300" height="220" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-62" value="&lt;div&gt;this.clientHttpRequestInitializers.forEach(&lt;br&gt;(initializer) -&amp;gt; {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; initializer.&lt;b&gt;initialize&lt;/b&gt;(request);&lt;/div&gt;&lt;div&gt;});&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="800" y="1680" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-64" value="属于扩展点&lt;br&gt;测试Demo中并没有用到" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1000" y="1695" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-68" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-65" target="tu7KC7_A9Dg24m53ykQn-67" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-65" value="InterceptingRequestExecution requestExecution = new InterceptingRequestExecution()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="621.75" y="1760" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-70" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-67" target="tu7KC7_A9Dg24m53ykQn-69" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-67" value="requestExecution.&lt;b&gt;execute&lt;/b&gt;(this, bufferedOutput)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="621.75" y="1820" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-72" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-69" target="tu7KC7_A9Dg24m53ykQn-71" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-69" value="&lt;b&gt;nextInterceptor&lt;/b&gt;.intercept(request, body, &lt;b&gt;this&lt;/b&gt;)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;拦截器依次迭代执行&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="817" y="1820" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-74" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-71" target="tu7KC7_A9Dg24m53ykQn-73" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1190" y="1840" />
              <mxPoint x="1190" y="1880" />
              <mxPoint x="610" y="1880" />
              <mxPoint x="610" y="1930" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-71" value="LoadBalancerInterceptor&lt;br&gt;&lt;span style=&quot;font-weight: normal&quot;&gt;#intercept(...)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;我们这里使用了Ribbon负载均衡&lt;/font&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1020" y="1820" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-77" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-73" target="tu7KC7_A9Dg24m53ykQn-76" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-93" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;elbow=vertical;dashed=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-73" target="tu7KC7_A9Dg24m53ykQn-91" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-73" value="&lt;span style=&quot;font-weight: normal&quot;&gt;(ClientHttpResponse)this.&lt;/span&gt;loadBalancer&lt;br&gt;&lt;span style=&quot;font-weight: normal&quot;&gt;.&lt;/span&gt;execute&lt;span style=&quot;font-weight: normal&quot;&gt;(serviceName, this.requestFactory.&lt;/span&gt;createRequest&lt;span style=&quot;font-weight: normal&quot;&gt;(request, body, execution))&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-weight: 400&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;requestFactory 是 LoadBalancerRequestFactory&lt;/font&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fontStyle=1" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="620.87" y="1900" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-75" value="责任链模式" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="862" y="1800" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-79" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-76" target="tu7KC7_A9Dg24m53ykQn-78" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-106" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-76" target="tu7KC7_A9Dg24m53ykQn-105" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-76" value="&lt;span style=&quot;font-weight: normal&quot;&gt;ILoadBalancer loadBalancer = this.&lt;/span&gt;getLoadBalancer&lt;span style=&quot;font-weight: normal&quot;&gt;(serviceId)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fontStyle=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="900" y="1910" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-82" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-78" target="tu7KC7_A9Dg24m53ykQn-81" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-86" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-78" target="tu7KC7_A9Dg24m53ykQn-85" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-78" value="&lt;span style=&quot;font-weight: 400&quot;&gt;Server server = this.getServer(loadBalancer, hint)&lt;br&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;通过serviceId查找对应的服务Server信息&lt;/font&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fontStyle=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="900" y="1970" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-80" value="RibbonLoadBalancerClient" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="915" y="1890" width="130" height="20" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-84" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-81" target="tu7KC7_A9Dg24m53ykQn-83" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-81" value="&lt;span style=&quot;font-weight: 400&quot;&gt;loadBalancer.&lt;/span&gt;chooseServer&lt;span style=&quot;font-weight: 400&quot;&gt;(&lt;br&gt;hint != null ? hint : &quot;default&quot;)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fontStyle=1" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1100" y="1970" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-83" value="&lt;span style=&quot;font-weight: 400&quot;&gt;this.rule.choose(key)&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;执行负载均衡策略选择一个服务实例&lt;/font&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fontStyle=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1300" y="1970" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-88" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-85" target="tu7KC7_A9Dg24m53ykQn-87" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-85" value="&lt;span style=&quot;font-weight: 400 ; font-size: 8px&quot;&gt;&lt;font style=&quot;font-size: 8px&quot;&gt;RibbonServer ribbonServer = new RibbonServer(serviceId, server, &lt;br&gt;this.isSecure(server, serviceId), this.serverIntrospector(serviceId).getMetadata(server))&lt;/font&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fontStyle=1" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="880" y="2026.25" width="200" height="53.75" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-90" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-87" target="tu7KC7_A9Dg24m53ykQn-89" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-87" value="&lt;span style=&quot;font-weight: 400&quot;&gt;this.execute(serviceId, &lt;br&gt;(ServiceInstance)ribbonServer, (LoadBalancerRequest)request)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fontStyle=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="900" y="2100" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-94" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-89" target="tu7KC7_A9Dg24m53ykQn-91" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1270" y="2120" />
              <mxPoint x="1270" y="2160" />
              <mxPoint x="610" y="2160" />
              <mxPoint x="610" y="2200" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-89" value="&lt;span style=&quot;font-weight: 400&quot;&gt;T returnVal = request.&lt;/span&gt;apply&lt;span style=&quot;font-weight: 400&quot;&gt;(serviceInstance)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fontStyle=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1100" y="2100" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-97" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-91" target="tu7KC7_A9Dg24m53ykQn-96" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-91" value="&lt;span style=&quot;font-weight: 400&quot;&gt;execution.execute((HttpRequest)&lt;br&gt;serviceRequest, body)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fontStyle=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="620" y="2180" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-96" value="&lt;span style=&quot;font-weight: 400&quot;&gt;发送请求到目标服务&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fontStyle=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="820" y="2180" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-98" value="由@LoadBalanced 注解&lt;br&gt;注入LoadBalancerInterceptor" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1190" y="1825" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-101" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-99" target="tu7KC7_A9Dg24m53ykQn-100" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-99" value="Ribbon自动配置&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;要研究Ribbon的原理还是单独建个&lt;br&gt;非Spring项目测试比较好&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="220" y="2360" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-104" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-100" target="tu7KC7_A9Dg24m53ykQn-103" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-100" value="RibbonAutoConfiguration" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="420.87" y="2360" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-102" value="&lt;div&gt;org.springframework.boot.autoconfigure.EnableAutoConfiguration=\&lt;/div&gt;&lt;div&gt;org.springframework.cloud.netflix.ribbon.RibbonAutoConfiguration&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="220" y="2400" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-108" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-103" target="tu7KC7_A9Dg24m53ykQn-107" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-103" value="springClientFactory()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="620" y="2360" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-105" value="&lt;span style=&quot;font-weight: 400&quot;&gt;this.clientFactory.getLoadBalancer(&lt;br&gt;serviceId)&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fontStyle=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1100" y="1910" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-107" value="loadBalancerClient()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="620" y="2440" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-112" value="PUT" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-110" target="tu7KC7_A9Dg24m53ykQn-111" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-110" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&amp;nbsp;/nacos/v1/ns&lt;br&gt;/instance/beat&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1478" y="2000" width="82" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-111" value="TODO" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1618" y="2000" width="122" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-114" value="使用了Spring事件机制" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3841" y="120" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-115" value="&lt;font style=&quot;font-size: 10px&quot;&gt;udpSocket.send(&lt;br&gt;ackEntry.origin)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3980" y="1220" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-117" value="使用UDP相对与TCP更节省资源，&lt;br&gt;为了提升UDP的可靠性，&lt;br&gt;还引入ACK机制，以及重发；&lt;br&gt;即使发送失败，客户端还有定时拉取&lt;br&gt;服务列表兜底" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="3951" y="1260" width="180" height="70" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-123" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#007FFF;elbow=vertical;dashed=1;fillColor=#dae8fc;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-118" target="tu7KC7_A9Dg24m53ykQn-120" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2940" y="2060" />
              <mxPoint x="1560" y="2060" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-118" value="&lt;div&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;/distro/datum&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;最终通过异步调用其他NacosServer的/distro/datum&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=8;rounded=1;fillColor=#d5e8d4;strokeColor=#82b366;align=center;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2940" y="1920" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-125" value="PUT" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="tu7KC7_A9Dg24m53ykQn-120" target="tu7KC7_A9Dg24m53ykQn-124" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-120" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&amp;nbsp;/nacos/v1/ns&lt;br&gt;/distro/datum&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1478" y="2080" width="82" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-122" value="datum: 数据，资料" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1478" y="2120" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-124" value="TODO" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1618" y="2080" width="122" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-126" value="ServerStatusReporter&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;集群Server节点之间同步自己的状态，防止万一节点宕机&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1478" y="2160" width="122" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-127" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1458" y="2160" width="12" height="160" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-128" value="NacosServer启动阶段&lt;br&gt;一些重要的定时任务" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1348" y="2225" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-129" value="ServiceReporter&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;如果某个服务实例心跳异常，将状态同步到其他NacosServer&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1478" y="2220" width="122" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-130" value="DistroLoadDataTask&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;新增节点时从其他节点同步数据&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1478" y="2280" width="122" height="40" as="geometry" />
        </mxCell>
        <mxCell id="tu7KC7_A9Dg24m53ykQn-131" value="&lt;font color=&quot;#cc0066&quot;&gt;TODO 这里面的流程还没分析完&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#007FFF;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1295" y="2010" width="130" height="20" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="o6wrNa-VAWkXoja7IL9O" name="Distro协议原理">
    <mxGraphModel dx="1220" dy="766" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="Swqwk-0Pdm74yuupKNYV-0" />
        <mxCell id="Swqwk-0Pdm74yuupKNYV-1" parent="Swqwk-0Pdm74yuupKNYV-0" />
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-60" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;dashed=1;fontSize=9;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-57" target="PLv1tA6vPW1lIZsVHoEl-24" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="990" y="440.5" />
              <mxPoint x="990" y="1265.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-0" value="&lt;h1&gt;Nacos Distro 协议原理（1.4.1）&lt;/h1&gt;&lt;p&gt;一致性协议，无非是将分布式系统不同节点间数据进行同步，寻求数据最终保持一致，研究协议原理就是研究它是怎么同步不同节点的数据的。&lt;br&gt;&lt;br&gt;看ServerMemberManager源码，发现貌似每个Nacos节点实例中维护的节点信息列表也是用Distro协议进行同步的。因为不涉及较复杂的业务，可以以这个为切入点分析协议同步原理。&lt;/p&gt;&lt;p&gt;源码包路径：&lt;br&gt;&lt;span&gt;&#x9;&lt;/span&gt;nacos-core : /src/main/java/com/alibaba/nacos/core/distributed/distro&lt;/p&gt;&lt;p&gt;前置知识：&lt;br&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Spring Boot事件机制－SpringApplicationRunListener&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="20" y="19" width="420" height="261" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-3" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-1" target="PLv1tA6vPW1lIZsVHoEl-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-31" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-1" target="PLv1tA6vPW1lIZsVHoEl-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-1" value="DistroProtocol&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;核心类Bean初始化&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="40" y="480.5" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-7" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-2" target="PLv1tA6vPW1lIZsVHoEl-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="350" y="500.5" />
              <mxPoint x="350" y="440.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-11" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-2" target="PLv1tA6vPW1lIZsVHoEl-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-12" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-2" target="PLv1tA6vPW1lIZsVHoEl-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-13" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-2" target="PLv1tA6vPW1lIZsVHoEl-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-15" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-2" target="PLv1tA6vPW1lIZsVHoEl-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-2" value="构造器注入了四个Bean&lt;br&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;spring构造器注入@Autowired不是必须的&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="200" y="480.5" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-26" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;dashed=1;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-5" target="DJlTjO-XSqIWl9eDNL-M-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="520" y="440.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-5" value="ServerMemberManager&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;Nacos实例容器, 主要字段serverList (是个Map)&amp;nbsp;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="380" y="420.5" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-39" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-8" target="PLv1tA6vPW1lIZsVHoEl-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-8" value="DistroComponentHolder&lt;br&gt;&lt;font style=&quot;font-size: 9px&quot; color=&quot;#007fff&quot;&gt;Distro组件容器&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="380" y="460.5" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-42" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-9" target="PLv1tA6vPW1lIZsVHoEl-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-9" value="DistroTaskEngineHolder&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;任务执行引擎容器&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="380" y="500.5" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-10" value="DistroConfig" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="380" y="540.5" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-17" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-14" target="PLv1tA6vPW1lIZsVHoEl-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-14" value="startDistroTask()&lt;br&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;如果是单节点模式直接就退出了&lt;br&gt;非单节点启动两个任务&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="200" y="1060.5" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-19" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-16" target="PLv1tA6vPW1lIZsVHoEl-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-21" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-16" target="PLv1tA6vPW1lIZsVHoEl-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-16" value="startVerifyTask()&lt;br&gt;&lt;font color=&quot;#0066cc&quot; style=&quot;font-size: 9px&quot;&gt;每隔30s执行一次&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="380" y="1060.5" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-71" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#3399FF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-18" target="PLv1tA6vPW1lIZsVHoEl-70" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="520" y="1140.5" />
              <mxPoint x="520" y="1205.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-18" value="startLoadTask()&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;一次性任务&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="380" y="1120.5" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-44" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-20" target="PLv1tA6vPW1lIZsVHoEl-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-20" value="DistroVerifyTask$run" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="540" y="1060.5" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-25" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-22" target="PLv1tA6vPW1lIZsVHoEl-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-22" value="&lt;font style=&quot;font-size: 9px&quot;&gt;先循环等待其他Nacos实例注册到ServerMemberManager 的 serverList&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;put操作只有在此Bean初始化以及监听到&lt;/font&gt;&lt;b style=&quot;font-size: 10px&quot;&gt;IPChangeEvent&lt;/b&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;事件会执行&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="740" y="1180.5" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-27" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-24" target="PLv1tA6vPW1lIZsVHoEl-26" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-24" value="再循环等待DistroDataStorage数据注册到distroComponentHolder&lt;br&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;命名服务启动时会put DistroDataStorageImpl&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="740" y="1245.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-29" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-26" target="PLv1tA6vPW1lIZsVHoEl-28" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-74" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#3399FF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-26" target="PLv1tA6vPW1lIZsVHoEl-73" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-26" value="遍历DistroDataStorage从其他实例加载数据快照到本地" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="740" y="1300.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-76" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-28" target="PLv1tA6vPW1lIZsVHoEl-75" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1160" y="1321" />
              <mxPoint x="1160" y="1220" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-28" value="&lt;font style=&quot;font-size: 9px&quot;&gt;loadCompletedMap.put(each, loadAllDataSnapshotFromRemote(each))&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="940" y="1300.5" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-33" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-30" target="PLv1tA6vPW1lIZsVHoEl-32" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-34" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-30" target="PLv1tA6vPW1lIZsVHoEl-35" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="200" y="1730.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-37" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-30" target="PLv1tA6vPW1lIZsVHoEl-36" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-30" value="功能方法" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="40" y="1640.5" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-32" value="sync(DistroKey distroKey, DataOperation action, &lt;br&gt;long delay)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="200" y="1640.5" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-35" value="queryFromRemote(&lt;br&gt;DistroKey distroKey)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="200" y="1720.5" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-36" value="onXxx()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="200" y="1800.5" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-38" value="&lt;div style=&quot;font-size: 9px&quot;&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;font color=&quot;#3399ff&quot; style=&quot;font-size: 9px&quot;&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;//通信代理，即HTTPClient、Socket那些&lt;/font&gt;&lt;br style=&quot;font-size: 9px&quot;&gt;&lt;/font&gt;Map&amp;lt;String, DistroTransportAgent&amp;gt; transportAgentMap&lt;br style=&quot;font-size: 9px&quot;&gt;&lt;font style=&quot;font-size: 9px&quot; color=&quot;#3399ff&quot;&gt;//需要同步的数据的存储，都是什么数据？？？&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px&quot;&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;Map&amp;lt;String, DistroDataStorage&amp;gt; dataStorageMap&lt;br style=&quot;font-size: 9px&quot;&gt;&lt;font color=&quot;#3399ff&quot; style=&quot;font-size: 9px&quot;&gt;//任务失败重试处理器&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px&quot;&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;Map&amp;lt;String, DistroFailedTaskHandler&amp;gt; failedTaskHandlerMap&lt;br style=&quot;font-size: 9px&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;//同步数据处理器，接收到数据后进行处理&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px&quot;&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;Map&amp;lt;String, DistroDataProcessor&amp;gt; dataProcessorMap&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fontColor=#000000;align=left;arcSize=5;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="560" y="410.5" width="260" height="90" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-41" value="&lt;div style=&quot;font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;b style=&quot;font-size: 10px&quot;&gt;DistroDelayTaskExecuteEngine&lt;/b&gt; delayTaskExecuteEngine&lt;br style=&quot;font-size: 10px&quot;&gt;&lt;/font&gt;&lt;b style=&quot;font-size: 10px&quot;&gt;DistroExecuteTaskExecuteEngine&lt;/b&gt; executeWorkersManager&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;猜测这两个就是执行数据同步任务的吧？TODO&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fontColor=#000000;align=left;arcSize=5;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="560" y="520.5" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-46" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-43" target="PLv1tA6vPW1lIZsVHoEl-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-43" value="List&amp;lt;Member&amp;gt; targetServer = serverMemberManager&lt;br&gt;.allMembersWithoutSelf();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;所有其他Nacos实例节点&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="740" y="1060.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-48" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-45" target="PLv1tA6vPW1lIZsVHoEl-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-45" value="&lt;font color=&quot;#007fff&quot;&gt;遍历dataStorageMap&lt;br style=&quot;font-size: 10px&quot;&gt;&lt;/font&gt;verifyForDataStorage(each, targetServer)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="740" y="1120.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-95" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-47" target="PLv1tA6vPW1lIZsVHoEl-94" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-47" value="distroComponentHolder.findTransportAgent(type)&lt;br&gt;.syncVerifyData(distroData, member.getAddress())&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;通过HTTP向其他Member(Nacos节点)同步校验数据&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="940" y="1110" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-51" value="DistroHttpRegistry.class&lt;br&gt;属于命名服务" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="930" y="310" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-56" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-52" target="PLv1tA6vPW1lIZsVHoEl-55" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-61" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.25;entryDx=0;entryDy=0;dashed=1;fontSize=9;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-52" target="PLv1tA6vPW1lIZsVHoEl-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-63" value="&lt;span style=&quot;background-color: rgb(248 , 249 , 250)&quot;&gt;DistroHttpAgent&lt;br&gt;&lt;div&gt;DistroDataStorageImpl&lt;/div&gt;&lt;div&gt;DistroHttpCombinedKeyTaskFailedHandler&lt;/div&gt;&lt;div&gt;DistroHttpDelayTaskProcessor&lt;/div&gt;&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;fontColor=#000000;" parent="PLv1tA6vPW1lIZsVHoEl-61" vertex="1" connectable="0">
          <mxGeometry x="0.0286" y="-9" relative="1" as="geometry">
            <mxPoint x="12" y="-3" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-64" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.25;entryDx=0;entryDy=0;dashed=1;fontSize=9;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-52" target="PLv1tA6vPW1lIZsVHoEl-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-65" value="DistroConsistencyServiceImpl" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;fontColor=#000000;" parent="PLv1tA6vPW1lIZsVHoEl-64" vertex="1" connectable="0">
          <mxGeometry x="0.5331" y="-12" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-52" value="&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;DistroHttpRegistry$doRegister()&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#3399ff&quot;&gt;Bean初始化阶段&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;strokeColor=#82b366;fillColor=#d5e8d4;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="920" y="340" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-58" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-55" target="PLv1tA6vPW1lIZsVHoEl-57" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-62" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;dashed=1;fontSize=9;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-55" target="PLv1tA6vPW1lIZsVHoEl-47" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1050" y="390.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-55" value="&lt;font color=&quot;#000000&quot; style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp;componentHolder.registerTransportAgent(&lt;/font&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 9px;&quot;&gt;KeyBuilder.&lt;/font&gt;&lt;b style=&quot;color: rgb(0, 0, 0); font-size: 9px;&quot;&gt;INSTANCE_LIST_KEY_PREFIX&lt;/b&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 9px;&quot;&gt;, &lt;/font&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 9px;&quot;&gt;new &lt;/font&gt;&lt;b style=&quot;color: rgb(0, 0, 0); font-size: 9px;&quot;&gt;DistroHttpAgent&lt;/b&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 9px;&quot;&gt;(memberManager));&lt;/font&gt;&lt;br style=&quot;font-size: 9px;&quot;&gt;DistroHttpAgent通过NamingProxy向其他节点发数据，内部是用的JDK的HTTP客户端" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="1100" y="330" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-57" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 9px;&quot;&gt;componentHolder.registerDataStorage(&lt;br style=&quot;font-size: 9px;&quot;&gt;KeyBuilder.&lt;b style=&quot;font-size: 9px;&quot;&gt;INSTANCE_LIST_KEY_PREFIX&lt;/b&gt;,&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 9px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; new &lt;b style=&quot;font-size: 9px;&quot;&gt;DistroDataStorageImpl&lt;/b&gt;(dataStore, distroMapper));&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="1100" y="410.5" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-68" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;dashed=1;fontSize=9;fontColor=#3399FF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-66" target="PLv1tA6vPW1lIZsVHoEl-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-69" value="本地Nacos实例新信息" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;fontColor=#3399FF;" parent="PLv1tA6vPW1lIZsVHoEl-68" vertex="1" connectable="0">
          <mxGeometry x="-0.2609" y="2" relative="1" as="geometry">
            <mxPoint x="-8" y="8" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-66" value="NotifyCenter.registerSubscriber(new Subscriber&amp;lt;InetUtils.&lt;b&gt;IPChangeEvent&lt;/b&gt;&amp;gt;() {...}&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;触发IPChangeEvent事件后会往serverList加入新实例&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="480" y="1400.5" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-72" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#3399FF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-70" target="PLv1tA6vPW1lIZsVHoEl-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-70" value="DistroLoadDataTask$run" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="540" y="1185.5" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-73" value="失败的话重新提交此任务；&lt;br&gt;成功的话通过回调方法更新isInitialized状态" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="740" y="1360.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;" edge="1" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-75" target="rsGOLgr29P1Unm8RyWxL-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-75" value="&lt;font style=&quot;font-size: 9px&quot;&gt;for (Member each : memberManager.allMembersWithoutSelf())&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="1200" y="1200.5" width="200" height="39.5" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-77" value="&lt;span style=&quot;font-size: 9px&quot;&gt;ServerMemberManager.class&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="505" y="1380.5" width="130" height="20" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-88" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;dashed=1;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-78" target="PLv1tA6vPW1lIZsVHoEl-85" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-78" value="事件发布&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;(这里只需要关注IPChangeEvent)&lt;/font&gt;&lt;br&gt;this.queue.&lt;b&gt;offer&lt;/b&gt;(event)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;倒推&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="480" y="1560.5" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-84" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-79" target="PLv1tA6vPW1lIZsVHoEl-78" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-79" value="DefaultPublisher$publish()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="700" y="1560.5" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-83" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-81" target="PLv1tA6vPW1lIZsVHoEl-79" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-81" value="NotifyCenter$&lt;b&gt;publishEvent&lt;/b&gt;(final Class&amp;lt;? extends Event&amp;gt; eventType, final Event event)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="860" y="1560.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-87" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-85" target="PLv1tA6vPW1lIZsVHoEl-86" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-85" value="DefaultPublisher启动了一个守护者线程，执行openEventHandler()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;循环等待读取queue的事件，发给所有订阅此事件的订阅者&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="480" y="1480.5" width="180" height="50" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-89" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;dashed=1;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-86" target="PLv1tA6vPW1lIZsVHoEl-66" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="920" y="1505.5" />
              <mxPoint x="920" y="1445.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-90" value="事件通知" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;fontColor=#007FFF;" parent="PLv1tA6vPW1lIZsVHoEl-89" vertex="1" connectable="0">
          <mxGeometry x="-0.0243" y="5" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-86" value="Event event = queue.&lt;b&gt;take&lt;/b&gt;();&lt;br&gt;receiveEvent(event)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;发给所有订阅此事件的订阅者&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="730" y="1485.5" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-93" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-91" target="PLv1tA6vPW1lIZsVHoEl-81" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-91" value="InetUtils$static{...}&lt;br style=&quot;font-size: 8px&quot;&gt;IPChangeEvent event = new IPChangeEvent();&lt;br style=&quot;font-size: 8px&quot;&gt;&amp;nbsp;NotifyCenter.publishEvent(event);&lt;br&gt;&lt;font color=&quot;#3399ff&quot;&gt;这个是本地IP发生改变时才走的逻辑&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;fillColor=#d5e8d4;strokeColor=#82b366;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="1060" y="1560.5" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-94" target="rsGOLgr29P1Unm8RyWxL-0">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-94" value="NamingProxy.syncCheckSums(&lt;br&gt;verifyData.getContent(), targetServer)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="1200" y="1120.5" width="200" height="39.5" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-96" value="&lt;font color=&quot;#ff0080&quot;&gt;这里面是什么数据？&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="920" y="1240.5" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-97" value="&lt;font color=&quot;#007fff&quot;&gt;集群模式有配置cluster.conf&lt;br&gt;这里面列举了集群所有实例的IP端口，所以每个实例是知道其他实例的基本信息的&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=8;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="200" y="1100.5" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-100" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#3399FF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-98" target="PLv1tA6vPW1lIZsVHoEl-99" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-98" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;FileConfigMemberLookup$start()&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;读取cluster.conf文件，将集群实例信息注册到ServerMemberManager的serverList&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#d5e8d4;strokeColor=#82b366;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="1240" y="980.5" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-102" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#3399FF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-99" target="PLv1tA6vPW1lIZsVHoEl-101" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-99" value="&lt;font style=&quot;font-size: 9px&quot;&gt;readClusterConfFromDisk()&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="1460" y="980.5" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-44" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-101" target="DJlTjO-XSqIWl9eDNL-M-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-101" value="&lt;div&gt;&lt;div style=&quot;font-size: 9px&quot;&gt;List&amp;lt;String&amp;gt; tmp = EnvUtil.readClusterConf();&lt;/div&gt;&lt;div&gt;tmpMembers = MemberUtil.readServerConf(tmp);&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;读取cluster.conf文件中Nacos集群节点配置信息（IP、端口），对应创建Member实例（Member代表Nacos节点）&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=left;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="1620" y="970.25" width="220" height="60.5" as="geometry" />
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-105" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#3399FF;dashed=1;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PLv1tA6vPW1lIZsVHoEl-103" target="PLv1tA6vPW1lIZsVHoEl-22" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2090" y="1001" />
              <mxPoint x="2090" y="1050" />
              <mxPoint x="920" y="1050" />
              <mxPoint x="920" y="1206" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-106" value="集群实例信息" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=8;fontColor=#3399FF;" parent="PLv1tA6vPW1lIZsVHoEl-105" vertex="1" connectable="0">
          <mxGeometry x="-0.4008" y="-1" relative="1" as="geometry">
            <mxPoint x="-237" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PLv1tA6vPW1lIZsVHoEl-103" value="&lt;font style=&quot;font-size: 9px&quot;&gt;memberManager&lt;br&gt;.memberChange(members)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;更新serverList，将变化同步到配置文件，通过NotifierCenter发布&lt;b&gt;MembersChangeEvent&lt;/b&gt;事件&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="1880" y="971.75" width="190" height="59" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-0" value="&lt;font style=&quot;font-size: 9px&quot; color=&quot;#007fff&quot;&gt;ServerMemberManager.class&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="1265" y="960.5" width="130" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="DJlTjO-XSqIWl9eDNL-M-5" target="DJlTjO-XSqIWl9eDNL-M-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-5" value="ServerMemberManager &amp;lt;init&amp;gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="380" y="700.5" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="DJlTjO-XSqIWl9eDNL-M-6" target="DJlTjO-XSqIWl9eDNL-M-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-6" value="init()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="600" y="700.5" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="DJlTjO-XSqIWl9eDNL-M-8" target="DJlTjO-XSqIWl9eDNL-M-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-8" value="serverList.put(self.getAddress(), self)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="720" y="700.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="DJlTjO-XSqIWl9eDNL-M-10" target="DJlTjO-XSqIWl9eDNL-M-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-10" value="registerClusterEvent()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="720" y="760.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-15" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="DJlTjO-XSqIWl9eDNL-M-12" target="DJlTjO-XSqIWl9eDNL-M-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-12" value="initAndStartLookup()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="720" y="820.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="DJlTjO-XSqIWl9eDNL-M-14" target="DJlTjO-XSqIWl9eDNL-M-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-20" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#000000;curved=1;" parent="Swqwk-0Pdm74yuupKNYV-1" source="DJlTjO-XSqIWl9eDNL-M-14" target="DJlTjO-XSqIWl9eDNL-M-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-21" value="集群模式" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;fontColor=#007FFF;" parent="DJlTjO-XSqIWl9eDNL-M-20" vertex="1" connectable="0">
          <mxGeometry x="0.1617" y="-4" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-23" value="单机模式" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="DJlTjO-XSqIWl9eDNL-M-14" target="DJlTjO-XSqIWl9eDNL-M-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-14" value="this.lookup = LookupFactory&lt;br&gt;.createLookUp(this)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="920" y="820.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-39" value="&lt;font style=&quot;font-size: 8px&quot;&gt;LookupType.FILE_CONFIG&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="DJlTjO-XSqIWl9eDNL-M-16" target="PLv1tA6vPW1lIZsVHoEl-98" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1240" y="1000" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1160" y="941" />
              <mxPoint x="1160" y="1000" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-41" value="&lt;font style=&quot;font-size: 8px&quot;&gt;LookupType.ADDRESS_SERVER&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="DJlTjO-XSqIWl9eDNL-M-16" target="DJlTjO-XSqIWl9eDNL-M-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-16" value="this.lookup.start()&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;这里关注集群模式下Nacos实例注册流程&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="920" y="920.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-25" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" source="DJlTjO-XSqIWl9eDNL-M-18" target="DJlTjO-XSqIWl9eDNL-M-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-18" value="StartingApplicationListener&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;实现SpringBoot同名接口,观察者模式将应用上下文信息传给StartingApplicationListener&lt;br&gt;这里只关注ConfigurableEnvironment&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fontColor=#000000;strokeColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="400" y="620.5" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-19" value="&lt;div style=&quot;font-size: 9px&quot;&gt;&lt;div style=&quot;font-size: 9px&quot;&gt;String lookupType = EnvUtil.getProperty(&lt;b&gt;LOOKUP_MODE_TYPE&lt;/b&gt;);&lt;/div&gt;&lt;div style=&quot;font-size: 9px&quot;&gt;LookupType type = &lt;b style=&quot;font-size: 9px&quot;&gt;chooseLookup&lt;/b&gt;(lookupType);&lt;/div&gt;&lt;div style=&quot;font-size: 9px&quot;&gt;&lt;b&gt;LOOK_UP&lt;/b&gt; = find(type);&lt;/div&gt;&lt;div style=&quot;font-size: 9px&quot;&gt;currentLookupType = type;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fontColor=#000000;align=left;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="1160" y="780.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-22" value="&lt;b&gt;LOOK_UP&lt;/b&gt; = new &lt;b&gt;StandaloneMemberLookup&lt;/b&gt;()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="1160" y="850.5" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-29" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="DJlTjO-XSqIWl9eDNL-M-24" target="DJlTjO-XSqIWl9eDNL-M-28" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-24" value="StartingApplicationListener&lt;br&gt;$environmentPrepared(&lt;br&gt;&lt;b&gt;ConfigurableEnvironment&lt;/b&gt; environment)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fontColor=#000000;strokeColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="621" y="620.5" width="179" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-27" value="Nacos启动阶段的业务" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="440" y="600.5" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-32" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;dashed=1;" parent="Swqwk-0Pdm74yuupKNYV-1" source="DJlTjO-XSqIWl9eDNL-M-28" target="DJlTjO-XSqIWl9eDNL-M-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-33" value="关注属性：“nacos.core.member.lookup.type”" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#007FFF;" parent="DJlTjO-XSqIWl9eDNL-M-32" vertex="1" connectable="0">
          <mxGeometry x="0.3436" y="-13" relative="1" as="geometry">
            <mxPoint x="-7" y="45" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-28" value="１）创建工作目录：&quot;logs&quot;, &quot;conf&quot;, &quot;data&quot;&lt;br&gt;２）注入环境信息EnvUtil.setEnvironment(environment);&lt;br&gt;３）加载需预处理的属性，如加载文件资源（&lt;b&gt;application.properties&lt;/b&gt;），存入SOURCES，然后再将SOURCES注册会ConfigurableEnvironment，注册配置文件变更监听&lt;br&gt;４）将部分重要环境属性存入系统属性System.setProperty()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;EnvUtil是环境配置属性的容器&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fontColor=#000000;strokeColor=#000000;align=left;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="840" y="600" width="300" height="80" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-31" value="&lt;font color=&quot;#000000&quot; style=&quot;font-size: 12px&quot;&gt;可学习借鉴的东西：&lt;br&gt;&lt;ul&gt;&lt;li&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 12px&quot;&gt;配置文件变更监听，以及实时更新配置&lt;br&gt;&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 12px&quot;&gt;NotifyCenter事件发布订阅&lt;/font&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="480" y="40" width="520" height="200" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-37" value="LookupType有两种模式：file、address-server&lt;br&gt;如果nacos.core.member.lookup.type属性值为空，再查看&lt;b&gt;conf/cluster.conf&lt;/b&gt;, 文件存在且nacos.member.list系统属性不为空则是LookupType.FILE_CONFIG，否则LookupType.ADDRESS_SERVER" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="1360" y="781" width="240" height="59" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-40" value="AddressServerMemberLookup&lt;br&gt;$start()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fontColor=#000000;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="1240" y="900" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PnlBcWU3IaTW_KHYqvyt-11" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="DJlTjO-XSqIWl9eDNL-M-43" target="PLv1tA6vPW1lIZsVHoEl-103" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1860" y="1081" />
              <mxPoint x="1860" y="1001" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-43" value="&lt;div&gt;&lt;div&gt;afterLookup(tmpMembers)&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;align=center;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="1660" y="1060.5" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PnlBcWU3IaTW_KHYqvyt-0" style="edgeStyle=entityRelationEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;shape=link;fillColor=#d5e8d4;strokeColor=#82b366;width=2.2222222222222214;" parent="Swqwk-0Pdm74yuupKNYV-1" source="DJlTjO-XSqIWl9eDNL-M-45" target="PLv1tA6vPW1lIZsVHoEl-103" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PnlBcWU3IaTW_KHYqvyt-7" value="事件订阅" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#007FFF;" parent="PnlBcWU3IaTW_KHYqvyt-0" vertex="1" connectable="0">
          <mxGeometry x="-0.0545" relative="1" as="geometry">
            <mxPoint x="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PnlBcWU3IaTW_KHYqvyt-2" value="" style="edgeStyle=entityRelationEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="DJlTjO-XSqIWl9eDNL-M-45" target="PnlBcWU3IaTW_KHYqvyt-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DJlTjO-XSqIWl9eDNL-M-45" value="MembersChangeEvent&lt;br style=&quot;font-size: 10px;&quot;&gt;事件监听器" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="1460" y="701" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PnlBcWU3IaTW_KHYqvyt-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;curved=1;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PnlBcWU3IaTW_KHYqvyt-1" target="PnlBcWU3IaTW_KHYqvyt-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PnlBcWU3IaTW_KHYqvyt-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;curved=1;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PnlBcWU3IaTW_KHYqvyt-1" target="PnlBcWU3IaTW_KHYqvyt-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PnlBcWU3IaTW_KHYqvyt-1" value="&lt;b&gt;MemberChangeListener&lt;/b&gt; extends Subscriber&amp;lt;MembersChangeEvent&amp;gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="1650" y="701" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PnlBcWU3IaTW_KHYqvyt-9" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" source="PnlBcWU3IaTW_KHYqvyt-3" target="PnlBcWU3IaTW_KHYqvyt-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PnlBcWU3IaTW_KHYqvyt-3" value="&lt;b&gt;DistroMapper&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="1850" y="741" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PnlBcWU3IaTW_KHYqvyt-4" value="&lt;b&gt;ProtocolManager&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="1850" y="661" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PnlBcWU3IaTW_KHYqvyt-8" value="&lt;span style=&quot;font-weight: normal&quot;&gt;onEvent(MembersChangeEvent event)&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-weight: normal&quot;&gt;更新每个DistroMapper的&lt;/span&gt;&lt;span style=&quot;font-weight: 400&quot;&gt;healthyList（&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-weight: 400&quot;&gt;过滤出UP、SUSPICIOUS状态的Member,将其名字排序存入healthyList）&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;fontStyle=1" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="2030" y="741" width="150" height="39" as="geometry" />
        </mxCell>
        <mxCell id="PnlBcWU3IaTW_KHYqvyt-10" value="DistroMapper又是做什么的？TODO" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="Swqwk-0Pdm74yuupKNYV-1" vertex="1">
          <mxGeometry x="2180" y="750.5" width="170" height="20" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-0" value="HTTP PUT /v1/ns/distro/checksum" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="1440" y="1121" width="160" height="39.5" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;" edge="1" parent="Swqwk-0Pdm74yuupKNYV-1" source="rsGOLgr29P1Unm8RyWxL-2" target="rsGOLgr29P1Unm8RyWxL-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;" edge="1" parent="Swqwk-0Pdm74yuupKNYV-1" source="rsGOLgr29P1Unm8RyWxL-2" target="rsGOLgr29P1Unm8RyWxL-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-2" value="&lt;font style=&quot;font-size: 9px&quot;&gt;DistroData distroData = transportAgent.getDatumSnapshot(each.getAddress());&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="1180" y="1261" width="240" height="39.5" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;" edge="1" parent="Swqwk-0Pdm74yuupKNYV-1" source="rsGOLgr29P1Unm8RyWxL-4" target="rsGOLgr29P1Unm8RyWxL-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-4" value="&lt;font style=&quot;font-size: 9px&quot;&gt;boolean result = dataProcessor.processSnapshot(distroData)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="1200" y="1321" width="200" height="39.5" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;" edge="1" parent="Swqwk-0Pdm74yuupKNYV-1" source="rsGOLgr29P1Unm8RyWxL-6" target="rsGOLgr29P1Unm8RyWxL-8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-6" value="&lt;font style=&quot;font-size: 9px&quot;&gt;NamingProxy.getAllData(targetServer)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;从集群其他节点同步数据&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="1460" y="1260.5" width="180" height="39.5" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-8" value="&lt;font style=&quot;font-size: 9px&quot;&gt;HTTP GET /v1/ns/distro/datums&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="1680" y="1260.5" width="140" height="39.5" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" edge="1" parent="Swqwk-0Pdm74yuupKNYV-1" source="rsGOLgr29P1Unm8RyWxL-10" target="rsGOLgr29P1Unm8RyWxL-13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-10" value="&lt;font style=&quot;font-size: 9px&quot;&gt;processData(distroData.getContent())&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="1454" y="1321" width="200" height="39.5" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-12" value="&lt;font color=&quot;#007fff&quot;&gt;DistroConsistencyServiceImpl.class&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="1470" y="1301" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" edge="1" parent="Swqwk-0Pdm74yuupKNYV-1" source="rsGOLgr29P1Unm8RyWxL-13" target="rsGOLgr29P1Unm8RyWxL-21">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-13" value="&lt;font style=&quot;font-size: 9px&quot;&gt;datumMap = serializer.deserializeMap(data, Instances.class)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="1680" y="1321" width="200" height="39.5" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-25" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" edge="1" parent="Swqwk-0Pdm74yuupKNYV-1" source="rsGOLgr29P1Unm8RyWxL-15" target="rsGOLgr29P1Unm8RyWxL-24">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-15" value="&lt;font style=&quot;font-size: 9px&quot;&gt;dataStore.put(entry.getKey(), entry.getValue())&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="1680" y="1420" width="200" height="39.5" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" edge="1" parent="Swqwk-0Pdm74yuupKNYV-1" source="rsGOLgr29P1Unm8RyWxL-21" target="rsGOLgr29P1Unm8RyWxL-15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-21" value="for datumMap start" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fontColor=#007FFF;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="1680" y="1380.5" width="200" height="19.5" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-29" value="Y" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;" edge="1" parent="Swqwk-0Pdm74yuupKNYV-1" source="rsGOLgr29P1Unm8RyWxL-24" target="rsGOLgr29P1Unm8RyWxL-28">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" edge="1" parent="Swqwk-0Pdm74yuupKNYV-1" source="rsGOLgr29P1Unm8RyWxL-24" target="rsGOLgr29P1Unm8RyWxL-32">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-24" value="&lt;font style=&quot;font-size: 9px&quot;&gt;!listeners.containsKey(entry.getKey())&lt;br&gt;&amp;amp;&amp;amp;&amp;nbsp;switchDomain.isDefaultInstanceEphemeral()&lt;br&gt;&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=11;rounded=1;arcSize=8;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="1700" y="1480.5" width="160" height="40.75" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-34" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;curved=1;" edge="1" parent="Swqwk-0Pdm74yuupKNYV-1" source="rsGOLgr29P1Unm8RyWxL-28" target="rsGOLgr29P1Unm8RyWxL-32">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="14ZzdMd3coV8cI0hSLZz-1" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="Swqwk-0Pdm74yuupKNYV-1" source="rsGOLgr29P1Unm8RyWxL-28" target="14ZzdMd3coV8cI0hSLZz-0">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2100" y="1600" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2340" y="1501" />
              <mxPoint x="2340" y="1570" />
              <mxPoint x="1980" y="1570" />
              <mxPoint x="1980" y="1620" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-28" value="&lt;font size=&quot;1&quot;&gt;创建空的Service&lt;br&gt;获取listeners &quot;com.alibaba.nacos.naming.domains.meta.&quot;对应listener队列的头部元素？&lt;br&gt;&lt;b&gt;实例变更处理&lt;/b&gt;：&lt;b&gt;listener.onChange&lt;/b&gt;(KeyBuilder.buildServiceMetaKey(namespaceId, serviceName), service)&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;align=left;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="1900" y="1471.75" width="410" height="58.25" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-45" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" edge="1" parent="Swqwk-0Pdm74yuupKNYV-1" source="rsGOLgr29P1Unm8RyWxL-32" target="rsGOLgr29P1Unm8RyWxL-38">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-32" value="&lt;font style=&quot;font-size: 9px&quot; color=&quot;#007fff&quot;&gt;for datumMap end&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="1680" y="1560.5" width="200" height="19.5" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-37" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;" edge="1" parent="Swqwk-0Pdm74yuupKNYV-1" source="rsGOLgr29P1Unm8RyWxL-38" target="I4dAWADa_2ZqshCw2mCF-4">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1780" y="1640" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-38" value="for datumMap start 又遍历一次" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fontColor=#007FFF;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="1680" y="1600.5" width="200" height="19.5" as="geometry" />
        </mxCell>
        <mxCell id="rsGOLgr29P1Unm8RyWxL-44" value="&lt;font style=&quot;font-size: 9px&quot; color=&quot;#007fff&quot;&gt;for datumMap end&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="1680" y="1720.5" width="200" height="19.5" as="geometry" />
        </mxCell>
        <mxCell id="I4dAWADa_2ZqshCw2mCF-1" value="这里为什么是个队列？" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#007FFF;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="2120" y="1422.25" width="140" height="39.5" as="geometry" />
        </mxCell>
        <mxCell id="I4dAWADa_2ZqshCw2mCF-3" value="第一个条件当不包含这个key说明服务实例有变更" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#007FFF;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="1520" y="1480.5" width="130" height="39.5" as="geometry" />
        </mxCell>
        <mxCell id="I4dAWADa_2ZqshCw2mCF-5" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" edge="1" parent="Swqwk-0Pdm74yuupKNYV-1" source="I4dAWADa_2ZqshCw2mCF-4" target="rsGOLgr29P1Unm8RyWxL-44">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="I4dAWADa_2ZqshCw2mCF-4" value="&lt;div&gt;&lt;font size=&quot;1&quot;&gt;for (RecordListener listener : listeners.get(entry.getKey())) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font size=&quot;1&quot;&gt;&amp;nbsp; &amp;nbsp; listener.onChange(entry.getKey(), entry.getValue().value);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font size=&quot;1&quot;&gt;}&lt;br&gt;dataStore.put(entry.getKey(), entry.getValue());&lt;br&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;align=left;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="1630" y="1640.5" width="300" height="53.25" as="geometry" />
        </mxCell>
        <mxCell id="u3ho21g5NhgYBAJT4E-B-1" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" edge="1" parent="Swqwk-0Pdm74yuupKNYV-1" source="14ZzdMd3coV8cI0hSLZz-0" target="u3ho21g5NhgYBAJT4E-B-0">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="14ZzdMd3coV8cI0hSLZz-0" value="&lt;font color=&quot;#000000&quot;&gt;ServiceManager$onChange(String key, Service service)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fontColor=#007FFF;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="2000" y="1600.5" width="200" height="39.5" as="geometry" />
        </mxCell>
        <mxCell id="u3ho21g5NhgYBAJT4E-B-3" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" edge="1" parent="Swqwk-0Pdm74yuupKNYV-1" source="u3ho21g5NhgYBAJT4E-B-0" target="u3ho21g5NhgYBAJT4E-B-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u3ho21g5NhgYBAJT4E-B-0" value="&lt;font color=&quot;#000000&quot;&gt;putServiceAndInit(service)&lt;/font&gt;&lt;br&gt;跟注册中心新增业务服务实例是一样的" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fontColor=#007FFF;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="2240" y="1600.5" width="140" height="39.5" as="geometry" />
        </mxCell>
        <mxCell id="u3ho21g5NhgYBAJT4E-B-2" value="&lt;font color=&quot;#000000&quot;&gt;putServiceAndInit(service)&lt;/font&gt;&lt;br&gt;跟注册中心新增业务服务实例是一样的" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fontColor=#007FFF;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="2420" y="1601" width="140" height="39.5" as="geometry" />
        </mxCell>
        <mxCell id="fU9LpJNLqezEe8AvTQxP-1" value="？？？代码跟错了？还是说Nacos节点管理和注册中心实例管理是一样的？&lt;br&gt;严重怀疑看错代码了&lt;br&gt;还是得本地搭个集群，调试下看看中间数据" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#007FFF;" vertex="1" parent="Swqwk-0Pdm74yuupKNYV-1">
          <mxGeometry x="2560" y="1580" width="190" height="79" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="VJsHk_5L0xsUDjSNkUBP" name="Nacos-Raft协议原理">
    <mxGraphModel dx="1434" dy="842" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="gBnhPy8Dz_HbGRqAG81q-0" />
        <mxCell id="gBnhPy8Dz_HbGRqAG81q-1" parent="gBnhPy8Dz_HbGRqAG81q-0" />
        <mxCell id="4JI8YmCZhSrTeP3LNC5_-0" value="&lt;h1&gt;Nacos Raft 协议原理（1.4.1）&lt;/h1&gt;&lt;p style=&quot;font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;Raft协议原理演示动画：http://thesecretlivesofdata.com/raft/　（很清晰，５分钟可以完全理解）&lt;br&gt;相比Paxos、ZAB更好理解。&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;Leader选举关键点：每个节点等待Leader连接时超时等待时间是随机的（150-300ms），最早超时的节点作为Leader候选节点向其他节点拉票。万一首轮（term）中两个节点同时最先超时且拉的票都超过一半，会新开一轮重新随机获取一个超时时间，最早超时的节点也作为候选节点和之前的候选节点拉票PK。&lt;/font&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;源码包路径：&lt;/span&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;nacos-core : &lt;/span&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;com.alibaba.nacos.core.distributed.raft&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="gBnhPy8Dz_HbGRqAG81q-1" vertex="1">
          <mxGeometry x="20" y="19" width="460" height="181" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="C0nibZY6vM2-n-i7cBZv" name="ZK-ZAB协议原理">
    <mxGraphModel dx="1098" dy="689" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="aE6XB09Smqo9M96ppP9N-0" />
        <mxCell id="aE6XB09Smqo9M96ppP9N-1" parent="aE6XB09Smqo9M96ppP9N-0" />
        <mxCell id="JVZy7zcXYES6SEFBquC8-0" value="&lt;h1&gt;ZK ZAB 协议原理（）&lt;/h1&gt;&lt;p&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;源码包路径：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="aE6XB09Smqo9M96ppP9N-1">
          <mxGeometry x="20" y="19" width="460" height="181" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="qSAxH0jNmK0XPMDjovVi" name="ETCD协议原理">
    <mxGraphModel dx="1098" dy="689" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="YyF9cl4UstWeF-OzIlqx-0" />
        <mxCell id="YyF9cl4UstWeF-OzIlqx-1" parent="YyF9cl4UstWeF-OzIlqx-0" />
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
